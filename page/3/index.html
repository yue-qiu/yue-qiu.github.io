<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">






























<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="高山仰止，景行行止。虽不能至，心向往之。">
<meta property="og:type" content="website">
<meta property="og:title" content="精神的壳">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="精神的壳">
<meta property="og:description" content="高山仰止，景行行止。虽不能至，心向往之。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="精神的壳">
<meta name="twitter:description" content="高山仰止，景行行止。虽不能至，心向往之。">






  <link rel="canonical" href="http://yoursite.com/page/3/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>精神的壳</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?847f7a1169508eb118c64f7719e8a4cf";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">精神的壳</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/23/字符串编码/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/23/字符串编码/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">字符串编码</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-05-23 22:47:56" itemprop="dateCreated datePublished" datetime="2018-05-23T22:47:56+08:00">2018-05-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-07-18 16:32:51" itemprop="dateModified" datetime="2018-07-18T16:32:51+08:00">2018-07-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/计算机系统/" itemprop="url" rel="index"><span itemprop="name">计算机系统</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/23/字符串编码/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/05/23/字符串编码/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/05/23/字符串编码/" class="leancloud_visitors" data-flag-title="字符串编码">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="不同的编码方式"><a href="#不同的编码方式" class="headerlink" title="不同的编码方式"></a>不同的编码方式</h1><p>由于计算机是美国人发明的，所以最早的时候只收录了127个字符，包括阿拉伯数字、英文字母大小写和一些常用符号，称为<code>ASCII编码</code>。后来计算机越来越普及，127个字符显然不够。于是各国又制定了自己国家的字符编码。为了避免不同国家之间通信出现乱码的问题，一种同一编码<code>unicode编码</code>诞生了。<code>ASCII</code>用一个字节（byte）来储存一个字符，而<code>unicode</code>用2到6个字节来储存字符，理论上所有的文字、符号都可以用<code>unicode编码</code>表示。</p>
<p>但是新的问题又出现了：<code>unicode编码</code>至少会用两个字节来表示一个字符，但是对于一些简单字符如<code>A</code>，<code>@</code>，这样做显然太浪费了，特别是文章中大量使用这种简单字符的时候。一种”可变长编码“应运而生：<code>UTC-8编码</code>。在<code>UTC-8编码</code>中，会为每个字符分配合适的字节数。这样就大大节约了空间，特别适合用于网络传输。在计算机内存中，同一使用<code>unicode</code>，而在网络传输和硬盘保存时，则将<code>unicode</code>转为<code>UTF-8</code>以节省空间。</p>
<h1 id="字符与字节"><a href="#字符与字节" class="headerlink" title="字符与字节"></a>字符与字节</h1><p>在python3中，字符默认以<code>unicode</code>方式编码，而在进行网络传输和硬盘保存时，常常将<code>unicode</code>字符串转成<code>utf-8</code>字节。这就要用到<code>encode()</code>方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'hello world'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'test'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(s.encode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure></p>
<p><code>encode()</code>将字符串转换成字节，而<code>utf-8</code>则指定是以何种编码格式转换。</p>
<p>当我们从网络上获取数据时，常常也是获取到以<code>UTF-8</code>形式编码的字节，为了方便我们对数据进行处理，用<code>decode()</code>方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="string">b'\xe4\xb8\xad\xe6\x96\x87'</span></span><br><span class="line">print(b.decode(<span class="string">'utf-8'</span>)) <span class="comment"># 输出：'中文'</span></span><br></pre></td></tr></table></figure></p>
<p>参数<code>utf-8</code>表明将字节以UTF-8的形式解码。在python中，字节的前面会有个前缀<code>b</code>。</p>
<p><strong>为了避免乱码，应该始终坚持以UTF-8的形式进行字符和字节之间的转换</strong>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/23/unittest单元测试/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/23/unittest单元测试/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">unittest单元测试</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-05-23 17:08:42" itemprop="dateCreated datePublished" datetime="2018-05-23T17:08:42+08:00">2018-05-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-11-27 13:53:49" itemprop="dateModified" datetime="2018-11-27T13:53:49+08:00">2018-11-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/23/unittest单元测试/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/05/23/unittest单元测试/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/05/23/unittest单元测试/" class="leancloud_visitors" data-flag-title="unittest单元测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有个词叫TDD(Tset Driven Development)，测试驱动开发。一个好的开发人员不仅要懂开发，还要懂得一定的测试技巧。python自带了很多的测试库，比如unittest，coverage….介绍一下unittest的使用。</p>
<h1 id="unittests四个重要的概念"><a href="#unittests四个重要的概念" class="headerlink" title="unittests四个重要的概念"></a>unittests四个重要的概念</h1><p>unittest有四个重要的面向对象概念：</p>
<ol>
<li>test fixture。这个概念主要处理测试环境的搭建和清理。很多时候我们在进行测试的时候需要搭建合适的环境，例如创建目录、创建数据库等，而在测试完毕后这些环境又不再需要了。test fixturn可以帮我们很好的处理这些事情。</li>
<li>test case。 既然要进行测试，测试用例当然是最重要的。每一项测试内容都是一个test case。</li>
<li>test suite。我们当然不希望只能一项项的进行测试，最好是将要测试的项目放在一起。test suite相当于test case的集合，当然test suite也能嵌套在test suite中。</li>
<li>test runner。顾名思义，这个概念负责执行测试并控制结果输出。</li>
</ol>
<h1 id="创建testcase"><a href="#创建testcase" class="headerlink" title="创建testcase"></a>创建testcase</h1><p>unittest提供了TastCase类，要创建一个testcase只需要继承这个父类就好了。</p>
<p>先在<code>mathfunc.py</code>编写三个函数用于测试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">minus</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">string</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>
<p>在<code>test_math.py</code>中创建测试用例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mathfunc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> TestCase</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMath</span><span class="params">(TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""测试add函数"""</span></span><br><span class="line">        self.assertTrue(<span class="number">1</span>+<span class="number">2</span>, add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_minus</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""测试minus函数"""</span></span><br><span class="line">        self.assertEqual(<span class="number">2</span><span class="number">-1</span>, minus(<span class="number">2</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_string</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""测试string函数"""</span></span><br><span class="line">        self.assertIn(<span class="string">'h'</span> <span class="keyword">in</span> string(<span class="string">'hello'</span>))</span><br></pre></td></tr></table></figure>
<p>这就创建了一个testcase，包含三个测试。<strong>testcase中所有的测试必须以<code>test</code>开头</strong>。<code>self.assert*()</code>是由TestCase提供的测试函数。每一个测试里的文档会在输出测试报告时显示。不用python内置的assert()是因为uniittest在遇到<code>self.assert*()</code>发生错误时会把这个测试标记为failure，然后继续执行其他测试。</p>
<h1 id="创建testsuite"><a href="#创建testsuite" class="headerlink" title="创建testsuite"></a>创建testsuite</h1><p>有了testcase，自然想把它加入到suite中。unittest提供了<code>TestSuite</code>类来表示一个suite。默认情况下，unittest按测试函数的函数名进行排序，然后按这个排序执行测试。如果我们想控制测试执行顺序，就要在向suite添加case时做点文章：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mathfunc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line">suite = unittest.TestSuite()</span><br><span class="line"><span class="comment"># 传入列表，这样就会按照元素顺序执行测试</span></span><br><span class="line">suite.addTests([TestMath(<span class="string">'test_add'</span>), TestMath(<span class="string">'test_minus'</span>), TestMath(<span class="string">'test_string'</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure></p>
<p>还可以通过unittest提供的TestLoader类来添加testcase，<strong>TestLoader会返回一个suite</strong>。不过<strong>TestLoader无法保证按照顺序执行测试</strong>。TestLoader类提供了一下常用方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> test_math <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三种方法都可以</span></span><br><span class="line">suite.addTests(unittest.TestLoader().loadTestsFromName(<span class="string">'test_math.TestMath'</span>))</span><br><span class="line">suite.addTests(unitest.TestLoader().loadTestsFromNanes([<span class="string">'test_math.TestMath'</span>])</span><br><span class="line">suite.addTests(unitest.TestLoader().loadTestsFromTestCase(TestMath))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果test_math在/usr/test/目录下</span></span><br><span class="line">suite.addTests(unittest.TestLoader().discover(<span class="string">r'/usr/test/'</span>))</span><br><span class="line"><span class="comment"># 可用添加单个testcase</span></span><br><span class="line">suite.addTest(TestMath(<span class="string">'test_add'</span>))</span><br></pre></td></tr></table></figure></p>
<ul>
<li>loadTestsFromName(模块名.testcase名)</li>
<li>loadTestsFromTestCase(testcase名)</li>
<li>discover(start_dir, pattern=’test*.py’, top_level_dir=None)。start_dir是目标文件夹路径，unittest会查找指定目录及子目录下的全部符合pattern的模块并执行里面的TestCase。<strong>电脑中不能有同名的目标文件夹，否则unittest可能无法找到正确的位置</strong>。patter默认是’test*.py’。</li>
</ul>
<h1 id="搭建测试环境"><a href="#搭建测试环境" class="headerlink" title="搭建测试环境"></a>搭建测试环境</h1><p>TaseCase父类提供了<code>setUp()</code>，<code>tearDown()</code>，<code>setUpClass()</code>，<code>tearDownClass()</code>。我们在自己的测试用例中重写就可以了。</p>
<p>setUp()与tearDown()会在每个测试之前执行。setUp()负责搭建测试环境，tearDown()负责清理环境。如果setUp()执行失败那么这次测试不会进行，如果setUp()成功执行那么不管测试是否成功tearDown()都会执行。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> manage <span class="keyword">import</span> create_app, db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBasic</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.app = create_app(<span class="string">'TESTING'</span>)</span><br><span class="line">        self.app_context = self.app.app_context()</span><br><span class="line">        self.app_context.push()</span><br><span class="line">        self.client = self.app.test_client(use_cookies=<span class="keyword">True</span>)</span><br><span class="line">        db.create_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(self)</span>:</span></span><br><span class="line">        db.session.remove()</span><br><span class="line">        db.drop_all()</span><br><span class="line">        self.app_context.pop()</span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<p>如果想要在所以case之前执行一次环境准备，所有case之后清理环境，可用<code>setUpClass()</code>和<code>tearDownClass()</code>。不过要带上<code>@classmethod</code>装饰器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> manage <span class="keyword">import</span> create_app, db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBasic</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(cls)</span>:</span></span><br><span class="line">        cls.app = create_app(<span class="string">'TESTING'</span>)</span><br><span class="line">        cls.app_context = cls.app.app_context()</span><br><span class="line">        cls.app_context.push()</span><br><span class="line">        cls.client = cls.app.test_client(use_cookies=<span class="keyword">True</span>)</span><br><span class="line">        db.create_all()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(cls)</span>:</span></span><br><span class="line">        db.session.remove()</span><br><span class="line">        db.drop_all()</span><br><span class="line">        cls.app_context.pop()</span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure></p>
<h1 id="执行测试及控制输出"><a href="#执行测试及控制输出" class="headerlink" title="执行测试及控制输出"></a>执行测试及控制输出</h1><p>通常我们使用<code>unittest.main()</code>就会调用Test Runner开始测试。当然也可以手动执行Runner。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    runner = unittest.TextTest.Runner(verbosity=<span class="number">2</span>)</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure></p>
<p>verbosity设定了测试报告的详细程度，有0，1，2三种。默认值是1，数字越大越详细。</p>
<p>也可以把输出写到文件里,将文件指针传给Runner()里的<code>stream</code>参数就可以了：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'/usr/test/report'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    runner = unittest.TextTest.Runner(verbosity=<span class="number">2</span>, stream=f)</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure></p>
<h1 id="跳过测试"><a href="#跳过测试" class="headerlink" title="跳过测试"></a>跳过测试</h1><p>unittest提供3种跳过测试的装饰器：skip([reason])、skipIf(condtion[,reason])，skipUnless(conditon[,reason])。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mathfunc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMath</span><span class="params">(unittest.TestCase)</span>:</span></span><br><span class="line"><span class="meta">    @unittest.skip('跳过add函数')</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertTrue(<span class="number">1</span>+<span class="number">2</span>, add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_minus</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(<span class="number">2</span><span class="number">-1</span>, minus(<span class="number">2</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_string</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertIn(<span class="string">'h'</span> <span class="keyword">in</span> string(<span class="string">'hello'</span>))</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/23/git常见用法/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/23/git常见用法/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">git常见用法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-05-23 06:45:34" itemprop="dateCreated datePublished" datetime="2018-05-23T06:45:34+08:00">2018-05-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-12-12 00:10:04" itemprop="dateModified" datetime="2018-12-12T00:10:04+08:00">2018-12-12</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/23/git常见用法/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/05/23/git常见用法/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/05/23/git常见用法/" class="leancloud_visitors" data-flag-title="git常见用法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用git也有一段时间了，一直没有做总结，在这里记录一下方便以后查看。</p>
<h1 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h1><p>windows下直接从<a href="https://git-scm.com/downloads" target="_blank" rel="noopener">官网</a>下载就可以了，安装过程是傻瓜式的，一路点确定就OK。安装完成后发现多了个叫<code>git bash</code>的程序，打开程序会弹出一个命令行窗口就可以了。</p>
<p>linux下安装git很简单，直接在终端输入<code>git</code>，系统会告诉你是否已经安装。如果没有安装还会告诉你安装方法。Debian和Ubantu下通过<code>sudo apt-get install git</code>就可以进行安装。</p>
<h1 id="配置git"><a href="#配置git" class="headerlink" title="配置git"></a>配置git</h1><p>由于git是分布式版本控制系统，所以必须指出每台机器的身份。这就要配置git相关变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.username &quot;name&quot;</span><br><span class="line">git config --global user.email &quot;email&quot;</span><br></pre></td></tr></table></figure></p>
<p>有时候我们发现自己的账户和邮箱配置错了，重设我们的账户和邮箱：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --replace-all user.username &quot;new name&quot;</span><br><span class="line">git config --global --replace-all user.email &quot;new email&quot;</span><br></pre></td></tr></table></figure></p>
<h1 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h1><p><code>cd</code>到目标文件夹下，打开<code>git bash</code>或在终端输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure></p>
<p>这就创建了一个版本库，<strong>有了版本库就可以开始使用git的各项功能了</strong>。</p>
<h1 id="git分区"><a href="#git分区" class="headerlink" title="git分区"></a>git分区</h1><p>git有分区的概念，平时我们新建、删除、修改文件都是在工作区，通过<code>git add</code>命令把工作区的变动提交到暂存区(stage)，再用<code>git commit</code>把stage的内容提交到分支。<br><img src="http://p1csf090h.bkt.clouddn.com/git/git%E5%8E%9F%E7%90%86.jpg" alt=""></p>
<h1 id="查看git状态"><a href="#查看git状态" class="headerlink" title="查看git状态"></a>查看git状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status #查看当前仓库的状态（是否有文件被修改，有文件没有commit等）</span><br><span class="line">git diff file #用于比较工作区版本与缓存区版本的不同</span><br></pre></td></tr></table></figure>
<p><img src="http://p1csf090h.bkt.clouddn.com/git/status.png" alt=""><br>git指出有一个modified：learngit.txt,且not staged(没有提交至暂存区)</p>
<h1 id="添加远程仓库"><a href="#添加远程仓库" class="headerlink" title="添加远程仓库"></a>添加远程仓库</h1><p>想把github中的仓库和本地仓库关联起来，就要先在github中添加这台机器的ssh。可以通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;email&quot;</span><br></pre></td></tr></table></figure>
<p>来获得本机的ssh密钥，这条命令会在当前文件夹下生成<code>.ssh</code>文件夹，里面有两个文件：<code>id_rsa</code>和<code>id_rsa.pub</code>。带pub的是公钥，把<code>id_rsa.pub</code>里的内容添加到github上。</p>
<h1 id="远程仓库与本地仓库"><a href="#远程仓库与本地仓库" class="headerlink" title="远程仓库与本地仓库"></a>远程仓库与本地仓库</h1><p>通过这条命令可以实现，”url”是远程仓库的网址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &quot;url&quot;</span><br></pre></td></tr></table></figure></p>
<p>origin就是这个git本地仓库对远程仓库的称呼，也可以用别的名字，但是通常都用origin。</p>
<p>删除本地仓库与远程仓库的关联也很简单：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote remove origin</span><br></pre></td></tr></table></figure></p>
<h1 id="把本地库内容推送到远程"><a href="#把本地库内容推送到远程" class="headerlink" title="把本地库内容推送到远程"></a>把本地库内容推送到远程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure>
<p>如果是第一次推送，可以为push加上<code>-u</code>参数，这样以后推送的时候就不用再输入github的账号和密码了。<br>master代表远程仓库的主分支，如果要推送到其他分支就换成其他分支名。</p>
<h1 id="抓取远程库内容"><a href="#抓取远程库内容" class="headerlink" title="抓取远程库内容"></a>抓取远程库内容</h1><p>抓取远程仓库内容并merge到本地<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin</span><br></pre></td></tr></table></figure></p>
<h1 id="克隆一份仓库"><a href="#克隆一份仓库" class="headerlink" title="克隆一份仓库"></a>克隆一份仓库</h1><p>有时候我们在github上可能看到一些很有意思的库，可以用这个命令把它下载到本地，其中”url”是这个仓库的网址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone &quot;url&quot;</span><br></pre></td></tr></table></figure></p>
<h1 id="显示过往提交记录"><a href="#显示过往提交记录" class="headerlink" title="显示过往提交记录"></a>显示过往提交记录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git log # 显示提交日志，每次提交会有一个专属的版本号，通过版本号可回溯至本次提交</span><br><span class="line">git log --pretty=oneline # 在log显示信息过乱时可以加 --pretty=online参数，只显示提交记录及其版本号</span><br></pre></td></tr></table></figure>
<p><img src="http://p1csf090h.bkt.clouddn.com/git/log.png" alt=""><br>HEAD表示这是当前版本，可以用HEAD^表示上一版本，HEAD^表示上上版本…HEAD~100表示第前100个版本。</p>
<h1 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h1><p>使用git的一个主要好用就是git提供方便的版本控制，可以在需要的时候回退到任意版本。</p>
<p>版本回退命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard &apos;版本号&apos;</span><br></pre></td></tr></table></figure></p>
<p>版本号可以用<code>git log</code>查询，结合这两个命令就可以实现版本回退啦~</p>
<p>但是这里有个问题：当我们回到历史版本后，<code>git log</code>命令就无法显示最新版本的版本号。相当于我们穿越到过去，却没办法回来了。幸好<code>git relog</code>命令可以解决这个问题，<code>git relog</code>记录了每一次命令：<br><img src="http://p1csf090h.bkt.clouddn.com/git/relog.png" alt=""></p>
<p>在这个例子中，可以通过<code>git reset --hard 78ab7e9</code>从be2a4ae回退到78ab7e9版本。</p>
<h1 id="管理修改"><a href="#管理修改" class="headerlink" title="管理修改"></a>管理修改</h1><p>有时我们修改了工作区或暂存区的文件，过了一会儿又后悔了，可以用下面的命令撤销这些修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout file</span><br></pre></td></tr></table></figure></p>
<p>如果文件已经commit到了暂存区，想要把它从暂存区里撤下来也是可以的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD file</span><br></pre></td></tr></table></figure></p>
<h1 id="处理冲突"><a href="#处理冲突" class="headerlink" title="处理冲突"></a>处理冲突</h1><p>在合并分支时，可能会遇到两个分支的内容有冲突而导致合并失败的现象（这在执行pull操作时尤其常见，特别是当你在github上在线修改了一个文件，而本地没有修改时）。git会在冲突文件中用&lt;&lt;&lt;&lt;&lt;&lt;&lt;，=======，&gt;&gt;&gt;&gt;&gt;&gt;&gt;标记出不同内容的分支。我们需要将文件进行修改后再执行<code>git commit</code>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 可以看到，两个分支冲突了</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;HEAD</span><br><span class="line">git is good</span><br><span class="line">=======</span><br><span class="line">git is very good</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;branch</span><br><span class="line"></span><br><span class="line"># 将文件修改一下</span><br><span class="line">git is very good</span><br><span class="line"></span><br><span class="line"># 提交</span><br><span class="line">git add test.txt</span><br><span class="line">git commit -m &quot;解决冲突&quot;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/29/Nginx与gunicorn/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/04/29/Nginx与gunicorn/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">Nginx与gunicorn</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-04-29 12:18:57 / 更新于：20:48:39" itemprop="dateCreated datePublished" datetime="2018-04-29T12:18:57+08:00">2018-04-29</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/29/Nginx与gunicorn/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/04/29/Nginx与gunicorn/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/04/29/Nginx与gunicorn/" class="leancloud_visitors" data-flag-title="Nginx与gunicorn">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="gunicorn"><a href="#gunicorn" class="headerlink" title="gunicorn"></a>gunicorn</h1><p>众所周知，Web应用最后是要放到网络上的。而我们平时写的Web应用只是一个应用而已，想要把应用放到网络上，成为server，我们就需要有服务器来对http请求进行解析，这样才能让别人访问我们的Web应用。对于Python应用来说gunicorn就是这样一个网关服务器，运行在linux平台，遵循WGSI协议。其性质类似于java里的Tomcat。通常，我们把写好的Web应用放在gunicorn里，这样别人向gunicorn发出请求，再由gunicorn根据Web应用对请求做出响应并返回，就完成了一次访问-响应过程。<br><img src="http://p1csf090h.bkt.clouddn.com/%E6%9C%8D%E5%8A%A1%E5%99%A8/gunicorn.jpg" alt=""><br>安装gunicorn的方式很简单：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gunicorn</span><br></pre></td></tr></table></figure></p>
<p>要使用gunicorn，常用的命令是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn [-option] module:application</span><br></pre></td></tr></table></figure></p>
<p>常用的option有：</p>
<ul>
<li>-w w是worker的简写。在多核服务器上，为了支持更多的并发访问并充分利用资源，使用更多的进程，我们就可以指定worker数量，比如指定 <code>-w 4</code>就可以启动4个进程同时处理http请求,提高系统的效率及性能。</li>
<li>-b b是bind的简写。绑定gunicorn监听端口。如<code>-b 0.0.0.0:5000</code>会在公网上运行你的Web应用，通过访问<code>公网ip:5000</code>就可以访问你的Web应用。</li>
<li>-k  gunicorn默认使用同步阻塞的网络模型(-k sync)，对于大并发的访问可能表现不够好，它还支持其它更好的模式，比如：gevent，gevent是一个基于libev的并发库，它为各种并发和网络相关的任务提供了整洁的API。gunicorn对于“协程”也就是Gevent的支持非常好。通过<code>-k gevent</code>的方式就可以指定使用gevent。<strong>gevent需要另外安装</strong></li>
</ul>
<p>module是应用所在的模块名，application当然就是你的Web应用名。</p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>Nginx是高性能的Web服务器，性能好，高并发，可以做负载均衡，也是常用的反向代理服务器。那个首先要弄清楚两个问题：什么是反向代理，什么是负载均衡呢？  </p>
<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2><p>反向代理的代理对象是服务器。也意味着用户做服务器域名解析时，解析得到的IP其实是负载均衡的IP，而不是服务器的IP，这样有一个好处是，当新加入/移走服务器时，仅仅需要修改负载均衡的服务器列表，而不会影响现有的服务。比如当我们访问<a href="https://www.baidu.com" target="_blank" rel="noopener">百度</a>时，我们会获得百度返回的html，css，js，img等资源，而这些资源很可能不是放在同一个服务器上的，换言之，你以为你是访问<a href="https://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a>后，从这个域名绑定的服务器上获得这些资源，就像这样：<br><img src="http://p1csf090h.bkt.clouddn.com/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E7%99%BE%E5%BA%A6%E6%97%A0%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.jpg" alt=""><br>但其实这个服务器只是一个中介，它连接了很多很多的服务器，当它收到请求后，从各个服务器上获取相应的资源，再把这些资源返回给你。这样就能大大减轻每一个服务器的压力，就像这样：<br><img src="http://p1csf090h.bkt.clouddn.com/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E7%99%BE%E5%BA%A6%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.jpg" alt="">  </p>
<h2 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h2><p>有反向代理，自然就有正向代理。所谓正向代理，代理对象是客户端。比如你在科学上网的时候，想要访问<a href="https://www.google.com" target="_blank" rel="noopener">谷歌</a>，你的访问请求会被发到海外的代理服务器上，由这个代理服务器向谷歌发出请求，再把谷歌的响应返回到你的客户端上。这个过程就是正向代理，而你的客户端就是代理对象。<br><br><br>总而言之，反向代理与正向代理关系就像这样：<br><img src="http://p1csf090h.bkt.clouddn.com/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.jpg" alt="">  </p>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>关于负载均衡，知乎上有一篇很不错的介绍文章:<a href="https://zhuanlan.zhihu.com/p/32841479" target="_blank" rel="noopener">什么是负载均衡</a>。  </p>
<p>了解了一些基本知识后，让我们回到Nginx。通常，我们不会让用户直接访问gunicorn，而是在gunicorn上套一层Nginx。这首先是因为gunicorn对静态资源的加载不好，这时使用Nginx缓存静态资源可以明显提高用户体验。其次，有了这样一层服务器做缓冲，我们可以保留80端口，可以在后端部署一大堆服务器，万一有一台服务器宕机了，只要在负载列表中把这台机子down掉，再加一台新的就可以了。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/31/《MySQL从入门到精通》之基本语句/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/31/《MySQL从入门到精通》之基本语句/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">MySQL之基础语法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-03-31 21:15:37" itemprop="dateCreated datePublished" datetime="2018-03-31T21:15:37+08:00">2018-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-12-11 22:22:32" itemprop="dateModified" datetime="2018-12-11T22:22:32+08:00">2018-12-11</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/31/《MySQL从入门到精通》之基本语句/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/03/31/《MySQL从入门到精通》之基本语句/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/03/31/《MySQL从入门到精通》之基本语句/" class="leancloud_visitors" data-flag-title="MySQL之基础语法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据库常用对象"><a href="#数据库常用对象" class="headerlink" title="数据库常用对象"></a>数据库常用对象</h1><p>在MySQL中，表、视图、存储过程和索引等具体存储数据或对数据进行操作的实体都被称为数据库对象。</p>
<h2 id="表"><a href="#表" class="headerlink" title="表"></a>表</h2><p>表是包含数据库中所有数据的数据库对象，由行和列组成，用于组织和存储数据类型</p>
<h2 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h2><p>表中每列被称为一个字段，字段具有自己的属性，如字段类型、字段大小等。其中，字段类型是字段最重要的属性，它决定了字段能存储哪种数据。</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引是一个单独的、物理的数据结构。它是依赖于表建立的，在数据库中索引使用数据库程序无需对整个表进行扫描就可以在其中找到所需的数据。</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是从一张或多张表中导出的表（也称虚拟表），是用户查看数据的一种方式，表中包括几个被定义的数据列与数据行，其结构和数据建立在对表的查询基础之上。</p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>存储过程是一组为了完成特定功能的SQL语句集合（包括查询、插入、删除、更新等操作），经编译后以名称的形式存储在SQL Server服务端的数据库中，由用户通过指定存储过程的名字来执行对应的存储操作。</p>
<h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><p>存储引擎其实就是如何在存储数据，如何为存储的数据建立索引和如何更新、查询数据等技术的实现方法。MySQL支持很多表，每种类型都有自己的特定作用、优点和缺点。MySQL还相应提供了很多不同的存储引擎，可以以最适合于应用需求的方式存储数据。</p>
<h2 id="存储引擎的概念"><a href="#存储引擎的概念" class="headerlink" title="存储引擎的概念"></a>存储引擎的概念</h2><p>MySQL中的数据用各种不同的技术存储在文件或内存中，这些技术采用不同的存储机制、索引技巧、锁定水平并最终提供广泛的、不同的功能和能力。通过选择不同的技术，能够获取额外的速度或者功能，从而改善应用的整体功能。</p>
<h2 id="查询当前数据库的引擎"><a href="#查询当前数据库的引擎" class="headerlink" title="查询当前数据库的引擎"></a>查询当前数据库的引擎</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%storage_engine%'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><p>InnoDB支持自动增长列：<code>AUTO_INCREMENT</code>。自动增长列的值不能为空，且值必须唯一。<strong>MySQL中规定自动增长列必须为主键</strong>，在插入值时，如果自动增长列不输入值或插入的值为0、null，则插入的值为自动增长后的值。</p>
<p>InnoDB支持外键（foreign key）。外键所在表为子表，外键所依赖的表为父表。<strong>父表中被子表外键关联的字段必须为主键</strong>。当修改父表的某天信息时，子表也必须有相应的改变。</p>
<p>InnoDB是如下情况的理想引擎：  </p>
<ol>
<li>更新密集的表。InnnoDB特别适合处理多重并发的更新请求</li>
<li>事务。InnoDB是唯一支持事务的标志MySQL存储引擎。在管理敏感数据（如用户注册）时特别有用</li>
<li>自动灾难修复。与其他引擎不同，InnoDB能自动从灾难中恢复，虽然MyISAM也能做到但是其过程要长得多</li>
</ol>
<h2 id="MyISAM引擎"><a href="#MyISAM引擎" class="headerlink" title="MyISAM引擎"></a>MyISAM引擎</h2><p>MyISAM引擎的优点在于占用空间小，处理速度快；缺点是不支持事务的完整性和并发性。</p>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>MySQL支持5中基本字段类型：数值型，字符型，文本型，逻辑型和日期时间型。</p>
<h2 id="数值型"><a href="#数值型" class="headerlink" title="数值型"></a>数值型</h2><p>MySQL支持所有标准SQL数值数据类型。这些数值类型包括严格数值数据类型(INTEGER、SMALLINT、DECIMAL和NUMERIC)，以及近似数值数据类型(FLOAT、REAL和DOUBLE PRECISION)。<br>关键字INT是INTEGER的同义词，关键字DEC是DECIMAL的同义词。</p>
<h3 id="整数型"><a href="#整数型" class="headerlink" title="整数型"></a>整数型</h3><p><img src="http://ke.dajiangtai.com/content/411/1.png" alt=""></p>
<h3 id="浮点数型"><a href="#浮点数型" class="headerlink" title="浮点数型"></a>浮点数型</h3><p><img src="http://ke.dajiangtai.com/content/411/2.png" alt=""></p>
<h2 id="时间日期型"><a href="#时间日期型" class="headerlink" title="时间日期型"></a>时间日期型</h2><p>表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR。</p>
<p>每个时间类型有一个有效值范围和一个”零”值，当指定不合法的MySQL不能表示的值时使用”零”值。</p>
<p>TIMESTAMP类型有专有的自动更新特性。</p>
<p><img src="http://ke.dajiangtai.com/content/411/3.png" alt="时间日期类型"></p>
<h2 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h2><p>字符串类型指CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM和SET。</p>
<p><img src="http://ke.dajiangtai.com/content/411/4.png" alt="字符串类型"></p>
<p>CHAR和VARCHAR类型类似，但它们保存和检索的方式不同。它们的最大长度和是否尾部空格被保留等方面也不同。在存储或检索过程中不进行大小写转换。</p>
<p>创建表时，使用字符串类型时应遵循以下原则：  </p>
<ol>
<li>从速度方面考虑，要选择固定的列，可以使用CHAR类型</li>
<li>要节省空间，使用动态的列，可以使用VARCHAR类型</li>
<li>要将列中的内容限制在一种选择，可以用ENUM类型</li>
<li>允许一个列中有多于一个的条目，可以用SET类型</li>
</ol>
<h2 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h2><p>其实MySQL里根本没有布尔型，虽然可以用<code>boolean</code>但实际上MySQL会把它替换成<code>tinyint(1)</code>。用1或True表示真，0或False表示假。</p>
<h1 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h1><p>使用数据库，首先要会SQL语句。下列SQL语句中，带<code>{}</code>的是必选项，<code>[]</code>是可选项，<code>[default]</code>表示可选并有默认值的选项，<code>|</code>表示或。sql语句以<code>;</code>结尾，也可以用<code>\g</code>或<code>\G</code>，<code>\g</code>与<code>;</code>是相同的，而<code>\G</code>可以让结果显示更美观。</p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> [<span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span>] 数据库名</span><br><span class="line">[<span class="keyword">default</span>]<span class="built_in">character</span> <span class="keyword">set</span> [=] 字符集名;</span><br></pre></td></tr></table></figure>
<p><code>character set</code>默认情况下是MySQL服务器配置文件里的字符集。可以是GB2312或GBK（简体中文）、UTF8（针对Unicode的可变长度的字符编码，又称万国码）、BIG5（繁体中文）、Latin1（拉丁文）等，最常见的就是GBK和UTF8。</p>
<h2 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">database</span> [<span class="keyword">like</span> <span class="string">'模式'</span>];</span><br></pre></td></tr></table></figure>
<p>查看所有数据库，<code>like</code>用于指定匹配模式（支持正则）。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">database</span> <span class="keyword">like</span> <span class="string">'db_%'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名;</span><br></pre></td></tr></table></figure>
<p>使用<code>use</code>语句将数据库指定为当前数据库后，当前数据库在当前工作会话关闭（即断开与该数据库的连接）或再次使用<code>use</code>语句指定数据库时结束工作状态。</p>
<h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> [<span class="keyword">if</span> <span class="keyword">exists</span>] 数据库名;</span><br></pre></td></tr></table></figure>
<p><code>if exists</code>在删除数据库前先判断数据库是否已经存在，只有已经存在是才会执行删除操作，这样可以避免删除不存在的数据库时产生异常。</p>
<h2 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">temporary</span>] <span class="keyword">table</span> [<span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span>] 数据表名</span><br><span class="line">(&#123;create_defination[,create_defination]&#125;) [table_options] [select_statement];</span><br></pre></td></tr></table></figure>
<p>说明：  </p>
<ol>
<li>temporary：创建一个临时表</li>
<li>if not exists：避免表存在时出错</li>
<li>create_defination：定义表的列属性</li>
<li>table_options：表的一些特性参数，涉及表数据如何存储。如engine选项：engine=MyISAM。</li>
<li>select_statement：select语句描述部分，用它可以快速创建表</li>
</ol>
<p>create_defination格式：</p>
<blockquote>
<p>col_name type [not null | null] [default default_value] [auto_increment] [primary key] [reference_defination]</p>
</blockquote>
<p>下面是例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint <span class="keyword">not</span> <span class="literal">null</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="查看表结构"><a href="#查看表结构" class="headerlink" title="查看表结构"></a>查看表结构</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;describe | desc&#125; 数据表名 [列名];</span><br></pre></td></tr></table></figure>
<h2 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h2><p>修改表结构指增加或删除字段、修改字段名称或字段类型、设置取消主键外键、设置取消索引等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 数据表名 alter_spec[,alter_spec] | table_options</span><br></pre></td></tr></table></figure>
<p>alter_spec:  </p>
<ul>
<li>add create_defination[first | after column_name] //添加新字段</li>
<li>add index [index_name] (index_col_name) //添加索引名称</li>
<li>add primary key (index_col_name) //添加主键名称</li>
<li>add unique [index_name] (index_col_name) //添加唯一索引</li>
<li>alter col_name {set default 默认值 | drop default} //修改字段默认值</li>
<li>change old_col_name create_defination //修改字段名、类型</li>
<li>modify col_name create_defination //修改字段定义</li>
<li>drop col_name //删除字段</li>
<li>drop index index_name //删除索引</li>
<li>rename as new_tab_name //修改表名</li>
</ul>
<p><strong><code>alter table</code>语句允许指定多个动作，其动作间用逗号分隔，每个动作表示一个修改。</strong></p>
<h3 id="添加新字段及修改字段定义"><a href="#添加新字段及修改字段定义" class="headerlink" title="添加新字段及修改字段定义"></a>添加新字段及修改字段定义</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">add</span> email <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">after</span> location,</span><br><span class="line"><span class="keyword">modify</span> <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h3 id="修改字段名"><a href="#修改字段名" class="headerlink" title="修改字段名"></a>修改字段名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">change</span> <span class="keyword">user</span> username varhcar(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h3 id="删除字段"><a href="#删除字段" class="headerlink" title="删除字段"></a>删除字段</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">drop</span> email;</span><br></pre></td></tr></table></figure>
<h3 id="修改表名"><a href="#修改表名" class="headerlink" title="修改表名"></a>修改表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">rename</span> the_users;</span><br></pre></td></tr></table></figure>
<h2 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h2><p>在一张已存在的数据表的基础上创建一份该表的备份，也就是复制表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [<span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span>] 数据表名 <span class="keyword">like</span> 源数据表名;</span><br></pre></td></tr></table></figure>
<p>使用该语法复制数据表时，将创建一个与源数据表相同结构的新表，该数据表的别名、数据类型和索引都将被复制，但是表的内容是不会被复制的。因此，创建的表是一张<strong>空表</strong>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> <span class="keyword">like</span> the_users;</span><br></pre></td></tr></table></figure>
<p>如果在复制表格式的同时也想复制表中的内容，可以使用<code>as</code>（查询表达式）字句实现：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> <span class="keyword">as</span> <span class="keyword">select</span> * <span class="keyword">from</span> the_users;</span><br></pre></td></tr></table></figure>
<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> [<span class="keyword">if</span> <span class="keyword">exists</span>] 数据表名;</span><br></pre></td></tr></table></figure>
<p>可同时删除多张表，多个表之间用逗号<code>,</code>连接。</p>
<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> [<span class="keyword">low_priority</span> | <span class="keyword">delayed</span> | <span class="keyword">high_priority</span>] [<span class="keyword">ignore</span>]</span><br><span class="line">[<span class="keyword">into</span>] 数据表名 [(字段名)] <span class="keyword">values</span> (&#123;值 | <span class="keyword">default</span>&#125;),(...),...</span><br></pre></td></tr></table></figure>
<ul>
<li>[low_priority | delayed | high_priority]：<code>low_priority</code>是<code>insert</code>、<code>delete</code>、<code>update</code>都可选的操作，降低<code>insert</code>、<code>delete</code>、<code>update</code>的优先级。<code>delayed</code>是<code>insert</code>语句支持的一种可选修饰符，用于指定MySQL服务器把待插入的行数据放在一个缓冲器中，直到待插数据的表空闲时，才真正的在表中插入数据行。<code>high_priority</code>是<code>insert</code>和<code>select</code>语句支持的一种可选修饰符，用于指定<code>insert</code>和<code>select</code>操作优先执行。</li>
<li>[ignore]： 在执行<code>insert</code>语句时，所出现的错误都会被当做警告</li>
<li>[into]： 指定被操作的数据表</li>
<li>[(字段名,…)]： 当不指定该选项时，表示要向表中所有列插入数据，否则表示向数据表的指定列插入数据。</li>
<li>({值 | default}),(…),…：用于指定需要插入的数据清单，其<strong>顺序必须与字段的顺序相对应</strong>。其中的每一列的数据可以是一个变量、常量、表达式或者null。但是其<strong>数据类型要与对应的字段类型相匹配</strong>；也可以使用<code>default</code>关键字，表示为该列插入默认值，但是前提是已经明确指定了默认值，否则会出错。</li>
</ul>
<h3 id="插入完整数据"><a href="#插入完整数据" class="headerlink" title="插入完整数据"></a>插入完整数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">'qiuyue'</span>, <span class="number">19</span>);</span><br></pre></td></tr></table></figure>
<h3 id="插入数据记录的一部分"><a href="#插入数据记录的一部分" class="headerlink" title="插入数据记录的一部分"></a>插入数据记录的一部分</h3><p>只插入表的一行中的某几个字段的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (<span class="keyword">name</span>, age) <span class="keyword">values</span> (<span class="string">'qiuyue'</span>, <span class="number">19</span>);</span><br></pre></td></tr></table></figure>
<p>MySQL支持同时插入多行数据，不同行的数据之间用<code>,</code>分割。</p>
<h3 id="插入查询结果"><a href="#插入查询结果" class="headerlink" title="插入查询结果"></a>插入查询结果</h3><p>MySQL支持将查询结果插入到数据表中。可以通过<code>insert...select...</code>实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> [<span class="keyword">low_priority</span> | <span class="keyword">high_priority</span>] [<span class="keyword">ignore</span>]</span><br><span class="line">[<span class="keyword">into</span>] 数据表名 [(字段名,...)]</span><br><span class="line"><span class="keyword">select</span> ...;</span><br></pre></td></tr></table></figure>
<ul>
<li>[(字段名,…)]： 当不指定该选项时，表示要向表中所有列插入数据，否则表示向数据表的指定列插入数据。</li>
<li>select字句：用于快速地从一个或多个表中取出数据，并将这些数据作为行数据插入到目标数据表中。<strong><code>select</code>字句返回的结果集中的字段数量、字段类型必须与目标数据表完全一致。</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> (username,age) <span class="keyword">select</span> username,age <span class="keyword">from</span> students;</span><br></pre></td></tr></table></figure>
<h2 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h2><p>执行修改操作可以用<code>update</code>语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 数据表名</span><br><span class="line"><span class="keyword">set</span> 字段<span class="number">1</span>=值<span class="number">1</span>[,字段<span class="number">2</span>=值<span class="number">2</span> ...]</span><br><span class="line">[<span class="keyword">where</span> 条件表达式] [<span class="keyword">order</span> by...] [<span class="keyword">limit</span> 行数]</span><br></pre></td></tr></table></figure>
<ul>
<li>set： 指定表中要修改的字段名及字段值，其中的值可以是表达式，也可以是该字段所对应的默认值。如果指定默认值，那么使用关键字<code>default</code>指定。</li>
<li>where: 用于限定表中要修改的行，如果不指定该字句那么<code>update</code>会更新所有行</li>
<li>[order by] : 用于限定表中的行的被修改的次序。</li>
<li>[limit] : 限定被修改的行数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">users</span> <span class="keyword">set</span> username=<span class="string">'qiuyue'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 数据表名</span><br><span class="line">[<span class="keyword">where</span> 条件表达式] [<span class="keyword">order</span> by...] [<span class="keyword">limit</span> 行数];</span><br></pre></td></tr></table></figure>
<p><strong>如果没有指定<code>where</code>条件，将删除所有记录</strong>。<br>一般删除条件为数据的id，以避免一些错误的发生。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>如果要删除所有行，还可以使用<code>truncate table</code>语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> [<span class="keyword">table</span>] 数据表名</span><br></pre></td></tr></table></figure>
<p><code>truncate</code>会<strong>删除数据表中所有数据且无法恢复</strong>。<br><code>delete</code>与<code>truncate</code>区别如下：</p>
<ol>
<li>使用<code>turncate</code>语句会重新设置<code>auto_increment</code>计数器的初始值</li>
<li>对于参与了索引和视图的表不能使用<code>truncate</code>语句</li>
<li><code>truncate</code>比<code>delete</code>使用的系统和事物资源少。每删除一条记录<code>delete</code>语句都会添加一条日志，而<code>truncate</code>只再事物日志中记录页的释放。</li>
</ol>
<h2 id="查询语句"><a href="#查询语句" class="headerlink" title="查询语句"></a>查询语句</h2><p><code>select</code>语句基本语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> selection_list //要查询的内容，选择哪些列</span><br><span class="line"><span class="keyword">from</span> 数据表名 //指定数据表</span><br><span class="line"><span class="keyword">where</span> primary_constraint //查询时要满足的条件</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sroting_cloumns //如何对结果进行排序</span><br><span class="line"><span class="keyword">having</span> secondary_constraint //查询时满足的第二条件</span><br><span class="line"><span class="keyword">limit</span> <span class="keyword">count</span> //限定输出的查询结果数</span><br></pre></td></tr></table></figure>
<h3 id="查询一张表的一列或多列"><a href="#查询一张表的一列或多列" class="headerlink" title="查询一张表的一列或多列"></a>查询一张表的一列或多列</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span>; //查询users表所有内容</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,age <span class="keyword">from</span> <span class="keyword">users</span>; //查询users表id列和age列所有内容</span><br></pre></td></tr></table></figure>
<h3 id="从多个表中获取数据"><a href="#从多个表中获取数据" class="headerlink" title="从多个表中获取数据"></a>从多个表中获取数据</h3><p>使用<code>select</code>语句进行多表查询，需要确定所查询的数据在哪个表中，多个表之间用<code>,</code>分隔：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> users.id,users.name,student.id,student.name</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">users</span>,student;</span><br></pre></td></tr></table></figure>
<p>还可以在<code>where</code>子句中用连接符<code>=</code>来确定表之间的联系。然后根据这个条件返回查询结果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> users.name,student.location <span class="keyword">from</span> <span class="keyword">users</span>,studnet <span class="keyword">where</span> users.id=student.id <span class="keyword">and</span> users.id=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><code>users.id=student.id</code>表示将<code>users</code>和<code>student</code>两张表根据<code>users.id=stduent.id</code>的条件连接起来，叫做等同连接。如果不使用<code>users.id=stduent.id</code>那么产生的结果是两张表的笛卡尔积，叫全连接。</p>
<h3 id="带关键字in的查询"><a href="#带关键字in的查询" class="headerlink" title="带关键字in的查询"></a>带关键字in的查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 字段 [<span class="keyword">not</span>] <span class="keyword">in</span> (元素<span class="number">1</span>，元素<span class="number">2</span> ...);</span><br></pre></td></tr></table></figure>
<p>关键字<code>in</code>可以判断某个字段的值是否在指定的集合中，如果在该记录会被查询出来：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,age <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">in</span> (<span class="string">'Mike'</span>, <span class="string">'David'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="带关键字between…and…的范围查询"><a href="#带关键字between…and…的范围查询" class="headerlink" title="带关键字between…and…的范围查询"></a>带关键字between…and…的范围查询</h3><p><code>between and</code>是前闭后闭的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">between</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">7</span>;</span><br></pre></td></tr></table></figure>
<h3 id="带like的字符匹配查询"><a href="#带like的字符匹配查询" class="headerlink" title="带like的字符匹配查询"></a>带like的字符匹配查询</h3><p>通过<code>like</code>可以实现模糊查询，它有两种通配符<code>%</code>和<code>_</code>:</p>
<ol>
<li><code>%</code>可以匹配0个或多个字符，可以代表任意长度的字符串。如<code>&quot;Mi%ke&quot;</code>可以匹配<code>Mike</code>，<code>Miosfke</code>等</li>
<li><code>_</code>只能匹配一个字符。</li>
</ol>
<h3 id="关键字distinct去除结果重复行"><a href="#关键字distinct去除结果重复行" class="headerlink" title="关键字distinct去除结果重复行"></a>关键字distinct去除结果重复行</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名 <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
<h3 id="关键字group-by分组查询"><a href="#关键字group-by分组查询" class="headerlink" title="关键字group by分组查询"></a>关键字group by分组查询</h3><p>通过关键字<code>group by</code>可以将数据划分到不同的组中，实现对记录的分组查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,age,location,class_id <span class="keyword">from</span> students <span class="keyword">group</span> <span class="keyword">by</span> class_id;</span><br></pre></td></tr></table></figure>
<p>默认情况下只会显示分组中一个成员的信息，要显示分组中某个字段的所有成员可以用<code>group_ concat()</code>函数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">group_concat</span>(<span class="keyword">name</span>) <span class="keyword">as</span> <span class="keyword">name</span>,<span class="keyword">group_concat</span>(age) <span class="keyword">as</span> age,class_id </span><br><span class="line"><span class="keyword">from</span> students <span class="keyword">group</span> <span class="keyword">by</span> class_id;</span><br></pre></td></tr></table></figure>
<h3 id="聚合函数查询"><a href="#聚合函数查询" class="headerlink" title="聚合函数查询"></a>聚合函数查询</h3><p>聚合函数特点是<strong>根据一组数据求出一个值</strong>。常与<code>group by</code>搭配使用。</p>
<h4 id="count"><a href="#count" class="headerlink" title="count()"></a>count()</h4><p>对于<code>*</code>以外的任何参数，返回所选集合中非null值的行的数目，对于<code>*</code>返回集合中所有行的数目。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">name</span>) <span class="keyword">as</span> <span class="keyword">num</span>,class_id <span class="keyword">from</span> students <span class="keyword">group</span> <span class="keyword">by</span> class_id;</span><br></pre></td></tr></table></figure>
<h4 id="sum-avg-max-min"><a href="#sum-avg-max-min" class="headerlink" title="sum(),avg(),max(),min()"></a>sum(),avg(),max(),min()</h4><h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>连接是把不同表的记录连接在一起的最普遍的方法。</p>
<h3 id="内连接查询"><a href="#内连接查询" class="headerlink" title="内连接查询"></a>内连接查询</h3><p>内连接会把不符合连接条件的行从视图中删除，最常见的例子是相等查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.name,s.age,s.class_id,c.name <span class="keyword">as</span> class_name <span class="keyword">from</span> students <span class="keyword">as</span> s </span><br><span class="line"><span class="keyword">join</span> classes <span class="keyword">as</span> c <span class="keyword">where</span> s.class_id=c.id <span class="keyword">and</span> s.id&gt;<span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<h3 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h3><p>返回结果除了内连接的数据外，还包括左表中不符合条件的数据，并在右表相应列加null值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段 <span class="keyword">from</span> 左表名 <span class="keyword">left</span> <span class="keyword">join</span> 右表名 <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>
<h3 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h3><p>返回结果除了内连接的数据外，还包括右表中不符合条件的数据，并在左表相应列加null值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段 <span class="keyword">from</span> 左表名 <span class="keyword">left</span> <span class="keyword">join</span> 右表名 <span class="keyword">on</span> 条件;</span><br></pre></td></tr></table></figure>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>子查询就是<code>select</code>查询是另一个查询的附属。在外面一层的查询中使用里面一层查询产生的结果集，这样就不是执行多个独立的查询而是执行包含一个或多个子查询的单独查询。</p>
<p>遇到多层查询时，MySQL会先从最内层的查询开始，然后从它开始向外移动到外层，这个过程中每个查询产生的结果集都被赋予给包围它的父集，接着这个父查询被执行。</p>
<p>子查询可以用在任何可以使用表达式的地方。</p>
<h3 id="带关键字in的子查询"><a href="#带关键字in的子查询" class="headerlink" title="带关键字in的子查询"></a>带关键字in的子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> students);</span><br></pre></td></tr></table></figure>
<h3 id="带关键字exists的子查询"><a href="#带关键字exists的子查询" class="headerlink" title="带关键字exists的子查询"></a>带关键字exists的子查询</h3><p>使用关键字<code>exists</code>时，内层查询语句不返回查询的记录而是返回一个真假值。如果内层查询语句查询到满足条件的记录就返回<code>True</code>,否则返回<code>False</code>。当返回值为<code>True</code>，外层语句就会进行，否则外层语句查询不到任何记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> * <span class="keyword">from</span> students <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">27</span>);</span><br></pre></td></tr></table></figure>
<h3 id="带关键字any、all的子查询"><a href="#带关键字any、all的子查询" class="headerlink" title="带关键字any、all的子查询"></a>带关键字any、all的子查询</h3><p>这两个关键字多用于比较运算。<code>any</code>表示满足其中任意一个条件，只要满足内层查询语句返回的结果中的任意一个，就可以通过该条件来执行外层查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span> &gt; <span class="keyword">any</span>(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> students);</span><br></pre></td></tr></table></figure>
<p><code>all</code>表示满足所有条件，只有满足内层查询语句返回的所有结果，才可以执行外层查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span> &gt; all(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> students);</span><br></pre></td></tr></table></figure>
<h2 id="使用正则表达式查询"><a href="#使用正则表达式查询" class="headerlink" title="使用正则表达式查询"></a>使用正则表达式查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 regexp</span><br></pre></td></tr></table></figure>
<p>MySQL中正则表达式格式与普通格式是一样的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">name</span> regexp <span class="string">'^M.*e [JS].+o&#123;2,4&#125;y$'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="语句执行顺序"><a href="#语句执行顺序" class="headerlink" title="语句执行顺序"></a>语句执行顺序</h1><p>MySQL的语句一共分为11步，如下图所标注的那样，最先执行的总是FROM操作，最后执行的是LIMIT操作。其中每一个操作都会产生一张虚拟的表，这个虚拟的表作为一个处理的输入，只是这些虚拟的表对用户来说是透明的，但是只有最后一个虚拟的表才会被作为结果返回。如果没有在语句中指定某一个子句，那么将会跳过相应的步骤。  </p>
<p><img src="https://images0.cnblogs.com/i/243280/201406/082230505368061.png" alt="执行顺序">  </p>
<p>下面来分析一下这些语句：  </p>
<ol>
<li>FORM: 对FROM的左边的表和右边的表计算笛卡尔积。产生虚表VT1</li>
<li>ON: 对虚表VT1进行ON筛选，只有那些符合<join-condition>的行才会被记录在虚表VT2中。</join-condition></li>
<li>JOIN： 如果指定了OUTER JOIN（比如left join、 right join），那么保留表中未匹配的行就会作为外部行添加到虚拟表VT2中，产生虚拟表VT3,如果from子句中包含两个以上的表的话，那么就会对上一个join连接产生的结果VT3和下一个表重复执行步骤1~3这三个步骤，一直到处理完所有的表为止。</li>
<li>WHERE： 对虚拟表VT3进行WHERE条件过滤。只有符合<where-condition>的记录才会被插入到虚拟表VT4中。</where-condition></li>
<li>GROUP BY: 根据group by子句中的列，对VT4中的记录进行分组操作，产生VT5.</li>
<li>CUBE | ROLLUP: 对表VT5进行cube或者rollup操作，产生表VT6.</li>
<li>HAVING： 对虚拟表VT6应用having过滤，只有符合<having-condition>的记录才会被 插入到虚拟表VT7中。</having-condition></li>
<li>SELECT： 执行select操作，选择指定的列，插入到虚拟表VT8中。</li>
<li>DISTINCT： 对VT8中的记录进行去重。产生虚拟表VT9.</li>
<li>ORDER BY: 将虚拟表VT9中的记录按照<order_by_list>进行排序操作，产生虚拟表VT10.</order_by_list></li>
<li>LIMIT：取出指定行的记录，产生虚拟表VT11, 并将结果返回。  </li>
</ol>
<p><strong>where和having的区别</strong>：where是在分组之前进行过滤，而having是在分组之后对条件进行判断。这里要提醒一下:<strong>select中的选择字段除非使用了聚合函数如SUM(),AVG()等，必须是group_by中的分组字段，否则会报错。这是因为在MYSQL5.7版本中，默认设置了sql_mode=only_full_group_by，这会导致select选择字段必须是group_by分组字段。要解决这个问题也很简单，只要使用命令<code>SET sql_mode=(SELECT REPLACE(@@sql_mode,&#39;ONLY_FULL_GROUP_BY&#39;,&#39;&#39;));</code>，或者在配置文件my.ini中将sql_mode修改为：’STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION’</strong></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/08/一点感想/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/08/一点感想/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">一点感想</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-03-08 23:06:51" itemprop="dateCreated datePublished" datetime="2018-03-08T23:06:51+08:00">2018-03-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-15 09:40:12" itemprop="dateModified" datetime="2018-06-15T09:40:12+08:00">2018-06-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/矫情/" itemprop="url" rel="index"><span itemprop="name">矫情</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/08/一点感想/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/03/08/一点感想/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/03/08/一点感想/" class="leancloud_visitors" data-flag-title="一点感想">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天开了个学情分析会，说实话我觉得很无聊。本来大学里的学习就不应该再像中学似的一切绕着成绩转，当然不是说成绩就不重要了，只是我想到了现在更重要的是磨炼自己的技能，增长见识。其实以前也好，现在也好，成绩讲究的是一个够用，这个标准自然因人而异：考二本的400+够用，要考清北的670+够用，想要混过4年的不挂科就够用，想要保研的3.5+才够用……对我而言，上学期的成绩是否够用还是个未知数，一切还要再等3个月才能知晓。不过不管是不是够用，大概都是有一个遗憾的：最重视的数学和英语学的并不好，这点倒是令我挺难受。其他的课程学的好也罢，差也罢，我并不是很在乎，唯独这两门我是没办法做到不在意的。<br>还有就是写代码这件事了。接触这行也是机缘巧合。后来学得多了些，慢慢地也开始体会到乐趣所在，现在是CS的黄金年代，大量的人一拥而入，这是很正常的。但是不得不说如今的CS已经积累到了量变的程度，人工智能,区块链，云计算……这些方向都是多学科交叉的，统计学，数学，计算机科学，甚至物理学…以前那种能写些网站和app，会调个库，但是对底层一无所知还能被称为程序员的的时代已经快要过去了，未来必定会要求程序员对数据结构，算法，各种协议甚至硬件有更深的理解。<br>路还很长，要努力啊</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/08/《python核心编程》知识整理之正则表达式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/03/08/《python核心编程》知识整理之正则表达式/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">《python核心编程》知识整理之正则表达式</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-03-08 20:00:10" itemprop="dateCreated datePublished" datetime="2018-03-08T20:00:10+08:00">2018-03-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-03-09 09:14:15" itemprop="dateModified" datetime="2018-03-09T09:14:15+08:00">2018-03-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/08/《python核心编程》知识整理之正则表达式/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/03/08/《python核心编程》知识整理之正则表达式/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/03/08/《python核心编程》知识整理之正则表达式/" class="leancloud_visitors" data-flag-title="《python核心编程》知识整理之正则表达式">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="特殊符号和字符"><a href="#特殊符号和字符" class="headerlink" title="特殊符号和字符"></a>特殊符号和字符</h1><p>正则表达式由多个字符组成，而有些字符在正则表达式中有特殊的含义，这部分字符被称为元字符。正是有了它们正则表达式才会如此强大。<br><img src="http://p1csf090h.bkt.clouddn.com/%E5%B8%B8%E8%A7%81%E7%AC%A6%E5%8F%B71.png" alt=""><br><img src="http://p1csf090h.bkt.clouddn.com/%E5%B8%B8%E8%A7%81%E7%AC%A6%E5%8F%B72.png" alt=""><br>下面对一些常用字符做介绍。  </p>
<h2 id="择一匹配符："><a href="#择一匹配符：" class="headerlink" title="择一匹配符：|"></a>择一匹配符：|</h2><p>|&nbsp;起一个或的作用。如：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.search(r'hello|hi','hello,jack.').group() # 匹配到hello</span><br><span class="line">re.search(r'hello|hi','hi,jack').group() # 匹配到hi</span><br></pre></td></tr></table></figure></p>
<h2 id="匹配任意单个字符："><a href="#匹配任意单个字符：" class="headerlink" title="匹配任意单个字符：."></a>匹配任意单个字符：.</h2><p>. &nbsp;会匹配除了换行符\n和空字符以外的任意字符。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.search(r'.end','end').group() # 匹配失败，因为匹配目标end的开头是一个空字符</span><br></pre></td></tr></table></figure></p>
<h2 id="从字符串的起始-结尾或者单词边界开始匹配：-b-B"><a href="#从字符串的起始-结尾或者单词边界开始匹配：-b-B" class="headerlink" title="从字符串的起始/结尾或者单词边界开始匹配：^,$,\b,\B"></a>从字符串的起始/结尾或者单词边界开始匹配：^,$,\b,\B</h2><p>^ &nbsp;会匹配字符串的起始部分<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.search(r'^From','From China') # 这样会匹配所有以From开始的字符串</span><br></pre></td></tr></table></figure></p>
<p>$ &nbsp;会匹配字符串的末尾部分<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.search(r'jack$<span class="string">','</span>hello,jack') # 这样会匹配所以以jack结尾的字符串</span><br></pre></td></tr></table></figure></p>
<p>\b,\B<br><img src="http://p1csf090h.bkt.clouddn.com/%E5%8C%B9%E9%85%8D%E8%BE%B9%E7%95%8C.png" alt=""><br><img src="http://p1csf090h.bkt.clouddn.com/%E5%8C%B9%E9%85%8D%E8%BE%B9%E7%95%8C2.png" alt=""></p>
<h2 id="创建字符集："><a href="#创建字符集：" class="headerlink" title="创建字符集：[ ]"></a>创建字符集：[ ]</h2><p>在[&nbsp; ]里面的字符相当于被多个或运算符相连。[0-9]会匹配0到9的任意<strong>一个</strong>数字，[a-z]会匹配a到z的任意<strong>一个</strong>字母。<br>[^…]表示不匹配该字符集内的任意一个字符。如[^A-Z]表示不匹配所有的大写字母。</p>
<h2 id="闭包操作符和频数匹配：-，-，？，"><a href="#闭包操作符和频数匹配：-，-，？，" class="headerlink" title="闭包操作符和频数匹配：*，+，？，{}"></a>闭包操作符和频数匹配：*，+，？，{}</h2><p>闭包操作符都是对其左边的字符进行操作。<br>* &nbsp;代表对其左边的正则表达式进行0次或者多次匹配。<br>+ &nbsp;代表对其左边的正则表达式进行1次或多次匹配。<br>? &nbsp;代表对其左边的正则表达式进行0次或者1次匹配。<br>{M,N} {M}代表对其左边的正则表达式进行M到N次/M次匹配.<br>以上都称作闭包操作符。</p>
<h3 id="贪心模式和非贪心模式"><a href="#贪心模式和非贪心模式" class="headerlink" title="贪心模式和非贪心模式"></a>贪心模式和非贪心模式</h3><p>正则表达式在匹配时，尽可能多的进行匹配。比如说对于一个匹配目标，如果+既可以匹配1次，也可以匹配多次，正则表达式会优先匹配多次。这就是贪心模式。而在闭包操作符后面加上?就可以进入非贪心模式，按尽可能少的次数进行匹配。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data = 1111aa1</span><br><span class="line">re.search(r&apos;\w+(\d)&apos;).group(1) </span><br><span class="line"># 这样是无法取到分组1中的匹配对象的，因为\w+就已经把全部字符串匹配完毕。</span><br><span class="line">re.search(r&apos;\w+?(\d)&apos;).group(1)</span><br><span class="line"># 这样分组1中的匹配对象就是1，对应data中的第二个1。</span><br></pre></td></tr></table></figure></p>
<h2 id="使用圆括号进行分组"><a href="#使用圆括号进行分组" class="headerlink" title="使用圆括号进行分组"></a>使用圆括号进行分组</h2><p>像(\d+)-(\d+)这样的表达式会匹配形如666-888的字符串。用圆括号对表达式进行分组有利于以后使用子组的匹配值。要使用子组内的值，只需要\N的方式就能调用。如<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">re.sub(r'(\d+)-(\d+)','\2\1','666-888')</span><br><span class="line"># \<span class="number">2</span>会调用第<span class="number">2</span>个子组里的匹配值，\<span class="number">1</span>会调用第一个子组里的匹配值。输出结果为<span class="number">888</span><span class="number">-666</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Pythonre模块的使用"><a href="#Pythonre模块的使用" class="headerlink" title="Pythonre模块的使用"></a>Pythonre模块的使用</h1><p><img src="http://p1csf090h.bkt.clouddn.com/%E5%87%BD%E6%95%B0%E5%8F%8A%E5%B1%9E%E6%80%A7.png" alt=""></p>
<h2 id="搜索search-与匹配match"><a href="#搜索search-与匹配match" class="headerlink" title="搜索search()与匹配match()"></a>搜索search()与匹配match()</h2><p>不同点：</p>
<ul>
<li>搜索search()会在字符串的任意位置搜索匹配的模式。  </li>
<li>匹配match()是判断一个字符串能否从起始处全部或者部分的匹配某个模式。  </li>
</ul>
<p>共同点：</p>
<ul>
<li>二者都会返回一个<strong>匹配对象</strong>。<h3 id="匹配对象"><a href="#匹配对象" class="headerlink" title="匹配对象"></a>匹配对象</h3>当处理正则表达式时，除了正则表达式对象外，还有另外一种对象类型：匹配对象。这是成功调用match()或search()返回的对象。匹配对象有两个主要的方法：group()和groups()。<h4 id="group"><a href="#group" class="headerlink" title="group()"></a>group()</h4>group()要么返回整个匹配对象，要么根据要求返回特定的子组。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pat = <span class="string">'(\d+)-(\d+)'</span></span><br><span class="line">data = <span class="string">'888-666'</span></span><br><span class="line">print(re.search(pat,data).group()) <span class="comment"># 输出888-666,因为此时整个匹配对象是888-666</span></span><br><span class="line">print(re.search(pat,data).group(<span class="number">2</span>)) <span class="comment"># 输出666，因为此时group()返回子组2的匹配对象</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="groups"><a href="#groups" class="headerlink" title="groups()"></a>groups()</h4><p>groups()仅返回一个包含唯一或全部子组的元组，如果没有子组，那么会返回一个空元组。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pat1 = <span class="string">'(th\w+).*?and (th\w+).*'</span></span><br><span class="line">pat2 = <span class="string">'(this is (a(pple))) and that is (banana)'</span></span><br><span class="line">pat3 = <span class="string">'\w+'</span></span><br><span class="line">data = <span class="string">'this is apple and that is banana'</span></span><br><span class="line"></span><br><span class="line">print(re.search(pat1,data).groups()) <span class="comment"># 输出('this','that')</span></span><br><span class="line">print(re.search(pat2,data).groups()) <span class="comment"># 输出('this is apple', 'apple', 'pple', 'banana')</span></span><br><span class="line">print(re.search(pat3,data).groups()) <span class="comment"># 输出(),因为没有子组</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用sub-与subn-搜索与替换"><a href="#使用sub-与subn-搜索与替换" class="headerlink" title="使用sub()与subn()搜索与替换"></a>使用sub()与subn()搜索与替换</h2><p>有两个函数可以实现搜索与替换：sub()与subn()，两个几乎一样，都是将字符串中所有匹配正则表达式的部分进行某种形式的替换，用来替换的部分通常是一个字符串，可也以是一个返回字符串的函数。subn()和sub()一样，但是subn()还返回一个表示替换的总数，替换后的字符串和替换总数一起作为一个拥有两个元素的元组返回。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pat1 = <span class="string">'hello'</span></span><br><span class="line">pat2 = <span class="string">'(hello),(jack)'</span></span><br><span class="line">repl = <span class="string">'hi'</span></span><br><span class="line">data = <span class="string">'hello,jack'</span></span><br><span class="line"></span><br><span class="line">print(re.sub(pat1,repl,data)) <span class="comment"># 输出hi,jack</span></span><br><span class="line">print(re.subn(pat1,repl,data)) <span class="comment"># 输出('hi,jack',1)</span></span><br><span class="line">print(re.sub(pat2,<span class="string">r'\2,\1'</span>,data)) <span class="comment"># 输出jack,hello(用上面提到的引用子组匹配对象的方法进行替换)</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用split-分隔字符串"><a href="#使用split-分隔字符串" class="headerlink" title="使用split()分隔字符串"></a>使用split()分隔字符串</h2><p>re模块和正则表达式的对象方法split()对于相对应字符串的工作方式是类似的，但是与分割一个固定字符串相比，它们基于正则表达式的模式分隔字符串，为字符串的分隔功能添加一些额外的威力。如果给定分隔符不是使用特殊符号来匹配多重模式的正则表达式，那么re.split()与str.split()的工作方式相同。如果不想为每次模式的出现都分隔字符串，可以通过为maxsplit参数设定一个值(非0)来指定最大分割数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">'123:abc:def:456:789'</span></span><br><span class="line">pat = <span class="string">'\d+:'</span></span><br><span class="line"></span><br><span class="line">print(re.split(<span class="string">r':'</span>,data)) <span class="comment"># 输出['123', 'abc', 'def', '456', '789']</span></span><br><span class="line">print(data.split(<span class="string">':'</span>)) <span class="comment"># 输出['123', 'abc', 'def', '456', '789']</span></span><br><span class="line">print(re.split(pat,data)) <span class="comment"># 输出['', 'abc:def:', '789']</span></span><br><span class="line">print(re.split(pat,data,maxsplit=<span class="number">1</span>)) <span class="comment"># 输出['', 'abc:def:456:789']</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/24/python爬虫之爬取静态网页实战篇/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/24/python爬虫之爬取静态网页实战篇/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">python爬虫之爬取静态网页（实战篇）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-02-24 21:15:34" itemprop="dateCreated datePublished" datetime="2018-02-24T21:15:34+08:00">2018-02-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-03-24 09:55:12" itemprop="dateModified" datetime="2018-03-24T09:55:12+08:00">2018-03-24</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/02/24/python爬虫之爬取静态网页实战篇/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/02/24/python爬虫之爬取静态网页实战篇/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/02/24/python爬虫之爬取静态网页实战篇/" class="leancloud_visitors" data-flag-title="python爬虫之爬取静态网页（实战篇）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以爬取<a href="http://www.zhuoku.com/" target="_blank" rel="noopener">桌酷网</a>下<em>桌面最新壁纸</em>一栏中的图片为例。本篇教程旨在让新手快速入门爬虫，所以不涉及面向对象编程。<br><img src="http://p1csf090h.bkt.clouddn.com/%E6%A1%8C%E5%BA%93%E6%9C%80%E6%96%B0%E5%A3%81%E7%BA%B8.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://www.zhuoku.com/"</span></span><br><span class="line">header_list = [</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.91 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)"</span>]</span><br><span class="line">header1 = &#123;<span class="string">"User-Agent"</span>:<span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"</span>&#125;</span><br><span class="line">header1 = &#123;<span class="string">"User-Agent"</span>:<span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>先导入必要的库，配置该项爬虫的基本设置。在header_list中存放几个User-Agent反爬。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(url,headers=header1,timeout=<span class="number">30</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    r = requests.get(url,headers=header1,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">r.encoding = <span class="string">'utf-8'</span></span><br></pre></td></tr></table></figure></p>
<p>利用requests.get获取桌酷网首页的html文件，并将其设置为utf-8格式。timeout设置为30秒，如果30秒内没有获取成功会报错，为了避免连接超时导致程序停止在except中让程序再次连接这个url<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">soup = BeautifulSoup(res,<span class="string">"html.parser"</span>)</span><br><span class="line">all_a = soup.find(<span class="string">"div"</span>,id=<span class="string">"zuixin"</span>).find_all(<span class="string">'a'</span>,attrs=&#123;<span class="string">"class"</span>:<span class="string">"title"</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>煮一锅“汤”，解析下载好的html文件。在文件中找到‘zuixin’下所有分类为‘title’的a标签。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> all_a:</span><br><span class="line">    header = &#123;<span class="string">"User-Agent"</span>: choice(header_list)&#125;</span><br><span class="line">    title  = a.get_text().replace(<span class="string">"/"</span>,<span class="string">''</span>)</span><br><span class="line">    href = a.get(<span class="string">"href"</span>)</span><br><span class="line">    img_url = url + href[<span class="number">1</span>:<span class="number">-4</span>] + <span class="string">"(1).htm"</span><span class="comment">#补第一张图片的全href</span></span><br></pre></td></tr></table></figure></p>
<p>值得注意的是，此时我们用choice()函数从上面设置好的header_list列表中随机选择了一个User-Agent作为header里的内容。在下面的每一次requests.get()中都会加上这个header，这样就可以突破很多网站的反爬措施了。遍历找出的每一个a标签,通过get_text()方法取出该标签的元素作为这组图片的title，通过get(‘href’)取出该a标签的href属性内容。通过观察可以发现，这组图片的url就是网站首页url与取出的href属性拼接而成，后面(1).htm这个后缀实际上代表了这组图片的页数。(1).htm既是这组图的第一张图片，(2).htm既是这组图的第二张图片…通过补全url构造出每一组图的<strong>第一张图片url</strong>。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> os.path.isdir(os.path.join(<span class="string">"D:\zhuoku"</span>,title)): <span class="comment">#如果存在文件夹</span></span><br><span class="line">    print(<span class="string">"exist"</span> + title)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    os.makedirs(os.path.join(<span class="string">"D:\zhuoku"</span>,title)) <span class="comment">#创建文件夹</span></span><br><span class="line">    print(<span class="string">"makedir"</span> + title)</span><br><span class="line">os.chdir(<span class="string">"D:\zhuoku\\"</span> + title) <span class="comment">#切换到此文件夹</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    img_url_get = requests.get(img_url,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    img_url_get = requests.get(img_url,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure></p>
<p>判断一下储存图片的文件夹是否存在，不存在就创建一个（os.join()将两个路径拼接起来），然后通过os.chdir()移动到这个文件夹下。还是通过requests.get()获取这张图片页面的html文件。sleep()让程序停止0.5秒，免得访问太频繁给服务器带来太大的负担。<strong>设置合适的sleep()时间很重要，既是出于不给网站带来太大压力的道德因素，也是避免访问过于频繁导致服务器强制断开连接使程序中断</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">img_url_soup = BeautifulSoup(img_url_get.text,<span class="string">"html.parser"</span>)</span><br><span class="line"><span class="comment"># 找出最大页数</span></span><br><span class="line">max_img_page = img_url_soup.find(<span class="string">'div'</span>,id=<span class="string">"yema"</span>).find_all(<span class="string">"a"</span>)[<span class="number">-1</span>].get_text()</span><br><span class="line"><span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>,int(max_img_page)+<span class="number">1</span>):</span><br><span class="line">    jpg_href = url + href[<span class="number">1</span>:<span class="number">-4</span>] + <span class="string">"("</span> + str(page) + <span class="string">").htm"</span> + <span class="string">"#turn"</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        jpg_href_get = requests.get(jpg_href,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        jpg_href_get = requests.get(jpg_href,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure></p>
<p>解析下载好的html文件，在html文件中找到这组图片的最大页数。依次构造这组图的<strong>每一张图片的url</strong>。通过<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jpg_soup = BeautifulSoup(jpg_href_get.text,<span class="string">"html.parser"</span>)</span><br><span class="line"><span class="comment"># 在find()方法后面用方括号将属性括起来可以取出该属性的值</span></span><br><span class="line">jpg_url = jpg_soup.find(<span class="string">"div"</span>,id=<span class="string">"bizhiimg"</span>).find(<span class="string">"img"</span>)[<span class="string">"src"</span>] </span><br><span class="line">name = jpg_url[<span class="number">-9</span>:] <span class="comment">#截取倒数第九位至末尾为图片的名字</span></span><br></pre></td></tr></table></figure></p>
<p>依次解析每一张图片的html文件，通过find(‘img’)找出图片所在的img标签并取出src属性的值（类似于get(‘src’)），这个值就是图片URI。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">if</span> os.path.isfile(name): <span class="comment">#如果存在名为name的文件</span></span><br><span class="line">            print(name + <span class="string">" exist  skip"</span>)</span><br><span class="line">            <span class="keyword">pass</span> <span class="comment">#下面全跳过</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            jpg_header = &#123;</span><br><span class="line">                <span class="string">"Referer"</span>: jpg_href,</span><br><span class="line">                <span class="string">"User-Agent"</span>:choice(header_list)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                jpg = requests.get(jpg_url,headers=jpg_header,timeout=<span class="number">30</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                jpg = requests.get(jpg_url,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">            sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">with</span> open(name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(jpg.content)</span><br><span class="line">                print(name+<span class="string">" saved"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"congratulations! all finished!"</span>)</span><br></pre></td></tr></table></figure></p>
<p>判断一下图片是否已经保存。如果没有保存通过requests.get()访问刚才找出的URI，此时变量jpg就可以看做是这张图片。<br>以‘wb’形式新建一个名为name变量的值的文件，通过f.write(jpg.content)将图片写入文件中。<br>成功！现在你就有一个完整的爬虫了！启动程序，大概20分钟之后，这些图片就会统统下载到你的电脑里啦~<br><img src="http://p1csf090h.bkt.clouddn.com/%E5%A3%81%E7%BA%B8.png" alt=""><br>以下是程序的完整代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://www.zhuoku.com/"</span></span><br><span class="line">header_list = [</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.91 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"</span>,</span><br><span class="line">    <span class="string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)"</span>]</span><br><span class="line">header1 = &#123;<span class="string">"User-Agent"</span>:<span class="string">"Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)"</span>&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(url,headers=header1,timeout=<span class="number">30</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    r = requests.get(url,headers=header1,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">r.encoding = <span class="string">'utf-8'</span></span><br><span class="line">soup = BeautifulSoup(r,<span class="string">"html.parser"</span>)</span><br><span class="line">all_a = soup.find(<span class="string">"div"</span>,id=<span class="string">"zuixin"</span>).find_all(<span class="string">'a'</span>,attrs=&#123;<span class="string">"class"</span>:<span class="string">"title"</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> all_a:</span><br><span class="line">    header = &#123;<span class="string">"User-Agent"</span>: choice(header_list)&#125;</span><br><span class="line">    title  = a.get_text().replace(<span class="string">"/"</span>,<span class="string">''</span>)</span><br><span class="line">    href = a.get(<span class="string">"href"</span>)</span><br><span class="line">    img_url = url + href[<span class="number">1</span>:<span class="number">-4</span>] + <span class="string">"(1).htm"</span><span class="comment">#补第一张图片的全href</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(os.path.join(<span class="string">"D:\zhuoku"</span>,title)): <span class="comment">#如果存在文件夹</span></span><br><span class="line">        print(<span class="string">"exist"</span> + title)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        os.makedirs(os.path.join(<span class="string">"D:\zhuoku"</span>,title)) <span class="comment">#创建文件夹</span></span><br><span class="line">        print(<span class="string">"makedir"</span> + title)</span><br><span class="line">    os.chdir(<span class="string">"D:\zhuoku\\"</span> + title) <span class="comment">#切换到此文件夹</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        img_url_get = requests.get(img_url,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        img_url_get = requests.get(img_url,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br><span class="line">    img_url_soup = BeautifulSoup(img_url_get.text,<span class="string">"html.parser"</span>)</span><br><span class="line">    max_img_page = img_url_soup.find(<span class="string">'div'</span>,id=<span class="string">"yema"</span>).find_all(<span class="string">"a"</span>)[<span class="number">-1</span>].get_text()</span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>,int(max_img_page)+<span class="number">1</span>):</span><br><span class="line">        jpg_href = url + href[<span class="number">1</span>:<span class="number">-4</span>] + <span class="string">"("</span> + str(page) + <span class="string">").htm"</span> + <span class="string">"#turn"</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            jpg_href_get = requests.get(jpg_href,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            jpg_href_get = requests.get(jpg_href,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        jpg_soup = BeautifulSoup(jpg_href_get.text,<span class="string">"html.parser"</span>)</span><br><span class="line">        jpg_url = jpg_soup.find(<span class="string">"div"</span>,id=<span class="string">"bizhiimg"</span>).find(<span class="string">"img"</span>)[<span class="string">"src"</span>] <span class="comment">#在find方法后面用方括号将属性括起来可以取出该属性的值</span></span><br><span class="line">        name = jpg_url[<span class="number">-9</span>:] <span class="comment">#截取倒数第九位至末尾为图片的名字</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(name): <span class="comment">#如果存在名为name的文件</span></span><br><span class="line">            print(name + <span class="string">" exist  skip"</span>)</span><br><span class="line">            <span class="keyword">pass</span> <span class="comment">#下面全跳过</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            jpg_header = &#123;</span><br><span class="line">                <span class="string">"Referer"</span>: jpg_href,</span><br><span class="line">                <span class="string">"User-Agent"</span>:choice(header_list)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                jpg = requests.get(jpg_url,headers=jpg_header,timeout=<span class="number">30</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                jpg = requests.get(jpg_url,headers=header,timeout=<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">            sleep(<span class="number">0.5</span>)</span><br><span class="line">            <span class="keyword">with</span> open(name,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(jpg.content)</span><br><span class="line">                print(name+<span class="string">" saved"</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"congratulations! all finished!"</span>)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/09/进程与线程/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/09/进程与线程/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">进程与线程</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-01-09 21:18:09" itemprop="dateCreated datePublished" datetime="2018-01-09T21:18:09+08:00">2018-01-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-05-30 21:56:16" itemprop="dateModified" datetime="2018-05-30T21:56:16+08:00">2018-05-30</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Web开发/" itemprop="url" rel="index"><span itemprop="name">Web开发</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/09/进程与线程/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/01/09/进程与线程/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/01/09/进程与线程/" class="leancloud_visitors" data-flag-title="进程与线程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是进程-线程"><a href="#什么是进程-线程" class="headerlink" title="什么是进程/线程"></a>什么是进程/线程</h1><p>众所周知，CPU是计算机的核心，它承担了所有的计算任务。而操作系统是计算机的管理者，是一个大管家，它负责任务的调度，资源的分配和管理，统领整个计算机硬件。应用应用程序是具有某种功能的程序，程序运行与操作系统之上。</p>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>进程时一个具有一定功能的程序在一个数据集上的一次动态执行过程。进程由程序，数据集合和进程控制块三部分组成。程序用于描述进程要完成的功能，是控制进程执行的指令集；数据集合是程序在执行时需要的数据和工作区；程序控制块（PCB）包含程序的描述信息和控制信息，是进程存在的唯一标志。  </p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>在很早的时候计算机并没有线程这个概念，但是随着时代的发展，只用进程来处理程序出现很多的不足。如当一个进程堵塞时，整个程序会停止在堵塞处，并且如果频繁的切换进程，会浪费系统资源。所以线程出现了。<br>线程是能拥有资源和独立运行的最小单位，也是程序执行的最小单位。一个进程可以拥有多个线程，而且属于同一个进程的多个线程间会共享该进行的资源。</p>
<h2 id="进程与线程的区别"><a href="#进程与线程的区别" class="headerlink" title="进程与线程的区别"></a>进程与线程的区别</h2><ol>
<li>一个进程由一个或者多个线程组成，线程是一个进程中代码的不同执行路线。</li>
<li>切换进程需要的资源比切换线程的要多的多。</li>
<li>进程之间相互独立，而同一个进程下的线程共享程序的内存空间（如代码段，数据集，堆栈等）。某进程内的线程在其他进程不可见。换言之，线程共享同一片内存空间，而进程各有独立的内存空间。<br>以下是作者在知乎上看到的关于进程与线程的讨论，其中一个作者感觉很有道理，摘抄如下：<blockquote>
<p>作者：zhonyong<br>链接：<a href="https://www.zhihu.com/question/25532384/answer/81152571" target="_blank" rel="noopener">https://www.zhihu.com/question/25532384/answer/81152571</a>  </p>
</blockquote>
</li>
</ol>
<blockquote>
<p>首先来一句概括的总论：进程和线程都是一个时间段的描述，是CPU工作时间段的描述。下面细说背景：CPU+RAM+各种资源（比如显卡，光驱，键盘，GPS, 等等外设）构成我们的电脑，但是电脑的运行，实际就是CPU和相关寄存器以及RAM之间的事情。一个最最基础的事实：CPU太快，太快，太快了，寄存器仅仅能够追的上他的脚步，RAM和别的挂在各总线上的设备完全是望其项背。那当多个任务要执行的时候怎么办呢？轮流着来?或者谁优先级高谁来？不管怎么样的策略，一句话就是在CPU看来就是轮流着来。一个必须知道的事实：执行一段程序代码，实现一个功能的过程介绍 ，当得到CPU的时候，相关的资源必须也已经就位，就是显卡啊，GPS啊什么的必须就位，然后CPU开始执行。这里除了CPU以外所有的就构成了这个程序的执行环境，也就是我们所定义的程序上下文。当这个程序执行完了，或者分配给他的CPU执行时间用完了，那它就要被切换出去，等待下一次CPU的临幸。在被切换出去的最后一步工作就是保存程序上下文，因为这个是下次他被CPU临幸的运行环境，必须保存。串联起来的事实：前面讲过在CPU看来所有的任务都是一个一个的轮流执行的，具体的轮流方法就是：先加载程序A的上下文，然后开始执行A，保存程序A的上下文，调入下一个要执行的程序B的程序上下文，然后开始执行B,保存程序B的上下文。。。。<br>========= 重要的东西出现了========<br>进程和线程就是这样的背景出来的，两个名词不过是对应的CPU时间段的描述，名词就是这样的功能。进程就是包换上下文切换的程序执行时间总和 = CPU加载上下文+CPU执行+CPU保存上下文线程是什么呢？进程的颗粒度太大，每次都要有上下的调入，保存，调出。如果我们把进程比喻为一个运行在电脑上的软件，那么一个软件的执行不可能是一条逻辑执行的，必定有多个分支和多个程序段，就好比要实现程序A，实际分成 a，b，c等多个块组合而成。那么这里具体的执行就可能变成：程序A得到CPU =》CPU加载上下文，开始执行程序A的a小段，然后执行A的b小段，然后再执行A的c小段，最后CPU保存A的上下文。这里a，b，c的执行是共享了A的上下文，CPU在执行的时候没有进行上下文切换的。这里的a，b，c就是线程，也就是说线程是共享了进程的上下文环境，的更为细小的CPU时间段。到此全文结束，再一个总结：进程和线程都是一个时间段的描述，是CPU工作时间段的描述，不过是颗粒大小不同。  </p>
</blockquote>
<h1 id="开进程需要时间"><a href="#开进程需要时间" class="headerlink" title="开进程需要时间"></a>开进程需要时间</h1><p>学习《python爬虫开发与项目实践》时，执行下面一段代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_process</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"Child process %s (%s) is running"</span> % (name,os.getpid()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"parant process %s "</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        p = Process(target=run_process, args=(str(i),))</span><br><span class="line">        print(<span class="string">"process will start"</span>)</span><br><span class="line">        p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">"process end"</span>)</span><br></pre></td></tr></table></figure></p>
<p>显示的结果是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">parant process 6332 </span><br><span class="line">process will start</span><br><span class="line">process will start</span><br><span class="line">process will start</span><br><span class="line">process will start</span><br><span class="line">process will start</span><br><span class="line">Child process 2 (9896) is running</span><br><span class="line">Child process 0 (11208) is running</span><br><span class="line">Child process 3 (5464) is running</span><br><span class="line">Child process 1 (10208) is running</span><br><span class="line">Child process 4 (12596) is running</span><br><span class="line">process end</span><br></pre></td></tr></table></figure></p>
<p>可以看到，程序在执行完<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print (&quot;parant process %s &quot; % os.getpid())</span><br></pre></td></tr></table></figure></p>
<p>没有接着马上执行run_process()，而是先打印process will start，最后把子进程一起执行。这是因为子进程的创建是需要时间的，在这个空闲时间里父进程继续执行代码，而子进程在创建完成后显示。    </p>
<h1 id="Pool进程池"><a href="#Pool进程池" class="headerlink" title="Pool进程池"></a>Pool进程池</h1><p>需要创建多个进程时，可以使用multiprocessing中的Pool类开进程池。Pool()默认开启数量等于当前cpu核心数的子进程（当然可以手动改变）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(i)</span>:</span></span><br><span class="line">    print(<span class="string">"hello ,this is the %d process"</span> % i)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    p = Pool()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">        p.apply_async(target=hell0,args=(i,))</span><br><span class="line">    p.close    </span><br><span class="line">    p.join</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>apply_async表示在开进程时不阻塞主进程，是异步IO的一种方式之一。targe参数传入要在子线程中执行的<strong>函数对象</strong>，args以元组的方式传入函数的参数。<br>join会等待线程池中的每一个线程执行完毕，在调用join之前必须要先调用close，close表示不能再向线程池中添加新的process了。</p>
<h1 id="进程间的通信"><a href="#进程间的通信" class="headerlink" title="进程间的通信"></a>进程间的通信</h1><p>每个进程各自有不同的用户地址空间,任何一个进程的全局变量在另一个进程中都看不到，所以进程之间要交换数据必须通过内核,在内核中开辟一块缓冲区,进程A把数据从用户空间拷到内核缓冲区,进程B再从内核缓冲区把数据读走,内核提供的这种机制称为进程间通信。假如创建了多个进程，那么进程间的通信是必不可少的。Python提供了多种进程通信的方式，其中以Queue和Pipe用得最多。下面分别介绍这两种模式。</p>
<h2 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h2><p>Queue是一种<strong>多进程</strong>安全的队列。实现多进程间的通信有两种方法：</p>
<ul>
<li>get() 用于向队列中加入数据。有两个属性：blocked和timeout。blocked为true时（默认为True）且timeout为正值时，如果当队列已满会阻塞timeout时间，在这个时间内如果队列有空位会加入，如果超过时间仍然没有空位会抛出Queue.Full异常。</li>
<li>put() 用于从队列中获取一个数据并将其从队列中删除。有两个属性：blocked和timeout。blocked为true（默认为True）且timeout为正值时，如果当前队列为空会阻塞timeout时间，在这个时间内如果队列有新数据会获取，如果超过时间仍然没有新数据会抛出Queue.Empty异常。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put_data</span><span class="params">(q,nums)</span>:</span></span><br><span class="line">    print(<span class="string">'现在的进程编号为：%s，这是一个put进程'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        q.put(num)</span><br><span class="line">        print(<span class="string">'%d已经放入队列中啦！'</span> % num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">'现在的进程编号为：%s，这是一个get进程'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        print(<span class="string">'已经从队列中获取%s并从中删除'</span> % q.get())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    q = Queue()</span><br><span class="line">    p1 = Process(target=put_data,args=(q,[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>],))</span><br><span class="line">    p2 = Process(target=put_data,args=(q,[<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>],))</span><br><span class="line">    p3 = Process(target=get_data,args=(q,))</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    p2.join()</span><br><span class="line">    <span class="comment"># p3是个死循环，需要手动结束这个进程</span></span><br><span class="line">    p3.terminate()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>我们来看一下运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">现在的进程编号为：10336，这是一个put进程</span><br><span class="line">1已经放入队列中啦！</span><br><span class="line">2已经放入队列中啦！</span><br><span class="line">3已经放入队列中啦！</span><br><span class="line">现在的进程编号为：9116，这是一个get进程</span><br><span class="line">已经从队列中获取1,并从中删除</span><br><span class="line">已经从队列中获取2并从中删除</span><br><span class="line">已经从队列中获取3并从中删除</span><br><span class="line">现在的进程编号为：2732，这是一个put进程</span><br><span class="line">4已经放入队列中啦！</span><br><span class="line">5已经放入队列中啦！</span><br><span class="line">已经从队列中获取4,并从中删除</span><br><span class="line">6已经放入队列中啦！</span><br><span class="line">已经从队列中获取5并从中删除</span><br><span class="line">已经从队列中获取6并从中删除</span><br></pre></td></tr></table></figure></p>
<h2 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h2><p>Pipe与Queue不同之处在于Pipe是用于<strong>两个进程</strong>之间的通信。就像进程位于一根水管的两端。让我们看看Pipe官方文档的描述：  </p>
<blockquote>
<p>Returns a pair (conn1, conn2) of Connection objects representing the ends of a pipe.</p>
</blockquote>
<p>Piep返回conn1和conn2代表水管的两端。Pipe还有一个参数duplex（adj. 二倍的，双重的 n. 双工；占两层楼的公寓套房），默认为True。当duplex为True时，开启双工模式，此时水管的两边都可以进行收发。当duplex为False，那么<strong>conn1只负责接受信息，conn2只负责发送信息。</strong><br>conn通过send()和recv()来发送和接受信息。值得注意的是，如果管道中没有信息可接受，recv()会一直阻塞直到管道关闭（任意一端进程接结束则管道关闭）。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Pipe</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put_data</span><span class="params">(p,nums)</span>:</span></span><br><span class="line">    print(<span class="string">'现在的进程编号为：%s，这个一个send进程'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        p.send(num)</span><br><span class="line">        print(<span class="string">'%s已经放入管道中啦！'</span> % num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">(p)</span>:</span></span><br><span class="line">    print(<span class="string">'现在的进程编号为：%s，这个一个recv进程'</span> % os.getpid())</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        print(<span class="string">'已经从管道中获取%s并从中删除'</span> % p.recv())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = Pipe(duplex=<span class="keyword">False</span>)</span><br><span class="line">    <span class="comment"># 此时Pipe[1]即是Pipe返回的conn2</span></span><br><span class="line">    p1 = Process(target=put_data,args=(p[<span class="number">1</span>],[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>],))</span><br><span class="line">    <span class="comment"># 此时Pipe[0]即是Pipe返回的conn1</span></span><br><span class="line">    p3 = Process(target=get_data,args=(p[<span class="number">0</span>],))</span><br><span class="line">    p1.start()</span><br><span class="line">    p3.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    p3.terminate()</span><br></pre></td></tr></table></figure></p>
<p>让我们看一下输出结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">现在的进程编号为：9868，这个一个recv进程</span><br><span class="line">现在的进程编号为：9072，这个一个send进程</span><br><span class="line">1已经放入管道中啦！</span><br><span class="line">已经从管道中获取1,并从中删除</span><br><span class="line">2已经放入管道中啦！</span><br><span class="line">已经从管道中获取2并从中删除</span><br><span class="line">3已经放入管道中啦！</span><br><span class="line">已经从管道中获取3并从中删除</span><br></pre></td></tr></table></figure></p>
<h1 id="控制线程"><a href="#控制线程" class="headerlink" title="控制线程"></a>控制线程</h1><p>我们是没有办法完全人为控制线程的，因为线程由系统控制。但是可以用一些方式来影响线程的调用，比如互斥锁，sleep（阻塞），死锁等。</p>
<h2 id="线程的几种状态"><a href="#线程的几种状态" class="headerlink" title="线程的几种状态"></a>线程的几种状态</h2><p>新建—–就绪——————运行—–死亡<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;等待（阻塞）<br>线程的生命周期由run方法决定，当run方法结束时线程死亡。可以通过继承Thread，重写run方法改变Thread的功能，最后还是通过start()方法开线程。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'i am sorry'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t = MyThread()</span><br><span class="line">    t.start()</span><br><span class="line">```  </span><br><span class="line">通过args参数以一个元组的方式给线程中的函数传参。   </span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sorry</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">'i am sorry'</span>,name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:  </span><br><span class="line">    t = Thread(target=sorry,args=(<span class="string">'mike'</span>))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></p>
<h2 id="线程锁"><a href="#线程锁" class="headerlink" title="线程锁"></a>线程锁</h2><p>多线程中任务中，可能会发生多个线程同时对一个公共资源（如全局变量）进行操作的情况，这是就会发生混乱。为了避免这种情况，需要引入线程锁的概念。只有一个线程能处于上锁状态，当一个线程上锁之后，如果有另外一个线程试图获得锁，该线程就会挂起直到拥有锁的线程将锁释放。这样就保证了同时只有一个线程对公共资源进行访问或修改。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">puls</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 获得一个锁</span></span><br><span class="line">    lock = Lock()</span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="comment"># acquire()方法上锁</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    print(num)</span><br><span class="line">    <span class="comment"># release()方法解锁</span></span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        t = Thread(target=plus)</span><br><span class="line">        t.start()</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure></p>
<h2 id="join-方法会阻塞主线程直到子线程全部结束（也就是同步）。"><a href="#join-方法会阻塞主线程直到子线程全部结束（也就是同步）。" class="headerlink" title="join()方法会阻塞主线程直到子线程全部结束（也就是同步）。  "></a>join()方法会阻塞主线程直到子线程全部结束（也就是同步）。  </h2><p>锁的用处:</p>
<ol>
<li>确保某段关键代码只能由一个线程从头到尾执行，保证了数据的唯一性。  </li>
</ol>
<p>锁的坏处:  </p>
<ol>
<li>阻止了多线程并发执行，效率大大降低。</li>
<li>由于存在多个锁，不同的线程持有不同的锁并试图获取对方的锁时，可能造成死锁。  </li>
</ol>
<h1 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h1><p>线程其实并没有主次的概念，我们一般说的‘主线程’实际上是main函数的线程，而所谓主线程结束子线程也会结束是因为在主线程结束时调用了系统的退出函数。而守护线程是指‘不重要线程’。主线程会等所有‘重要’线程结束后才结束。通常当客户端访问服务器时会为这次访问开启一个守护线程。将setDaemon属性设为True即可将该线程设为守护线程。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">n = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> n=x+y</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    t = Thread(target=count,args=(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">    t.setDaemon = <span class="keyword">True</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/02/重新开始/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/02/重新开始/" class="post-title-link" itemprop="http://yoursite.com/page/3/index.html">重新开始</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2017-12-02 22:16:25" itemprop="dateCreated datePublished" datetime="2017-12-02T22:16:25+08:00">2017-12-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-15 09:41:20" itemprop="dateModified" datetime="2018-06-15T09:41:20+08:00">2018-06-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/矫情/" itemprop="url" rel="index"><span itemprop="name">矫情</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/02/重新开始/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/12/02/重新开始/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/12/02/重新开始/" class="leancloud_visitors" data-flag-title="重新开始">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前阵子手贱删了博客文件，还糊里糊涂地把coding里的项目也删了。然后各种蜜汁错误，各种无法重新部署。最近几天又蜜汁部署成功。可以说十分难受了。</p>
<p><img src="重新开始/扶墙吐血.jpg" alt=""></p>
<p>不过塞翁失马，焉知非福。经过这么一遭我再次练习了一遍coding+hexo下博客的部署，也算是好事一桩了吧？（强行自我安慰一波233）<br>以后我一定天天向上，重新做人，再不手贱。</p>
<p><img src="重新开始/跪地哭.jpg" alt=""></p>
<p>再次感谢王哥的教程，很详细，帮助很大，很好，很棒。感兴趣的同志可以去他那里转转呀（手动滑稽）<a href="http://windliang.cc" target="_blank" rel="noopener">windliang的博客</a></p>
<p>扯到这里算是暂时结束，以后有时间再上来扯扯淡，写点学习心得啥的吧。</p>
<p><img src="重新开始/溜了.jpg" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">博主</p>
              <p class="site-description motion-element" itemprop="description">高山仰止，景行行止。虽不能至，心向往之。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-[object Object]"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">路边的土豆</span>

  
</div>


<div class="powered-by">
  Hosted by  
  <a class="theme-link" href="https://pages.coding.me">
    Coding Pages
  </a>   
</div>
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { "$in": entries } }) })
        .done(function ({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log("LeanCloud Counter Error: " + responseJSON.code + " " + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "aMaKMjBVPa5XOf0bdfaeqpy5-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "aMaKMjBVPa5XOf0bdfaeqpy5-gzGzoHsz",
                'X-LC-Key': "NUE5wMDsMaQAeYjT5C9KmT3s",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          if ($('.post-title-link').length >= 1) {
            showTime(Counter);
          }
          
        })
    });
  </script>



  

  

  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

  

  

  

</body>
</html>
