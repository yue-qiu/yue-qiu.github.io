<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">






























<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="高山仰止，景行行止。虽不能至，心向往之。">
<meta property="og:type" content="website">
<meta property="og:title" content="精神的壳">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="精神的壳">
<meta property="og:description" content="高山仰止，景行行止。虽不能至，心向往之。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="精神的壳">
<meta name="twitter:description" content="高山仰止，景行行止。虽不能至，心向往之。">






  <link rel="canonical" href="http://yoursite.com/page/2/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>精神的壳</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?847f7a1169508eb118c64f7719e8a4cf";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">精神的壳</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/11/大一简单总结/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/11/大一简单总结/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">一点总结，一点想法</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-11 00:51:56" itemprop="dateCreated datePublished" datetime="2018-06-11T00:51:56+08:00">2018-06-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-15 09:43:32" itemprop="dateModified" datetime="2018-06-15T09:43:32+08:00">2018-06-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/矫情/" itemprop="url" rel="index"><span itemprop="name">矫情</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/11/大一简单总结/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/11/大一简单总结/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/11/大一简单总结/" class="leancloud_visitors" data-flag-title="一点总结，一点想法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>现在是2018年6月11日00:53:48，我在床上翻来覆去睡不着，翻了翻朋友的博客，更是想起很多有的没的。干脆起来写点东西</p>
<p>现在已经是6月中旬。很快这学期最后几门考试要来了，我的大一就这么过去了吧。</p>
<p>要说这念大学一年里什么令我最难忘，大概就是没能成功转专业吧。真是可惜啊，从跨进校门的第一天起我就着手准备，明明都那么努力了：晚上泡图书馆整理笔记，刷题，是周末早上7点出门去学习，去做练习册……只是有时候，或者说很多时候事情总是难遂人意。真的真的很可惜，很难受，特别是想到一些根本没我努力的人如愿以偿转到自己想去的专业，而自己不得不在这个甚至在查询录取结果之前根本没听说过的专业待3年。经常会想，如果我当初报了杭电，哪怕是广工呢？虽然这些学校不是什么211双一流，我也会比现在快活多了吧。两天前，2018年高考结束，说起来明明当初复读学校都联系好了，甚至包袱都收拾完毕，最后关头却还是怂了，如果那时坚定一点，现在结局又大不一样了。</p>
<p>人生无法重来，这一年里我深刻认识到这句话。我也知道，再多的假设，再多的如果，都只能是幻想了。来到地大以后我接触到一些人，有想造飞机却学了计算机的，有想搞机械却学了地质的…大概人生是很难圆满的吧，总有些遗憾，总有些错误，总有些代价。只是有时候，这个代价有点太沉重了。</p>
<p>还是要向前看吧，毕竟已经没有回头路。打算放弃本专业了，混个毕业证，学位证，足矣。多腾点时间出来学一下计算机。也许大二的时候会去报一个双学位吧，至于更长远的是不是要跨考，这个我还没想好。说实话已经有点不想考虑太长远的事情了。毕竟眼前的事就足够我忙碌，何况计划落空的感觉真的不好受。应用地质吧傅扎兄的一句话：我不因小事而屈服，只为失去许多可能而遗憾</p>
<p>话说到现在，已经有些困了。还是去睡觉吧，等明天醒来，又是新的一天了。不管日子过的好还是坏，总还是要继续的</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/10/OOP、Python装饰器、GIL与requirements/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/10/OOP、Python装饰器、GIL与requirements/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">OOP、Python装饰器、GIL与requirements</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-10 21:19:01" itemprop="dateCreated datePublished" datetime="2018-06-10T21:19:01+08:00">2018-06-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-11-15 19:02:27" itemprop="dateModified" datetime="2018-11-15T19:02:27+08:00">2018-11-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/10/OOP、Python装饰器、GIL与requirements/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/10/OOP、Python装饰器、GIL与requirements/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/10/OOP、Python装饰器、GIL与requirements/" class="leancloud_visitors" data-flag-title="OOP、Python装饰器、GIL与requirements">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="面向对象编程（OOP）"><a href="#面向对象编程（OOP）" class="headerlink" title="面向对象编程（OOP）"></a>面向对象编程（OOP）</h1><h2 id="方法与函数"><a href="#方法与函数" class="headerlink" title="方法与函数"></a>方法与函数</h2><p>面向对象编程思想中，方法是指一个对象可以使用的函数，举个例子<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">arr.remove(<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<p>arr被定义为指向列表对象的变量，而remove则是list对象的一个方法，用于从列表中删除某个值。<br>而函数则是对对象进行操作，例如<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">len(arr)</span><br></pre></td></tr></table></figure></p>
<p>len()函数对其参数求长度。在本例中len()的参数既是一个列表。</p>
<h2 id="一切皆对象"><a href="#一切皆对象" class="headerlink" title="一切皆对象"></a>一切皆对象</h2><p>python一个很出名的特性是一切皆对象。比如变量，类，甚至函数也可以作为一个对象传给变量。比如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus</span><span class="params">(x,y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x+y</span><br><span class="line">plus(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Threat</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    t = Threat(target=plus,args=(<span class="number">1</span>,<span class="number">3</span>,))</span><br><span class="line">    t.start()</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure></p>
<p>第八行的target参数传入的是plus函数的对象，此时不需要括号。而第三行的plus()加了括号是告诉python解释器执行这个函数对象。</p>
<h1 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h1><p>当我们想要为某个函数临时添加某个功能时，装饰器能很好地完成这项工作。</p>
<p>装饰器其实就是在函数里定义函数：将目标函数对象传入装饰器里，装饰器内部的函数做一些事情，然后再执行目标函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(text)</span>:</span></span><br><span class="line">    print(text)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'这是关于装饰器的测试'</span>)</span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># hello</span></span><br><span class="line"><span class="comment"># 这是关于装饰器的测试</span></span><br></pre></td></tr></table></figure></p>
<p>这里的<code>@</code>是python的语法糖，作用相当于<code>test = decorator(test)</code>，即把目标函数对象传入装饰器中。由于decorator返回的是函数对象wrapper，原来的<code>test</code>便转而指向了<code>wrapper</code>。当我们调用<code>test</code>时，实际上是调用了<code>wrapper</code>。</p>
<h2 id="多层装饰器（装饰器传参）"><a href="#多层装饰器（装饰器传参）" class="headerlink" title="多层装饰器（装饰器传参）"></a>多层装饰器（装饰器传参）</h2><p>有时我们需要给装饰器传参，这就麻烦一点，需要多定义层函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(context=<span class="string">'hello'</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">warpper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            print(context)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 依次返回函数对象</span></span><br><span class="line">        <span class="keyword">return</span> warpper</span><br><span class="line">    <span class="comment"># 依次返回函数对象</span></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@log(context='hi')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(text)</span>:</span></span><br><span class="line">    print(text)</span><br><span class="line"></span><br><span class="line">test(<span class="string">'这是关于装饰器的测试'</span>)</span><br><span class="line"><span class="comment"># 输出：</span></span><br><span class="line"><span class="comment"># hi</span></span><br><span class="line"><span class="comment"># 这是关于装饰器的测试</span></span><br></pre></td></tr></table></figure></p>
<p>这里要注意，由于此时的装饰器<code>log</code>有默认参数，所以必须以<code>@log()</code>的形式进行装饰。如果还是用<code>@log</code>，相当于<code>test = log(test)</code>，这就把test赋给了context而decorator缺少位置参数func。而用<code>@log()</code>则使test指向<code>decorator</code>，即实际上是这样的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test = log(context=<span class="string">"hi"</span>)(test)</span><br></pre></td></tr></table></figure></p>
<h2 id="常用的内置装饰器"><a href="#常用的内置装饰器" class="headerlink" title="常用的内置装饰器"></a>常用的内置装饰器</h2><p>python中的装饰器可以对函数进行扩展。</p>
<h3 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h3><p><strong>@property装饰器可以把类的方法变成属性</strong>。例如<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,score)</span>:</span></span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用Student类</span></span><br><span class="line">qiuyue = Student(<span class="number">90</span>)</span><br><span class="line">print(qiuyue.score) <span class="comment">#输出结果90</span></span><br></pre></td></tr></table></figure></p>
<p>可是这样也不无问题，比如当输入分数不合理（如1000）时，无法对分数进行检查。当然，可以对Student类附加方法实现检查分数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_score</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_score</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(score,int):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must is an integer!'</span>)</span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">100</span> <span class="keyword">or</span> value &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must between 0 to 100!'</span>)</span><br><span class="line">        self._score = value</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用Student类</span></span><br><span class="line">qiuyue = Student()</span><br><span class="line">qiuyue.set_score(<span class="number">90</span>)</span><br><span class="line">print(qiuyue.get_score()) <span class="comment">#输出90</span></span><br></pre></td></tr></table></figure></p>
<p>通过set方法对Student的score属性赋值，再用get方法获取score属性。这样就可以实现对score合法性的检查。但是为了一个属性特地写两个方法未免过于繁琐。所以用到装饰器@property封装set方法和get方法，实现对score属性赋值的同时进行数值合法性检查。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">score</span><span class="params">(self)</span></span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">self</span>.<span class="title">_score</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    @<span class="title">score</span>.<span class="title">setter</span></span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">score</span><span class="params">(self,value)</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">not</span> <span class="title">isinstance</span><span class="params">(value,int)</span>:</span></span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must is an integer!'</span>)</span><br><span class="line">        <span class="keyword">if</span> value &gt; <span class="number">100</span> <span class="keyword">or</span> value &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'score must between 0 to 100!'</span>)    </span><br><span class="line">        self._score = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">grade</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._score <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">elif</span> self._score &gt;= <span class="number">90</span>:</span><br><span class="line">            print(<span class="string">'优秀！'</span>)</span><br><span class="line">        <span class="keyword">elif</span> self._score &gt;=<span class="number">60</span>:</span><br><span class="line">            print(<span class="string">'及格！)</span></span><br><span class="line"><span class="string">        else:</span></span><br><span class="line"><span class="string">            print('</span>不及格！<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#调用Student类</span></span><br><span class="line"><span class="string">qiuyue = Student()</span></span><br><span class="line"><span class="string">qiuyue.score = 90</span></span><br><span class="line"><span class="string">print(qiuyue.score) # 输出90</span></span><br><span class="line"><span class="string">qiuyue.score = 1000 # 报错，ValueError</span></span><br><span class="line"><span class="string">qiuyue.grade = '</span>及格<span class="string">' # 报错</span></span><br><span class="line"><span class="string">qiuyue.grade # 输出优秀</span></span><br></pre></td></tr></table></figure>
<p>可以看到，@property装饰的第一个score，实际上是一个get方法，而@score.setter装饰的第二个score实际上是set方法。@score.setter其实是@property装饰器的副产品。这两个装饰器一个装饰get方法，一个装饰set方法，这样就使score方法变成了Student类的属性，在对score属性赋值（即set方法）时会自动对值的合法性进行检查，调用score属性即调用get方法。<br>@grade.setter并不是必须的，当缺少@grade.setter装饰器时grade属性变成只读属性，无法对其进行赋值，只能读取。</p>
<h3 id="classmethod与-staticmethod"><a href="#classmethod与-staticmethod" class="headerlink" title="@classmethod与@staticmethod"></a>@classmethod与@staticmethod</h3><p>在介绍类方法@classmethod与静态方法staticmethod前，先要清楚一个概念：类属性与实例属性是<strong>不同</strong>的。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plus</span><span class="params">()</span>:</span></span><br><span class="line">    num = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">f = Plus()</span><br><span class="line">f.num = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">print(Plus.num) <span class="comment"># 结果为1</span></span><br><span class="line">print(f.num) <span class="comment"># 结果为2</span></span><br></pre></td></tr></table></figure></p>
<p>众所周知，要调用类的方法，我们首先要把这个类实例化，然后通过<em>实例名.方法名</em>的方式调用。而@classmethod与@staticmethod都可以实现通过<em>类名.方法名</em>的方式调用方法。</p>
<h4 id="classmethod"><a href="#classmethod" class="headerlink" title="@classmethod"></a>@classmethod</h4><p>当类中有些方法不需要涉及实例，而需要涉及类，如对类属性的修改，往往使用@classmethod。用@classmethod修饰的方法不会将实例传入方法中，而会自动将自身类作为第一个参数传入。所以这个方法不需要写self参数，但需要一个cls参数代表这个类。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span><span class="params">()</span>:</span></span><br><span class="line">    species = <span class="string">'富士苹果'</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clsmed</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'苹果的种类为：%s'</span> % cls.species)</span><br><span class="line"></span><br><span class="line">Apple.clsmed() <span class="comment"># 输出：苹果的种类为：富士苹果</span></span><br></pre></td></tr></table></figure></p>
<h4 id="staticmethod"><a href="#staticmethod" class="headerlink" title="@staticmethod"></a>@staticmethod</h4><p>如果类中有些方法既不涉及类，也不涉及实例，可以用@staticmethod。@staticmethod既不会将实例传入方法，也不会将自身类传入方法。所以既没有self参数也没有cls参数。一般在这两种情况下适合用<code>@staticmethod</code>：</p>
<ol>
<li>一个方法不需要访问对象状态，其所需要的参数都是通过显示参数提供</li>
<li>一个方法只需要访问类的静态域</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span><span class="params">()</span>:</span></span><br><span class="line">    apple = <span class="number">1</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(self,data)</span>:</span></span><br><span class="line">        self.apple = data</span><br><span class="line">        print(<span class="string">'还有%s个苹果'</span> % self.apple)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stamed</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># 不需要访问实例对象</span></span><br><span class="line">        print(<span class="string">'没有苹果了'</span>)</span><br><span class="line"></span><br><span class="line">apple = Apple()</span><br><span class="line">apple.change(<span class="number">2</span>) <span class="comment"># 输出：还有2个苹果</span></span><br><span class="line">Apple.stamed() <span class="comment"># 输出： 没有苹果了</span></span><br></pre></td></tr></table></figure>
<p>下面这个例子加深区分：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span><span class="params">()</span>:</span></span><br><span class="line">    species = <span class="string">'富士苹果'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,data)</span>:</span></span><br><span class="line">        self.num = data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">common</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'还有%s个苹果'</span> % self.num)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clsmed</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'苹果的种类为：%s'</span> % cls.num)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stamed</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'没有苹果了'</span>)</span><br><span class="line"></span><br><span class="line">apple = Apple(<span class="number">2</span>)</span><br><span class="line">apple.common() <span class="comment"># 输出：还有2个苹果</span></span><br><span class="line">Apple.clsmed() <span class="comment"># 输出：苹果的种类为：富士苹果</span></span><br><span class="line">Apple.stamed() <span class="comment"># 输出：没有苹果了</span></span><br></pre></td></tr></table></figure></p>
<h3 id="wraps-func"><a href="#wraps-func" class="headerlink" title="@wraps(func)"></a>@wraps(func)</h3><p>函数的<code>__name__</code>方法可以取出函数名，看一个装饰器的例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hi'</span>)</span><br><span class="line"></span><br><span class="line">print(test.__name__)</span><br><span class="line"><span class="comment"># 输出：wrapper</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到，test的<code>__name__</code>属性被改变了，因为返回的那个wrapper()函数名字就是<code>wrapper</code>，所以，需要把原始函数的<code>__name__</code>等属性复制到wrapper()函数中，否则，有些依赖函数签名的代码执行就会出错。用functools.wraps可以解决这个问题：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'hello'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hi'</span>)</span><br><span class="line"></span><br><span class="line">print(test.__name__)</span><br><span class="line"><span class="comment"># 输出： test</span></span><br></pre></td></tr></table></figure></p>
<h1 id="Python的特点"><a href="#Python的特点" class="headerlink" title="Python的特点"></a>Python的特点</h1><p>像java，C#这种编译型语言，会将代码编译成二进制再运行。而python作为一种解释型语言，是<strong>动态的逐行解释代码</strong>的，也就是从脚本第一行开始，没有统一的入口。一个Python源码文件除了可以被直接执行外，还可以作为模块（也就是库）被其他.py文件导入。此时这个源码文件的文件名（不包括.py）就是库名。<br>python本身有很多有趣的方法，会在每一个python文件里自动生成，在特殊情况下还会自动调用，这种方法称之为魔法方法。魔法方法的形式为两个下划线(__)+方法名+两个下划线(__)。如：__new__。下面介绍一些常见的魔法方法。  </p>
<h2 id="file"><a href="#file" class="headerlink" title="__file__"></a>__file__</h2><p>通过下面一行代码，就能很直接地看出__file__的作用。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件位置为E:/python/test.py</span></span><br><span class="line">print(__file__)</span><br><span class="line"><span class="comment"># 输出E:/python/test.py</span></span><br></pre></td></tr></table></figure></p>
<p>可见，__file__代表了当前python文件的路径。而且如前面所言，这个方法是python自动实现的，不需要你去编写。  </p>
<h2 id="name"><a href="#name" class="headerlink" title="__name__"></a>__name__</h2><p>相信不少python初学者都见到过这样一段代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></p>
<p>可能很多人第一次看到这段代码的时候都会困惑：这个__main__我理解，是主函数的意思，可是这__name__是个什么东东？老规矩，上一段代码:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件位置为E:/python/test.py</span></span><br><span class="line">print(__name__)</span><br><span class="line"><span class="comment"># 输出__main__</span></span><br></pre></td></tr></table></figure></p>
<p>java，C等语言都会显示地定义一个main()函数，一个用C编写的程序都是以main()作为程序入口的。而python不同，哪个文件被直接执行，哪个文件的模块名就是__main__。现在说回__name__, __name__存放的就是当前python文件的名字，那么现在情况就很明显了，开头那段代码的意思是：如果这个文件是被直接运行的，就执行app.run()，如果这个文件是被别的文件导入后运行的，就会跳过app.run()。这样做的好处是避免了一些只能在主程序里执行的代码由于被导入了其他文件而错误执行。</p>
<h1 id="requirements-txt"><a href="#requirements-txt" class="headerlink" title="requirements.txt"></a>requirements.txt</h1><p>在查看别人的python项目时，常会见到一个requirements.txt文件，主要是说明这个项目依赖的模块及其版本，这样别人使用我们的项目时可以快速安装所需模块。我们可以用这个命令生成requirements.txt文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure></p>
<p>要导入这个文件里的模块也很简单，只要用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure></p>
<h1 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h1><p>GIL全称Global Interpreter Lock。Python的线程虽然是真正的线程，但解释器执行代码时，有一个GIL锁，任何Python线程执行前，必须先获得GIL锁，然后，每执行100条字节码，解释器就自动释放GIL锁，让别的线程有机会执行，换言之，对于某个特定时刻，一个进程里只有一个线程在运行。这个GIL全局锁实际上把所有线程的执行代码都给上了锁，所以，多线程在Python中只能交替执行，即使100个线程跑在100核CPU上，也只能用到1个核。</p>
<p>GIL锁的存在导致python不能很好地利用多核性能，但是可以通过多进程实现多任务。不同进程之间的GIL互不影响。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/10/《Python-cookbook》笔记/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/10/《Python-cookbook》笔记/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">《Python cookbook》第一章</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-10 21:18:46" itemprop="dateCreated datePublished" datetime="2018-06-10T21:18:46+08:00">2018-06-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-07-10 17:23:19" itemprop="dateModified" datetime="2018-07-10T17:23:19+08:00">2018-07-10</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/10/《Python-cookbook》笔记/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/10/《Python-cookbook》笔记/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/10/《Python-cookbook》笔记/" class="leancloud_visitors" data-flag-title="《Python cookbook》第一章">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h1><ol>
<li>dict的key是唯一的，而values不保证唯一。</li>
<li>dict()函数语法：<br>参数说明<ul>
<li>**kwargs – 关键字</li>
<li>mapping – 元素的容器。</li>
<li>iterable – 可迭代对象<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dict</span><span class="params">(**kwarg)</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">dict</span><span class="params">(mapping, **kwarg)</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">dict</span><span class="params">(iterable, **kwarg)</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<p>下面这三种调用方式是可接受的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dict(a=<span class="string">'hello'</span>,b=<span class="string">'hi'</span>) <span class="comment"># &#123;'a':'hello','b':'hi'&#125;</span></span><br><span class="line">dict(zip([<span class="string">'a'</span>,<span class="string">'b'</span>],[<span class="string">'hello'</span>,<span class="string">'hi'</span>])) <span class="comment"># 映射函数方式构造字典，zip()返回一个迭代器 &#123;'a':'hello','b':'hi'&#125;</span></span><br><span class="line">dict([(<span class="string">'a'</span>,<span class="string">'hello'</span>),(<span class="string">'b'</span>,<span class="string">'hi'</span>)]) <span class="comment"># &#123;'a':'hello','b':'hi'&#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="让key映射到多个values上"><a href="#让key映射到多个values上" class="headerlink" title="让key映射到多个values上"></a>让key映射到多个values上</h1><p>多数情况下，字典的key与values并不是1对1而是1对多。例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;</span><br><span class="line">    <span class="string">'a'</span>:[<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    <span class="string">'b'</span>:[<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">e = &#123;</span><br><span class="line">    <span class="string">'c'</span>:&#123;<span class="number">35</span>,<span class="number">345</span>&#125;,</span><br><span class="line">    <span class="string">'d'</span>: &#123;<span class="number">3222</span>,<span class="number">89</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>values是使用list还是set完全取决于需要，如果要保持顺序就用list，如果要保证唯一性而顺序不是那么重要就用set。<br>如果手动创建一个list或者set来存放values，再将之与key对应起来会使代码很混乱。这时可以用collenctions模块的defaultdict()类。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">d = defaultdict(list)</span><br><span class="line">d[<span class="string">'a'</span>].append(<span class="number">2</span>)</span><br><span class="line">d[<span class="string">'a'</span>].append(<span class="number">2</span>)</span><br><span class="line">d[<span class="string">'a'</span>].append(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">e = defaultdict(set)</span><br><span class="line">e[<span class="string">'c'</span>].add(<span class="number">35</span>)</span><br><span class="line">e[<span class="string">'c'</span>].add(<span class="number">345</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="让dict保持有序"><a href="#让dict保持有序" class="headerlink" title="让dict保持有序"></a>让dict保持有序</h1><p><del>通常情况下，当我们对字典做迭代时，并不能保证迭代是按排列顺序进行的。<br>我们想创建一个字典，同时当对字典做迭代或序列化操作时，也能控制其中元素的顺序。<br>可以使用collections模块中的OrderDict类。当对字典做迭代时，它会严格按照元素初始添加的顺序进行。值得一提的是，OrderDict()内部维护了一个双向列表用于记录dict本身与key添加顺序，所以它的大小也是一般dict的两倍多。</del> <code>在python3.7中，字典对象的 keys 按插入顺序排列，也就是说已经不需要使用OrderDict了</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderDict</span><br><span class="line">d = OrderDict()</span><br><span class="line">d[<span class="string">'foo'</span>] = <span class="number">1</span></span><br><span class="line">d[<span class="string">'bar'</span>] = <span class="number">2</span></span><br><span class="line">d[<span class="string">'spam'</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> d:</span><br><span class="line">    print(d[key])</span><br><span class="line"><span class="comment"># 输出1,2,3</span></span><br></pre></td></tr></table></figure></p>
<p>这在我们要精确控制json的时候特别有用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">json.dumps(d) <span class="comment"># 将一个OrderedDict对象转化为json</span></span><br></pre></td></tr></table></figure></p>
<h1 id="与字典有关的计算问题"><a href="#与字典有关的计算问题" class="headerlink" title="与字典有关的计算问题"></a>与字典有关的计算问题</h1><p>我们想在字典上进行各式各样的计算，如求最小值、最大值，排序等。假设我们有这样一个字典：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">price = &#123;</span><br><span class="line">    <span class="string">'Apple'</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">'Banana'</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="string">'Pear'</span>: <span class="number">12</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果尝试在字典上执行常见的数据操作，将发现它们只会处理键，而不是值。例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">max(price) <span class="comment"># Pear</span></span><br><span class="line">min(price) <span class="comment"># Apple</span></span><br></pre></td></tr></table></figure></p>
<p>通常这没有意义，因为我们更多时候是想要对values进行处理，当然可以将<code>price.values()</code>作为参数传给比较函数，即使这样也没有意义，因为我们想知道最值对应的key（如最贵的水果是什么）。利用zip(iterable，iterable)函数的解决方案是生成一个values-key生成器。zip有拉链的意思，这个函数就像拉链一样把两个迭代对象的值一一对应起来，每组对应起来的值放在一个二元tuple中。</p>
<p>在这样的元组中进行比较时，values会先进行比较，然后才是key。例如我们可以这样找出最贵与最便宜的水果：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">max(zip(prices.values(), prices.keys())) <span class="comment"># (12, 'Pear')</span></span><br><span class="line">min(zip(prices.values(), prices.keys())) <span class="comment"># (8, 'Banana')</span></span><br></pre></td></tr></table></figure></p>
<h1 id="找出两个字典的相同点"><a href="#找出两个字典的相同点" class="headerlink" title="找出两个字典的相同点"></a>找出两个字典的相同点</h1><p>这很像数学上的交集。类似的操作还有求并集，差集。python中的set就是一个典型的集合对象，符合集合的一切特征：无序性，唯一性。（由于集合的无序性，set并不保证元素的顺序是固定的，所以不支持索引操作，类似的dict也是无序的，所以也不支持位置索引）</p>
<p>考虑下面两个dict<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;</span><br><span class="line">    <span class="string">'x'</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="string">'y'</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="string">'z'</span>: <span class="number">150</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b = &#123;</span><br><span class="line">    <span class="string">'x'</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="string">'y'</span>: <span class="number">39</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>dict的keys()方法与items()方法返回的都是集合对象，所以可以直接对其应用常用的集合操作。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找出a与b的交集</span></span><br><span class="line">a.items() &amp; b.items() <span class="comment"># &#123;('x', 100)&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找出a与b的key交集</span></span><br><span class="line">a.keys() &amp; b.keys() <span class="comment"># &#123;'x', 'y'&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找出a与b的不同</span></span><br><span class="line">a.items() - b.items() <span class="comment"># &#123;('z': 150), ('y', 80)&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>dict的<strong>values()方法并不支持集合操作</strong>，这是由dict的values没有唯一性决定的。如果想对values进行集合操作就要先用set()方法将values转化为集合。</p>
<h1 id="对切片命名"><a href="#对切片命名" class="headerlink" title="对切片命名"></a>对切片命名</h1><p>随着代码越来越复杂，时间越隔越久，当初做切片时为什么要选那几个数字早就想不起来了。这时代码已经无法阅读，到处都是硬编码的切片索引。我们对切片命名，这样大大增加了代码的可阅读性。</p>
<p>内置的slice()函数会创建一个切片对象，可以用在任何允许进行切片操作的地方。与普通的切片操作一样，slice()的截取是<strong>前闭后开</strong>的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = slice(<span class="number">6</span>,)</span><br><span class="line">b = slice(<span class="number">0</span>,<span class="keyword">None</span>,<span class="number">2</span>)</span><br><span class="line">x = <span class="string">'hello world'</span></span><br><span class="line">print(x[a]) <span class="comment"># 'world'</span></span><br><span class="line">print(x[b]) <span class="comment"># 'hlowrd'</span></span><br></pre></td></tr></table></figure></p>
<h1 id="筛选列表中的元素"><a href="#筛选列表中的元素" class="headerlink" title="筛选列表中的元素"></a>筛选列表中的元素</h1><p>有时我们想要对一个列表中的元素进行筛选，常用的方法有以下几种：</p>
<h2 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h2><p>找出列表中比50000大的数并将其余的数视为1:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">12646</span>, <span class="number">34</span>, <span class="number">233426</span>, <span class="number">987346</span>, <span class="number">35436</span>, <span class="number">3867</span>]</span><br><span class="line">[i <span class="keyword">if</span> i &gt; <span class="number">50000</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> l] <span class="comment"># [1, 1, 233426, 987346, 1, 1]</span></span><br></pre></td></tr></table></figure></p>
<p>如果元素比较多，为了避免占用过多内存，可以改用<code>生成器表达式</code>。<code>生成器表达式</code>与列表推导式相似，把方括号改成圆括号就可以了：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">12646</span>, <span class="number">34</span>, <span class="number">233426</span>, <span class="number">987346</span>, <span class="number">35436</span>, <span class="number">3867</span>]</span><br><span class="line">k = (i <span class="keyword">if</span> i &gt; <span class="number">50000</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> l)</span><br><span class="line">next(k) <span class="comment"># 1</span></span><br><span class="line">next(k) <span class="comment"># 1</span></span><br><span class="line">next(k) <span class="comment"># 233426</span></span><br><span class="line">next(k) <span class="comment"># 987346</span></span><br><span class="line"><span class="comment"># ···</span></span><br></pre></td></tr></table></figure></p>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>与java类似，python也有匿名函数<code>lambda()</code>。其语法如下：</p>
<blockquote>
<p>lambda [arg1[, arg2, … argN]]: expression</p>
</blockquote>
<p>匿名函数顾名思义就是没有名字的函数。有时一些函数只在某个特定的地方用1次，如果对这种函数命名很容易污染命名空间。通过<code>lambda()</code>可以快速定义一个简单的函数，<strong>注意：<code>lambda()</code>会将<code>expression</code>作为返回值</strong>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">lambda</span> x, y: x + y)(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># 3</span></span><br></pre></td></tr></table></figure></p>
<h2 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h2><p><code>map(function, sequence)</code>提供一种映射，对sequence的每个元素都调用一次function。如果对元素的处理比较复杂，不适合写在列表推导式里，可以用<code>map()</code>，<code>map()</code>创建了一个迭代器：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> name != <span class="string">'Lucy'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'hello '</span> + name</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Woops'</span></span><br><span class="line"></span><br><span class="line">g = map(hello, [<span class="string">'Mike'</span>, <span class="string">'David'</span>, <span class="string">'Luck'</span>,<span class="string">'Susan'</span>])</span><br><span class="line">next(g) <span class="comment"># 'hello Mike'</span></span><br><span class="line">next(g) <span class="comment"># 'hello Davidn'</span></span><br><span class="line">next(g) <span class="comment"># 'Woops'</span></span><br><span class="line">next(g) <span class="comment"># 'hello Susan'</span></span><br><span class="line"></span><br><span class="line">g = map(<span class="keyword">lambda</span> x, y: x + y, range(<span class="number">1</span>,<span class="number">10</span>), range(<span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line">list(g) <span class="comment"># [2, 4, 6, 8, 10, 12, 14, 16, 18]</span></span><br></pre></td></tr></table></figure></p>
<h2 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h2><p>与<code>map(function, sequence)</code>类似，<code>filter(function, sequence)</code>也提供了一种映射，对sequence的每个元素都调用一次function。不同之处在于<code>map()</code>将function的返回值放入迭代器中，而<code>filter()</code>将使function为True的元素放入迭代器。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_num</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        int(n)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">354</span>, <span class="number">87</span>, <span class="string">'g'</span>]</span><br><span class="line">g = filter(is_num, l)</span><br><span class="line">list(g) <span class="comment"># [354, 87]</span></span><br></pre></td></tr></table></figure></p>
<h1 id="随机选择"><a href="#随机选择" class="headerlink" title="随机选择"></a>随机选择</h1><p>我们想从序列中随机挑选出元素，或者想生成随机数。可以使用<code>random</code>模块</p>
<h2 id="从序列中随机选择"><a href="#从序列中随机选择" class="headerlink" title="从序列中随机选择"></a>从序列中随机选择</h2><p>从序列中随机挑选元素,可用<code>random.choice()</code>函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">values = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">random.choice(values) <span class="comment"># 2</span></span><br><span class="line">random.choice(values) <span class="comment"># 5</span></span><br><span class="line">random.choice(values, <span class="number">2</span>) <span class="comment"># [1, 4]</span></span><br><span class="line">random.choice(values, <span class="number">3</span>) <span class="comment"># [3, 2, 6]</span></span><br></pre></td></tr></table></figure></p>
<h2 id="产生随机整数"><a href="#产生随机整数" class="headerlink" title="产生随机整数"></a>产生随机整数</h2><p>用<code>random.randint()</code>函数，<strong>random.randint()是前闭后闭的</strong>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">random.randint(<span class="number">1</span>, <span class="number">10</span>) <span class="comment"># 5</span></span><br><span class="line">random.randint(<span class="number">0</span>, <span class="number">15</span>) <span class="comment"># 15</span></span><br></pre></td></tr></table></figure></p>
<h2 id="产生0到1之间的浮点数"><a href="#产生0到1之间的浮点数" class="headerlink" title="产生0到1之间的浮点数"></a>产生0到1之间的浮点数</h2><p>用<code>random.random()</code>函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">randon.randon() <span class="comment"># 0.2101003475395049</span></span><br><span class="line">random.randon() <span class="comment"># 0.16454716916733036</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/10/Python合并列表、格式化输出与代码思路/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/10/Python合并列表、格式化输出与代码思路/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">Python合并列表、格式化输出与代码思路</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-10 20:58:41" itemprop="dateCreated datePublished" datetime="2018-06-10T20:58:41+08:00">2018-06-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-11-15 19:04:27" itemprop="dateModified" datetime="2018-11-15T19:04:27+08:00">2018-11-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/10/Python合并列表、格式化输出与代码思路/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/10/Python合并列表、格式化输出与代码思路/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/10/Python合并列表、格式化输出与代码思路/" class="leancloud_visitors" data-flag-title="Python合并列表、格式化输出与代码思路">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h1><p>Python提供了很多合并的方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""合并两个列表"""</span></span><br><span class="line">l1 = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line">l2 = [<span class="string">'d'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># + 操作，不会改变原来的列表</span></span><br><span class="line">l3 = l1 + l2 <span class="comment"># ['a', 'b', 'c', 'd', 'f', 'g']</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># extend()方法</span></span><br><span class="line">l2.extend(l1) <span class="comment"># l2变成['d', 'f', 'g', 'a', 'b', 'c']，l1不变</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ** 操作,不会改变原来的列表</span></span><br><span class="line">l3 = [**l2, **l1] <span class="comment"># ['d', 'f', 'g', 'a', 'b', 'c']</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""合并两个字典"""</span></span><br><span class="line">d1 = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>:<span class="number">2</span>&#125;</span><br><span class="line">d2 = &#123;<span class="string">'d'</span>: <span class="number">3</span>, <span class="string">'g'</span>: <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ** 操作</span></span><br><span class="line">d3 = &#123;**d2, **d1&#125; <span class="comment"># &#123;'a': 1, 'd': 3, 'b': 2, 'g': 4&#125;, 如果有重复键，则以第一个参数为准</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># update()方法</span></span><br><span class="line">d1.update(d2) <span class="comment"># d1变成&#123;'d': 3, 'b': 2, 'a': 1, 'g': 4&#125;，d2不变</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># * 操作，取两字典key值的集合</span></span><br><span class="line">d3 = &#123;*d2, *d1&#125; <span class="comment"># &#123;'d', 'a', 'b', 'g'&#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="封装协议"><a href="#封装协议" class="headerlink" title="封装协议"></a>封装协议</h1><p>常常可以看到封装协议这个词，比如smtplib.SMTP类就封装了smtp协议，Flask-httpauth.HTTPBasicAuth类封装了http协议。</p>
<p>所谓某个包封装了某个协议的意思是包为这个协议提供了一系列接口，使用者只需要调用这些接口就会自动实现这些协议,这样我们就不用自己再去造轮子了。</p>
<p>下面这段代码就是一个例子，我们调用SMTP类的connect()方法连接QQ邮箱服务器，starttls()方法实现smtp协议的tls连接，login()方法实现与服务器连接。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> smtplib <span class="keyword">import</span> SMTP</span><br><span class="line">smtp = SMTP()</span><br><span class="line">smtp.connect(host=<span class="string">'smtp.qq.com'</span>, port=<span class="number">587</span>)</span><br><span class="line">smtp.ehlo()</span><br><span class="line">smtp.starttls()</span><br><span class="line">smtp.ehlo()</span><br><span class="line">smtp.login(<span class="string">'xxxxx@qq.com'</span>, <span class="string">'passwd'</span>)</span><br></pre></td></tr></table></figure></p>
<p>可以看到，我们只是调用了一系列接口就自动遵循smtp协议与QQ邮箱服务器连接上了，至于方法内部是如何实现的我们并不需要了解。</p>
<h1 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h1><p>用<code>join()</code>方法可以把字符串插入到迭代对象中。相当于<code>split()</code>的逆操作：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = [<span class="string">'hello'</span>, <span class="string">' '</span>, <span class="string">'world'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">''</span>.join(l) <span class="comment"># 'hello world'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">'-'</span>.join(l) <span class="comment"># hello- - world</span></span><br></pre></td></tr></table></figure></p>
<h1 id="编写分支条件"><a href="#编写分支条件" class="headerlink" title="编写分支条件"></a>编写分支条件</h1><h2 id="提前结束"><a href="#提前结束" class="headerlink" title="提前结束"></a>提前结束</h2><p>最常见的分支条件当然就是<code>if...else...</code>这种格式了。当时当代码中有多层if嵌套时会大大降低可读性。这是可以用<code>提前结束</code>来减少if的使用：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_fruit</span><span class="params">(nerd, store)</span>:</span></span><br><span class="line">    <span class="string">"""去水果店买苹果</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - 先得看看店是不是在营业</span></span><br><span class="line"><span class="string">    - 如果有苹果的话，就买 1 个</span></span><br><span class="line"><span class="string">    - 如果钱不够，就回家取钱再来</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> store.is_open():</span><br><span class="line">        <span class="keyword">if</span> store.has_stocks(<span class="string">"apple"</span>):</span><br><span class="line">            <span class="keyword">if</span> nerd.can_afford(store.price(<span class="string">"apple"</span>, amount=<span class="number">1</span>)):</span><br><span class="line">                nerd.buy(store, <span class="string">"apple"</span>, amount=<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nerd.go_home_and_get_money()</span><br><span class="line">                <span class="keyword">return</span> buy_fruit(nerd, store)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> MadAtNoFruit(<span class="string">"no apple in store!"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> MadAtNoFruit(<span class="string">"store is closed!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用“提前结束”</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_fruit</span><span class="params">(nerd, store)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> store.is_open():</span><br><span class="line">        <span class="keyword">raise</span> MadAtNoFruit(<span class="string">"store is closed!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> store.has_stocks(<span class="string">"apple"</span>):</span><br><span class="line">        <span class="keyword">raise</span> MadAtNoFruit(<span class="string">"no apple in store!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nerd.can_afford(store.price(<span class="string">"apple"</span>, amount=<span class="number">1</span>)):</span><br><span class="line">        nerd.buy(store, <span class="string">"apple"</span>, amount=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        nerd.go_home_and_get_money()</span><br><span class="line">        <span class="keyword">return</span> buy_fruit(nerd, store)</span><br></pre></td></tr></table></figure></p>
<h2 id="封装复杂逻辑"><a href="#封装复杂逻辑" class="headerlink" title="封装复杂逻辑"></a>封装复杂逻辑</h2><p>一个判断中如果有多个逻辑条件并列容易使人发晕。一个明智的做法是把这些条件封装起来：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果活动还在开放，并且活动剩余名额大于 10，为所有性别为女性，或者级别大于 3</span></span><br><span class="line"><span class="comment"># 的活跃用户发放 10000 个金币</span></span><br><span class="line"><span class="keyword">if</span> activity.is_active <span class="keyword">and</span> activity.remaining &gt; <span class="number">10</span> <span class="keyword">and</span> \</span><br><span class="line">        user.is_active <span class="keyword">and</span> (user.sex == <span class="string">'female'</span> <span class="keyword">or</span> user.level &gt; <span class="number">3</span>):</span><br><span class="line">    user.add_coins(<span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 封装逻辑</span></span><br><span class="line"><span class="keyword">if</span> activity.is_active <span class="keyword">and</span> user.match_activity_condition():</span><br><span class="line">    user.add_coins(<span class="number">10000</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure></p>
<h2 id="多用肯定"><a href="#多用肯定" class="headerlink" title="多用肯定"></a>多用肯定</h2><p>在做逻辑判断时，常会使用下面的代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果用户没有登录或者用户没有使用 chrome，拒绝提供服务</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> user.has_logged_in <span class="keyword">or</span> <span class="keyword">not</span> user.is_from_chrome:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"our service is only available for chrome logged in user"</span></span><br></pre></td></tr></table></figure></p>
<p>人类不擅长处理否定逻辑和或逻辑，所以最好多用肯定与且：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> (user.has_logged_in <span class="keyword">and</span> user.is_from_chrome):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"our service is only available for chrome logged in user"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="使用all-和any"><a href="#使用all-和any" class="headerlink" title="使用all()和any()"></a>使用all()和any()</h2><p><code>all(seq)</code>当sqe全为<code>True</code>时返回<code>True</code>，否则返回False。<br><code>any(seq)</code>只要seq中任何一个<code>True</code>就返回 True，否则返回False<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all_numbers_gt_10</span><span class="params">(numbers)</span>:</span></span><br><span class="line">    <span class="string">"""仅当序列中所有数字大于 10 时，返回 True</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> numbers:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用all()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all_numbers_gt_10_2</span><span class="params">(numbers)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bool(numbers) <span class="keyword">and</span> all(n &gt; <span class="number">10</span> <span class="keyword">for</span> n <span class="keyword">in</span> numbers)</span><br></pre></td></tr></table></figure></p>
<h1 id="索引迭代"><a href="#索引迭代" class="headerlink" title="索引迭代"></a>索引迭代</h1><p>通常我们想要找出迭代对象中某个值的索引，比如找出列表中第一个重复字符的索引，我们会这样做：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]</span><br><span class="line">visited = dict()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(l)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(l)):</span><br><span class="line">        <span class="keyword">if</span> l[i] <span class="keyword">in</span> visited.keys():</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        visited[l[i]] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure></p>
<p>这种方法虽然可行，但是未免太蠢了。又是range()又是len()的，一点不简洁。<code>enumerate()</code>可以把一个迭代对象变成<code>索引-元素树</code>。（enumerate： 枚举，列举）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>]</span><br><span class="line">visited = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(l)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(l):</span><br><span class="line">        <span class="keyword">if</span> v <span class="keyword">in</span> visited.keys():</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        visited[v] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure></p>
<p>这样就变得干净清爽多了。</p>
<h1 id="对数值做格式化输出"><a href="#对数值做格式化输出" class="headerlink" title="对数值做格式化输出"></a>对数值做格式化输出</h1><p>用<code>format()</code>方法可以实现字符串格式化。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'hello &#123;&#125;'</span>.format(<span class="string">'Mike'</span>) <span class="comment"># 'hello Mike'</span></span><br></pre></td></tr></table></figure></p>
<p>除此之外，<code>format()</code>还有很多有趣的用法：</p>
<h2 id="格式限定符"><a href="#格式限定符" class="headerlink" title="格式限定符"></a>格式限定符</h2><p>为了限定输出格式，需要在<code>{}</code>里加上<code>:</code></p>
<h3 id="填充与对齐"><a href="#填充与对齐" class="headerlink" title="填充与对齐"></a>填充与对齐</h3><p><code>&gt;</code>、<code>&lt;</code>、<code>^</code>表示右对齐，左对齐，居中。后面带宽度</p>
<p><code>:</code>后面带填充的字符。默认是空格<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'there are &#123;:&gt;3&#125; apples in here'</span>.format(<span class="number">5</span>) <span class="comment"># 'there are   5 apples in here'</span></span><br><span class="line"><span class="string">'there are &#123;:&lt;3&#125; apples in here'</span>.format(<span class="number">5</span>) <span class="comment"># 'there are 5   apples in here'</span></span><br><span class="line"><span class="string">'there are &#123;:^3&#125; apples in here'</span>.format(<span class="number">5</span>) <span class="comment"># 'there are  5  apples in here'</span></span><br><span class="line"><span class="string">'there are &#123;:0&gt;3&#125; apples in here'</span>.format(<span class="number">5</span>) <span class="comment"># 'there are 005 apples in here'</span></span><br></pre></td></tr></table></figure></p>
<h3 id="控制精度"><a href="#控制精度" class="headerlink" title="控制精度"></a>控制精度</h3><p>输出浮点数时常常要控制精度：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'圆周率约等于&#123;:.2f&#125;'</span>.format(<span class="number">3.1415926</span>) <span class="comment"># '圆周率约等于3.14'</span></span><br></pre></td></tr></table></figure></p>
<p>其中<code>2</code>表示保留到小数点后两位，遵循4舍5入原则。<code>f</code>表示数据是浮点数。</p>
<p>也可以控制整体的位数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'圆周率约等于&#123;:.2&#125;'</span>.format(<span class="number">3.1415926</span>) <span class="comment"># '圆周率约等于3.1'</span></span><br><span class="line"><span class="string">'圆周率约等于&#123;:.4&#125;'</span>.format(<span class="number">3.1415926</span>) <span class="comment"># '圆周率约等于3.142'</span></span><br></pre></td></tr></table></figure></p>
<p>除了<code>format()</code>之外，还可以用传统的占位符对输出进行格式化：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'圆周率约等于%.2f'</span> % (<span class="number">3.1415</span>) <span class="comment"># '圆周率约等于3.14'</span></span><br><span class="line"><span class="string">'圆周率约等于%8.2f'</span> % (<span class="number">3.141</span>) <span class="comment"># '圆周率约等于    3.14'</span></span><br><span class="line"><span class="string">'圆周率约等于%08.2f'</span> % (<span class="number">3.141</span>) <span class="comment"># '圆周率约等于00003.14'</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/07/计算机网络之应用层/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/07/计算机网络之应用层/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">计算机网络之应用层</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-07 21:53:17" itemprop="dateCreated datePublished" datetime="2018-06-07T21:53:17+08:00">2018-06-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-12 19:17:51" itemprop="dateModified" datetime="2018-06-12T19:17:51+08:00">2018-06-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/计算机网络/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/07/计算机网络之应用层/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/07/计算机网络之应用层/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/07/计算机网络之应用层/" class="leancloud_visitors" data-flag-title="计算机网络之应用层">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h1><p>一个进程可以理解为运行在端系统中的的一个程序。当进程运行在相同的端系统上时，它们使用进程间通信机制相互通信。而在不同的端系统上，通过跨越计算机网络交换<code>报文</code>实现进程间的通信。</p>
<p>多数应用程序由通信进程对组成，每对中的两个进程互相发送报文，从一个进程向另一个进程发送报文就必须经过下面的计算机网络。进程通过一个被称为<code>套接字</code>的软件接口向网络发送报文和接受报文。<code>套接字</code>类似于一栋屋子的门，无论是要进入屋子还是离开屋子，都要进过门。<code>套接字</code>是应用层与运输层的接口。在运输层，开发者对于<code>套接字</code>几乎没有控制权，只能</p>
<ol>
<li>选择运输层协议</li>
<li>设定几个参数，如最大缓存、最大报文段长度等</li>
</ol>
<h2 id="进程寻址"><a href="#进程寻址" class="headerlink" title="进程寻址"></a>进程寻址</h2><p>为了与另一个端系统通信，必须知道：</p>
<ol>
<li>另一端系统的地址</li>
<li>定义在目的端系统中的接收进程的标志符</li>
</ol>
<p>端系统地址由<code>IP地址</code>确定，而接收进程标志符由<code>端口</code>确定。</p>
<h1 id="几种常见的应用层协议"><a href="#几种常见的应用层协议" class="headerlink" title="几种常见的应用层协议"></a>几种常见的应用层协议</h1><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>HTTP（超文本传输协议）是Web的核心。在Web应用中，客户与服务器之间是通过HTTP报文进行会话的。而HTTP协议定义了报文格式与交换方式。Web服务器实现了HTTP的服务器端，用于存储Web对象，每个对象由url寻址。</p>
<p>HTTP使用<code>TCP</code>作为它的支撑运输协议。一次完整的<code>请求——相应</code>流程是这样的：</p>
<ol>
<li>HTTP客户端首先发起一个与服务器的TCP连接，一旦连接建立，该浏览器进程与服务器进程就可以通过套接字接口访问TCP</li>
<li>客户向它的<code>套接字</code>接口发送HTTP请求报文</li>
<li>客户端收到请求报文并生成相应的相应报文，通过客户端的<code>套接字</code>发送HTTP响应报文</li>
<li>客户端从<code>套接字</code>接受响应报文</li>
</ol>
<h3 id="Web缓存器"><a href="#Web缓存器" class="headerlink" title="Web缓存器"></a>Web缓存器</h3><p>Web缓存器也叫<code>代理服务器</code>，如Nginx，uwsgi等，它是能够代表初始Web服务器来满足HTTP请求的网络实体。代理服务器有自己的磁盘空间，在存储空间中保存最近请求过的对象的副本。</p>
<p>在客户端与服务器之间部署一层代理服务器，大大减轻了服务器的负担。在一次请求过后，代理服务器缓存了这次响应对象。对于下一次相同的请求，代理服务器向服务器确认两次响应对象是否相同，如果是一样的则代理服务器直接把上次响应对象返回给客户。</p>
<h2 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h2><p>通过SMTP（简单邮件传输协议）实现发送邮件，只能包含7位的ASCII码。因特网电子邮件系统由3部分组成：</p>
<ul>
<li>用户代理。常见的邮件客户端如Outlook等都是用户代理，如果是通过Web端发送邮件，那么浏览器是用户代理。用户代理负责读写邮件、与邮件服务器交互</li>
<li>邮件服务器。通常由企业提供，如QQ邮箱的服务器<code>smtp.qq.com</code>，126邮箱服务器<code>smtp.126.com</code></li>
<li>SMTP。负责在邮件服务器之间发送邮件</li>
</ul>
<p>一个典型的发送邮件的过程是：</p>
<ol>
<li>从发送方的用户代理开始，传输到发送方的邮件服务器</li>
<li>从发送方的邮件服务器发到接收方的邮件服务器，然后被分发到接收方的邮箱中</li>
<li>接收方通过用户代理从邮箱获取邮件</li>
</ol>
<p>SMTP是因特网电子协议中的主要应用层协议，它是用TCP可靠数据传输服务。</p>
<p>SMTP规定邮件报文首部必须包含关键字<code>From:</code>与<code>To:</code>，可以包含关键字<code>Subject:</code>。</p>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>如果把客户向服务器发送报文比作打电话，那么服务器的IP地址是电话号码，域名是号码主人的姓名，而DNS（Domain Name System域名系统）就是电话簿，把姓名和电话号码联系起来。</p>
<p>DNS是：</p>
<ol>
<li>一个由分层的DNS服务器实现的分布式数据库</li>
<li>一个使主机能够查询分布式数据库的应用层协议</li>
</ol>
<p>DNS提供的服务有：</p>
<ul>
<li>域名解析服务</li>
<li>主机别名服务</li>
<li>邮件服务器别名服务</li>
<li>负载均衡。将一个域名与多个IP地址对应起来，当客户对域名发出一个DNS请求时，每次响应都循环<br>这些IP地址的次序。由于客户总是向排在最前面的IP地址发送HTTP请求，由此实现了负载均衡。</li>
</ul>
<p>获得一个域名的IP地址的过程如下：</p>
<ol>
<li>浏览器把域名发送到用户主机上的DNS客户端 </li>
<li>DNS客户端向DNS服务器发送一个包含主机名的请求</li>
<li>DNS服务器通过迭代查找，找出相应的域名——&gt;IP地址间的映射关系，生成一个响应报文并返回</li>
<li>DNS客户端收到响应报文，把报文中的IP地址传给浏览器</li>
</ol>
<h3 id="DNS工作机理"><a href="#DNS工作机理" class="headerlink" title="DNS工作机理"></a>DNS工作机理</h3><p>DNS是分层的，它们之间的层级关系如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根DNS服务器 ————&gt; 顶级域名DNS服务器 ————&gt; 权威服务器（通常为机构DNS服务器）</span><br></pre></td></tr></table></figure></p>
<p>DNS查询方式有两种：<code>迭代查询</code>与<code>递归查询</code></p>
<h4 id="迭代查询"><a href="#迭代查询" class="headerlink" title="迭代查询"></a>迭代查询</h4><p>客户首先与根DNS服务器联系，根据域名后缀，根DNS返回相应的顶级域名DNS服务器地址，客户再与顶级DNS服务器联系，顶级域名DNS服务器根据域名返回权威服务器IP地址以此类推。</p>
<p>举个例子：想要查询 www.qiuyueqy.com 的IP地址。需要经过如下几个步骤：</p>
<ol>
<li>客户向根DNS服务器发送请求，根服务器根据<code>com</code>返回comDNS服务器的IP地址</li>
<li>客户向comDNS服务器发送请求，comDNS服务器根据<code>qiuyueqy</code>返回qiuyueqy.comDNS服务器的IP地址</li>
<li>客户向qiuyueqy.comDNS服务器发送请求，qiuyueqy.comDNS服务器根据<code>www</code>返回www.qiuyueqy.com的IP地址</li>
</ol>
<h4 id="递归查询"><a href="#递归查询" class="headerlink" title="递归查询"></a>递归查询</h4><p>与迭代查询不同之处在于递归查询是客户向根DNS发请求，根DNS向顶级域名DNS发请求，顶级域名DNS向权威DNS发请求……最后的结果是层层传回给客户。</p>
<h3 id="本地DNS服务器"><a href="#本地DNS服务器" class="headerlink" title="本地DNS服务器"></a>本地DNS服务器</h3><p>本地DNS服务器不属于DNS层级结构。每个ISP都有一个本地DNS服务器，当 主机进行DNS查询时，查询被发送到本地DNS服务器，本地DNS服务器作为代理将查询转发给层级DNS服务器。</p>
<h3 id="DNS缓存"><a href="#DNS缓存" class="headerlink" title="DNS缓存"></a>DNS缓存</h3><p>由上可知，为了获取一个DNS地址进行了很多次请求，这就影响了速度。为了加快响应速度，DNS服务器有缓存机制：在一个请求链中，当某DNS服务器接收到一个DNS回答，它能将该回答中的信息缓存到本地存储器中，类似于Web缓存器。在一段时间（默认为两天）后将缓存信息丢弃。</p>
<h3 id="DNS记录"><a href="#DNS记录" class="headerlink" title="DNS记录"></a>DNS记录</h3><p>共同实现DNS分布式数据库的所有DNS服务器存储了<code>资源记录(Resource Record,RR)</code>，RR提供主机名到IP地址之间的映射。资源记录是一个包含了下列字段的4元祖：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(Name,Value,Type,TTL)</span><br></pre></td></tr></table></figure></p>
<p>TTL是该记录的生存时间，它决定资源记录从缓存中删除的时间</p>
<ol>
<li>Type=A，则Name是主机名，Value是该主机名对应的IP地址</li>
<li>Type=NS，则Name是个域(foo.com)，Value是知道如何获得该域主机IP地址的权威DNS服务器的主机名(dns.foo.com)</li>
<li>Type=CNAME，则Value是别名为Name的主机的规范主机名。通俗的说就是域名到域名。如(qiuyueqy.com, qiuyue9971.coding.me,CNAME)</li>
<li>Type=MX，则Value是别名为Name的邮件服务器的规范主机名。MX允许邮件服务器具有简单的别名，例如(foo.com, mail.bar.foo.com,MX)</li>
</ol>
<h2 id="P2P"><a href="#P2P" class="headerlink" title="P2P"></a>P2P</h2><p>P2P（Peer to Peer）应用的几个特点：</p>
<ul>
<li>没有服务器</li>
<li>任意端系统之间直接互联</li>
<li>节点阶段性接入Intent</li>
<li>节点可能更换IP地址</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/04/计算机网络与因特网/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/04/计算机网络与因特网/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">计算机网络与因特网</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-04 19:31:43" itemprop="dateCreated datePublished" datetime="2018-06-04T19:31:43+08:00">2018-06-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-12 19:17:56" itemprop="dateModified" datetime="2018-06-12T19:17:56+08:00">2018-06-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/计算机网络/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/04/计算机网络与因特网/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/04/计算机网络与因特网/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/04/计算机网络与因特网/" class="leancloud_visitors" data-flag-title="计算机网络与因特网">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>计算机网络是一个自治的、互联的计算机集合。</p>
<h1 id="因特网"><a href="#因特网" class="headerlink" title="因特网"></a>因特网</h1><p>因特网是一个世界范围的计算机网络，是“网络的网络”。由十多个第一层<code>ISP(因特网服务提供商)</code>和数十万个底层ISP组成。ISP覆盖区域有所不同，有些跨越多个大洲和大洋，有些限于很小的地理区域。低层ISP与高层ISP互联，高层ISP彼此互联。</p>
<h2 id="端系统"><a href="#端系统" class="headerlink" title="端系统"></a>端系统</h2><p>所有连接到因特网的设备都称为<code>主机</code>或<code>端系统</code>。</p>
<p>端系统通过<code>通信链路</code>和<code>分组交换机</code>连接到一起。通俗的讲通信链路就是一条条光缆、网线等物理线路，不同的链路能以不同的速率传输数据，链路的传输速率单位为<code>bit/s或bps</code>，即<code>比特/秒</code>。端系统通过ISP接入因特网。</p>
<p>当一台端系统向另一台端系统发送数据时，发送端系统将数据将数据分段，并为每段加上首部字节。由此形成的信息包称为<code>分组</code>。这些分组通过网络发送到目的端系统，在那里被装配成初始数据。分组交换机从它的一条入通信链路接收到达的分组，并从它的一条出通信链路转发该分组。目前最出名的两种分组交换机类型是<code>路由器</code>和<code>链路层交换机</code>。这两种类型的交换机朝着最终的目的地转发分组。链路层交换机常用于接入网中，而路由器常用于网络核心中。从发送端到接收端，一个分组所经历的一系列通信链路和分组交换机称为通过该网络的<code>路径</code>。</p>
<p>与因特网相连的端系统提供了<code>应用程序编程接口(API)</code>,该API规定了运行在一个端系统上的软件请求因特网基础设施向运行在另一个端系统上的特定目的地软件交付数据的方式。因特网API是一套发送软件必须遵循的规则集合。类似于我们在寄信的时候需要遵邮局的规定贴上邮票、写上邮政编码等，这些规定就是API。</p>
<h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>端系统、分组交换机和其他因特网部件要运行一系列协议，这些协议控制因特网中信息的接受和发送。<code>TCP(Transmission Control Protocol 控制传输协议)</code>和<code>IP(Internet Protocol 网际协议)</code>是因特网中最重要的两个协议。IP协议定义在路由器和端系统之间发送和接受的分组格式。因特网统称协议为<code>TCP/IP</code>。</p>
<p>一个协议定义了在两个或多个通信实体间交换的报文格式和次序，以及报文发送或接受一条报文或其他事件时所采取的动作。</p>
<h2 id="网络边缘"><a href="#网络边缘" class="headerlink" title="网络边缘"></a>网络边缘</h2><p>常把与因特网相连的设备称为端系统，因为它们位于网络的边缘。将端系统连接到其<code>边缘路由器</code>的物理链路称为<code>接入网</code>。<code>边缘路由器</code>是端系统到任何其他远程系统的路径上的第一台路由器。<br>除了端系统外，<code>网络应用</code>也处于网络边缘。网络应用通常有两种结构：</p>
<ul>
<li>客户——服务器结构（Client-Server）。常见的Web应用都是这种结构。这种应用的特点是客户只与服务器进行交互，只有客户可以主动发起连接。<strong>客户与客户之间是互不可见的</strong></li>
<li>P2P结构（点对点结构）。这种结构是对等的，不存在客户和服务器的概念。各个端点之间可以直接互相访问。例子有文件共享服务如bt下载，所以才会有<strong>越多人下载速度越快</strong>的说法</li>
</ul>
<h3 id="家庭接入"><a href="#家庭接入" class="headerlink" title="家庭接入"></a>家庭接入</h3><p>当前宽带住宅接入有两种流行类型：</p>
<ul>
<li>数字用户线(Digital Subscriber Line，DSL)。即常说的拨号上网。利用DSL调制解调器将到达家庭的数据信号和电话信号分隔开（ADSL是非对称接入，即上行与下行速率是不同的，通常下行更快）</li>
<li>电缆（HFC,混合光纤同轴电缆网）。通过有线电视网络进行传输，用cable modem（即“猫”）将电视信号与网络信号分开。这也是非对称的，下行通常到30Mbts，上行为2Mbps</li>
<li>光纤到户。本地中心局直接提供了一条光纤线路到家庭。</li>
<li>LAN无限局域网。在公司、大学和越来越多的家庭环境中，通常是用局域网(LAN)将端系统连接到边缘路由器。尽管有多种不同的局域网技术，但<code>以太网</code>是目前最流行的接入技术。在无线LAN环境中，无线用户从一个接入点发送/接受分租，接入点与企业网连接，该企业网再与有线因特网相连，这就是wifi。可达54Mbps</li>
<li>蜂窝网。蜂窝网也属于无线接入。所谓3G网4G网都属于蜂窝网。</li>
</ul>
<h2 id="网络核心"><a href="#网络核心" class="headerlink" title="网络核心"></a>网络核心</h2><p><code>网络核心</code>即互联因特网端系统的分组交换机和链路构成的网状网络。</p>
<p>网络核心的关键功能是<code>路由</code>+<code>转发</code>。<code>路由</code>即确定分组从源到目的地的路径。</p>
<h3 id="存储转发传输"><a href="#存储转发传输" class="headerlink" title="存储转发传输"></a>存储转发传输</h3><p>多数分组交换机在链路的输入端用<code>存储转发传输机制</code>：交换机能够在开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组。由此存在<code>存储转发延时</code>：如果某源端系统或分组交换机经过一条链路发送一个L比特的分组，链路的传输速率为R bit/s，则分组在这条链路上的传输时间为L/R秒。</p>
<h3 id="排队延时和丢包"><a href="#排队延时和丢包" class="headerlink" title="排队延时和丢包"></a>排队延时和丢包</h3><p>每个分组交换机有多条链路与之相连。对于每条相连的链路，该分组交换机有一个<code>输出缓存</code>用于存储路由器准备发往那条链路的分组。如果到达的分组需要传输到某天链路但发现该链路正忙于传输其他分组，该到达分组必须在输出缓存中等待，由此分组又存在<code>排队延时</code>。缓存空间是有限的，一个到达的分组可能发现该缓存已满，此时会发生<code>丢包(分组丢失)</code>：到达的分组或正排队的分组之一会被丢弃。</p>
<h3 id="转发表和路由选择协议"><a href="#转发表和路由选择协议" class="headerlink" title="转发表和路由选择协议"></a>转发表和路由选择协议</h3><p>在因特网中，每个端系统具有一个被称为<code>IP地址</code>的地址。当源主机要向目的地端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。如同邮政地址那样，该地址具有一种等级结构。当一个分组到达网络中的路由器时，路由器检查该分组的目的地地址的一部分，并向一台相邻路由器转发该分组。更特别的是，每台路由器具有一个<code>转发表</code>，用于将目的地址映射为输出链路。当某分组到达一台路由器时，路由器检查该地址，并用这个目的地址搜索其转发表，以发行适当的出链路。路由器则将分组导向该出链路。</p>
<h2 id="分组交换时延"><a href="#分组交换时延" class="headerlink" title="分组交换时延"></a>分组交换时延</h2><p>分组从一个主机出发通过一系列路由器传输，在另一台主机中结束它的历程。这个过程是存在时延的。其中最为重要的几种时延是<code>节点处理时延</code>、<code>排队时延</code>、<code>传输时延</code>、<code>传播时延</code>。这些延时加起来称为<code>节点总时延</code></p>
<ul>
<li>节点处理时延（nodal processing delay）。造成这部分时延的原因主要是检查分组首部（差错检测）和决定将该分组导向何处（确定输出链路）</li>
<li>排队时延（queueing delay）。链路繁忙时新到达交换机的分组会进入排队状态。</li>
<li>传输时延（transmission delay）。仅当所有先到达的分组传输完毕后才能传输刚到达的分组。传输时延是将该分组的所有比特推向链路所需要的时间。L为分组长度，R为链路带宽，则传输时延为L/R</li>
<li>传播时延（propagation delay）。分组在链路上传播的时间称为传播时延。d为链路长度，v为传播速率，则传播时延为d/v</li>
</ul>
<p>传输时延与传播时延不同之处在于传输时延是分组从交换机到链路的时间，与分组的大小有关，与两台路由器之间的距离无关。而传播时延是分组在链接上传播消耗的时间，与分组大小无关，与距离有关。</p>
<h1 id="五层因特网协议栈"><a href="#五层因特网协议栈" class="headerlink" title="五层因特网协议栈"></a>五层因特网协议栈</h1><p>每层完成一类特定功能，底层为上层提供服务，相邻的两层通过<code>接口</code>进行交互</p>
<p>计算机网络体系结构是计算机网络各层及其协议的集合</p>
<ol>
<li>应用层。应用层是网络应用程序及他们的应用层协议存留的地方。HTTP、SMTP、FTP、DNS等都属于应用层协议。分组在应用层中称为<strong>报文</strong></li>
<li>运输层。运输层在应用程序端点之间传送应用层报文。在因特网中有两个运输协议<code>TCP</code>和<code>UDP</code>。分组在运输层中称为<code>报文段</code></li>
<li>网络层。网络层负责将报文段从一台主机转移到另一台主机。网络层接受运输层递交的报文段和目的地址，类似于寄信时要向邮局提供目标地址。著名的<code>IP协议</code>就在网络层。该协议定义了数据报中的各个字段及端系统和路由器如何作用于这些字段，已达到<code>寻址传输</code>的目的。分组在网络层称为<code>数据报</code></li>
<li>链路层。负责将网络层的IP数据包组装成帧（帧包含数据和必要的控制信息，例如信道编码，卷积码，turbo码）</li>
<li>物理层。物理层负责将帧一个比特一个比特地从一个节点移动到下一个节点。这一层的协议任然是和链路有关的，但是进一步与链路实体（如双通铜线、单模光缆）相关。传输数据为比特流，物理层需要定义比特传输的电气特性（多少电压代表1多少代表0）、机械特性（接口形状尺寸等），如RS-232、USB、Bluetooth等。而传输物理介质如光纤、双绞线等并不处于物理层的范畴</li>
</ol>
<p>下面是知乎一个有趣的例子：</p>
<blockquote>
<p>为了实现跨越互联网的，主机 A 的进程 P1，和主机 B 的进程 P2 之间的通信，我们逐层把这个任务交给 TCP/IP 协议栈。<br>运输层：“如果有人能帮我把数据从某个网络中的机器 A 搬到另一个网络中的机器 B，我就可以搞定这个任务，因为我知道不同的数据应该交给机器上的哪个进程。”<br>网络层：“如果有人能帮我把数据从局域网中直接相连的一台机器搬到另一台机器，我就可以把数据从一个网络搬到另一个网络，因为我知道路线怎么走，要经过哪些节点。”<br>链路层：“我知道怎样在局域网中搬数据，还能用 CSMA/CD 协议协调工作，还能用 CRC32 校验发送的数据和接收的数据是一致的，blabla… But，我只是说说，我不干苦力活。”<br>物理层：“楼上的大爷们发话了，兄弟们上。”</p>
</blockquote>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><p>数据在每一层都会被打上一个该层的附加信息（所谓运输首部信息）。而这些信息会在下一个节点的对应层被使用。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/03/《MySQL从入门到精通》之备份与恢复/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/03/《MySQL从入门到精通》之备份与恢复/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">MySQL之备份与恢复</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-03 19:35:59" itemprop="dateCreated datePublished" datetime="2018-06-03T19:35:59+08:00">2018-06-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-15 11:30:49" itemprop="dateModified" datetime="2018-06-15T11:30:49+08:00">2018-06-15</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/03/《MySQL从入门到精通》之备份与恢复/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/03/《MySQL从入门到精通》之备份与恢复/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/03/《MySQL从入门到精通》之备份与恢复/" class="leancloud_visitors" data-flag-title="MySQL之备份与恢复">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="使用mysqldump命令备份"><a href="#使用mysqldump命令备份" class="headerlink" title="使用mysqldump命令备份"></a>使用mysqldump命令备份</h1><p><code>mysqldump</code>命令可以将数据库中的数据备份成一个文本文件。表的结构和表中的数据将存储在生成的文本文件中。</p>
<p>mysqldump的工作原理就是查出需要备份的数据库和表的结构，然后在文本文件中生成相应的<code>create</code>和<code>insert</code>语句。需要导入数据库文件时mysql通过使用文本文件中记录的语句生成相应的数据库和表就可以了。</p>
<p>使用<code>mysqldump</code>命令进行数据备份时，经常分为以下3种形式：</p>
<ol>
<li>备份一个数据库</li>
<li>备份多个数据库</li>
<li>备份所有数据库</li>
</ol>
<p>下面分别介绍：</p>
<h2 id="备份一个数据库"><a href="#备份一个数据库" class="headerlink" title="备份一个数据库"></a>备份一个数据库</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u username -p dbname table1 table2 ... &gt; filename</span><br></pre></td></tr></table></figure>
<p>dbname为数据库名。table1、table2为表名，没有该参数时将备份整个数据库。filename为文本文件名称，通常使用<code>.sql</code>作为后缀。</p>
<p>备份数据库users中的studnets表到D盘sql文件夹下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p users  students &gt; D:\sql\students.sql</span><br></pre></td></tr></table></figure></p>
<h2 id="备份多个数据库"><a href="#备份多个数据库" class="headerlink" title="备份多个数据库"></a>备份多个数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u username -p --databeses dbname1 dbname2 &gt; filename</span><br></pre></td></tr></table></figure>
<p>加上<code>databases</code>选项，后面跟多个数据库名称</p>
<p>备份数据库users、customers到D盘：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p --databeses users customers &gt; data.sql</span><br></pre></td></tr></table></figure></p>
<h2 id="备份所有数据库"><a href="#备份所有数据库" class="headerlink" title="备份所有数据库"></a>备份所有数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p --all --databases &gt; filename</span><br></pre></td></tr></table></figure>
<h1 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h1><p>使用<code>mysql</code>命令进行还原：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p [dbname] &lt; filename</span><br></pre></td></tr></table></figure></p>
<p>dbname表示数据库名称，该参数是可选的。指定数据库名称时，表示还原该数据库下的表，不指定时表示还原数据库。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/03/《MySQL从入门到精通》之事件与优化/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/03/《MySQL从入门到精通》之事件与优化/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">MySQL之事务与优化</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-06-03 15:03:41" itemprop="dateCreated datePublished" datetime="2018-06-03T15:03:41+08:00">2018-06-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-11-18 12:17:13" itemprop="dateModified" datetime="2018-11-18T12:17:13+08:00">2018-11-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/03/《MySQL从入门到精通》之事件与优化/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/06/03/《MySQL从入门到精通》之事件与优化/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/06/03/《MySQL从入门到精通》之事件与优化/" class="leancloud_visitors" data-flag-title="MySQL之事务与优化">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事务概述"><a href="#事务概述" class="headerlink" title="事务概述"></a>事务概述</h1><p>在MySQL中，事务由一条或多条SQL语句组成，在这个事务中，每条MySQL语句是相互依赖的。而整个事务作为一个不可分割的整体，一旦某条MySQL语句执行失败或产生错误，整个事务将会回滚。</p>
<p>只有<code>InnoDB</code>类型的表支持事务。MySQL默认表类型为<code>InnoDB</code>。</p>
<h2 id="事务的基本要素-ACID"><a href="#事务的基本要素-ACID" class="headerlink" title="事务的基本要素(ACID)"></a>事务的基本要素(ACID)</h2><ol>
<li>原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。</li>
<li>一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。</li>
<li>孤立性（Isolation）：每个事务在自己的空间内执行，与其他事务隔离，而且事务的结果只有在它被完全执行时才能看到。这样即使一个系统同时发生多个事物，孤立性也可以保证特定的事务在完成之前其结果不被公布。</li>
<li>持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</li>
</ol>
<h2 id="事务的创建与存在周期"><a href="#事务的创建与存在周期" class="headerlink" title="事务的创建与存在周期"></a>事务的创建与存在周期</h2><p>创建事务的一般过程是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">初始化事务 ————&gt; 创建事务 ————&gt; 提交或回滚</span><br></pre></td></tr></table></figure></p>
<p><strong>无论最后是提交还是回滚，都会关闭这个事务</strong>。  </p>
<ul>
<li>初始化事务：<code>start transaction;</code>或<code>begin;</code>，MySQL默认是<strong>自动提交</strong>的，所以需要用命令改为手动模式</li>
<li>创建事务：执行SQL语句</li>
<li>提交或回滚： 提交<code>commit;</code>，回滚<code>rollback;</code></li>
</ul>
<h2 id="事务的并发问题"><a href="#事务的并发问题" class="headerlink" title="事务的并发问题"></a>事务的并发问题</h2><ol>
<li>脏读：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据</li>
<li>不可重复读：事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。</li>
<li>幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。</li>
</ol>
<p>小结：不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表</p>
<h2 id="事务的孤立性等级"><a href="#事务的孤立性等级" class="headerlink" title="事务的孤立性等级"></a>事务的孤立性等级</h2><p>事务具有孤立的空间，在MySQL服务器中，用户通过不同的会话执行不同的事务，在多用户环境中，许多RDBMS(关系型数据库管理系统)会话在任意时刻都是活动的。为了使这些事务互不影响，保证数据库性能不受影响，采用事务的孤立等级是很重要的。</p>
<p>如果没有孤立性，不同的<code>select</code>会在同一事务的环境中检索到不同的结果，这将导致数据的不一致性。</p>
<ol>
<li>序列化(serializable)：以序列的形式对事务进行处理。该孤立级的特定是只有当事务提交后，用户才能从数据库上查看数据的变化。。</li>
<li>可重读(repeatale read)：对应于程序的安全性做出部分妥协，以提高性能。事务在孤立级上不会被看成一个序列，不过在当前执行的事务过程中，用户依然看不到事务的过程。直到事务提交为止，用户才能看到事务的变化结果。（客户端A、B同时开启事务，B向表中插入数据行，A在提交事务前是看不到改变的）</li>
<li>读已提交(read committed)：该孤立级的安全性比可重读低。在这一级事务用户可以看到其他事务添加到新纪录。在事务处理时如果存在其他用户同时对事务的相应表进行修改那么在同一事务的不同时间内，select语句可能返回不同的结果(客户端A、B同时开启事务，B向表中插入数据行且提交后，A可以看到改变)</li>
<li>读未提交(read uncommitted)：该孤立级提供事务之间最小程度间隔，该孤立级容易产生幻读。其他用户可以在该孤立级上看到未提交的事务。(客户端A、B同时开启事务，B向表中插入数据行且未提交，A也可以看到改变)</li>
</ol>
<table>
<thead>
<tr>
<th>孤立等级</th>
<th style="text-align:center">脏读</th>
<th style="text-align:right">不可重复读</th>
<th style="text-align:right">幻读 </th>
</tr>
</thead>
<tbody>
<tr>
<td>序列化</td>
<td style="text-align:center">否</td>
<td style="text-align:right">否</td>
<td style="text-align:right">否  </td>
</tr>
<tr>
<td>可重读</td>
<td style="text-align:center">否</td>
<td style="text-align:right">否</td>
<td style="text-align:right">是 </td>
</tr>
<tr>
<td>读已提交</td>
<td style="text-align:center">否</td>
<td style="text-align:right">是</td>
<td style="text-align:right">是</td>
</tr>
<tr>
<td>读未提交</td>
<td style="text-align:center">是</td>
<td style="text-align:right">是</td>
<td style="text-align:right">是</td>
</tr>
</tbody>
</table>
<h3 id="修改事务孤立级："><a href="#修改事务孤立级：" class="headerlink" title="修改事务孤立级："></a>修改事务孤立级：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> ...;</span><br></pre></td></tr></table></figure>
<h2 id="事务的性能"><a href="#事务的性能" class="headerlink" title="事务的性能"></a>事务的性能</h2><h3 id="应用小事务"><a href="#应用小事务" class="headerlink" title="应用小事务"></a>应用小事务</h3><p>应用小事务的意义在于保证每个事务不会在执行前等待很长时间，从而避免各个事务因为互相等待而导致系统性能大幅度下降。应尽量缩短<code>insert</code>、<code>update</code>等操作与<code>commit</code>之间的间隔时间。</p>
<h3 id="合适的孤立级"><a href="#合适的孤立级" class="headerlink" title="合适的孤立级"></a>合适的孤立级</h3><p>事务的性能与其对服务器产生的负载成反比，即事务孤立级越高，其性能越低。例如序列化虽然很稳定，但是会大大影响MySQL的性能，生产中比较少用，而用乐观锁悲观锁解决幻读等问题</p>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>当两个或多个处于不同序列的用户打算同时更新某相同数据库时，因互相等待对方释放权限而导致双方一直处于等待状态。两个不同序列的客户端同时对数据执行操作极有可能产生死锁。更通俗地讲，当两个事物相互等待操作对方释放所持有的资源而导致两个事务都无法操作对方持有的资源，这样无限期的等待称为死锁。</p>
<p>InnoDB具有检查死锁的功能。如果发现产生了死锁，InnoDB会立刻撤销其中一个任务以便死锁消失。这样就可以使另一个事务获取对方所占有的资源而执行操作逻辑。</p>
<h1 id="优化数据库"><a href="#优化数据库" class="headerlink" title="优化数据库"></a>优化数据库</h1><ol>
<li><p>使用索引.<strong>对于新表可以先不创建索引，等数据导入后在创建，这样可以提高数据导入效率</strong>。一般来说，索引应建立在那些将用于JOIN,WHERE判断和ORDERBY排序的字段上。尽量不要对数据库中某个含有大量重复的值的字段建立索引。对于一个ENUM类型的字段来说，出现大量重复值是很有可能的情况</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">add</span> <span class="keyword">unique</span> <span class="keyword">name</span> (username);</span><br></pre></td></tr></table></figure>
</li>
<li><p>尽量少用<code>like</code>语句与通配符<code>%</code></p>
</li>
<li>选取最合适的字段大小<br>表越小，速度越快。所以能用<code>char</code>就不要用<code>varchar</code>，能用<code>mediumint</code>就不用<code>bigint</code>。<strong>尽量使用<code>not null</code>这样在查询时数据库不用去比较null值。</strong></li>
<li>用<code>join</code>代替子查询,这样MySQL不需要在内存中创建临时表来完成逻辑上的需要两个步骤的查询工作。。</li>
<li>优化insert语句。一次插入多条数据比每次插入一条数据快。能用<code>union</code>将多条<code>select</code>结合就不要单独用多次<code>select</code></li>
<li><p>使用事务。我们可以使用子查询（Sub-Queries）、连接（JOIN）和联合（UNION）来创建各种各样的查询，但不是所有的数据库操作都可以只用一条或少数几条SQL语句就可以完成的。更多的时候是需要用到一系列的语句来完成某种工作。但是在这种情况下，当这个语句块中的某一条语句运行出错的时候，整个语句块的操作就会变得不确定起来。这时候就要用到事务。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>; </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'Mike'</span>); </span><br><span class="line"><span class="keyword">UPDATE</span> inventory <span class="keyword">SET</span> Quantity=<span class="number">11</span> <span class="keyword">WHERE</span> item=<span class="string">'book'</span>; </span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用外键分解表中低频字段。有些字段的使用频率很低，当表的数据量很大时查询速度会很慢。用<code>外键</code>将这些字段拆分成一个单独的表可以提高效率。</p>
</li>
<li>在相同类型的字段间进行比较的操作</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/30/mysql定义完整性约束/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/30/mysql定义完整性约束/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">MySQL之完整性约束</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-05-30 20:19:42" itemprop="dateCreated datePublished" datetime="2018-05-30T20:19:42+08:00">2018-05-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-06-18 20:03:32" itemprop="dateModified" datetime="2018-06-18T20:03:32+08:00">2018-06-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/30/mysql定义完整性约束/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/05/30/mysql定义完整性约束/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/05/30/mysql定义完整性约束/" class="leancloud_visitors" data-flag-title="MySQL之完整性约束">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MySQL提供了多种完整性约束，作为数据库关系模式定义的一部分，可以通过<code>create table</code>或<code>alter table</code>语句来定义。一旦定义了完整性约束，MySQL服务器会随时检测处于更新状态的数据库内容是否符合相关的完整性约束，从而保证数据的一致性与正确性。</p>
<p>在关系模型中，提供了实体完整性、参照完整性和用户完整性3项规则。</p>
<h1 id="实体完整性"><a href="#实体完整性" class="headerlink" title="实体完整性"></a>实体完整性</h1><p><code>实体</code>是一个数据对象，是指客观存在并可以相互区分的事物，如一个教师、一个学生等。一个实体在数据库中表现为一条记录。</p>
<p>实体完整性是指关系的主属性及主键的组成不能为空。也就是主键不能使空值null。关系对应于现实世界的实体集，而现实世界的实体是可以区分的，即说明每个实例具有唯一性标识。在关系模型中，是使用主键作为唯一性标识的。</p>
<p>先来认识一下关系型数据库中重要的三个键：</p>
<ul>
<li>超键(super key):在关系中能唯一标识元组的属性集称为关系模式的超键 </li>
<li>候选键(candidate key):不含有多余属性的超键称为候选键 </li>
<li>主键(primary key):用户选作元组标识的一个候选键程序主键</li>
</ul>
<p>在MySQL中，实体完整性是通过<em>主键约束</em>和<em>候选键约束</em>实现的。</p>
<h2 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h2><p>主键可以是表中的某一列，也可以是表中多个列所构成的一个组合。其中多个列组合而成的主键也被称为复合主键。在MySQL中，主键必须遵循如下规则：</p>
<ol>
<li>每个表只能定义一个主键</li>
<li>主键必须能唯一标识表中的每一行记录并且不能为null</li>
<li>复合主键不能包含不必要的多余列</li>
<li>一个列名在复合主键的列表中只能出现一次</li>
</ol>
<h3 id="作为列的主键约束"><a href="#作为列的主键约束" class="headerlink" title="作为列的主键约束"></a>作为列的主键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="作为表的主键约束"><a href="#作为表的主键约束" class="headerlink" title="作为表的主键约束"></a>作为表的主键约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    primary <span class="keyword">key</span> (<span class="keyword">id</span>,<span class="keyword">name</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>如果主键仅由表中的某一列构成，以上两种方法均可以定义主键。如果主键由表中多个列组成，那么只能有第二种方法定义主键约束。</strong></p>
<h2 id="候选键约束"><a href="#候选键约束" class="headerlink" title="候选键约束"></a>候选键约束</h2><p>如果一个属性集能<strong>唯一标识元组</strong>而又<strong>不含有多余的属性</strong>，那么这个属性集称为关系的候选键，用关键字<code>unique</code>来定义。</p>
<p>候选键可以是表中的某一列，也可以是表中多个列所构成的一个组合。<strong>任何时候，候选键的值必须是唯一的且不能为空</strong>。定义方法类似于主键：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">unique</span>,</span><br><span class="line">    age tinyint</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    <span class="keyword">unique</span> (<span class="keyword">name</span>,age)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>候选键与主键的区别在于：</p>
<ol>
<li>一个表只能创建一个主键，但是可以有多个候选键</li>
<li>定义主键约束时，系统会自动创建<code>primary key</code>索引，定义候选键约束时，系统会自动创建<code>unique</code>索引</li>
</ol>
<h1 id="参照完整性"><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h1><p>现实世界的实体之间往往存在着某种联系，在关系模型中，实体及实体间的联系都是用关系来描述的，那么自然就存在关系与关系间的引用。</p>
<p><strong>参照完整性就是定义外键与主键之间的引用关系</strong>的。参照完整性的定义为：</p>
<blockquote>
<p>若属性（或属性组）F是基本关系R的外键，它与基本关系S的主键K对应，则对于R中的每个元组在F上的值只允许两种可能：要么取空值，要么等于S中某个元组的主键值，其中R与S可以是不同的关系，也可以是同一是关系，而F和K定义在同一个域中。</p>
</blockquote>
<p>声明外键的基本语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[constraint [symbol]] foreign key (index_col_name,...) reference_defination</span><br></pre></td></tr></table></figure></p>
<p><code>reference_defination</code>主要用于定义外键所参照的表、列，它的基本语法格式如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">references tbl_name [(index_col_name,...)]</span><br><span class="line">[match full | match pratial | match simple]</span><br><span class="line">[on <span class="keyword">delete</span> reference_options]</span><br><span class="line">[<span class="keyword">on</span> <span class="keyword">update</span> reference_options]</span><br></pre></td></tr></table></figure></p>
<p><code>tbl_name</code>指定外键所参照的表名，这个表称为<code>被参照表</code>或<code>父表</code>，外键所在的表被称为<code>参照表</code>或<code>子表</code>。 </p>
<p><code>index_col_name</code>指定被参照表中与外键相关联的列，<strong>必须是父表的主键或候选键</strong>，格式语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">col_name [(length)] [ASC|DESC]</span><br></pre></td></tr></table></figure></p>
<p><code>reference_options</code>指定参照完整性约束的实现策略，默认为<code>restrict</code>。语法格式如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restrict | cascade | <span class="keyword">set</span> <span class="literal">null</span> | <span class="keyword">no</span> <span class="keyword">action</span></span><br></pre></td></tr></table></figure></p>
<p>cascade：瀑布、级联</p>
<ul>
<li>restrict 限制策略：当要删除或更新被参照表中被参照列上，并在外键中出现的值时，系统拒绝对被参照表的删除和更新</li>
<li>no action 不采取措施策略：一个相关的外键值在被参照表中时，删除或更新被参照表中的键值动作不被允许。类似于restrict</li>
<li>cascade 级联策略：从被参照表中删除或更新纪录行时，自动删除或更新参照表匹配的记录行</li>
<li>set null 制空策略：从被参照表中删除或更新纪录行时，设置参照表中与之对应的外键列的值为null。这个策略需要被参照表中的外键没有声明限定词not null</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    class_id tinyint <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">constraint</span> <span class="keyword">class</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (class_id) <span class="keyword">references</span> <span class="keyword">class</span>(<span class="keyword">id</span>)</span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span></span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">cascade</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>当父子表是同一张表时，MySQL不允许指定<code>on update cascade</code>与<code>on update set null</code></strong>，相关联的两个字段类型必须一致。</p>
<h1 id="用户定义完整性"><a href="#用户定义完整性" class="headerlink" title="用户定义完整性"></a>用户定义完整性</h1><p>用户定义完整性是针对某一应用环境的完整性约束条件，它反映了某一具体应用所涉及的数据应满足的要求，关系模型提供定义和检查这类完整性规则的机制。</p>
<p>MySQL提供了<strong>非空约束</strong>，<strong>check约束</strong>和<strong>触发器</strong>3种用户自定义完整性约束。</p>
<h2 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h2><p>通过<code>create table</code>或<code>alter table</code>语句将某个列加上关键字<code>not null</code>可以实现非空约束。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">modify</span> age tinyint <span class="keyword">not</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="check约束"><a href="#check约束" class="headerlink" title="check约束"></a>check约束</h2><p>可以对列或表使用<code>check</code>约束，语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">check</span> (expr)</span><br></pre></td></tr></table></figure></p>
<p><code>expr</code>是一个SQL表达式，用于指定需要检查的限定条件。更新数据时MySQL会检查更新后的数据行是否满足<code>check</code>约束中的限定条件。该条件可以是表达式，也可以是子查询。</p>
<h3 id="对列使用check约束"><a href="#对列使用check约束" class="headerlink" title="对列使用check约束"></a>对列使用check约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age tinyint <span class="keyword">check</span>(age&gt;<span class="number">6</span> <span class="keyword">and</span> age&lt;<span class="number">19</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="对表使用check约束"><a href="#对表使用check约束" class="headerlink" title="对表使用check约束"></a>对表使用check约束</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    <span class="keyword">check</span>(<span class="keyword">name</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> students))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="触发器约束"><a href="#触发器约束" class="headerlink" title="触发器约束"></a>触发器约束</h2><p>触发器由MySQL的基本命令事件来触发的某种特定操作，这些基本的命令有<code>insert</code>、<code>update</code>、<code>delete</code>等事件来触发某些特定的操作。满足触发器的触发条件时，数据库系统会自动执行触发器中定义的程序语句。</p>
<h3 id="创建单行触发器"><a href="#创建单行触发器" class="headerlink" title="创建单行触发器"></a>创建单行触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器名 <span class="keyword">before</span>|<span class="keyword">after</span> 触发事件</span><br><span class="line"><span class="keyword">on</span> 表名 <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> 执行语句;</span><br></pre></td></tr></table></figure>
<ul>
<li>before|after 指定触发器执行时间是在触发事件之前还是之后</li>
<li>触发事件 <code>insert</code>、<code>delete</code>、<code>update</code>等都是触发事件</li>
<li>执行语句 当满足条件时执行的触发器语句</li>
</ul>
<p>创建一个触发器，自动在用户向users表插入数据行之前向日志插入当前时间：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> userstime <span class="keyword">before</span> <span class="keyword">insert</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">users</span> <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> userslog <span class="keyword">values</span> (<span class="literal">null</span>, <span class="keyword">now</span>());</span><br></pre></td></tr></table></figure></p>
<h3 id="创建多行触发器"><a href="#创建多行触发器" class="headerlink" title="创建多行触发器"></a>创建多行触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器名称 <span class="keyword">before</span>|<span class="keyword">after</span> 触发事件</span><br><span class="line"><span class="keyword">on</span> 表名 <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">执行语句列表</span><br><span class="line"><span class="keyword">end</span>\g</span><br></pre></td></tr></table></figure>
<p>要执行的多条语句放入<code>begin</code>和<code>end</code>中，用<code>;</code>分隔。</p>
<h3 id="查看触发器："><a href="#查看触发器：" class="headerlink" title="查看触发器："></a>查看触发器：</h3><p>查看所有触发器：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">triggers</span>;</span><br></pre></td></tr></table></figure></p>
<p>根据名字查看触发器：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> infomation_schema.triggers <span class="keyword">where</span> trigger_name=触发器名;</span><br></pre></td></tr></table></figure></p>
<h3 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> 触发器名称;</span><br></pre></td></tr></table></figure>
<h1 id="命名完整性约束"><a href="#命名完整性约束" class="headerlink" title="命名完整性约束"></a>命名完整性约束</h1><p>可以对完整性使用添加，删除和修改等操作。为了删除和修改完整性约束，需要在定义约束的同时对其进行命名。命名完整性约束是在各种完整性约束的定义说明之前加上<code>constraint</code>字句实现的：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">constraint &lt;symbol&gt; [primary key | foreign key | check]</span><br></pre></td></tr></table></figure></p>
<p>对users表添加外键约束并命名为class：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">add</span> <span class="keyword">constraint</span> <span class="keyword">class</span> <span class="keyword">foreign</span> <span class="keyword">key</span> (class_id)</span><br><span class="line"><span class="keyword">references</span> <span class="keyword">class</span>(<span class="keyword">id</span>)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">cascade</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="更新完整性约束"><a href="#更新完整性约束" class="headerlink" title="更新完整性约束"></a>更新完整性约束</h1><p>对各种约束命名后就可以用<code>alter table</code>语句来更新或删除。</p>
<h2 id="删除完整性约束"><a href="#删除完整性约束" class="headerlink" title="删除完整性约束"></a>删除完整性约束</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> [<span class="keyword">foreign</span> <span class="keyword">key</span> | <span class="keyword">index</span> | &lt;symbol&gt;] | primary <span class="keyword">key</span>;</span><br></pre></td></tr></table></figure>
<p>在删除主键时，必须在创建一个主键否则不会成功。</p>
<p>删除users表的名为class的外键：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">users</span> <span class="keyword">drop</span> <span class="keyword">foreign</span> <span class="keyword">key</span> <span class="keyword">class</span>;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/30/《MySQL从入门到精通》之索引与视图/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="博主">
      <meta itemprop="description" content="高山仰止，景行行止。虽不能至，心向往之。">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="精神的壳">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/30/《MySQL从入门到精通》之索引与视图/" class="post-title-link" itemprop="http://yoursite.com/page/2/index.html">MySQL之索引与范式</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建于：2018-05-30 18:33:48" itemprop="dateCreated datePublished" datetime="2018-05-30T18:33:48+08:00">2018-05-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="更新于：2018-11-18 12:14:49" itemprop="dateModified" datetime="2018-11-18T12:14:49+08:00">2018-11-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/30/《MySQL从入门到精通》之索引与视图/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments：</span> <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2018/05/30/《MySQL从入门到精通》之索引与视图/" itemprop="commentCount">0</span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/05/30/《MySQL从入门到精通》之索引与视图/" class="leancloud_visitors" data-flag-title="MySQL之索引与范式">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引是一种特殊的数据结构，类似于字典里的<code>key</code>。通过索引查询数据库中的内容时，不需要遍历所有数据而是直接指向数据所在的位置，这样就可以快速查询到想要的内容。</p>
<p>索引是把双刃剑，虽然索引可以提高检索数据的速度，提高整体的性能，但是也会带来一些副作用：  </p>
<ol>
<li>额外的物理空间（单列索引至少占原表5%到15%）</li>
<li>额外的创建和维护时间（create、insert、update、delete等）</li>
</ol>
<p>MySQL支持很多数据类型，选择合适的数据类型存储数据对性能有很大的影响。通常来说，可以遵循以下一些指导原则：</p>
<ol>
<li>越小的数据类型通常更好：越小的数据类型通常在磁盘、内存和CPU缓存中都需要更少的空间，处理起来更快。</li>
<li>简单的数据类型更好：整型数据比起字符，处理开销更小，因为字符串的比较更复杂。在MySQL中，应该用内置的日期和时间数据类型，而不是用字符串来存储时间；以及用整型数据类型存储IP地址。</li>
<li>尽量避免NULL：应该指定列为NOT NULL，除非你想存储NULL。在MySQL中，含有空值的列很难进行查询优化，因为它们使得索引、索引的统计信息以及比较运算更加复杂。你应该用0、一个特殊的值或者一个空串代替空值。</li>
</ol>
<h2 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h2><p>常见的索引包括普通索引、唯一性索引、全文索引、单列索引、多列索引等</p>
<ol>
<li>普通索引<br>即不应用任何限制条件的索引，该索引可以在任何数据类型中创建。字段本身的约束条件可以判断其值是否为空或唯一。</li>
<li>唯一性索引<br>使用<code>unique</code>参数可以设置唯一索引。创建该索引时索引的值必须唯一。通过唯一索引，用户可以快速定位某条数据。<strong>主键是一种特殊的唯一索引</strong>。</li>
<li>全文索引<br><code>fulltext</code>参数可以设置索引为全文索引。全文索引只能创建在<code>char</code>、<code>varchar</code>、<code>text</code>类型字段上。查询数据量较大的字符串型字段时，使用全文索引可以提高查询速度。<strong>只有MyISAM支持<code>fulltext</code>索引</strong></li>
<li>单列索引<br>就是只对应一个字段的索引，可以包括以上三种索引方式。</li>
<li>多列索引<br>在表的多个字段上创建一个索引。该索引指向创建时对应的多个字段。可用通过这几个字段进行查询但是<strong>这几个字段必须包含多列索引的第一个字段，只有这样多列索引才会发挥作用</strong></li>
</ol>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><h3 id="在建立数据表时创建索引"><a href="#在建立数据表时创建索引" class="headerlink" title="在建立数据表时创建索引"></a>在建立数据表时创建索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_name (</span><br><span class="line">    create_defination</span><br><span class="line">    [<span class="keyword">unique</span> | fulltext] <span class="keyword">index</span></span><br><span class="line">    [别名](属性名<span class="number">1</span>[(长度)[,属性名<span class="number">2</span>(长度)...]] [<span class="keyword">ASC</span>|<span class="keyword">DESC</span>])</span><br><span class="line">)[table_options];</span><br></pre></td></tr></table></figure>
<p>一个简单的例子：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span> (</span><br><span class="line">    <span class="keyword">id</span> tinyint auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    sex tinyint(<span class="number">1</span>),</span><br><span class="line">    fulltext <span class="keyword">index</span> username(<span class="keyword">name</span>)</span><br><span class="line">)<span class="keyword">engine</span>=MyISAM;</span><br></pre></td></tr></table></figure></p>
<h3 id="在已建立的数据表中创建索引"><a href="#在已建立的数据表中创建索引" class="headerlink" title="在已建立的数据表中创建索引"></a>在已建立的数据表中创建索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span> | fulltext] <span class="keyword">index</span> index_name </span><br><span class="line"><span class="keyword">on</span> table_name(属性[(长度) [AES|<span class="keyword">DESC</span>]])</span><br></pre></td></tr></table></figure>
<p>一个简单的例子：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> <span class="keyword">index</span> username <span class="keyword">on</span> <span class="keyword">users</span>(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<p>也可以通过修改表结构的方式创建索引，参见《MySQL从入门到精通》之基本语句。</p>
<h1 id="范式-Normal-Form"><a href="#范式-Normal-Form" class="headerlink" title="范式(Normal Form)"></a>范式(Normal Form)</h1><p>关系型数据库的规范化理论为：关系数据库中的每一个关系都要满足一定的规范。根据满足规范的条件不同，可以分为5个等级，一般只要把数据库规范到第三等级就足够了。</p>
<h2 id="第一范式-1NF"><a href="#第一范式-1NF" class="headerlink" title="第一范式(1NF)"></a>第一范式(1NF)</h2><p>第一范式包括下列指导原则：</p>
<ol>
<li>数据组中的每个属性只可以包含一个值</li>
<li>关系中的每个数组必须包含相同数量的值</li>
<li>关系中的每个数组一定不能相同</li>
</ol>
<p>在任何一个关系型数据库中，第一范式是对关系模式的基本要求，不满足第一范式的数据库就不是关系型数据库。  </p>
<p><strong>如果数据表中的每一个列都是不可再分割的基本数据项，即同一列中不能有多个值，那么就称此数据表符合第一范式</strong>，由此可见第一范式具有不可再分割的原子特性。</p>
<h2 id="第二范式-2NF"><a href="#第二范式-2NF" class="headerlink" title="第二范式(2NF)"></a>第二范式(2NF)</h2><p>第二范式是在第一范式的基础上建立起来的，即满足第二范式必须先满足第一范式。<strong>第二范式要求数据库表中的每个实体（即各个记录行）必须可以被唯一地区分</strong>。 为了实现区分各记录行通常需要为表设置一个“区分列”，用以存储各个实体的唯一标识。这个唯一属性列被称为<strong>主关键字或主键。</strong></p>
<h2 id="第三范式-3NF"><a href="#第三范式-3NF" class="headerlink" title="第三范式(3NF)"></a>第三范式(3NF)</h2><p>第三范式是在第二范式的基础上建立起来的。<strong>第三范式要求关系表不存在非关键字列对任意候选关键字列的传递函数依赖</strong>，也就是说，第三范式要求一个关系表中不包含已在其他表中包含的非主关键字信息。<br>所谓传递函数依赖，就是指如果存在关键字段A决定非关键字段B，而非关键字段B决定非关键字段C，则称非关键字段C传递函数依赖与关键字段A。参考下面的例子：  </p>
<blockquote>
<p>(员工编码) ——&gt; (决定) (员工姓名、年龄、部门编码、部门经理)  </p>
</blockquote>
<p>上面这个关系表是符合第二范式的，但是不符合第三范式，因为该关系表内部隐含着如下关系：   </p>
<blockquote>
<p>(员工编码) ——&gt; (决定) (部门编码) ——&gt; (决定) (部门经理)  </p>
</blockquote>
<p>上面的关系表纯真非关键字段“部门经理”对关键字段“员工编码”的函数传递依赖，对于上面这种关系，可以把这个关系表改为如下两个关系表：  </p>
<blockquote>
<p>员工信息表：(员工编码，员工姓名，年龄好部门编码)<br>部门信息表：(部门编码和部门经理)  </p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">博主</p>
              <p class="site-description motion-element" itemprop="description">高山仰止，景行行止。虽不能至，心向往之。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-[object Object]"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">路边的土豆</span>

  
</div>


<div class="powered-by">
  Hosted by  
  <a class="theme-link" href="https://pages.coding.me">
    Coding Pages
  </a>   
</div>
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  

  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { "$in": entries } }) })
        .done(function ({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log("LeanCloud Counter Error: " + responseJSON.code + " " + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "aMaKMjBVPa5XOf0bdfaeqpy5-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "aMaKMjBVPa5XOf0bdfaeqpy5-gzGzoHsz",
                'X-LC-Key': "NUE5wMDsMaQAeYjT5C9KmT3s",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          if ($('.post-title-link').length >= 1) {
            showTime(Counter);
          }
          
        })
    });
  </script>



  

  

  

  

  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

  

  

  

</body>
</html>
